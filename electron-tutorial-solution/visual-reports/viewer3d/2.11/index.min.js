function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function getGlobal(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:global}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e){return String.fromCharCode(255&e,255&e>>8,255&e>>16,255&e>>24)}function n(e,t,i,r){for(var n=4*i*r,o=new Uint8Array(e,t,n),s=new Uint8Array(n),a=0,l=0,h=0;r>h;h++)for(var u=0;i>u;u++){var d=o[l];l++;var c=o[l];l++;var p=o[l];l++;var f=o[l];l++,s[a]=p,a++,s[a]=c,a++,s[a]=d,a++,s[a]=f,a++}return s}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,a=512,l=4,h=i("DXT1"),u=i("DXT3"),d=i("DXT5"),c=31,p=0,f=1,g=3,m=4,v=7,y=20,b=21,E=22,w=23,_=24,T=25,S=26,x=28,M=new Int32Array(e,0,c);if(M[p]!==s)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),o;if(!M[y]&l)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),o;var k,R=M[b],C=!1;switch(R){case h:k=8,o.format=THREE.RGB_S3TC_DXT1_Format;break;case u:k=16,o.format=THREE.RGBA_S3TC_DXT3_Format;break;case d:k=16,o.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==M[E]&&16711680&M[w]&&65280&M[_]&&255&M[T]&&4278190080&M[S]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",r(R)),o;C=!0,k=64,o.format=THREE.RGBAFormat}o.mipmapCount=1,M[v]>0&&t!==!1&&(o.mipmapCount=Math.max(1,M[v])),o.isCubemap=M[x]&a?!0:!1,o.width=M[m],o.height=M[g];for(var A=M[f]+4,P=o.width,I=o.height,D=o.isCubemap?6:1,L=0;D>L;L++){for(var O=0;o.mipmapCount>O;O++){if(C)var V=n(e,A,P,I),N=V.length;else var N=Math.max(4,P)/4*Math.max(4,I)/4*k,V=new Uint8Array(e,A,N);var F={data:V,width:P,height:I};o.mipmaps.push(F),A+=N,P=Math.max(.5*P,1),I=Math.max(.5*I,1)}P=o.width,I=o.height}return o}}function init_three_pvr_loader(){THREE.PVRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(e,t){var i=13,r=new Uint32Array(e,0,i),n={buffer:e,header:r,loadMipmaps:t};if(55727696===r[0])return THREE.PVRLoader._parseV3(n);if(559044176===r[11])return THREE.PVRLoader._parseV2(n);throw Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(e){var t,i,r=e.header,n=r[12],o=r[2],s=r[6],a=r[7],l=(r[9],r[10]),h=r[11];switch(o){case 0:t=2,i=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:t=2,i=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:t=4,i=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:t=4,i=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:throw Error("pvrtc - unsupported PVR format "+o)}return e.dataPtr=52+n,e.bpp=t,e.format=i,e.width=a,e.height=s,e.numSurfaces=l,e.numMipmaps=h,e.isCubemap=6===l,THREE.PVRLoader._extract(e)},THREE.PVRLoader._parseV2=function(e){var t,i,r=e.header,n=r[0],o=r[1],s=r[2],a=r[3],l=r[4],t=(r[5],r[6]),h=(r[7],r[8],r[9],r[10]),u=(r[11],r[12]),d=255,c=24,p=25,f=l&d,g=h>0;if(f===p)i=g?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,t=4;else{if(f!==c)throw Error("pvrtc - unknown format "+f);i=g?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,t=2}return e.dataPtr=n,e.bpp=t,e.format=i,e.width=s,e.height=o,e.numSurfaces=u,e.numMipmaps=a+1,e.isCubemap=6===u,THREE.PVRLoader._extract(e)},THREE.PVRLoader._extract=function(e){var t={mipmaps:[],width:e.width,height:e.height,format:e.format,mipmapCount:e.numMipmaps,isCubemap:e.isCubemap},i=e.buffer,r=e.dataPtr,n=e.bpp,o=e.numSurfaces,s=0,a=0,l=0,h=0,u=0,d=0;2===n?(l=8,h=4):(l=4,h=4),a=l*h*n/8,t.mipmaps.length=e.numMipmaps*o;for(var c=0;e.numMipmaps>c;){var p=e.width>>c,f=e.height>>c;u=p/l,d=f/h,2>u&&(u=2),2>d&&(d=2),s=u*d*a;for(var g=0;o>g;g++){var m=new Uint8Array(i,r,s),v={data:m,width:p,height:f};t.mipmaps[g*e.numMipmaps+c]=v,r+=s}c++}return t}}function MainWorker(){var e=this,t=this.listeners=[];this.addEventListener=function(e,i){"message"!==e&&console.error("Expected 'message' event type for worker thread."),t.push(i)},this.addEventListenerWithIntercept=function(e){t.push(e)},this.clearAllEventListenerWithIntercept=function(){t=[]},this.terminate=function(){t=[]},this.postMessage=function(e){for(var i={data:e},r=0;t.length>r;r++)t[r](i)},this.doOperation=function(e){var t=e;t.worker=this,avp.workerMain(t)},this.raiseError=function(t,i,r){e.postMessage({error:{code:t,msg:i,args:r}})},this.debug=function(t){e.postMessage({debug:1,message:t})}}var THREE=require("./three.js");global.THREE=THREE;var WGS=require("./wgs.js");(function(){"use strict";function e(e){throw e}function t(e,t){var i=e.split("."),r=d;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||t===u?r=r[n]?r[n]:r[n]={}:r[n]=t}function i(e,t,i){var r,n="number"==typeof t?t:t=0,o="number"==typeof i?i:e.length;for(r=-1,n=7&o;n--;++t)r=r>>>8^v[255&(r^e[t])];for(n=o>>3;n--;t+=8)r=r>>>8^v[255&(r^e[t])],r=r>>>8^v[255&(r^e[t+1])],r=r>>>8^v[255&(r^e[t+2])],r=r>>>8^v[255&(r^e[t+3])],r=r>>>8^v[255&(r^e[t+4])],r=r>>>8^v[255&(r^e[t+5])],r=r>>>8^v[255&(r^e[t+6])],r=r>>>8^v[255&(r^e[t+7])];return(4294967295^r)>>>0}function r(){}function n(e){var t,i,r,n,o,s,a,l,h,u=e.length,d=0,p=Number.POSITIVE_INFINITY;for(l=0;u>l;++l)e[l]>d&&(d=e[l]),p>e[l]&&(p=e[l]);for(t=1<<d,i=new(c?Uint32Array:Array)(t),r=1,n=0,o=2;d>=r;){for(l=0;u>l;++l)if(e[l]===r){for(s=0,a=n,h=0;r>h;++h)s=s<<1|1&a,a>>=1;for(h=s;t>h;h+=o)i[h]=r<<16|l;++n}++r,n<<=1,o<<=1}return[i,d,p]}function o(t,i){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=c?new Uint8Array(t):t,this.o=!1,this.k=_,this.w=!1,(i||!(i={}))&&(i.index&&(this.c=i.index),i.bufferSize&&(this.j=i.bufferSize),i.bufferType&&(this.k=i.bufferType),i.resize&&(this.w=i.resize)),this.k){case w:this.a=32768,this.b=new(c?Uint8Array:Array)(32768+this.j+258);break;case _:this.a=0,this.b=new(c?Uint8Array:Array)(this.j),this.e=this.D,this.q=this.A,this.l=this.C;break;default:e(Error("invalid inflate mode"))}}function s(t,i){for(var r,n=t.f,o=t.d,s=t.input,a=t.c;i>o;)r=s[a++],r===u&&e(Error("input buffer is broken")),n|=r<<o,o+=8;return r=n&(1<<i)-1,t.f=n>>>i,t.d=o-i,t.c=a,r}function a(e,t){for(var i,r,n,o=e.f,s=e.d,a=e.input,l=e.c,h=t[0],d=t[1];d>s&&(i=a[l++],i!==u);)o|=i<<s,s+=8;return r=h[o&(1<<d)-1],n=r>>>16,e.f=o>>n,e.d=s-n,e.c=l,65535&r}function l(e){function t(e,t,i){var r,n,o,l;for(l=0;e>l;)switch(r=a(this,t)){case 16:for(o=3+s(this,2);o--;)i[l++]=n;break;case 17:for(o=3+s(this,3);o--;)i[l++]=0;n=0;break;case 18:for(o=11+s(this,7);o--;)i[l++]=0;n=0;break;default:n=i[l++]=r}return i}var i,r,o,l,h=s(e,5)+257,u=s(e,5)+1,d=s(e,4)+4,p=new(c?Uint8Array:Array)(M.length);for(l=0;d>l;++l)p[M[l]]=s(e,3);i=n(p),r=new(c?Uint8Array:Array)(h),o=new(c?Uint8Array:Array)(u),e.l(n(t.call(e,h,i,r)),n(t.call(e,u,i,o)))}function h(e){this.input=e,this.c=0,this.m=[],this.s=!1}var u=void 0,d=this,c="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;new(c?Uint8Array:Array)(256);var p;for(p=0;256>p;++p)for(var f=p,g=7,f=f>>>1;f;f>>>=1)--g;var m=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],v=c?new Uint32Array(m):m;r.prototype.getName=function(){return this.name},r.prototype.getData=function(){return this.data},r.prototype.G=function(){return this.H},t("Zlib.GunzipMember",r),t("Zlib.GunzipMember.prototype.getName",r.prototype.getName),t("Zlib.GunzipMember.prototype.getData",r.prototype.getData),t("Zlib.GunzipMember.prototype.getMtime",r.prototype.G);var y,b=[];for(y=0;288>y;y++)switch(!0){case 143>=y:b.push([y+48,8]);break;case 255>=y:b.push([y-144+400,9]);break;case 279>=y:b.push([y-256+0,7]);break;case 287>=y:b.push([y-280+192,8]);break;default:e("invalid literal: "+y)}var E=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var i,r,n=[];for(i=3;258>=i;i++)r=t(i),n[i]=r[2]<<24|r[1]<<16|r[0];return n}();c&&new Uint32Array(E);var w=0,_=1;o.prototype.g=function(){for(;!this.o;){var t=s(this,3);switch(1&t&&(this.o=!0),t>>>=1){case 0:var i=this.input,r=this.c,n=this.b,o=this.a,a=u,h=u,d=u,p=n.length,f=u;switch(this.d=this.f=0,a=i[r++],a===u&&e(Error("invalid uncompressed block header: LEN (first byte)")),h=a,a=i[r++],a===u&&e(Error("invalid uncompressed block header: LEN (second byte)")),h|=a<<8,a=i[r++],a===u&&e(Error("invalid uncompressed block header: NLEN (first byte)")),d=a,a=i[r++],a===u&&e(Error("invalid uncompressed block header: NLEN (second byte)")),d|=a<<8,h===~d&&e(Error("invalid uncompressed block header: length verify")),r+h>i.length&&e(Error("input buffer is broken")),this.k){case w:for(;o+h>n.length;){if(f=p-o,h-=f,c)n.set(i.subarray(r,r+f),o),o+=f,r+=f;else for(;f--;)n[o++]=i[r++];this.a=o,n=this.e(),o=this.a}break;case _:for(;o+h>n.length;)n=this.e({t:2});break;default:e(Error("invalid inflate mode"))}if(c)n.set(i.subarray(r,r+h),o),o+=h,r+=h;else for(;h--;)n[o++]=i[r++];this.c=r,this.a=o,this.b=n;break;case 1:this.l(F,H);break;case 2:l(this);break;default:e(Error("unknown BTYPE: "+t))}}return this.q()};var T,S,x=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=c?new Uint16Array(x):x,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],R=c?new Uint16Array(k):k,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],A=c?new Uint8Array(C):C,P=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],I=c?new Uint16Array(P):P,D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=c?new Uint8Array(D):D,O=new(c?Uint8Array:Array)(288);for(T=0,S=O.length;S>T;++T)O[T]=143>=T?8:255>=T?9:279>=T?7:8;var V,N,F=n(O),U=new(c?Uint8Array:Array)(30);for(V=0,N=U.length;N>V;++V)U[V]=5;var H=n(U);o.prototype.l=function(e,t){var i=this.b,r=this.a;this.r=e;for(var n,o,l,h,u=i.length-258;256!==(n=a(this,e));)if(256>n)r>=u&&(this.a=r,i=this.e(),r=this.a),i[r++]=n;else for(o=n-257,h=R[o],A[o]>0&&(h+=s(this,A[o])),n=a(this,t),l=I[n],L[n]>0&&(l+=s(this,L[n])),r>=u&&(this.a=r,i=this.e(),r=this.a);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.c--;this.a=r},o.prototype.C=function(e,t){var i=this.b,r=this.a;this.r=e;for(var n,o,l,h,u=i.length;256!==(n=a(this,e));)if(256>n)r>=u&&(i=this.e(),u=i.length),i[r++]=n;else for(o=n-257,h=R[o],A[o]>0&&(h+=s(this,A[o])),n=a(this,t),l=I[n],L[n]>0&&(l+=s(this,L[n])),r+h>u&&(i=this.e(),u=i.length);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.c--;this.a=r},o.prototype.e=function(){var e,t,i=new(c?Uint8Array:Array)(this.a-32768),r=this.a-32768,n=this.b;if(c)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;t>e;++e)i[e]=n[e+32768];if(this.i.push(i),this.n+=i.length,c)n.set(n.subarray(r,r+32768));else for(e=0;32768>e;++e)n[e]=n[r+e];return this.a=32768,n},o.prototype.D=function(e){var t,i,r,n,o=0|this.input.length/this.c+1,s=this.input,a=this.b;return e&&("number"==typeof e.t&&(o=e.t),"number"==typeof e.z&&(o+=e.z)),2>o?(i=(s.length-this.c)/this.r[2],n=0|258*(i/2),r=a.length>n?a.length+n:a.length<<1):r=a.length*o,c?(t=new Uint8Array(r),t.set(a)):t=a,this.b=t},o.prototype.q=function(){var e,t,i,r,n,o=0,s=this.b,a=this.i,l=new(c?Uint8Array:Array)(this.n+(this.a-32768));if(0===a.length)return c?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,i=a.length;i>t;++t)for(e=a[t],r=0,n=e.length;n>r;++r)l[o++]=e[r];for(t=32768,i=this.a;i>t;++t)l[o++]=s[t];return this.i=[],this.buffer=l},o.prototype.A=function(){var e,t=this.a;return c?this.w?(e=new Uint8Array(t),e.set(this.b.subarray(0,t))):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},h.prototype.F=function(){return this.s||this.g(),this.m.slice()},h.prototype.g=function(){for(var t=this.input.length;t>this.c;){var n=new r,s=u,a=u,l=u,h=u,d=u,p=u,f=u,g=u,m=u,v=this.input,y=this.c;switch(n.u=v[y++],n.v=v[y++],(31!==n.u||139!==n.v)&&e(Error("invalid file signature:"+n.u+","+n.v)),n.p=v[y++],n.p){case 8:break;default:e(Error("unknown compression method: "+n.p))}if(n.h=v[y++],g=v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24,n.H=new Date(1e3*g),n.N=v[y++],n.M=v[y++],(4&n.h)>0&&(n.I=v[y++]|v[y++]<<8,y+=n.I),(8&n.h)>0){for(f=[],p=0;(d=v[y++])>0;)f[p++]=String.fromCharCode(d);n.name=f.join("")}if((16&n.h)>0){for(f=[],p=0;(d=v[y++])>0;)f[p++]=String.fromCharCode(d);n.J=f.join("")}(2&n.h)>0&&(n.B=65535&i(v,0,y),n.B!==(v[y++]|v[y++]<<8)&&e(Error("invalid header crc16"))),s=v[v.length-4]|v[v.length-3]<<8|v[v.length-2]<<16|v[v.length-1]<<24,512*s>v.length-y-4-4&&(h=s),a=new o(v,{index:y,bufferSize:h}),n.data=l=a.g(),y=a.c,n.K=m=(v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24)>>>0,i(l,u,u)!==m&&e(Error("invalid CRC-32 checksum: 0x"+i(l,u,u).toString(16)+" / 0x"+m.toString(16))),n.L=s=(v[y++]|v[y++]<<8|v[y++]<<16|v[y++]<<24)>>>0,(4294967295&l.length)!==s&&e(Error("invalid input size: "+(4294967295&l.length)+" / "+s)),this.m.push(n),this.c=y}this.s=!0;var b,E,w,_=this.m,T=0,S=0;for(b=0,E=_.length;E>b;++b)S+=_[b].data.length;if(c)for(w=new Uint8Array(S),b=0;E>b;++b)w.set(_[b].data,T),T+=_[b].data.length;else{for(w=[],b=0;E>b;++b)w[b]=_[b].data;w=Array.prototype.concat.apply([],w)}return w},t("Zlib.Gunzip",h),t("Zlib.Gunzip.prototype.decompress",h.prototype.g),t("Zlib.Gunzip.prototype.getMembers",h.prototype.F)}).call(this),function(){"use strict";function e(e){throw e}function t(e,t){var i=e.split("."),r=g;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||t===f?r=r[n]?r[n]:r[n]={}:r[n]=t}function i(e){var t,i,r,n,o,s,a,l,h,u=e.length,d=0,c=Number.POSITIVE_INFINITY;for(l=0;u>l;++l)e[l]>d&&(d=e[l]),c>e[l]&&(c=e[l]);for(t=1<<d,i=new(m?Uint32Array:Array)(t),r=1,n=0,o=2;d>=r;){for(l=0;u>l;++l)if(e[l]===r){for(s=0,a=n,h=0;r>h;++h)s=s<<1|1&a,a>>=1;for(h=s;t>h;h+=o)i[h]=r<<16|l;++n}++r,n<<=1,o<<=1}return[i,d,c]}function r(t,i){switch(this.l=[],this.m=32768,this.d=this.f=this.c=this.t=0,this.input=m?new Uint8Array(t):t,this.u=!1,this.n=M,this.K=!1,(i||!(i={}))&&(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.K=i.resize)),this.n){case x:this.a=32768,this.b=new(m?Uint8Array:Array)(32768+this.m+258);break;case M:this.a=0,this.b=new(m?Uint8Array:Array)(this.m),this.e=this.W,this.B=this.R,this.q=this.V;break;default:e(Error("invalid inflate mode"))}}function n(t,i){for(var r,n=t.f,o=t.d,s=t.input,a=t.c;i>o;)r=s[a++],r===f&&e(Error("input buffer is broken")),n|=r<<o,o+=8;return r=n&(1<<i)-1,t.f=n>>>i,t.d=o-i,t.c=a,r}function o(e,t){for(var i,r,n,o=e.f,s=e.d,a=e.input,l=e.c,h=t[0],u=t[1];u>s&&(i=a[l++],i!==f);)o|=i<<s,s+=8;return r=h[o&(1<<u)-1],n=r>>>16,e.f=o>>n,e.d=s-n,e.c=l,65535&r}function s(e){function t(e,t,i){var r,s,a,l;for(l=0;e>l;)switch(r=o(this,t)){case 16:for(a=3+n(this,2);a--;)i[l++]=s;break;case 17:for(a=3+n(this,3);a--;)i[l++]=0;s=0;break;case 18:for(a=11+n(this,7);a--;)i[l++]=0;s=0;break;default:s=i[l++]=r}return i}var r,s,a,l,h=n(e,5)+257,u=n(e,5)+1,d=n(e,4)+4,c=new(m?Uint8Array:Array)(A.length);for(l=0;d>l;++l)c[A[l]]=n(e,3);r=i(c),s=new(m?Uint8Array:Array)(h),a=new(m?Uint8Array:Array)(u),e.q(i(t.call(e,h,r,s)),i(t.call(e,u,r,a)))}function a(e){e=e||{},this.files=[],this.v=e.comment}function l(e,t){t=t||{},this.input=m&&e instanceof Array?new Uint8Array(e):e,this.c=0,this.ba=t.verify||!1,this.j=t.password}function h(e,t){this.input=e,this.offset=t}function u(e,t){this.input=e,this.offset=t}function d(t){var i,r,n,o,s=[],a={};if(!t.i){if(t.o===f){var l,u=t.input;if(!t.D)e:{var d,c=t.input;for(d=c.length-12;d>0;--d)if(c[d]===J[0]&&c[d+1]===J[1]&&c[d+2]===J[2]&&c[d+3]===J[3]){t.D=d;break e}e(Error("End of Central Directory Record not found"))}l=t.D,(u[l++]!==J[0]||u[l++]!==J[1]||u[l++]!==J[2]||u[l++]!==J[3])&&e(Error("invalid signature")),t.ha=u[l++]|u[l++]<<8,t.ja=u[l++]|u[l++]<<8,t.ka=u[l++]|u[l++]<<8,t.aa=u[l++]|u[l++]<<8,t.Q=(u[l++]|u[l++]<<8|u[l++]<<16|u[l++]<<24)>>>0,t.o=(u[l++]|u[l++]<<8|u[l++]<<16|u[l++]<<24)>>>0,t.w=u[l++]|u[l++]<<8,t.v=m?u.subarray(l,l+t.w):u.slice(l,l+t.w)}for(i=t.o,n=0,o=t.aa;o>n;++n)r=new h(t.input,i),r.parse(),i+=r.length,s[n]=r,a[r.filename]=n;i-t.o>t.Q&&e(Error("invalid file header size")),t.i=s,t.G=a}}function c(e,t,i){return i^=e.s(t),e.k(t,i),i}var p,f=void 0,g=this,m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;new(m?Uint8Array:Array)(256);var v;for(v=0;256>v;++v)for(var y=v,b=7,y=y>>>1;y;y>>>=1)--b;var E,w=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],_=m?new Uint32Array(w):w,T=[];for(E=0;288>E;E++)switch(!0){case 143>=E:T.push([E+48,8]);break;case 255>=E:T.push([E-144+400,9]);break;case 279>=E:T.push([E-256+0,7]);break;case 287>=E:T.push([E-280+192,8]);break;default:e("invalid literal: "+E)}var S=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var i,r,n=[];for(i=3;258>=i;i++)r=t(i),n[i]=r[2]<<24|r[1]<<16|r[0];return n}();m&&new Uint32Array(S);var x=0,M=1;r.prototype.r=function(){for(;!this.u;){var t=n(this,3);switch(1&t&&(this.u=!0),t>>>=1){case 0:var i=this.input,r=this.c,o=this.b,a=this.a,l=f,h=f,u=f,d=o.length,c=f;switch(this.d=this.f=0,l=i[r++],l===f&&e(Error("invalid uncompressed block header: LEN (first byte)")),h=l,l=i[r++],l===f&&e(Error("invalid uncompressed block header: LEN (second byte)")),h|=l<<8,l=i[r++],l===f&&e(Error("invalid uncompressed block header: NLEN (first byte)")),u=l,l=i[r++],l===f&&e(Error("invalid uncompressed block header: NLEN (second byte)")),u|=l<<8,h===~u&&e(Error("invalid uncompressed block header: length verify")),r+h>i.length&&e(Error("input buffer is broken")),this.n){case x:for(;a+h>o.length;){if(c=d-a,h-=c,m)o.set(i.subarray(r,r+c),a),a+=c,r+=c;else for(;c--;)o[a++]=i[r++];this.a=a,o=this.e(),a=this.a}break;case M:for(;a+h>o.length;)o=this.e({H:2});break;default:e(Error("invalid inflate mode"))}if(m)o.set(i.subarray(r,r+h),a),a+=h,r+=h;else for(;h--;)o[a++]=i[r++];this.c=r,this.a=a,this.b=o;break;case 1:this.q(z,W);break;case 2:s(this);break;default:e(Error("unknown BTYPE: "+t))}}return this.B()};var k,R,C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=m?new Uint16Array(C):C,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I=m?new Uint16Array(P):P,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],L=m?new Uint8Array(D):D,O=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],V=m?new Uint16Array(O):O,N=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=m?new Uint8Array(N):N,U=new(m?Uint8Array:Array)(288);for(k=0,R=U.length;R>k;++k)U[k]=143>=k?8:255>=k?9:279>=k?7:8;var H,B,z=i(U),G=new(m?Uint8Array:Array)(30);for(H=0,B=G.length;B>H;++H)G[H]=5;var W=i(G);p=r.prototype,p.q=function(e,t){var i=this.b,r=this.a;this.C=e;for(var s,a,l,h,u=i.length-258;256!==(s=o(this,e));)if(256>s)r>=u&&(this.a=r,i=this.e(),r=this.a),i[r++]=s;else for(a=s-257,h=I[a],L[a]>0&&(h+=n(this,L[a])),s=o(this,t),l=V[s],F[s]>0&&(l+=n(this,F[s])),r>=u&&(this.a=r,i=this.e(),r=this.a);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.c--;this.a=r},p.V=function(e,t){var i=this.b,r=this.a;this.C=e;for(var s,a,l,h,u=i.length;256!==(s=o(this,e));)if(256>s)r>=u&&(i=this.e(),u=i.length),i[r++]=s;else for(a=s-257,h=I[a],L[a]>0&&(h+=n(this,L[a])),s=o(this,t),l=V[s],F[s]>0&&(l+=n(this,F[s])),r+h>u&&(i=this.e(),u=i.length);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.c--;this.a=r},p.e=function(){var e,t,i=new(m?Uint8Array:Array)(this.a-32768),r=this.a-32768,n=this.b;if(m)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;t>e;++e)i[e]=n[e+32768];if(this.l.push(i),this.t+=i.length,m)n.set(n.subarray(r,r+32768));else for(e=0;32768>e;++e)n[e]=n[r+e];return this.a=32768,n},p.W=function(e){var t,i,r,n,o=0|this.input.length/this.c+1,s=this.input,a=this.b;return e&&("number"==typeof e.H&&(o=e.H),"number"==typeof e.P&&(o+=e.P)),2>o?(i=(s.length-this.c)/this.C[2],n=0|258*(i/2),r=a.length>n?a.length+n:a.length<<1):r=a.length*o,m?(t=new Uint8Array(r),t.set(a)):t=a,this.b=t},p.B=function(){var e,t,i,r,n,o=0,s=this.b,a=this.l,l=new(m?Uint8Array:Array)(this.t+(this.a-32768));if(0===a.length)return m?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(t=0,i=a.length;i>t;++t)for(e=a[t],r=0,n=e.length;n>r;++r)l[o++]=e[r];for(t=32768,i=this.a;i>t;++t)l[o++]=s[t];return this.l=[],this.buffer=l},p.R=function(){var e,t=this.a;return m?this.K?(e=new Uint8Array(t),e.set(this.b.subarray(0,t))):e=this.b.subarray(0,t):(this.b.length>t&&(this.b.length=t),e=this.b),this.buffer=e},a.prototype.L=function(e){this.j=e},a.prototype.s=function(e){var t=2|65535&e[2];return 255&t*(1^t)>>8},a.prototype.k=function(e,t){e[0]=(_[255&(e[0]^t)]^e[0]>>>8)>>>0,e[1]=(6681*(20173*(e[1]+(255&e[0]))>>>0)>>>0)+1>>>0,e[2]=(_[255&(e[2]^e[1]>>>24)]^e[2]>>>8)>>>0},a.prototype.T=function(e){var t,i,r=[305419896,591751049,878082192];for(m&&(r=new Uint32Array(r)),t=0,i=e.length;i>t;++t)this.k(r,255&e[t]);return r};var j={O:0,M:8},q=[80,75,1,2],Y=[80,75,3,4],J=[80,75,5,6];h.prototype.parse=function(){var t=this.input,i=this.offset;(t[i++]!==q[0]||t[i++]!==q[1]||t[i++]!==q[2]||t[i++]!==q[3])&&e(Error("invalid file header signature")),this.version=t[i++],this.ia=t[i++],this.Z=t[i++]|t[i++]<<8,this.I=t[i++]|t[i++]<<8,this.A=t[i++]|t[i++]<<8,this.time=t[i++]|t[i++]<<8,this.U=t[i++]|t[i++]<<8,this.p=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.z=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.J=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.h=t[i++]|t[i++]<<8,this.g=t[i++]|t[i++]<<8,this.F=t[i++]|t[i++]<<8,this.ea=t[i++]|t[i++]<<8,this.ga=t[i++]|t[i++]<<8,this.fa=t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24,this.$=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,m?t.subarray(i,i+=this.h):t.slice(i,i+=this.h)),this.X=m?t.subarray(i,i+=this.g):t.slice(i,i+=this.g),this.v=m?t.subarray(i,i+this.F):t.slice(i,i+this.F),this.length=i-this.offset};var K={N:1,ca:8,da:2048};u.prototype.parse=function(){var t=this.input,i=this.offset;(t[i++]!==Y[0]||t[i++]!==Y[1]||t[i++]!==Y[2]||t[i++]!==Y[3])&&e(Error("invalid local file header signature")),this.Z=t[i++]|t[i++]<<8,this.I=t[i++]|t[i++]<<8,this.A=t[i++]|t[i++]<<8,this.time=t[i++]|t[i++]<<8,this.U=t[i++]|t[i++]<<8,this.p=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.z=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.J=(t[i++]|t[i++]<<8|t[i++]<<16|t[i++]<<24)>>>0,this.h=t[i++]|t[i++]<<8,this.g=t[i++]|t[i++]<<8,this.filename=String.fromCharCode.apply(null,m?t.subarray(i,i+=this.h):t.slice(i,i+=this.h)),this.X=m?t.subarray(i,i+=this.g):t.slice(i,i+=this.g),this.length=i-this.offset},p=l.prototype,p.Y=function(){var e,t,i,r=[];for(this.i||d(this),i=this.i,e=0,t=i.length;t>e;++e)r[e]=i[e].filename;return r},p.r=function(t,i){var n;this.G||d(this),n=this.G[t],n===f&&e(Error(t+" not found"));var o;o=i||{};var s,a,l,h,p,g,v,y,b=this.input,E=this.i;if(E||d(this),E[n]===f&&e(Error("wrong index")),a=E[n].$,s=new u(this.input,a),s.parse(),a+=s.length,l=s.z,0!==(s.I&K.N)){for(!o.password&&!this.j&&e(Error("please set password")),g=this.S(o.password||this.j),v=a,y=a+12;y>v;++v)c(this,g,b[v]);for(a+=12,l-=12,v=a,y=a+l;y>v;++v)b[v]=c(this,g,b[v])}switch(s.A){case j.O:h=m?this.input.subarray(a,a+l):this.input.slice(a,a+l);break;case j.M:h=new r(this.input,{index:a,bufferSize:s.J}).r();break;default:e(Error("unknown compression type"))}if(this.ba){var w,T=f,S="number"==typeof T?T:T=0,x=h.length;for(w=-1,S=7&x;S--;++T)w=w>>>8^_[255&(w^h[T])];for(S=x>>3;S--;T+=8)w=w>>>8^_[255&(w^h[T])],w=w>>>8^_[255&(w^h[T+1])],w=w>>>8^_[255&(w^h[T+2])],w=w>>>8^_[255&(w^h[T+3])],w=w>>>8^_[255&(w^h[T+4])],w=w>>>8^_[255&(w^h[T+5])],w=w>>>8^_[255&(w^h[T+6])],w=w>>>8^_[255&(w^h[T+7])];p=(4294967295^w)>>>0,s.p!==p&&e(Error("wrong crc: file=0x"+s.p.toString(16)+", data=0x"+p.toString(16)))}return h},p.L=function(e){this.j=e},p.k=a.prototype.k,p.S=a.prototype.T,p.s=a.prototype.s,t("Zlib.Unzip",l),t("Zlib.Unzip.prototype.decompress",l.prototype.r),t("Zlib.Unzip.prototype.getFilenames",l.prototype.Y),t("Zlib.Unzip.prototype.setPassword",l.prototype.L)}.call(this),function(){"use strict";function e(e){throw e}function t(e,t){var i=e.split("."),r=h;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(var n;i.length&&(n=i.shift());)i.length||t===l?r=r[n]?r[n]:r[n]={}:r[n]=t}function i(e){var t,i,r,n,o,s,a,l,h,d=e.length,c=0,p=Number.POSITIVE_INFINITY;for(l=0;d>l;++l)e[l]>c&&(c=e[l]),p>e[l]&&(p=e[l]);for(t=1<<c,i=new(u?Uint32Array:Array)(t),r=1,n=0,o=2;c>=r;){for(l=0;d>l;++l)if(e[l]===r){for(s=0,a=n,h=0;r>h;++h)s=s<<1|1&a,a>>=1;
for(h=s;t>h;h+=o)i[h]=r<<16|l;++n}++r,n<<=1,o<<=1}return[i,c,p]}function r(t,i){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=u?new Uint8Array(t):t,this.m=!1,this.i=c,this.r=!1,(i||!(i={}))&&(i.index&&(this.a=i.index),i.bufferSize&&(this.h=i.bufferSize),i.bufferType&&(this.i=i.bufferType),i.resize&&(this.r=i.resize)),this.i){case d:this.b=32768,this.c=new(u?Uint8Array:Array)(32768+this.h+258);break;case c:this.b=0,this.c=new(u?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:e(Error("invalid inflate mode"))}}function n(t,i){for(var r,n=t.f,o=t.d,s=t.input,a=t.a;i>o;)r=s[a++],r===l&&e(Error("input buffer is broken")),n|=r<<o,o+=8;return r=n&(1<<i)-1,t.f=n>>>i,t.d=o-i,t.a=a,r}function o(e,t){for(var i,r,n,o=e.f,s=e.d,a=e.input,h=e.a,u=t[0],d=t[1];d>s&&(i=a[h++],i!==l);)o|=i<<s,s+=8;return r=u[o&(1<<d)-1],n=r>>>16,e.f=o>>n,e.d=s-n,e.a=h,65535&r}function s(e){function t(e,t,i){var r,s,a,l;for(l=0;e>l;)switch(r=o(this,t)){case 16:for(a=3+n(this,2);a--;)i[l++]=s;break;case 17:for(a=3+n(this,3);a--;)i[l++]=0;s=0;break;case 18:for(a=11+n(this,7);a--;)i[l++]=0;s=0;break;default:s=i[l++]=r}return i}var r,s,a,l,h=n(e,5)+257,d=n(e,5)+1,c=n(e,4)+4,p=new(u?Uint8Array:Array)(v.length);for(l=0;c>l;++l)p[v[l]]=n(e,3);r=i(p),s=new(u?Uint8Array:Array)(h),a=new(u?Uint8Array:Array)(d),e.j(i(t.call(e,h,r,s)),i(t.call(e,d,r,a)))}function a(t,i){var n,o;switch(this.input=t,this.a=0,(i||!(i={}))&&(i.index&&(this.a=i.index),i.verify&&(this.A=i.verify)),n=t[this.a++],o=t[this.a++],15&n){case I:this.method=I;break;default:e(Error("unsupported compression method"))}0!==((n<<8)+o)%31&&e(Error("invalid fcheck flag:"+((n<<8)+o)%31)),32&o&&e(Error("fdict flag is not supported")),this.q=new r(t,{index:this.a,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}var l=void 0,h=this,u="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,d=0,c=1,p={t:d,s:c};r.prototype.k=function(){for(;!this.m;){var t=n(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var i=this.input,r=this.a,o=this.c,a=this.b,h=l,p=l,f=l,g=o.length,m=l;switch(this.d=this.f=0,h=i[r++],h===l&&e(Error("invalid uncompressed block header: LEN (first byte)")),p=h,h=i[r++],h===l&&e(Error("invalid uncompressed block header: LEN (second byte)")),p|=h<<8,h=i[r++],h===l&&e(Error("invalid uncompressed block header: NLEN (first byte)")),f=h,h=i[r++],h===l&&e(Error("invalid uncompressed block header: NLEN (second byte)")),f|=h<<8,p===~f&&e(Error("invalid uncompressed block header: length verify")),r+p>i.length&&e(Error("input buffer is broken")),this.i){case d:for(;a+p>o.length;){if(m=g-a,p-=m,u)o.set(i.subarray(r,r+m),a),a+=m,r+=m;else for(;m--;)o[a++]=i[r++];this.b=a,o=this.e(),a=this.b}break;case c:for(;a+p>o.length;)o=this.e({p:2});break;default:e(Error("invalid inflate mode"))}if(u)o.set(i.subarray(r,r+p),a),a+=p,r+=p;else for(;p--;)o[a++]=i[r++];this.a=r,this.b=a,this.c=o;break;case 1:this.j(C,P);break;case 2:s(this);break;default:e(Error("unknown BTYPE: "+t))}}return this.n()};var f,g,m=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],v=u?new Uint16Array(m):m,y=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],b=u?new Uint16Array(y):y,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],w=u?new Uint8Array(E):E,_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],T=u?new Uint16Array(_):_,S=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=u?new Uint8Array(S):S,M=new(u?Uint8Array:Array)(288);for(f=0,g=M.length;g>f;++f)M[f]=143>=f?8:255>=f?9:279>=f?7:8;var k,R,C=i(M),A=new(u?Uint8Array:Array)(30);for(k=0,R=A.length;R>k;++k)A[k]=5;var P=i(A);r.prototype.j=function(e,t){var i=this.c,r=this.b;this.o=e;for(var s,a,l,h,u=i.length-258;256!==(s=o(this,e));)if(256>s)r>=u&&(this.b=r,i=this.e(),r=this.b),i[r++]=s;else for(a=s-257,h=b[a],w[a]>0&&(h+=n(this,w[a])),s=o(this,t),l=T[s],x[s]>0&&(l+=n(this,x[s])),r>=u&&(this.b=r,i=this.e(),r=this.b);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.a--;this.b=r},r.prototype.w=function(e,t){var i=this.c,r=this.b;this.o=e;for(var s,a,l,h,u=i.length;256!==(s=o(this,e));)if(256>s)r>=u&&(i=this.e(),u=i.length),i[r++]=s;else for(a=s-257,h=b[a],w[a]>0&&(h+=n(this,w[a])),s=o(this,t),l=T[s],x[s]>0&&(l+=n(this,x[s])),r+h>u&&(i=this.e(),u=i.length);h--;)i[r]=i[r++-l];for(;this.d>=8;)this.d-=8,this.a--;this.b=r},r.prototype.e=function(){var e,t,i=new(u?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.c;if(u)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;t>e;++e)i[e]=n[e+32768];if(this.g.push(i),this.l+=i.length,u)n.set(n.subarray(r,r+32768));else for(e=0;32768>e;++e)n[e]=n[r+e];return this.b=32768,n},r.prototype.z=function(e){var t,i,r,n,o=0|this.input.length/this.a+1,s=this.input,a=this.c;return e&&("number"==typeof e.p&&(o=e.p),"number"==typeof e.u&&(o+=e.u)),2>o?(i=(s.length-this.a)/this.o[2],n=0|258*(i/2),r=a.length>n?a.length+n:a.length<<1):r=a.length*o,u?(t=new Uint8Array(r),t.set(a)):t=a,this.c=t},r.prototype.n=function(){var e,t,i,r,n,o=0,s=this.c,a=this.g,l=new(u?Uint8Array:Array)(this.l+(this.b-32768));if(0===a.length)return u?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,i=a.length;i>t;++t)for(e=a[t],r=0,n=e.length;n>r;++r)l[o++]=e[r];for(t=32768,i=this.b;i>t;++t)l[o++]=s[t];return this.g=[],this.buffer=l},r.prototype.v=function(){var e,t=this.b;return u?this.r?(e=new Uint8Array(t),e.set(this.c.subarray(0,t))):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},a.prototype.k=function(){var t,i,r=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){i=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=t;if("string"==typeof n){var o,s,a=n.split("");for(o=0,s=a.length;s>o;o++)a[o]=(255&a[o].charCodeAt(0))>>>0;n=a}for(var l,h=1,u=0,d=n.length,c=0;d>0;){l=d>1024?1024:d,d-=l;do h+=n[c++],u+=h;while(--l);h%=65521,u%=65521}i!==(u<<16|h)>>>0&&e(Error("invalid adler-32 checksum"))}return t};var I=8;t("Zlib.Inflate",a),t("Zlib.Inflate.prototype.decompress",a.prototype.k);var D,L,O,V,N={ADAPTIVE:p.s,BLOCK:p.t};if(Object.keys)D=Object.keys(N);else for(L in D=[],O=0,N)D[O++]=L;for(O=0,V=D.length;V>O;++O)L=D[O],t("Zlib.Inflate.BufferType."+L,N[L])}.call(this),global.Autodesk={Viewing:{isNodeJS:!0},LMVTK:{isNodeJS:!0}};var Zlib=exports.Zlib,AutodeskNamespace=function(e){for(var t=getGlobal(),i=e.split("."),r=0;i.length>r;++r)t[i[r]]=t[i[r]]||{},t=t[i[r]];return t};AutodeskNamespace("Autodesk.Viewing.Private"),AutodeskNamespace("Autodesk.Viewing.Extensions"),AutodeskNamespace("Autodesk.Viewing.Shaders"),AutodeskNamespace("Autodesk.Viewing.UI"),AutodeskNamespace("Autodesk.LMVTK"),Autodesk.Viewing.getGlobal=getGlobal,Autodesk.Viewing.AutodeskNamespace=AutodeskNamespace,Autodesk.Viewing.Private.initializeLegacyNamespaces=function(){var e=Autodesk.Viewing.Shaders,t=Autodesk.Viewing.Private;e.PackDepthShaderChunk=WGS.PackDepthShaderChunk,e.TonemapShaderChunk=WGS.TonemapShaderChunk,e.OrderedDitheringShaderChunk=WGS.OrderedDitheringShaderChunk,e.CutPlanesUniforms=WGS.CutPlanesUniforms,e.CutPlanesShaderChunk=WGS.CutPlanesShaderChunk,e.PackNormalsShaderChunk=WGS.PackNormalsShaderChunk,e.HatchPatternShaderChunk=WGS.HatchPatternShaderChunk,e.EnvSamplingShaderChunk=WGS.EnvSamplingShaderChunk,e.IdUniforms=WGS.IdUniforms,e.IdFragmentDeclaration=WGS.IdFragmentDeclaration,e.IdOutputShaderChunk=WGS.IdOutputShaderChunk,e.FinalOutputShaderChunk=WGS.FinalOutputShaderChunk,e.ThemingUniform=WGS.ThemingUniform,e.ThemingFragmentDeclaration=WGS.ThemingFragmentDeclaration,e.ThemingFragmentShaderChunk=WGS.ThemingFragmentShaderChunk,e.BackgroundShader=WGS.BackgroundShader,e.BlendShader=WGS.BlendShader,e.CelShader=WGS.CelShader,e.CopyShader=WGS.CopyShader,e.FXAAShader=WGS.FXAAShader,e.SAOBlurShader=WGS.SAOBlurShader,e.SAOMinifyFirstShader=WGS.SAOMinifyFirstShader,e.SAOMinifyShader=WGS.SAOMinifyShader,e.SAOShader=WGS.SAOShader,e.NormalsShader=WGS.NormalsShader,e.LineShader=WGS.LineShader,t.LineStyleDefs=WGS.LineStyleDefs,t.CreateLinePatternTexture=WGS.CreateLinePatternTexture,t.FloatToHalf=WGS.FloatToHalf,t.HalfToFloat=WGS.HalfToFloat,t.IntToHalf=WGS.IntToHalf,t.HalfToInt=WGS.HalfToInt,t.HalfTest=WGS.HalfTest,e.createShaderMaterial=WGS.createShaderMaterial,e.setMacro=WGS.setMacro,e.removeMacro=WGS.removeMacro,e.LmvShaderPass=WGS.ShaderPass,e.GaussianPass=WGS.GaussianPass,e.GroundShadow=WGS.GroundShadow,e.createGroundShape=WGS.createGroundShape,e.setGroundShapeTransform=WGS.setGroundShapeTransform,e.GroundReflection=WGS.GroundReflection,t.FireflyWebGLShader=WGS.WebGLShader,t.PrismMaps=WGS.PrismMaps,t.GetPrismMapChunk=WGS.GetPrismMapChunk,t.FireflyWebGLProgram=WGS.WebGLProgram,e.ShadowMapCommonUniforms=WGS.ShadowMapCommonUniforms,e.ShadowMapUniforms=WGS.ShadowMapUniforms,e.ShadowMapDeclareCommonUniforms=WGS.ShadowMapDeclareCommonUniforms,e.ShadowMapVertexDeclaration=WGS.ShadowMapVertexDeclaration,e.ShadowMapVertexShaderChunk=WGS.ShadowMapVertexShaderChunk,e.ShadowMapFragmentDeclaration=WGS.ShadowMapFragmentDeclaration,e.FireflyPhongShader=WGS.PhongShader,e.PrismShader=WGS.PrismShader,e.GetPrismMapUniforms=WGS.GetPrismMapUniforms,e.GetPrismMapSampleChunk=WGS.GetPrismMapSampleChunk,e.GetPrismMapUniformChunk=WGS.GetPrismMapUniformChunk,e.AverageOfFloat3=WGS.AverageOfFloat3,t.createPrismMaterial=WGS.createPrismMaterial,t.clonePrismMaterial=WGS.clonePrismMaterial,t.ShadowMapShader=WGS.ShadowMapShader,t.GroundShadowShader=WGS.GroundShadowShader,t.ShadowMapOverrideMaterials=WGS.ShadowMapOverrideMaterials,t.SHADOWMAP_NEEDS_UPDATE=WGS.SHADOWMAP_NEEDS_UPDATE,t.SHADOWMAP_INCOMPLETE=WGS.SHADOWMAP_INCOMPLETE,t.SHADOWMAP_VALID=WGS.SHADOWMAP_VALID,t.ShadowConfig=WGS.ShadowConfig,t.ShadowRender=WGS.ShadowRender,t.ShadowMaps=WGS.ShadowMaps,t.FrustumIntersector=WGS.FrustumIntersector,t.OUTSIDE=WGS.OUTSIDE,t.INTERSECTS=WGS.INTERSECTS,t.CONTAINS=WGS.CONTAINS,t.VBIntersector=WGS.VBIntersector,t.memoryOptimizedLoading=WGS.memoryOptimizedLoading,t.GPU_MEMORY_LIMIT=WGS.GPU_MEMORY_LIMIT,t.GPU_OBJECT_LIMIT=WGS.GPU_OBJECT_LIMIT,t.FRAGS_PERSISTENT_COUNT=WGS.FRAGS_PERSISTENT_COUNT,t.FRAGS_PERSISTENT_MAX_COUNT=WGS.FRAGS_PERSISTENT_MAX_COUNT,t.GEOMS_COUNT_LIMIT=WGS.GEOMS_COUNT_LIMIT,t.onDemandLoading=WGS.onDemandLoading,t.cullGeometryOnLoading=WGS.cullGeometryOnLoading,t.pageOutGeometryEnabled=WGS.pageOutGeometryEnabled,t.PAGEOUT_SUCCESS=WGS.PAGEOUT_SUCCESS,t.PAGEOUT_FAIL=WGS.PAGEOUT_FAIL,t.PAGEOUT_NONE=WGS.PAGEOUT_NONE,t.PAGEOUT_PERCENTAGE=WGS.PAGEOUT_PERCENTAGE,t.GEOMS_PAGEOUT_COUNT=WGS.GEOMS_PAGEOUT_COUNT,t.GeometryList=WGS.GeometryList,t.MESH_VISIBLE=WGS.MESH_VISIBLE,t.MESH_HIGHLIGHTED=WGS.MESH_HIGHLIGHTED,t.MESH_HIDE=WGS.MESH_HIDE,t.MESH_ISLINE=WGS.MESH_ISLINE,t.MESH_MOVED=WGS.MESH_MOVED,t.MESH_TRAVERSED=WGS.MESH_TRAVERSED,t.MESH_RENDERFLAG=WGS.MESH_RENDERFLAG,t.FragmentPointer=WGS.FragmentPointer,t.FragmentList=WGS.FragmentList,t.RENDER_NORMAL=WGS.RENDER_NORMAL,t.RENDER_HIGHLIGHTED=WGS.RENDER_HIGHLIGHTED,t.RENDER_HIDDEN=WGS.RENDER_HIDDEN,t.RENDER_SHADOWMAP=WGS.RENDER_SHADOWMAP,t.RENDER_FINISHED=WGS.RENDER_FINISHED,t.RenderBatch=WGS.RenderBatch,av.rescueFromPolymer=WGS.rescueFromPolymer,t.FireflyWebGLRenderer=WGS.WebGLRenderer,t.ModelIteratorLinear=WGS.ModelIteratorLinear,t.ModelIteratorBVH=WGS.ModelIteratorBVH,t.BufferGeometryUtils=WGS.BufferGeometry,t.RenderScene=WGS.RenderScene,t.SortedList=WGS.SortedList,t.ModelIteratorTexQuad=WGS.ModelIteratorTexQuad,t.TexQuadConfig=WGS.TexQuadConfig};var av=Autodesk.Viewing,avp=av.Private;av.getGlobal=getGlobal;var isBrowser=av.isBrowser="undefined"!=typeof navigator,isIE11=av.isIE11=isBrowser&&!!navigator.userAgent.match(/Trident\/7\./);"undefined"!=typeof window&&isIE11&&function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.CustomEvent.prototype,window.CustomEvent=e}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(e,t){if(!t||t>this.byteLength?t=this.byteLength:0>t&&(t=this.byteLength+t,0>t&&(t=0)),0>e&&(e=this.byteLength+e,0>e&&(e=0)),e>=t)return new ArrayBuffer;for(var i=t-e,r=new Uint8Array(this,e,i),n=new Uint8Array(i),o=0;i>o;o++)n[o]=r[o];return n.buffer}),function(){Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2}}(),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var launchFullscreen=av.launchFullscreen=function(e,t){e.requestFullscreen?e.requestFullscreen(t):e.mozRequestFullScreen?e.mozRequestFullScreen(t):e.webkitRequestFullscreen?e.webkitRequestFullscreen(t):e.msRequestFullscreen&&e.msRequestFullscreen(t)},exitFullscreen=av.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},inFullscreen=av.inFullscreen=function(){return"webkitIsFullScreen"in document?document.webkitIsFullScreen:!!(document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenEnabled||document.querySelector(".viewer-fill-browser"))},fullscreenElement=av.fullscreenElement=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},isFullscreenAvailable=av.isFullscreenAvailable=function(e){return e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen},getAndroidVersion=av.getAndroidVersion=function(e){var e=e||navigator.userAgent,t=e.match(/Android\s([0-9\.]*)/);return t?t[1]:!1},isTouchDevice=av.isTouchDevice=function(){return"undefined"!=typeof window&&"ontouchstart"in window};av.isIOSDevice=function(){return isBrowser?/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase()):!1},av.isAndroidDevice=function(){return isBrowser?-1!==navigator.userAgent.toLowerCase().indexOf("android"):!1},av.isMobileDevice=function(){return isBrowser?av.isIOSDevice()||av.isAndroidDevice():!1},av.isSafari=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("safari")&&-1===e.indexOf("chrome")},av.isFirefox=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("firefox")},av.isMac=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("mac os")},av.isWindows=function(){if(!isBrowser)return!1;var e=navigator.userAgent.toLowerCase();return-1!==e.indexOf("win32")||-1!==e.indexOf("windows")};var detectWebGL=av.detectWebGL=function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,r=0;4>r;r++)try{if(i=e.getContext(t[r]),i=rescueFromPolymer(i),i&&"function"==typeof i.getParameter)return 1}catch(n){}return 0}return-1},touchStartToClick=av.touchStartToClick=function(e){e.preventDefault(),e.stopPropagation(),e.target.click()};(function(){var e=getGlobal();e.performance||(e.performance=Date)})();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private;avp.IS_CONCAT_BUILD=!0,avp.BUILD_LMV_WORKER_URL="lmvworker.js",avp.LMV_WORKER_URL=avp.BUILD_LMV_WORKER_URL,avp.ENABLE_DEBUG=avp.ENABLE_DEBUG||!1,avp.ENABLE_TRACE=avp.ENABLE_TRACE||!1,avp.ENABLE_INLINE_WORKER=!0;var av=Autodesk.Viewing;av.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12},function(){"use strict";function e(){this.adp=null,this.runtimeStats={},this.level=-1,this.setLevel(r.ENABLE_TRACE?r.LogLevels.DEBUG:r.LogLevels.ERROR)}function t(){return"undefined"!=typeof window?encodeURI(window.location.href):""}var i=Autodesk.Viewing,r=Autodesk.Viewing.Private;r.LogLevels={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0},e.prototype.initialize=function(e){if(e.eventCallback&&(this.callback=e.eventCallback),this.sessionId=e.sessionId,!this.sessionId){var n=Date.now()+"";this.sessionId=parseFloat((0|1e4*Math.random())+""+n.substring(4))}this.environmentInfo={touch:i.isTouchDevice(),env:r.env,referer:t(),version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE};var o={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,patch:this.environmentInfo.patch,build_type:this.environmentInfo.build_type};this.track(o);var s=this;this.interval=setInterval(function(){s.reportRuntimeStats()},6e4)},e.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},e.prototype.track=function(e){if(this.updateRuntimeStats(e),!r.offline&&this.sessionId){e.timestamp=Date.now(),e.sessionId=this.sessionId;var t=this.logToADP(e);this.callback&&this.callback(e,{adp:t})}},e.prototype.logToADP=function(e){if(!this.adp)return!1;var i="",r="";switch(e.category){case"tool_changed":case"pref_changed":i="CLICK_OPERATION",r=e.category+"/"+e.name;break;case"screen_mode":i="CLICK_OPERATION",r="pref_changed/"+e.category;break;case"metadata_load_stats":i="DOCUMENT_START",r="stats",e.full_url=t();break;case"model_load_stats":i="DOCUMENT_FULL",r="stats";break;case"error":i="BACKGROUND_CALL",r="error"}return i?(this.adp.trackEvent(i,{operation:{id:e.sessionId,type:r,stage:"",status:"C",meta:e}}),!0):!1},e.prototype.updateRuntimeStats=function(e){if(e.hasOwnProperty("aggregate"))switch(e.aggregate){case"count":this.runtimeStats[e.name]>0?this.runtimeStats[e.name]++:this.runtimeStats[e.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[e.name]=e.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},e.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.adp&&this.adp.trackEvent("BACKGROUND_CALL",{operation:{id:this.sessionId,type:"stats",stage:"",status:"C",meta:this.runtimeStats}}),this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},e.prototype.setLevel=function(e){if(this.level!==e){this.level=e;var t=function(){},i=r.LogLevels;this.debug=e>=i.DEBUG?console.log.bind(console):t,this.log=e>=i.LOG?console.log.bind(console):t,this.info=e>=i.INFO?console.info.bind(console):t,this.warn=e>=i.WARNING?console.warn.bind(console):t,this.error=e>=i.ERROR?console.error.bind(console):t}},Autodesk.Viewing.Private.logger=new e}(),LmvMatrix4=function(e){this.elements=e?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(e,t,i,r,n,o,s,a,l,h,u,d,c,p,f,g){var m=this.elements;return m[0]=e,m[4]=t,m[8]=i,m[12]=r,m[1]=n,m[5]=o,m[9]=s,m[13]=a,m[2]=l,m[6]=h,m[10]=u,m[14]=d,m[3]=c,m[7]=p,m[11]=f,m[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z,o=e.w,s=i+i,a=r+r,l=n+n,h=i*s,u=i*a,d=i*l,c=r*a,p=r*l,f=n*l,g=o*s,m=o*a,v=o*l;return t[0]=1-(c+f),t[4]=u-v,t[8]=d+m,t[1]=u+v,t[5]=1-(h+f),t[9]=p-g,t[2]=d-m,t[6]=p+g,t[10]=1-(h+c),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},multiply:function(e){return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],h=i[1],u=i[5],d=i[9],c=i[13],p=i[2],f=i[6],g=i[10],m=i[14],v=i[3],y=i[7],b=i[11],E=i[15],w=r[0],_=r[4],T=r[8],S=r[12],x=r[1],M=r[5],k=r[9],R=r[13],C=r[2],A=r[6],P=r[10],I=r[14],D=r[3],L=r[7],O=r[11],V=r[15];return n[0]=o*w+s*x+a*C+l*D,n[4]=o*_+s*M+a*A+l*L,n[8]=o*T+s*k+a*P+l*O,n[12]=o*S+s*R+a*I+l*V,n[1]=h*w+u*x+d*C+c*D,n[5]=h*_+u*M+d*A+c*L,n[9]=h*T+u*k+d*P+c*O,n[13]=h*S+u*R+d*I+c*V,n[2]=p*w+f*x+g*C+m*D,n[6]=p*_+f*M+g*A+m*L,n[10]=p*T+f*k+g*P+m*O,n[14]=p*S+f*R+g*I+m*V,n[3]=v*w+y*x+b*C+E*D,n[7]=v*_+y*M+b*A+E*L,n[11]=v*T+y*k+b*P+E*O,n[15]=v*S+y*R+b*I+E*V,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],u=e[6],d=e[10],c=e[14],p=e[3],f=e[7],g=e[11],m=e[15];return p*(+n*a*u-r*l*u-n*s*d+i*l*d+r*s*c-i*a*c)+f*(+t*a*c-t*l*d+n*o*d-r*o*c+r*l*h-n*a*h)+g*(+t*l*u-t*s*c-n*o*u+i*o*c+n*s*h-i*l*h)+m*(-r*s*h-t*a*u+t*s*d+r*o*u-i*o*d+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[4],s=r[8],a=r[12],l=r[1],h=r[5],u=r[9],d=r[13],c=r[2],p=r[6],f=r[10],g=r[14],m=r[3],v=r[7],y=r[11],b=r[15];i[0]=u*g*v-d*f*v+d*p*y-h*g*y-u*p*b+h*f*b,i[4]=a*f*v-s*g*v-a*p*y+o*g*y+s*p*b-o*f*b,i[8]=s*d*v-a*u*v+a*h*y-o*d*y-s*h*b+o*u*b,i[12]=a*u*p-s*d*p-a*h*f+o*d*f+s*h*g-o*u*g,i[1]=d*f*m-u*g*m-d*c*y+l*g*y+u*c*b-l*f*b,i[5]=s*g*m-a*f*m+a*c*y-n*g*y-s*c*b+n*f*b,i[9]=a*u*m-s*d*m-a*l*y+n*d*y+s*l*b-n*u*b,i[13]=s*d*c-a*u*c+a*l*f-n*d*f-s*l*g+n*u*g,i[2]=h*g*m-d*p*m+d*c*v-l*g*v-h*c*b+l*p*b,i[6]=a*p*m-o*g*m-a*c*v+n*g*v+o*c*b-n*p*b,i[10]=o*d*m-a*h*m+a*l*v-n*d*v-o*l*b+n*h*b,i[14]=a*h*c-o*d*c-a*l*p+n*d*p+o*l*g-n*h*g,i[3]=u*p*m-h*f*m-u*c*v+l*f*v+h*c*y-l*p*y,i[7]=o*f*m-s*p*m+s*c*v-n*f*v-o*c*y+n*p*y,i[11]=s*h*m-o*u*m-s*l*v+n*u*v+o*l*y-n*h*y,i[15]=o*u*c-s*h*c+s*l*p-n*u*p-o*l*f+n*h*f;var E=n*i[0]+l*i[4]+c*i[8]+m*i[12];if(0==E){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/E),this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,l=n*o,h=n*s;return this.set(l*o+i,l*s-r*a,l*a+r*s,0,l*s+r*a,h*s+i,h*a-r*o,0,l*a-r*s,h*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},transformPoint:function(e){var t=e.x,i=e.y,r=e.z,n=this.elements;return e.x=n[0]*t+n[4]*i+n[8]*r+n[12],e.y=n[1]*t+n[5]*i+n[9]*r+n[13],e.z=n[2]*t+n[6]*i+n[10]*r+n[14],e},transformDirection:function(e){var t=e.x,i=e.y,r=e.z,n=this.elements;e.x=n[0]*t+n[4]*i+n[8]*r,e.y=n[1]*t+n[5]*i+n[9]*r,e.z=n[2]*t+n[6]*i+n[10]*r;var o=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);if(o>0){var s=1/o;e.x*=s,e.y*=s,e.z*=s}return e},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return(new LmvMatrix4).fromArray(this.elements)}},LmvVector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},LmvVector3.prototype={constructor:LmvVector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r+n[12],this.y=n[1]*t+n[5]*i+n[9]*r+n[13],this.z=n[2]*t+n[6]*i+n[10]*r+n[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*i,h=a*i+s*t-n*r,u=a*r+n*i-o*t,d=-n*t-o*i-s*r;return this.x=l*a+d*-n+h*-s-u*-o,this.y=h*a+d*-o+u*-n-l*-s,this.z=u*a+d*-s+l*-o-h*-n,this},transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this},clamp:function(e,t){return e.x>this.x?this.x=e.x:this.x>t.x&&(this.x=t.x),e.y>this.y?this.y=e.y:this.y>t.y&&(this.y=t.y),e.z>this.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new LmvVector3,t=new LmvVector3),e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e),this},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,n=this.z;return this.x=r*e.z-n*e.y,this.y=n*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},projectOnVector:function(){var e,t;return function(i){return void 0===e&&(e=new LmvVector3),e.copy(i).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new LmvVector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new LmvVector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){var i=4*e,r=t.elements;return this.x=r[i],this.y=r[i+1],this.z=r[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,i){return void 0===i&&(i=0),t=t*e.itemSize+i,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}};var LmvBox3=function(e,t){this.min=void 0!==e?e:new LmvVector3(1/0,1/0,1/0),this.max=void 0!==t?t:new LmvVector3(-1/0,-1/0,-1/0)
};LmvBox3.prototype={constructor:LmvBox3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;i>t;t++)this.expandByPoint(e[t]);return this},setFromArray:function(e,t){return this.min.x=e[t],this.min.y=e[t+1],this.min.z=e[t+2],this.max.x=e[t+3],this.max.y=e[t+4],this.max.z=e[t+5],this},copyToArray:function(e,t){e[t]=this.min.x,e[t+1]=this.min.y,e[t+2]=this.min.z,e[t+3]=this.max.x,e[t+4]=this.max.y,e[t+5]=this.max.z},setFromCenterAndSize:function(){var e=new LmvVector3;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.min.x>this.max.x||this.min.y>this.max.y||this.min.z>this.max.z},center:function(e){var t=e||new LmvVector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new LmvVector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return this.min.x>e.x||e.x>this.max.x||this.min.y>e.y||e.y>this.max.y||this.min.z>e.z||e.z>this.max.z?!1:!0},containsBox:function(e){return e.min.x>=this.min.x&&this.max.x>=e.max.x&&e.min.y>=this.min.y&&this.max.y>=e.max.y&&e.min.z>=this.min.z&&this.max.z>=e.max.z?!0:!1},getParameter:function(e,t){var i=t||new LmvVector3;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return this.min.x>e.max.x||e.min.x>this.max.x||this.min.y>e.max.y||e.min.y>this.max.y||this.min.z>e.max.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var i=t||new LmvVector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new LmvVector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new LmvVector3,new LmvVector3,new LmvVector3,new LmvVector3,new LmvVector3,new LmvVector3,new LmvVector3,new LmvVector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},function(){"use strict";function e(e,t){this.bytes_per_node=t?32:36;var i,r;e instanceof ArrayBuffer?(i=e.byteLength/this.bytes_per_node,r=e,this.nodeCount=i):(i=0|e,r=new ArrayBuffer(this.bytes_per_node*i),this.nodeCount=0),this.nodeCapacity=i,this.nodesRaw=r,this.is_lean_node=t,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}function t(e,t){this.boxes=e.boxes,this.polygonCounts=e.polygonCounts,this.materials=e.materials,this.materialDefs=t,this.prim_count=e.length,this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(o*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}var i=Autodesk.Viewing,r=i.Private;e.prototype.setLeftChild=function(e,t){this.nodesI[e*this.node_stride+6]=t},e.prototype.getLeftChild=function(e){return this.nodesI[e*this.node_stride+6]},e.prototype.setPrimStart=function(e,t){this.is_lean_node?this.nodesI[e*this.node_stride+6]=t:this.nodesI[e*this.node_stride+8]=t},e.prototype.getPrimStart=function(e){return this.is_lean_node?this.nodesI[e*this.node_stride+6]:this.nodesI[e*this.node_stride+8]},e.prototype.setPrimCount=function(e,t){this.nodesS[e*this.node_stride_short+14]=t},e.prototype.getPrimCount=function(e){return this.nodesS[e*this.node_stride_short+14]},e.prototype.setFlags=function(e,t,i,r){this.nodesS[e*this.node_stride_short+15]=r<<3|i<<2|3&t},e.prototype.getFlags=function(e){return this.nodesS[e*this.node_stride_short+15]},e.prototype.setBox0=function(e,t){var i=e*this.node_stride,r=this.nodesF;r[i]=t[0],r[i+1]=t[1],r[i+2]=t[2],r[i+3]=t[3],r[i+4]=t[4],r[i+5]=t[5]},e.prototype.getBoxThree=function(e,t){var i=e*this.node_stride,r=this.nodesF;t.min.x=r[i],t.min.y=r[i+1],t.min.z=r[i+2],t.max.x=r[i+3],t.max.y=r[i+4],t.max.z=r[i+5]},e.prototype.setBoxThree=function(e,t){var i=e*this.node_stride,r=this.nodesF;r[i]=t.min.x,r[i+1]=t.min.y,r[i+2]=t.min.z,r[i+3]=t.max.x,r[i+4]=t.max.y,r[i+5]=t.max.z},e.prototype.makeEmpty=function(e){var t=e*this.node_stride,i=this.nodesI;i[t+6]=-1,i[t+7]=0,this.is_lean_node||(i[t+8]=-1)},e.prototype.realloc=function(e){if(this.nodeCount+e>this.nodeCapacity){var t=0|3*this.nodeCapacity/2;this.nodeCount+e>t&&(t=this.nodeCount+e);var i=new ArrayBuffer(t*this.bytes_per_node),r=new Int32Array(i);r.set(this.nodesI),this.nodeCapacity=t,this.nodesRaw=i,this.nodesF=new Float32Array(i),this.nodesI=r,this.nodesS=new Uint16Array(i)}},e.prototype.nextNodes=function(e){this.realloc(e);var t=this.nodeCount;this.nodeCount+=e;for(var i=0;e>i;i++)this.makeEmpty(t+i);return t},e.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var n=6,o=3,s=1e-5,a=1e-5,l=15,h=16,u=function(){function e(e,t,i,r){e[t]=.5*(i[r]+i[r+3]),e[t+1]=.5*(i[r+1]+i[r+4]),e[t+2]=.5*(i[r+2]+i[r+5])}function t(e,t,i){e[0]>t[i]&&(e[0]=t[i]),t[i]>e[3]&&(e[3]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),t[i+1]>e[4]&&(e[4]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),t[i+2]>e[5]&&(e[5]=t[i+2])}function i(e,t,i){e[0]>t[i]&&(e[0]=t[i]),e[1]>t[i+1]&&(e[1]=t[i+1]),e[2]>t[i+2]&&(e[2]=t[i+2]),t[i+3]>e[3]&&(e[3]=t[i+3]),t[i+4]>e[4]&&(e[4]=t[i+4]),t[i+5]>e[5]&&(e[5]=t[i+5])}function r(e,t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),t[3]>e[3]&&(e[3]=t[3]),t[4]>e[4]&&(e[4]=t[4]),t[5]>e[5]&&(e[5]=t[5])}function n(e,t,i,r){for(var n=0;3>n;n++)e[t+n]=i[r+3+n]-i[r+n]}function o(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]}function u(e){e[0]=_,e[1]=_,e[2]=_,e[3]=-_,e[4]=-_,e[5]=-_}function d(e,t){var i=e[t+3]-e[t],r=e[t+4]-e[t+1],n=e[t+5]-e[t+2];return 0>i||0>r||0>n?0:2*(i*r+r*n+n*i)}function c(e){var t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 0>t||0>i||0>r?0:2*(t*i+i*r+r*t)}function p(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function f(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function g(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}function m(e,r,n,o,s,l,h){for(var u=e.centroids,d=e.primitives,c=e.boxes,p=h*(1-a)/l[o],f=s[o],g=e.sort_prims,m=r;n>=m;m++){var v=0|d[m],y=p*(u[3*v+o]-f),b=0|y;0>b?b=0:b>=h&&(b=h-1),g[m]=b,S[b].num_prims++,i(S[b].box_bbox,c,6*v),t(S[b].box_centroid,u,3*v)}}function v(e,t,i,n,s,a,l){if(e.scene_epsilon>a[n])return l.best_cost=1/0,void 0;var u=h;u>i-t+1&&(u=i-t+1);var d;for(d=0;u>d;d++)S[d].reset();for(d=0;u-1>d;d++)x[d].reset();l.num_bins=u,m(e,t,i,n,s,a,u),o(x[0].BL,S[0].box_bbox),o(x[0].CL,S[0].box_centroid),x[0].AL=c(x[0].BL),x[0].NL=S[0].num_prims;var p;for(d=1;u-1>d;d++){p=S[d];var f=x[d];o(f.BL,x[d-1].BL),r(f.BL,p.box_bbox),f.AL=c(f.BL),o(f.CL,x[d-1].CL),r(f.CL,p.box_centroid),f.NL=x[d-1].NL+p.num_prims}d=u-1,o(M,S[d].box_bbox),o(k,S[d].box_centroid);var g=c(M),v=S[d].num_prims,y=d,b=g*v+x[d-1].AL*x[d-1].NL;for(o(l.vb_right,M),o(l.cb_right,S[d].box_centroid),o(l.vb_left,x[d-1].BL),o(l.cb_left,x[d-1].CL),l.num_left=x[d-1].NL,d-=1;d>=1;d--){p=S[d],r(M,p.box_bbox),r(k,p.box_centroid),g=c(M),v+=p.num_prims;var E=g*v+x[d-1].AL*x[d-1].NL;b>=E&&(b=E,y=d,o(l.vb_right,M),o(l.cb_right,k),o(l.vb_left,x[d-1].BL),o(l.cb_left,x[d-1].CL),l.num_left=x[d-1].NL)}l.best_split=y,l.best_cost=b}function y(e,t,i,r,n,o,s){var a,l,h=e.primitives,u=e.sort_prims,d=0,c=0|t,p=0|s.best_split;for(a=t;i>=a;a++){var f=0|h[a],g=u[a];p>g?h[c++]=f:u[d++]=f}for(l=0;d>l;l++)h[c+l]=u[l]}function b(e,i,r,o,s,a,l,h){var d=e.primitives,c=e.centroids,p=s-o+1;p>e.frags_per_inner_node&&(p=e.frags_per_inner_node),p>h&&(p=h),i.setPrimStart(r,o),i.setPrimCount(r,p),o+=p,u(a);for(var f=o;s>=f;f++)t(a,c,3*d[f]);n(l,0,a,0);var g=0;return l[1]>l[0]&&(g=1),l[2]>l[g]&&(g=2),g}function E(e,t,i,r,o,s,a,h){n(R,0,s,0);var u=e.nodes,d=a?e.frags_per_leaf_node_transparent:e.frags_per_leaf_node,c=a?e.frags_per_inner_node_transparent:e.frags_per_inner_node,f=e.max_polys_per_node,g=0;R[1]>R[0]&&(g=1),R[2]>R[g]&&(g=2),u.setBox0(t,o);var m=0,E=0;if(e.polygonCounts)for(var w=i;r>=w&&(m+=e.polygonCounts[e.primitives[w]],E++,!(m>f));w++);var _=r-i+1,T=d>=_&&f>m||1===_;if(T||h>l||e.scene_epsilon>R[g])return u.setLeftChild(t,-1),u.setPrimStart(t,i),u.setPrimCount(t,r-i+1),u.setFlags(t,0,0,a?1:0),void 0;c&&(g=b(e,u,t,i,r,s,R,E),i+=u.getPrimCount(t));var S=new p;if(v(e,i,r,g,s,R,S),0>S.num_bins)return u.setPrimCount(t,u.getPrimCount(t)+r-i+1),void 0;y(e,i,r,g,s,R,S);var x=u.nextNodes(2),M=.5*(S.vb_left[3+g]+S.vb_left[g]),k=.5*(S.vb_right[3+g]+S.vb_right[g]);u.setFlags(t,g,k>M?0:1,a?1:0),u.setLeftChild(t,x),e.recursion_stack.push([e,x+1,i+S.num_left,r,S.vb_right,S.cb_right,a,h+1]),e.recursion_stack.push([e,x,i,i+S.num_left-1,S.vb_left,S.cb_left,a,h+1])}function w(r){var o=r.boxv_o,a=r.boxc_o,l=r.boxv_t,h=r.boxc_t;u(o),u(a),u(l),u(h);for(var d=r.centroids,c=r.boxes,p=0,f=r.prim_count;f>p;p++)e(d,3*p,c,6*p),p>=r.first_transparent?(t(h,d,3*p),i(l,c,6*p)):(t(a,d,3*p),i(o,c,6*p));n(R,0,r.boxv_o,0);var g=Math.max(R[0],R[1],R[2]);r.scene_epsilon=s*g}var _=1/0;p.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},f.prototype.reset=function(){this.num_prims=0,u(this.box_bbox),u(this.box_centroid)},g.prototype.reset=function(){this.NL=0,this.AL=0,u(this.BL),u(this.CL)};var T,S=[];for(T=0;h>T;T++)S.push(new f);var x=[];for(T=0;h-1>T;T++)x.push(new g);var M=new Float32Array(6),k=new Float32Array(6),R=new Float32Array(3);return{bvh_subdivide:E,compute_boxes:w,box_area:d}}();t.prototype.sortPrimitives=function(){var e,t,i=new Float32Array(this.work_buf),r=this.materialDefs,o=this.materials,s=this.primitives,a=0;for(e=0,t=this.prim_count;t>e;e++){s[e]=e;var l=r&&r[o[e]]?r[o[e]].transparent:!1;l&&a++,h?(i[e]=u.box_area(this.boxes,n*e),l&&(i[e]=-i[e])):i[e]=l?-1:1}var h=!1;if(h)Array.prototype.sort.call(this.primitives,function(e,t){return i[t]-i[e]});else if(a&&this.prim_count>a){var d=new Int32Array(a),c=0,p=0;for(e=0,t=this.prim_count;t>e;e++)i[e]>=0?s[c++]=s[e]:d[p++]=s[e];s.set(d,this.prim_count-a)}this.first_transparent=this.prim_count-a},t.prototype.build=function(t){function i(e,i){n[e]=t.hasOwnProperty(e)?t[e]:i}var r=t&&!!t.useSlimNodes,n=this;if(r)i("frags_per_leaf_node",1),i("frags_per_inner_node",0),i("frags_per_leaf_node_transparent",1),i("frags_per_inner_node_transparent",0),i("max_polys_per_node",1/0);else{var o=t.isWeakDevice?.5:1;i("frags_per_leaf_node",0|32*o),i("frags_per_inner_node",0|this.frags_per_leaf_node),i("frags_per_leaf_node_transparent",this.frags_per_leaf_node),i("frags_per_inner_node_transparent",0),i("max_polys_per_node",0|1e4*o)}if(this.nodes&&this.nodes.is_lean_node==r)this.nodes.nodeCount=0;else{for(var s=this.prim_count/this.frags_per_leaf_node,a=1;s>a;)a*=2;this.nodes=new e(a,t?t.useSlimNodes:!1)}this.sortPrimitives(),u.compute_boxes(this);var l=this.nodes.nextNodes(2);u.bvh_subdivide(this,l,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);for(var h;this.recursion_stack.length;)h=this.recursion_stack.pop(),u.bvh_subdivide(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7]);for(u.bvh_subdivide(this,l+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)h=this.recursion_stack.pop(),u.bvh_subdivide(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7])},r.NodeArray=e,r.BVHBuilder=t}(),function(){"use strict";function e(e,t,i){var r,n,o,s,a,l;for(r="",o=i,n=0;o>n;)switch(s=e[t+n++],s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(s);break;case 12:case 13:a=e[t+n++],r+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=e[t+n++],l=e[t+n++],r+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&l)<<0)}return r}var t=Autodesk.LMVTK,i=!0;t.utf8ArrayToString=function(t,r,n){if(void 0===r&&(r=0),void 0===n&&(n=t.length),i)return e(t,r,n);for(var o="",s=r,a=r+n;a>s;s++)o+=String.fromCharCode(t[s]);return decodeURIComponent(escape(o))},t.blobToJson=function(e){var i=t.utf8ArrayToString(e,0,e.length);return JSON.parse(i)},t.subBlobToJson=function(e,i){if(void 0===i)return"";for(var r=i;e.length-1>r;){var n=e[r];if(44==n&&(10==e[r+1]||13==e[r+1]))break;if(10==n||13==n)break;r++}var o=t.utf8ArrayToString(e,i,r-i);try{return JSON.parse(o)}catch(s){return console.error("Error parsing property blob to JSON : "+o),o}},t.subBlobToJsonInt=function(e,t){var i=0,r=t;for(34==e[r]&&r++;e.length-1>r;){var n=e[r];if(44==n&&(10==e[r+1]||13==e[r+1]))break;if(10==n||13==n||34==n)break;n>=48&&57>=n&&(i=10*i+(n-48)),r++}return i},t.parseIntArray=function(e,t){for(var i=0,r=0,n=e.length;n>r;r++)44==e[r]&&i++;i++;var o=new Uint32Array(i+(t?1:0));r=0;for(var s=e.length;91!=e[r]&&s>r;)r++;if(r==e.length)return null;r++;var a=!1;i=0;for(var l=0;s>r;){var h=e[r];h>=48&&57>=h?(l=10*l+(h-48),a=!0):44==h||93==h?a&&(o[i++]=l,a=!1,l=0):(a=!1,l=0),r++}return o},t.findValueOffsets=function(e){for(var t=0,i=e.length-1,r=0;i>r;r++)44!=e[r]||10!=e[r+1]&&13!=e[r+1]||t++;if(!t)return null;t++;var n=new Uint32Array(t);for(r=0,t=0;91!=e[r]&&i>r;)r++;r++,n[t++]=r;for(var o=!1;i>r;)10==e[r]||13==e[r]?o=!0:o&&(o=!1,n[t++]=r),r++;return n}}(),function(){"use strict";function e(e){this.buffer=e,this.offset=0,this.byteLength=e.length}var t=Autodesk.LMVTK,i=new ArrayBuffer(8),r=new Uint8Array(i),n=new Uint16Array(i),o=new Int32Array(i),s=new Uint32Array(i),a=new Float32Array(i),l=new Float64Array(i);e.prototype.seek=function(e){this.offset=e},e.prototype.getBytes=function(e){var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},e.prototype.getVarints=function(){var e,t=0,i=0;do e=this.buffer[this.offset++],t|=(127&e)<<i,i+=7;while(128&e);return t},e.prototype.getUint8=function(){return this.buffer[this.offset++]},e.prototype.getUint16=function(){return r[0]=this.buffer[this.offset++],r[1]=this.buffer[this.offset++],n[0]},e.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e=4294901760|e),e},e.prototype.getInt32=function(){var e=this.buffer,t=r,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,o[0]},e.prototype.getUint32=function(){var e=this.buffer,t=r,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,s[0]},e.prototype.getFloat32=function(){var e=this.buffer,t=r,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,a[0]},e.prototype.getIndicesArray=function(e,t,i){for(var r=this.buffer,n=new Uint8Array(e,t,2*i),o=this.offset,s=0,a=2*i;a>s;s+=2)n[s]=r[o],n[s+1]=r[o+1],o+=4;this.offset=o},e.prototype.getVector3Array=function(e,t,i,r){var n=this.buffer,o=this.offset,s=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(3===r&&0===i){var a=12*t;s.set(n.subarray(o,o+a)),this.offset+=a}else{r*=4;for(var l=4*i,h=0;t>h;h++){for(var u=0;12>u;u++)s[l+u]=n[o++];l+=r}this.offset=o}},e.prototype.getVector2Array=function(e,t,i,r){var n=this.buffer,o=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s=this.offset;r*=4;for(var a=4*i,l=0;t>l;l++){for(var h=0;8>h;h++)o[a+h]=n[s++];a+=r}this.offset=s},e.prototype.getVector4=function(e,t){for(var i=this.buffer,n=r,o=this.offset,s=a,l=0;4>l;l++)n[0]=i[o],n[1]=i[o+1],n[2]=i[o+2],n[3]=i[o+3],e[t+l]=s[0],o+=4;this.offset=o},e.prototype.getFloat64=function(){for(var e=this.buffer,t=r,i=this.offset,n=0;8>n;n++)t[n]=e[i+n];return this.offset+=8,l[0]},e.prototype.getString=function(e){var i=t.utf8ArrayToString(this.buffer,this.offset,e);return this.offset+=e,i},e.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length},t.InputStream=e}(),function(){"use strict";var e=Autodesk.LMVTK;e.VBUtils={deduceUVRepetition:function(e){for(var t in e.vblayout)if(0==t.indexOf("uv")&&0!=t.indexOf("uvw"))for(var i=e.vblayout[t].offset,r=e.vbstride,n=e.vb,o=e.vb.length/r,s=0,a=i;o>s;s++,a+=r){var l=n[a],h=n[a+1];if(l>2||0>l||h>2||0>h){e.vblayout[t].isPattern=!0;break}}},computeBounds3D:function(e){var t,i,r,n,o,s=1/0,a=1/0,l=1/0,h=-1/0,u=-1/0,d=-1/0,c=e.vbstride,p=e.vblayout.position.offset,f=e.vb,g=e.vb.length/c;for(t=0,i=p;g>t;t++,i+=c)r=f[i],n=f[i+1],o=f[i+2],s>r&&(s=r),a>n&&(a=n),l>o&&(l=o),r>h&&(h=r),n>u&&(u=n),o>d&&(d=o);e.boundingBox={min:{x:s,y:a,z:l},max:{x:h,y:u,z:d}};var m=.5*(s+h),v=.5*(a+u),y=.5*(l+d),b=e.boundingSphere={};b.center={x:m,y:v,z:y};var E=0;for(t=0,i=p;g>t;t++,i+=c){r=f[i],n=f[i+1],o=f[i+2];var w=r-m,_=n-v,T=o-y,S=w*w+_*_+T*T;S>E&&(E=S)}b.radius=Math.sqrt(E)},bboxUnion:function(e,t){e.min.x>t.min.x&&(e.min.x=t.min.x),e.min.y>t.min.y&&(e.min.y=t.min.y),e.min.z>t.min.z&&(e.min.z=t.min.z),t.max.x>e.max.x&&(e.max.x=t.max.x),t.max.y>e.max.y&&(e.max.y=t.max.y),t.max.z>e.max.z&&(e.max.z=t.max.z)}}}(),function(){"use strict";function e(e,t){var i=t||65536;this.useInstancing=e,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?i/4:i)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vcount=0,this.ib=this.useInstancing?null:new Uint16Array(i),this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0}var t=Autodesk.Viewing,i=t.Private,r=2*Math.PI,n=0,o=1,s=2,a=3,l=4,h=5,u=0,d=1,c=2,p=3,f=6,g=7,m=8,v=9,y=[0,1,3,0,3,2];e.prototype.expandStride=function(){},e.prototype.addToBounds=function(e,t){this.minx>e&&(this.minx=e),e>this.maxx&&(this.maxx=e),this.miny>t&&(this.miny=t),t>this.maxy&&(this.maxy=t)},e.prototype.setCommonVertexAttribs=function(e,t,i,r,n,o,s,a){t=255&t,i=255&i,a=255&a,o=65535&o,s=65535&s,this.vbi[e+m]=t|i<<8|a<<16,this.vbi[e+f]=r,this.vbi[e+g]=n,this.vbi[e+v]=o|s<<16,this.dbIds[n]=1},e.prototype.addVertexTriangleGeom=function(e,t,i,r,n,o,s,a,l,d){for(var c=this.vcount,p=this.vbf,f=this.useInstancing?1:4,g=0;f>g;g++){var m=(c+g)*this.stride;p[m]=e,p[m+1]=t,p[m+2]=i,p[m+3]=r,p[m+4]=n,p[m+5]=o,this.setCommonVertexAttribs(m,u+g,h,s,a,l,d,0),this.vcount++}return c},e.prototype.addVertexLine=function(e,t,i,r,n,s,a,l,h,d,c){for(var p=this.vcount,f=this.vbf,g=this.useInstancing?1:4,m=0;g>m;m++){var v=(p+m)*this.stride;f[v]=e,f[v+1]=t,f[v+2]=i,f[v+3]=r,f[v+4]=.5*s,f[v+5]=n,this.setCommonVertexAttribs(v,u+m,o,a,l,h,d,c),this.vcount++}return p},e.prototype.addVertexTexQuad=function(e,t,i,r,n,o,s,a,h){for(var d=this.vcount,c=this.vbf,p=this.useInstancing?1:4,f=0;p>f;f++){var g=(d+f)*this.stride;c[g]=e,c[g+1]=t,c[g+2]=n,c[g+3]=i,c[g+4]=r,this.setCommonVertexAttribs(g,u+f,l,o,s,a,h,0),this.vcount++}return d},e.prototype.addVertexArc=function(e,t,i,r,n,o,l,h,d,c,p,f){for(var g=this.vcount,m=this.vbf,v=n==o?s:a,y=this.useInstancing?1:4,b=0;y>b;b++){var E=(g+b)*this.stride;m[E]=e,m[E+1]=t,m[E+2]=i,m[E+3]=r,m[E+4]=.5*h,m[E+5]=n,v===a&&(m[E+10]=o,m[E+11]=l),this.setCommonVertexAttribs(E,u+b,v,d,c,p,f,0),this.vcount++}return g},e.prototype.addVertex=function(e,t,i,r,o,s){if(!this.useInstancing){var a=this.vcount,l=this.stride*a,h=this.vbf;return h[l]=e,h[l+1]=t,this.setCommonVertexAttribs(l,0,n,i,r,o,s,0),this.vcount++,a}},e.prototype.addVertexPolytriangle=function(e,t,i,r,n,o){this.useInstancing||(this.addVertex(e,t,i,r,n,o),this.addToBounds(e,t))},e.prototype.addIndices=function(e,t){if(!this.useInstancing){var i=this.ib,r=this.icount;if(r+e.length>=i.length){for(var n=new Uint16Array(2*i.length),o=0;r>o;++o)n[o]=i[o];this.ib=i=n}for(var o=0;e.length>o;++o)i[r+o]=t+e[o];this.icount+=e.length}},e.prototype.finalizeQuad=function(e){this.useInstancing||this.addIndices(y,e)},e.prototype.addSegment=function(e,t,i,r,n,o,s,a,l,h,u){var d=i-e,c=r-t,p=d||c?Math.atan2(c,d):0,f=d||c?Math.sqrt(d*d+c*c):0,g=this.addVertexLine(e,t,p,f,n,o,s,a,l,h,u);this.finalizeQuad(g),this.addToBounds(e,t),this.addToBounds(i,r)},e.prototype.addTriangleGeom=function(e,t,i,r,n,o,s,a,l,h){this.numTriangleGeoms++;var u=this.addVertexTriangleGeom(e,t,i,r,n,o,s,a,l,h);this.finalizeQuad(u),this.addToBounds(e,t),this.addToBounds(i,r),this.addToBounds(n,o)},e.prototype.addArc=function(e,t,i,n,o,s,a,l,h,u,d,c){o==s?this.numCirculars++:this.numEllipticals++;var p=b(i,n);i=p.start,n=p.end,0==i&&0==n&&(n=r);var f=Math.abs(i-n);if(f>1e-4&&Math.abs(f-r)>1e-4){var g=e+o*Math.cos(i),m=t+s*Math.sin(i);this.addSegment(g,m,g,m,0,l,h,u,d,c);var v=e+o*Math.cos(n),y=t+s*Math.sin(n);this.addSegment(v,y,v,y,0,l,h,u,d,c)}else this.addToBounds(e-o,t-s),this.addToBounds(e+o,t+s);var E=this.addVertexArc(e,t,i,n,o,s,a,l,h,u,d,c);this.finalizeQuad(E);var f,g,m,v,y},e.prototype.addTexturedQuad=function(e,t,i,r,n,o,s,a,l){var h=this.addVertexTexQuad(e,t,i,r,n,o,s,a,l);this.finalizeQuad(h);var u=.5*Math.cos(n),d=.5*Math.sin(n),c=Math.abs(i*u)+Math.abs(r*d),p=Math.abs(i*d)+Math.abs(r*u);this.addToBounds(e-c,t-p),this.addToBounds(e+c,t+p)},e.prototype.isFull=function(e){e=e||3;var t=this.useInstancing?4:1;return this.vcount*t+e>32767},e.prototype.toMesh=function(){var e={};e.vb=new Float32Array(this.vb.slice(0,4*this.vcount*this.stride)),e.vbstride=this.stride;var t=this.useInstancing?1:0;if(e.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:t,normalize:!1},color4b:{offset:f,itemSize:4,bytesPerItem:1,divisor:t,normalize:!0},dbId4b:{offset:g,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},flags4b:{offset:m,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1},layerVp4b:{offset:v,itemSize:4,bytesPerItem:1,divisor:t,normalize:!1}},this.stride>10&&(e.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:t,normalize:!1}),this.useInstancing){e.numInstances=this.vcount;var i=new Int32Array([u,d,c,p]);e.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},e.vblayout.instFlags4b.array=i.buffer,e.indices=new Uint16Array(y)}else e.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));e.dbIds=this.dbIds;var r=this.maxx-this.minx,n=this.maxy-this.miny,o=Math.max(r,n);return e.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-o},max:{x:this.maxx,y:this.maxy,z:.001*o}},e.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(r*r+n*n)},e};var b=function(e,t){function i(){function i(e,t){return.001>Math.abs(e-t)}i(e,0)&&(e=0),i(t,0)&&(t=0),i(e,r)&&(e=r),i(t,r)&&(t=r)}if(i(),e>t)for(;e>r;)e-=r,t-=r;else for(;t>r;)e-=r,t-=r;return i(),0>e&&t>0&&(e+=r),{start:e,end:t}};i.VertexBufferBuilder=e}(),function(){"use strict";function e(e){var i=this.stream=new t.InputStream(e),r=i.getInt32();this.type=i.getString(r),this.version=i.getInt32(),this.types=null,this.entryOffsets=[],i.seek(i.byteLength-8);var n=i.getUint32();this.typesOffset=i.getUint32(),i.seek(this.typesOffset);var o=this.readU32V();this.types=[];for(var s=0;o>s;++s)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});i.seek(n);for(var a=this.readU32V(),l=this.entryOffsets,s=0;a>s;++s)l.push(i.getUint32());i.seek(0)}var t=Autodesk.LMVTK;e.prototype.readVarint=function(){var e,t=0,i=0;do e=this.stream.getUint8(),t|=(127&e)<<i,i+=7;while(128&e);return t},e.prototype.readU32V=e.prototype.readVarint,e.prototype.readU16=function(){return this.stream.getUint16()},e.prototype.readU8=function(){return this.stream.getUint8()},e.prototype.readString=function(){return this.stream.getString(this.readU32V())},e.prototype.readVector3f=function(){var e=this.stream;return{x:e.getFloat32(),y:e.getFloat32(),z:e.getFloat32()}},e.prototype.readVector3d=function(){var e={x:0,y:0,z:0};return function(){var t=this.stream;return e.x=t.getFloat64(),e.y=t.getFloat64(),e.z=t.getFloat64(),e}}(),e.prototype.readQuaternionf=function(){var e={x:0,y:0,z:0,w:0};return function(){var t=this.stream;return e.x=t.getFloat32(),e.y=t.getFloat32(),e.z=t.getFloat32(),e.w=t.getFloat32(),e}}(),e.prototype.readMatrix3f=function(){var e=new LmvMatrix4;return function(t){t||(t=e);var i=this.stream;t.identity();for(var r=0;3>r;++r)for(var n=0;3>n;++n)t.elements[4*r+n]=i.getFloat32();return t}}(),e.prototype.readTransform=function(){var e={x:1,y:1,z:1},t=new LmvMatrix4(!0);return function(i,r,n,o,s,a){var l,h,u=this.stream,d=u.getUint8();switch(d){case 4:t.identity();break;case 0:l=this.readVector3d(),t.makeTranslation(l.x,l.y,l.z);break;case 1:h=this.readQuaternionf(),l=this.readVector3d(),e.x=1,e.y=1,e.z=1,t.compose(l,h,e);break;case 2:var c=u.getFloat32();h=this.readQuaternionf(),l=this.readVector3d(),e.x=c,e.y=c,e.z=c,t.compose(l,h,e);break;case 3:this.readMatrix3f(t),l=this.readVector3d(),t.setPosition(l);break;default:}if(a&&(a[0]=t.elements[12],a[1]=t.elements[13],a[2]=t.elements[14]),o&&t.multiplyMatrices(o,t),s&&(t.elements[12]-=s.x,t.elements[13]-=s.y,t.elements[14]-=s.z),void 0===i)return(new LmvMatrix4).copy(t);var p=t.elements;r&&(r[n+0]=p[0],r[n+1]=p[1],r[n+2]=p[2],r[n+3]=p[4],r[n+4]=p[5],r[n+5]=p[6],r[n+6]=p[8],r[n+7]=p[9],r[n+8]=p[10],r[n+9]=p[12],r[n+10]=p[13],r[n+11]=p[14])}}(),e.prototype.getEntryCounts=function(){return this.entryOffsets.length},e.prototype.seekToEntry=function(e){var t=this.getEntryCounts();if(e>=t)return null;this.stream.seek(this.entryOffsets[e]);var i=this.stream.getUint32();return i>=this.types.length?null:this.types[i]},e.prototype.readPathID=function(){var e=this.stream;if(2>this.version){var t=e.getUint16();if(!t)return null;if(e.getUint16(),1==t)return"";for(var i=e.getUint16(),r=2;t>r;++r)i+="/"+e.getUint16()}else{var t=this.readU32V();if(!t)return null;if(this.readU32V(),1==t)return"";for(var i=this.readU32V(),r=2;t>r;++r)i+="/"+this.readU32V()}return i},t.PackFileReader=e}(),function(){"use strict";function e(e,t){var i=Math.abs(t),r=Math.abs(e),n=Math.min(i,r)/Math.max(i,r),o=n*n,s=((-.0464964749*o+.15931422)*o-.327622764)*o*n+n;return r>i&&(s=1.57079637-s),0>t&&(s=3.14159274-s),0>e&&(s=-s),s}function t(t,i,r,s,a){var l=function(){return t.getString(t.getInt32())},h=t.getString(4);if("INDX"!=h)return null;var u=i.vertexCount,d=i.triangleCount,c=i.vbstride,p=u*c,f=0|p+(2*3*d+3)/4;if(i.sharedBufferBytes=4*f,!a){var g;if(r||(r=new ArrayBuffer(4*f),s=0),g=i.vb=new Float32Array(r,s,p),i.indices=new Uint16Array(r,s+4*p,3*d),t.getIndicesArray(g.buffer,s+4*p,3*d),h=t.getString(4),"VERT"!=h)return null;var m;if(i.vblayout.normal&&2===i.vblayout.normal.itemSize&&(m=new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2)),t.getVector3Array(g,u,i.vblayout.position.offset,c),1&i.flags){if(h=t.getString(4),"NORM"!=h)return null;if(m){3*u>n.length&&(n=new Float32Array(3*u)),t.getVector3Array(n,u,0,3);for(var v=0,y=i.vblayout.normal.offset;u>v;v++,y+=c){var b=.5*(e(n[3*v+1],n[3*v])*o+1),E=.5*(n[3*v+2]+1);m[2*y]=0|65535*b,m[2*y+1]=0|65535*E}}else t.getVector3Array(g,u,i.vblayout.normal.offset,c)}for(var w=0;i.texMapCount>w;w++){if(h=t.getString(4),"TEXC"!=h)return null;var _={name:l(),file:l()};i.uvs.push(_);var T="uv";w&&(T+=""+(w+1)),t.getVector2Array(g,u,i.vblayout[T].offset,c)}for(var S=c-3*(i.attribMapCount||0),w=0;i.attribMapCount>w;w++){if(h=t.getString(4),"ATTR"!=h)return null;var x,M={name:l()};if(-1!=M.name.indexOf("Color"))x="color";else{if(-1==M.name.indexOf("UVW")){i.attrs.push(M),t.getBytes(16*u);continue}x="uvw"}i.vblayout[x]={offset:S,itemSize:3};for(var k=[0,0,0,0],v=0,y=S;u>v;v++,y+=c)t.getVector4(k,0),g[y]=k[0],g[y+1]=k[1],g[y+2]=k[2];S+=3}}}function i(e,t,i,r,n,o){var l=e.seekToEntry(t);return l?"Autodesk.CloudPlatform.OpenCTM"==l.entryType?s(e.stream,r,n,o):"Autodesk.CloudPlatform.Lines"==l.entryType?a(e,l,o):null:null}var r=Autodesk.LMVTK,n=new Float32Array(3),o=1/Math.PI,s=function(e,i,n,o){var s=function(){return e.getString(e.getInt32())},a=e.getString(4);if("OCTM"!=a)return null;var l=e.getInt32();if(5!=l)return null;var h=e.getString(3);e.getUint8();var u={stream:null,vertices:null,indices:null,normals:null,colors:null,uvs:[],attrs:[]};u.vertexCount=e.getInt32(),u.triangleCount=e.getInt32(),u.texMapCount=e.getInt32(),u.attribMapCount=e.getInt32(),u.flags=e.getInt32(),u.comment=s();var d=!0;u.vbstride=3,1&u.flags&&(u.vbstride+=d?1:3),u.vbstride+=2*(u.texMapCount||0),u.vbstride+=3*(u.attribMapCount||0),u.vblayout={};var c=0;if(u.vblayout.position={offset:c,itemSize:3},c+=3,1&u.flags&&(u.vblayout.normal={offset:c,itemSize:d?2:3,bytesPerItem:d?2:4,normalize:d},c+=d?1:3),u.texMapCount)for(var p=0;u.texMapCount>p;p++){var f="uv";p&&(f+=""+(p+1)),u.vblayout[f]={offset:c,itemSize:2},c+=2}return"RAW"==h?(t(e,u,i,n,o),o||(r.VBUtils.deduceUVRepetition(u),r.VBUtils.computeBounds3D(u)),u):"MG2"==h?(readOpenCTM_MG2(e,u,i,n,o),o||(r.VBUtils.deduceUVRepetition(u),r.VBUtils.computeBounds3D(u)),u):null},a=function(e,t,i){if(i)return null;var n,o,s={isLines:!0,vertices:null,indices:null,colors:null,normals:null,uvs:[],attrs:[]};t.version>1?(s.vertexCount=e.readU16(),n=e.readU16(),o=e.readU16()):(s.vertexCount=e.readU32V(),n=e.readU32V(),o=e.readU32V());var a=0!=e.stream.getUint8();s.vbstride=3,a&&(s.vbstride+=3),s.vblayout={};var l=0;s.vblayout.position={offset:l,itemSize:3},l+=3,a&&(s.vblayout.color={offset:l,itemSize:3}),s.vb=new Float32Array(s.vertexCount*s.vbstride);var h=s.vb,u=s.vbstride,d=e.stream;if(d.getVector3Array(h,s.vertexCount,s.vblayout.position.offset,u),a)for(var c=0,l=s.vblayout.color.offset,p=s.vertexCount;p>c;c++,l+=u)h[l]=d.getFloat32(),h[l+1]=d.getFloat32(),h[l+2]=d.getFloat32(),d.getFloat32();var f,g,m=function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.length)};t.version>1?(f=new Uint16Array(m(d.getBytes(2*n))),g=new Uint16Array(m(d.getBytes(2*o)))):(f=new Int32Array(m(d.getBytes(4*n))),g=new Int32Array(m(d.getBytes(4*o))));var v=g[o-1]-o+1;s.indices=new Uint16Array(2*v);for(var y=0,b=0;o>b+1;b++)for(var E=g[b];g[b+1]>E+1;E++)s.indices[y++]=f[E],s.indices[y++]=f[E+1];return r.VBUtils.computeBounds3D(s),s};r.readGeometry=i}(),function(){"use strict";function e(e,t){var i=e.seekToEntry(t);if(!i)return null;if(i.version>1)return null;var r=e.stream,n={position:e.readVector3f(),dir:e.readVector3f(),r:r.getFloat32(),g:r.getFloat32(),b:r.getFloat32(),intensity:r.getFloat32(),spotAngle:r.getFloat32(),size:r.getFloat32(),type:r.getUint8()};return n}var t=Autodesk.LMVTK;t.readLightDefinition=e}(),function(){"use strict";function e(e,t){var i=t.definition,r=e.seekToEntry(i);if(!r)return null;if(r.version>2)return null;var n=e.stream,o={isPerspective:!n.getUint8(),position:e.readVector3f(),target:e.readVector3f(),up:e.readVector3f(),aspect:n.getFloat32(),fov:n.getFloat32()*(180/Math.PI)};return 2>r.version&&(n.getFloat32(),n.getFloat32()),o.orthoScale=n.getFloat32(),o}var t=Autodesk.LMVTK;t.readCameraDefinition=e}(),function(){"use strict";function e(){this.length=0,this.numLoaded=0,this.boxes=null,this.transforms=null,this.materials=null,this.packIds=null,this.entityIndexes=null,this.fragId2dbId=null,this.topoIndexes=null
}function t(e,t){var i=t.geomDataIndexes.length,r=e.stream,n=0,o={},s=t.mesh2frag={};t.polygonCounts=t.geomDataIndexes;for(var a=0;i>a;a++){var l=t.geomDataIndexes[a];if(o[l]){var h=o[l];t.polygonCounts[a]=t.polygonCounts[h],t.packIds[a]=t.packIds[h],t.entityIndexes[a]=t.entityIndexes[h],n+=t.polygonCounts[a]}else{var u=e.seekToEntry(l);if(!u)return;r.getUint8(),r.seek(r.offset+24),t.polygonCounts[a]=r.getUint16(),t.packIds[a]=parseInt(e.readString()),t.entityIndexes[a]=e.readU32V(),n+=t.polygonCounts[a],o[l]=a}var d=t.packIds[a]+":"+t.entityIndexes[a],c=s[d];void 0===c?s[d]=a:Array.isArray(c)?c.push(a):s[d]=[c,a]}return t.geomDataIndexes=null,o=null,n}function i(e,t){var i=e.getEntryCounts(),r=e.stream;t.length=i;for(var n,o=t.fragTypes=new Uint8Array(i),s=t.primCounts=new Uint16Array(i),a=t.packIds=new Int32Array(i),l=t.entityIndexes=new Int32Array(i),h=0,u=i;u>h;h++){var d=e.seekToEntry(h);if(!d)return;if(o[h]=r.getUint8(),r.seek(r.offset+24),s[h]=r.getUint16(),a[h]=parseInt(e.readString()),l[h]=e.readU32V(),d.version>2){var c=r.getInt32();if(-1!=c&&void 0===n){n=t.topoIndexes=new Int32Array(i);for(var p=0;h>p;p++)n[p]=-1}void 0!=n&&(n[h]=c)}}}function r(e,t){var i=[];if(!t)return i;for(var r=e.getEntryCounts(),n=e.stream,o=0;r>o;o++){var s=e.seekToEntry(o);if(!s)return;if(s.version>5)return;s.version>4&&e.readU8(),e.readU32V(),s.version>2?e.readU32V():(e.readString(),e.readU32V()),e.readTransform(o,null,12*o);for(var a=0;6>a;a++)n.getFloat32();if(s.version>1){var l=e.readU32V();t.indexOf(l)>=0&&i.push(o)}}return i}function n(e,t,i,n,o){function s(e){if(n){var t=6*e;p.setFromArray(g,t),p.applyMatrix4(f),p.copyToArray(g,t)}}function a(e){for(var t=6*e,i=0;6>i;i++)g[t++]=c.getFloat32()}function h(e,t){for(var i=6*e,r=0;6>r;r++)g[i++]=c.getFloat32()+t[r%3]}var u=r(e,o),d=u.length?u.length:e.getEntryCounts(),c=e.stream;l&&d>l&&(d=l),t.totalLength=e.getEntryCounts(),t.length=d,t.numLoaded=0;var p,f,g=t.boxes=new Float32Array(6*d),m=t.transforms=new Float32Array(12*d),v=t.materials=new Int32Array(d),y=t.packIds=new Int32Array(d),b=t.entityIndexes=new Int32Array(d),E=t.geomDataIndexes=new Int32Array(d),w=t.fragId2dbId=new Int32Array(d),_=[0,0,0];n&&(p=new LmvBox3,f=new LmvMatrix4(!0).fromArray(n.elements));for(var T=0,S=t.length;S>T;T++){var x=u.length?e.seekToEntry(u[T]):e.seekToEntry(T);if(!x)return;if(x.version>5)return;var M=!0;if(x.version>4){var k=e.readU8();M=0!=(1&k)}if(v[T]=e.readU32V(),x.version>2?E[T]=e.readU32V():(y[T]=parseInt(e.readString()),b[T]=e.readU32V()),e.readTransform(T,m,12*T,n,i,_),x.version>3?h(T,_):a(T),s(T),i){var R=6*T;g[R++]-=i.x,g[R++]-=i.y,g[R++]-=i.z,g[R++]-=i.x,g[R++]-=i.y,g[R++]-=i.z}x.version>1&&(w[T]=e.readU32V())}t.finishLoading=!0}function o(e,t){e.length=t.length,e.numLoaded=0;for(var i=e.length,r=[1/0,1/0,1/0,-1/0,-1/0,-1/0],n=new Float32Array(6*i),o=new Float32Array(12*i),s=new Int32Array(i),a=new Int32Array(i),l=new Int32Array(i),h={},u=0;t.length>u;++u){for(var d=t[u],c=6*d,p=6*u,f=0;6>f;++f)n[p++]=e.boxes[c++];c=12*d,p=12*u;for(var f=0;12>f;++f)o[p++]=e.transforms[c++];s[u]=e.materials[d],a[u]=e.packIds[d],l[u]=e.entityIndexes[d];var g=e.packIds[d]+":"+e.entityIndexes[d],m=h[g];void 0==m?h[g]=u:Array.isArray(m)?m.push(u):h[g]=[m,u];for(var v=6*u,f=0;3>f;++f)r[f]>n[v+f]&&(r[f]=n[v+f]);for(var f=3;6>f;++f)n[v+f]>r[f]&&(r[f]=n[v+f])}return e.boxes=n,e.transforms=o,e.materials=s,e.packIds=a,e.entityIndexes=l,e.mesh2frag=h,r}var s=Autodesk.LMVTK,a=Autodesk.Viewing;a.Private;var l=a.isMobileDevice()?null:null;s.FragList=e,s.readGeometryMetadataIntoFragments=t,s.readGeometryMetadata=i,s.filterFragments=o,s.readFragments=n}(),function(){"use strict";function e(e,t,i,r){var n=e.seekToEntry(t);if(!n)return null;if(n.version>2)return null;var o=!0;if(n.version>1){var s=e.readU8();o=0!=(1&s)}return{definition:e.stream.getUint32(),transform:e.readTransform(void 0,void 0,void 0,i,r),instanceNodePath:e.readPathID()}}var t=Autodesk.LMVTK;t.readInstance=e}(),function(){"use strict";function e(e){this.unzip=new Zlib.Unzip(e),this.manifest=null,this.materials=null,this.metadata=null,this.fragments=null,this.geompacks=[],this.instances=[],this.cameras=[],this.lights=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[]},this.bbox=null,this.animations=null,this.pendingRequests=0,this.globalOffset={x:0,y:0,z:0},this.topology=null}var t=Autodesk.Viewing,i=Autodesk.LMVTK,r=t.Private,n=t.isMobileDevice()?50:2e3;e.prototype.loadAsyncResource=function(e,t,i,n){function o(t){s.pendingRequests--,n(t),0==s.pendingRequests&&s.postLoad(e)}if(i)return n(i),void 0;var s=this;this.pendingRequests++,r.ViewingService.getItem(e,e.basePath+t,o,e.onFailureCallback,{asynchronous:!0})},e.prototype.loadManifest=function(){var e=this.unzip.decompress("manifest.json");if(!e)return!1;var t=new i.InputStream(e);this.manifest=JSON.parse(t.getString(e.byteLength))},e.prototype.parseFragmentList=function(e,t,r,n){var o=this;this.loadAsyncResource(t,r,n,function(e){var r=new i.PackFileReader(e),n=o.fragments=new i.FragList;i.readFragments(r,n,o.globalOffset,t.placementTransform),r=null})},e.prototype.parseGeometryMetadata=function(e,t,r,n){var o=this;this.loadAsyncResource(t,r,n,function(e){var t=new i.PackFileReader(e);o.geomMetadata={},i.readGeometryMetadata(t,o.geomMetadata)})},e.prototype.loadRemainingSvf=function(e){function r(e,t){e[0]-=t.x,e[1]-=t.y,e[2]-=t.z}var o=this,s=this.unzip;this.manifest=e.manifest;var a=this.manifest,l=a.assets,h=s.decompress("metadata.json"),u=new i.InputStream(h);if(h.byteLength>3&&0!==h[3]&&(this.metadata=JSON.parse(u.getString(h.byteLength)).metadata,this.metadata)){var d=this.metadata["world bounding box"],c={x:d.minXYZ[0],y:d.minXYZ[1],z:d.minXYZ[2]},p={x:d.maxXYZ[0],y:d.maxXYZ[1],z:d.maxXYZ[2]};this.bbox={min:c,max:p},this.globalOffset=e.globalOffset||{x:.5*(c.x+p.x),y:.5*(c.y+p.y),z:.5*(c.z+p.z)},this.placementTransform=e.placementTransform;var f=this.metadata.georeference;if(f){var g=f.refPointLMV;if(g){var m=0,v=this.metadata["custom values"];v&&v.hasOwnProperty("angleToTrueNorth")&&(m=Math.PI/180*v.angleToTrueNorth);var y=new LmvMatrix4(!0),b=y.elements;b[0]=b[5]=Math.cos(m),b[1]=-Math.sin(m),b[4]=Math.sin(m),b[12]=g[0],b[13]=g[1],b[14]=g[2],this.refPointTransform=y}}if(e.applyRefPoint&&this.refPointTransform){var E=new LmvMatrix4(!0);e.placementTransform&&E.copy(e.placementTransform),E.multiply(this.refPointTransform),this.placementTransform=e.placementTransform=E}c.x-=this.globalOffset.x,c.y-=this.globalOffset.y,c.z-=this.globalOffset.z,p.x-=this.globalOffset.x,p.y-=this.globalOffset.y,p.z-=this.globalOffset.z,this.metadata.hasOwnProperty("double sided geometry")&&this.metadata["double sided geometry"].value&&(this.doubleSided=!0)}this.packFileTotalSize=0,this.primitiveCount=0;for(var w=a.typesets,_={},T=0;w.length>T;T++){var S=w[T];_[S.id]=S.types}for(var T=0;l.length>T;T++){var x=l[T];if(!t.isMobileDevice()||"Set.bin"!==x.id&&"Topology.json.gz"!==x.id){var M=x.type;0==M.indexOf("Autodesk.CloudPlatform.")&&(M=M.substr(23));var k=x.URI,R=x.typeset?_[x.typeset]:null;if(0!=k.indexOf("embed:/"))if("PackFile"==M){var C=R?R[0]["class"]:null;"Autodesk.CloudPlatform.Geometry"==C&&(this.packFileTotalSize+=x.usize||0,n>this.geompacks.length&&this.geompacks.push({id:x.id,uri:k}))}else"PropertyAttributes"==M?this.propertydb.attrs.push(k):"PropertyAVs"==M?this.propertydb.avs.push(k):"PropertyIDs"==M?this.propertydb.ids.push(k):"PropertyOffsets"==M?this.propertydb.offsets.push(k):"PropertyValues"==M&&this.propertydb.values.push(k);var A=x.URI,P=null;0==A.indexOf("embed:/")&&(A=A.substr(7),P=s.decompress(A)),"ProteinMaterials"==M?-1==A.indexOf("Protein")?this.loadAsyncResource(e,A,P,function(e){var t=new i.InputStream(e),r=e.byteLength;o.materials=r>0?JSON.parse(t.getString(r)):null}):this.loadAsyncResource(e,A,P,function(e){var t=new i.InputStream(e),r=e.byteLength;o.proteinMaterials=r>0?JSON.parse(t.getString(r)):null}):"FragmentList"==M?this.parseFragmentList(x,e,A,P):"GeometryMetadataList"==M?this.parseGeometryMetadata(x,e,A,P):"PackFile"==M?-1!=A.indexOf("CameraDefinitions.bin")?this.loadAsyncResource(e,A,P,function(e){o.camDefPack=new i.PackFileReader(e)}):-1!=A.indexOf("CameraList.bin")?this.loadAsyncResource(e,A,P,function(e){o.camInstPack=new i.PackFileReader(e)}):-1!=A.indexOf("LightDefinitions.bin")?this.loadAsyncResource(e,A,P,function(e){o.lightDefPack=new i.PackFileReader(e)}):-1!=A.indexOf("LightList.bin")&&this.loadAsyncResource(e,A,P,function(e){o.lightInstPack=new i.PackFileReader(e)}):"Animations"==M?this.loadAsyncResource(e,A,P,function(e){var t=new i.InputStream(e),n=e.byteLength;if(n>0){o.animations=JSON.parse(t.getString(n));var s=o.animations.animations;if(s)for(var a=o.globalOffset,l=(new LmvMatrix4).makeTranslation(a.x,a.y,a.z),h=(new LmvMatrix4).makeTranslation(-a.x,-a.y,-a.z),u=new LmvMatrix4,d=new LmvMatrix4,c=0;s.length>c;c++){var p=s[c];if(p.hierarchy)for(var f=0;p.hierarchy.length>f;f++){var g=p.hierarchy[f].keys;if(g)for(var m=0;g.length>m;m++){var v=g[m].pos;if(v){var y=a,b=g[m].rot;b&&(u.makeRotationFromQuaternion({x:b[0],y:b[1],z:b[2],w:b[3]}),d.multiplyMatrices(l,u).multiply(h),y={x:d.elements[12],y:d.elements[13],z:d.elements[14]}),r(v,y)}var E=g[m].target;E&&r(E,a);var w=g[m].points;if(w)for(var _=0;w.length>_;_++)r(w[_],a)}}}}else o.animations=null}):"Topology"==M&&this.loadAsyncResource(e,A,P,function(e){var t=new i.InputStream(e),r=e.byteLength;o.topology=r>0?JSON.parse(t.getString(r)):null})}}0==this.pendingRequests&&this.postLoad(e),delete this.unzip},e.prototype.addTransparencyFlagsToMaterials=function(e){for(var t in e){var i=e[t],r=i.userassets,n=i.materials,o=n[r[0]];i.transparent=o.transparent}},e.prototype.postLoadOfCam=function(){if(this.camDefPack&&this.camInstPack){for(var e=0,t=this.camInstPack.getEntryCounts();t>e;e++){var r=i.readInstance(this.camInstPack,e,this.placementTransform,this.globalOffset),n=i.readCameraDefinition(this.camDefPack,r);r.transform&&(r.transform.transformPoint(n.position),r.transform.transformPoint(n.target),r.transform.transformDirection(n.up)),this.cameras.push(n)}delete this.camDefPack,delete this.camInstPack}},e.prototype.postLoadOfLight=function(){if(this.lightDefPack&&this.lightInstPack){for(var e=0,t=this.lightInstPack.getEntryCounts();t>e;e++){var r=i.readInstance(this.lightInstPack,e,this.placementTransform,this.globalOffset);this.lights.push(i.readLightDefinition(this.lightDefPack,r.definition))}delete this.lightInstPack,delete this.lightDefPack}},e.prototype.postLoadOfFragments=function(){var e=this.fragments;if(this.geomMetadata){e.polygonCounts=e.geomDataIndexes;var t=this.geomMetadata;void 0!=t.topoIndexes&&(e.topoIndexes=new Int32Array(e.length));for(var i=0,r=e.length;r>i;i++){var n=e.geomDataIndexes[i];e.entityIndexes[i]=t.entityIndexes[n],e.packIds[i]=t.packIds[n],e.polygonCounts[i]=t.primCounts[n],this.primitiveCount+=t.primCounts[n],void 0!=t.topoIndexes&&(e.topoIndexes[i]=t.topoIndexes[n])}e.geomDataIndexes=null,this.geomMetadata=null}for(var o=e.mesh2frag={},s=e.packIds,a=e.entityIndexes,i=0,r=e.length;r>i;i++){var l=s[i]+":"+a[i],h=o[l];void 0===h?o[l]=i:Array.isArray(h)?h.push(i):o[l]=[h,i]}},e.prototype.postLoadOfBBox=function(e){if(!this.bbox||e.placementTransform){this.bbox&&e.placementTransform&&(this.modelBox=this.bbox);for(var t=[1/0,1/0,1/0,-1/0,-1/0,-1/0],i=this.fragments,r=i.boxes,n=0,o=i.length;o>n;n++){var s,a=6*n;for(s=0;3>s;s++)t[s]>r[a+s]&&(t[s]=r[a+s]);for(s=3;6>s;s++)r[a+s]>t[s]&&(t[s]=r[a+s])}this.bbox={min:{x:t[0],y:t[1],z:t[2]},max:{x:t[3],y:t[4],z:t[5]}}}},e.prototype.postLoadOfObjectIds=function(e){var t=e.objectIds;if(null!=t){for(var r=[],n=[],o=0;t.length>o;++o)for(var s=0;this.fragments.length>s;++s)this.fragments.fragId2dbId[s]==t[o]&&(r.push(this.fragments.packIds[s]),n.push(s));for(var a=1,l=r.length,o=1;l>o;){for(;l>o&&r[o]==r[o-1];)++o;if(l==o)break;r[a++]=r[o++]}r.splice(a-1,l-a);for(var h=[],o=0;this.geompacks.length>o;++o)for(var s=0;r.length>s;++s)parseInt(this.geompacks[o].id)==r[s]&&h.push(this.geompacks[o]);this.geompacks=h;var u=i.filterFragments(this.fragments,n);this.bbox={min:{x:u[0],y:u[1],z:u[2]},max:{x:u[3],y:u[4],z:u[5]}}}},e.prototype.postLoadComplete=function(e){if(e.loadDoneCB("svf"),this.fragments.polygonCounts){var t=performance.now(),i=this.materials?this.materials.materials:null;i&&this.addTransparencyFlagsToMaterials(i),this.bvh=new r.BVHBuilder(this.fragments,i),this.bvh.build(e.bvhOptions);var n=performance.now();e.worker.debug("BVH build time (worker thread):"+(n-t)),e.loadDoneCB("bvh")}e.loadDoneCB("done")},e.prototype.postLoad=function(e){this.postLoadOfCam(e),this.postLoadOfLight(e),this.postLoadOfFragments(e),this.postLoadOfBBox(e),this.postLoadOfObjectIds(e),this.postLoadComplete(e)},i.Package=e}(),function(){"use strict";function e(e){var i=this.stream=new t.InputStream(e),r=i.getInt32();this.type=i.getString(r),this.version=i.getInt32(),this.types=null,this.entryOffsets=[],i.seek(i.byteLength-8);var n=i.getUint32();this.typesOffset=i.getUint32(),i.seek(this.typesOffset);var o=this.readU32V();this.types=[];for(var s=0;o>s;++s)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});i.seek(n);for(var a=this.readU32V(),l=this.entryOffsets,s=0;a>s;++s)l.push(i.getUint32());i.seek(0)}var t=Autodesk.LMVTK;e.prototype.readVarint=function(){var e,t=0,i=0;do e=this.stream.getUint8(),t|=(127&e)<<i,i+=7;while(128&e);return t},e.prototype.readU32V=e.prototype.readVarint,e.prototype.readU16=function(){return this.stream.getUint16()},e.prototype.readU8=function(){return this.stream.getUint8()},e.prototype.readString=function(){return this.stream.getString(this.readU32V())},e.prototype.readVector3f=function(){var e=this.stream;return{x:e.getFloat32(),y:e.getFloat32(),z:e.getFloat32()}},e.prototype.readVector3d=function(){var e={x:0,y:0,z:0};return function(){var t=this.stream;return e.x=t.getFloat64(),e.y=t.getFloat64(),e.z=t.getFloat64(),e}}(),e.prototype.readQuaternionf=function(){var e={x:0,y:0,z:0,w:0};return function(){var t=this.stream;return e.x=t.getFloat32(),e.y=t.getFloat32(),e.z=t.getFloat32(),e.w=t.getFloat32(),e}}(),e.prototype.readMatrix3f=function(){var e=new LmvMatrix4;return function(t){t||(t=e);var i=this.stream;t.identity();for(var r=0;3>r;++r)for(var n=0;3>n;++n)t.elements[4*r+n]=i.getFloat32();return t}}(),e.prototype.readTransform=function(){var e={x:1,y:1,z:1},t=new LmvMatrix4(!0);return function(i,r,n,o,s,a){var l,h,u=this.stream,d=u.getUint8();switch(d){case 4:t.identity();break;case 0:l=this.readVector3d(),t.makeTranslation(l.x,l.y,l.z);break;case 1:h=this.readQuaternionf(),l=this.readVector3d(),e.x=1,e.y=1,e.z=1,t.compose(l,h,e);break;case 2:var c=u.getFloat32();h=this.readQuaternionf(),l=this.readVector3d(),e.x=c,e.y=c,e.z=c,t.compose(l,h,e);break;case 3:this.readMatrix3f(t),l=this.readVector3d(),t.setPosition(l);break;default:}if(a&&(a[0]=t.elements[12],a[1]=t.elements[13],a[2]=t.elements[14]),o&&t.multiplyMatrices(o,t),s&&(t.elements[12]-=s.x,t.elements[13]-=s.y,t.elements[14]-=s.z),void 0===i)return(new LmvMatrix4).copy(t);var p=t.elements;r&&(r[n+0]=p[0],r[n+1]=p[1],r[n+2]=p[2],r[n+3]=p[4],r[n+4]=p[5],r[n+5]=p[6],r[n+6]=p[8],r[n+7]=p[9],r[n+8]=p[10],r[n+9]=p[12],r[n+10]=p[13],r[n+11]=p[14])}}(),e.prototype.getEntryCounts=function(){return this.entryOffsets.length},e.prototype.seekToEntry=function(e){var t=this.getEntryCounts();if(e>=t)return null;this.stream.seek(this.entryOffsets[e]);var i=this.stream.getUint32();return i>=this.types.length?null:this.types[i]},e.prototype.readPathID=function(){var e=this.stream;if(2>this.version){var t=e.getUint16();if(!t)return null;if(e.getUint16(),1==t)return"";for(var i=e.getUint16(),r=2;t>r;++r)i+="/"+e.getUint16()}else{var t=this.readU32V();if(!t)return null;if(this.readU32V(),1==t)return"";for(var i=this.readU32V(),r=2;t>r;++r)i+="/"+this.readU32V()}return i},t.PackFileReader=e}(),function(){"use strict";function e(e){var i,r,n,o,s,a,l,h,u,d,c,p,f,g,m;for(var v in e.attrs){i=t.blobToJson(e.attrs[v]);for(var y=0;i.length>y;y++){var b=i[y][1];switch(b){case"__parent__":u=y;break;case"__child__":h=y;break;case"__name__":d=y;break;case"__instanceof__":c=y;break;case"__viewable_in__":p=y;break;case"__externalref__":f=y;break;case"__node_flags__":g=y;break;default:}}break}for(var v in e.avs){n=t.parseIntArray(e.avs[v],0),delete e.avs;break}for(var v in e.offsets){r=t.parseIntArray(e.offsets[v],1),r[r.length-1]=n.length/2,delete e.offsets;break}for(var v in e.values){o=e.values[v],s=t.findValueOffsets(o);break}for(var v in e.ids){a=e.ids[v],l=t.findValueOffsets(a);break}this.getObjectCount=function(){return r.length-1},this.getValueAt=function(e){return t.subBlobToJson(o,s[e])},this.getIntValueAt=function(e){return t.subBlobToJsonInt(o,s[e])},this.getIdAt=function(e){return t.subBlobToJson(a,l[e])},this.getObjectProperties=function(e,t,o,s){var a={dbId:e,properties:[]},l=!1,g=!1;if((!t||-1!==t.indexOf("externalId"))&&(a.externalId=this.getIdAt(e),l=!0,t&&1===t.length))return a;for(var m=null,v=2*r[e],y=2*r[e+1],b=v;y>b;b+=2){var E=n[b];if(E!=c){var w=i[E];if(!(t&&-1===t.indexOf(w[0])&&-1===t.indexOf(w[5])||s&&(s.indexOf(w[0])>-1||s.indexOf(w[5])>-1)))if(E==d){var _=this.getValueAt(n[b+1]);g=!0,a.name=_}else{var T=w[6]?w[6]:0,S=w[5]?w[5]:w[0],x=1&T||E==u||E==h||E==p||E==f;if(o&&x)continue;a.properties.push({displayName:S,displayValue:this.getValueAt(n[b+1]),displayCategory:w[1],type:w[2],units:w[3],hidden:x})}}else{var M=this.getObjectProperties(this.getValueAt(n[b+1]),t);M&&M.properties&&(m=M)}}if(m){for(var k={},R=a.properties,b=0;R.length>b;b++)k[R[b].displayName]=1;a.name||(a.name=m.name);for(var C=m.properties,b=0;C.length>b;b++)k.hasOwnProperty(C[b].displayName)||R.push(C[b])}return!t||a.properties.length||l||g?a:null},this.getExternalIdMapping=function(){if(!m&&(m={},l&&"length"in l))for(var e=1,t=l.length;t>e;++e){var i=this.getIdAt(e);m[i]=e}return m},this.findRootNodes=function(){for(var e=[],t=1,i=r.length;i>t;t++){for(var o=!1,s=!1,a=!1,l=2*r[t],c=2*r[t+1],p=l;c>p;p+=2){var f=n[p];f==u?this.getIntValueAt(n[p+1])&&(s=!0):f==h?o=!0:f==d&&(a=!0)}o&&a&&!s&&e.push(t)}return e},this.getNodeNameAndChildren=function(e,t){for(var i,o=e.dbId,s=2*r[o],a=2*r[o+1],l=s;a>l;l+=2){var p,f=n[l];if(f==u);else if(f!=h||t)f==d?e.name=this.getValueAt(n[l+1]):f==g&&(e.flags=this.getIntValueAt(n[l+1]));else{p=this.getIntValueAt(n[l+1]);var m={dbId:p,parent:e.dbId};i?i.push(m):i=[m]}}if(!e.name)for(var l=s;a>l;l+=2){var f=n[l];if(f==c){var v={dbId:this.getIntValueAt(n[l+1]),name:null};this.getNodeNameAndChildren(v,!0),v&&v.name&&!e.name&&(e.name=v.name)}}return i};var E=0,w=6;this.buildObjectTreeFlat=function(e,t,i,r,n,o){r>n[0]&&(n[0]=r);var s={dbId:e},a=this.getNodeNameAndChildren(s),l=[],h=!1;if(i){var u=i[e];void 0!==u&&(a&&a.length&&console.error("Node that has both node children and fragment children! Not supported by flat storage"),l=Array.isArray(u)?u:[u],h=!0)}var d=s.flags||0;if(void 0===d&&(d=h?w:a?E:0),a)for(var c=0;a.length>c;c++){var p=this.buildObjectTreeFlat(a[c].dbId,e,i,r+1,n,o);p&&l.push(a[c].dbId)}return l.length&&o.setNode(e,t,s.name,d,l,h),l.length},this.bruteForceSearch=function(e,t,o){e=e.toLowerCase();for(var a=e.match(/"[^"]+"|[^\s]+/g)||[],l=a.length;l--;)a[l]=a[l].replace(/"/g,"");for(var h=[],l=0;a.length>l;l++)(o||a[l].length>1)&&h.push(a[l]);if(0===h.length)return[];for(var u=[],d={},c=[],p=0;h.length>p;p++){for(var f=[],g=[],l=0,m=s.length;m>l;l++){var v=this.getValueAt(l);"string"==typeof v?-1!=v.toLowerCase().indexOf(h[p])&&g.push(l):-1!=(""+v).toLowerCase().indexOf(h[p])&&g.push(l)}for(var y=1,b=r.length;b>y;y++){for(var E=2*r[y],w=2*r[y+1],_="",T=null,l=E;w>l;l+=2){var S=n[l],x=i[S],M=x[5]?x[5]:x[0];if(o&&"name"===M.toLowerCase()&&(_=this.getValueAt(n[l+1])),-1!=g.indexOf(n[l+1])){if(t&&t.length&&-1===t.indexOf(i[n[l]][0]))continue;f.push(y),T={id:y,nodeName:"",value:this.getValueAt(n[l+1]),name:M};break}}T&&o&&0===p&&(T.nodeName=_,1===h.length?c.push(T):d[y]=T)}u.push(f)}if(1===u.length)return o?c:u[0];for(var k={},R=u[0],l=0;R.length>l;l++)k[R[l]]=1;for(var C=1;u.length>C;C++){R=u[C];for(var A={},l=0;R.length>l;l++)1===k[R[l]]&&(A[R[l]]=1);k=A}var f=[];for(var p in k)f.push(parseInt(p)),o&&c.push(d[p]);return o?c:f}}var t=Autodesk.LMVTK;t.PropertyDatabase=e}(),function(){"use strict";function e(e,t,r,n){if(this.metadata=e,this.scaleX=1,this.scaleY=1,this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.is2d=!0,this.layersMap={},this.fontDefs={},this.fontCount=0,this.fontId=0,this.manifestAvailable=!1,this.objectMemberQueue=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],rcv_offsets:[],rcvs:[],viewables:[]},e){var o=e.page_dimensions;this.paperWidth=o.page_width,this.paperHeight=o.page_height,this.scaleX=this.paperWidth/o.plot_width,this.scaleY=this.paperHeight/o.plot_height,this.hidePaper=o.hide_paper,this.bbox.max.x=this.paperWidth,this.bbox.max.y=this.paperHeight;var s=0;this.layersMap[0]=s++;for(var a in e.layers){var l=parseInt(a);this.layersMap[l]=s++}this.layerCount=s,this.createLayerGroups(e.layers)}if(this.hidePaper=this.hidePaper||n&&n.modelSpace,this.opCount=0,this.fontFaces=[],this.fontFamilies=[],this.viewports=[0],this.currentVpId=0,this.clips=[0],this.strings=[],this.stringDbIds=[],this.stringBoxes=[],this.currentStringNumber=-1,this.currentStringBox=new LmvBox3,this.objectNumber=0,this.currentFakeId=-2,this.imageNumber=0,this.maxObjectNumber=0,this.objectStack=[],this.objectNameStack=[],this.parseObjState={polyTriangle:{},viewport:{},clip:{},raster:{},text:{},fontDef:{},uknown:{}},this.layer=0,this.bgColor="number"==typeof n.bgColor?n.bgColor:4294967295,this.contrastColor=this.color=this.fillColor=4278190080,this.hidePaper&&(this.contrastColor=4294967040),this.currentVbb=new i.VertexBufferBuilder(!1),this.meshes=[],this.numCircles=this.numEllipses=this.numPolylines=this.numLineSegs=0,this.numPolytriangles=this.numTriangles=0,this.error=!1,this.offsetX=0,this.offsetY=0,t){this.manifestAvailable=!0,this.imageId2URI={};for(var h=t.assets,u=0,d=h.length;d>u;++u){var c=h[u],p=c.mime;if(-1!=p.indexOf("image/")){var f=c.id;f=f.substr(0,f.indexOf(".")),this.imageId2URI[f]=r+c.URI}"Autodesk.CloudPlatform.PropertyAttributes"==c.type&&this.propertydb.attrs.push(c.URI),"Autodesk.CloudPlatform.PropertyValues"==c.type&&this.propertydb.values.push(c.URI),"Autodesk.CloudPlatform.PropertyIDs"==c.type&&this.propertydb.ids.push(c.URI),"Autodesk.CloudPlatform.PropertyViewables"==c.type&&this.propertydb.viewables.push(c.URI),"Autodesk.CloudPlatform.PropertyOffsets"==c.type&&(-1!=c.id.indexOf("rcv")?this.propertydb.rcv_offsets.push(c.URI):this.propertydb.offsets.push(c.URI)),"Autodesk.CloudPlatform.PropertyAVs"==c.type&&this.propertydb.avs.push(c.URI),"Autodesk.CloudPlatform.PropertyRCVs"==c.type&&this.propertydb.rcvs.push(c.URI)}}}var t=Autodesk.Viewing,i=t.Private,r=Autodesk.LMVTK,n={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},o={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127};e.prototype.load=function(e,t){if(t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t,this.parse(),this.stringBoxes.length){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}e.loadDoneCB(!0)},e.prototype.loadFrames=function(e){this.loadContext=e;var t=e.data;if(t)t instanceof Uint8Array||(t=new Uint8Array(t)),this.data=t;else if(e.finalFrame&&(this.data=null,this.stringBoxes.length)){var i=new Float32Array(this.stringBoxes.length);i.set(this.stringBoxes),this.stringBoxes=i}this.parseFrames(e.finalFrame),e.loadDoneCB(!0)},e.prototype.flushBuffer=function(e,t){if(this.currentVbb.vcount||t){var n=t;if(n=n||this.currentVbb.isFull(e)){if(this.currentVbb.vcount){var o=this.currentVbb.toMesh();r.VBUtils.bboxUnion(this.bbox,o.boundingBox),this.meshes.push(o),o.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing},this.currentImage&&(o.material.image=this.currentImage,o.material.image.name=this.imageNumber++,this.currentImage=null),this.currentVbb=new i.VertexBufferBuilder}this.loadContext&&this.loadContext.loadDoneCB(!0,t)}}},e.prototype.tx=function(e){return this.sx(e)},e.prototype.ty=function(e){return this.sy(e)},e.prototype.sx=function(e){return e*this.scaleX},e.prototype.sy=function(e){return e*this.scaleY},e.prototype.invertColor=function(e){var t=255&e>>24,i=255&e>>16,r=255&e>>8,n=255&e;return i=255-i,r=255-r,n=255-n,t<<24|i<<16|r<<8|n},e.prototype.mapColor=function(e,t){if(!this.hidePaper)return e;if(0!==this.bgColor)return e;var i=255&e,r=(65280&e)>>8,n=(16711680&e)>>16,o=i===r&&i===n;return 127>i||o&&t&&(e=2583691263&e),e},e.prototype.restoreSignBitFromLSB=function(e){return 1&e?-(e>>>1):e>>>1},e.prototype.parsePointPositions=function(){var e=this.stream.getVarints(),t=this.stream.getVarints();return e=this.restoreSignBitFromLSB(e),t=this.restoreSignBitFromLSB(t),e+=this.offsetX,t+=this.offsetY,this.offsetX=e,this.offsetY=t,[this.tx(e),this.ty(t)]},e.prototype.parserAssert=function(e,t,r){return e!=t?(i.logger.warn("Expect "+t+"; actual type is "+e+"; in function "+r),this.error=!0,!0):!1},e.prototype.unhandledTypeWarning=function(e,t){i.logger.warn("Unhandled semantic type : "+t+" in function "+e)},e.prototype.parseObject=function(){var e=this.stream.getVarints();switch(this.objectStack.push(e),e){case o.st_sheet:this.objectNameStack.push("sheet"),this.objectMemberQueue.unshift("paperColor");break;case o.st_viewport:this.objectNameStack.push("viewport"),this.objectMemberQueue.unshift("units","transform");break;case o.st_clip:this.objectNameStack.push("clip"),this.objectMemberQueue.unshift("contourCounts","points","indices");break;case o.st_polytriangle:this.objectNameStack.push("polyTriangle"),this.objectMemberQueue.unshift("points","indices","colors");break;case o.st_raster:this.objectNameStack.push("raster"),this.objectMemberQueue.unshift("position","width","height","imageId");break;case o.st_text:this.currentStringNumber=this.strings.length,0===this.objectNumber&&(this.objectNumber=this.currentFakeId--),this.currentStringBox.makeEmpty(),this.objectNameStack.push("text"),this.objectMemberQueue.unshift("string","position","height","widthScale","rotation","oblique","charWidths");break;case o.st_font_def:this.objectNameStack.push("fontDef"),this.objectMemberQueue.unshift("name","fullName","flags","spacing","panose");break;case o.st_end_object:if(this.objectStack.pop(),this.objectStack.length){var t=this.objectStack.pop();switch(t){case o.st_polytriangle:this.actOnPolyTriangle();break;case o.st_viewport:this.actOnViewport();break;case o.st_clip:this.actOnClip();break;case o.st_raster:this.actOnRaster();break;case o.st_text:this.actOnText();break;case o.st_font_def:this.actOnFontDef()}var i=this.objectNameStack.pop(),r=this.parseObjState[i];for(var n in r)r[n]=null}else this.parserAssert(0,1,"parseEndObject (Stack Empty)");this.objectMemberQueue.length=0;break;default:this.objectNameStack.push("unknown"),this.error=!0,this.unhandledTypeWarning("parseObject",e)}},e.prototype.initSheet=function(e){if(this.bgColor=e,!this.hidePaper&&this.metadata){var t=this.paperWidth,i=this.paperHeight,r=this.currentVbb,n=.0075*t,o=4283782485,s=[0,0,t,0,t,i,0,i,n,-n,t+n,-n,t+n,0,n,0,t,0,t+n,0,t+n,i-n,t,i-n],a=[e,e,e,e,o,o,o,o,o,o,o,o],l=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11],h=0,u=-1;this.addPolyTriangle(s,a,l,4294967295,u,h,!1),r.addSegment(0,0,t,0,0,1e-6,4278190080,u,h,this.currentVpId),r.addSegment(t,0,t,i,0,1e-6,4278190080,u,h,this.currentVpId),r.addSegment(t,i,0,i,0,1e-6,4278190080,u,h,this.currentVpId),r.addSegment(0,i,0,0,0,1e-6,4278190080,u,h,this.currentVpId)}},e.prototype.setObjectMember=function(e){if(!this.objectMemberQueue.length)return i.logger.warn("Unexpected object member. "+e+" on object "+this.objectNameStack[this.objectNameStack.length-1]),!1;var t=this.objectMemberQueue.shift(),r=this.objectNameStack[this.objectNameStack.length-1];return"sheet"==r&&"paperColor"==t?(this.initSheet(e),!0):r?(this.parseObjState[r][t]=e,!0):!1},e.prototype.parseString=function(){var e=this.stream,t=e.getVarints(),r=e.getVarints(),n=e.getString(r);switch(t){case o.st_object_member:if(this.setObjectMember(n))return;break;default:i.logger.info("Unexpected opcode semantic type for string.")}return n},e.prototype.actOnFontDef=function(){var e=this.parseObjState.fontDef;this.fontDefs[++this.fontCount]=e,this.fontId=this.fontCount},e.prototype.parsePoint=function(){var e=this.stream,t=e.getVarints(),r=this.parsePointPositions();switch(t){case o.st_object_member:if(this.setObjectMember(r))return;break;default:i.logger.info("Unexpected opcode semantic type for point.")}return r},e.prototype.parsePointsArray=function(){var e=this.stream,t=e.getVarints(),r=e.getVarints();if(r){r/=2;for(var n,s=[],a=0;r>a;++a)n=this.parsePointPositions(),s.push(n[0]),s.push(n[1]);switch(t){case o.st_polyline:return this.actOnPolylinePointsArray(s),void 0;case o.st_dot:return this.actOnDot(s),void 0;case o.st_object_member:if(this.setObjectMember(s))return;break;default:i.logger.info("Unexpected opcode semantic type for points array.")}return s}},e.prototype.parseIntArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;i>n;++n)r.push(e.getUint32());switch(t){case o.st_object_member:if(this.setObjectMember(r))return;break;default:this.unhandledTypeWarning("parseIntArray",t)}return r},e.prototype.parseDoubleArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;i>n;++n)r.push(e.getFloat64());switch(t){case o.st_object_member:if(this.setObjectMember(r))return;break;default:this.unhandledTypeWarning("parseDoubleArray",t)}return r},e.prototype.parseByteArray=function(){for(var e=this.stream,t=e.getVarints(),i=e.getVarints(),r=[],n=0;i>n;++n)r.push(e.getUint8());switch(t){case o.st_object_member:if(this.setObjectMember(r))return;break;default:this.unhandledTypeWarning("parseByteArray",t)}return r},e.prototype.parseVarintArray=function(){for(var e=this.stream,t=e.getVarints(),i=[],r=e.getVarints(),n=0;r>n;++n)i.push(e.getVarints());switch(t){case o.st_object_member:if(this.setObjectMember(i))return;break;default:this.unhandledTypeWarning("parseVarIntArray",t)}return i},e.prototype.parseInt=function(){var e=this.stream,t=e.getVarints(),i=e.getUint32();switch(t){case o.st_color:this.color=this.mapColor(i,!1);break;case o.st_fill:this.fill=!0,this.fillColor=this.mapColor(i,!0);break;case o.st_object_member:if(this.setObjectMember(i))return;default:this.unhandledTypeWarning("parseInt",t)}return i},e.prototype.parseVoid=function(){var e=this.stream.getVarints();switch(e){case o.st_fill_off:this.fill=!1;break;default:this.unhandledTypeWarning("parseVoid",e)}},e.prototype.parseVarint=function(){var e=this.stream,t=e.getVarints(),i=e.getVarints();switch(t){case o.st_line_weight:this.lineWeight=this.tx(i);break;case o.st_object_id:case o.st_markup_id:this.objectNumber=i,this.maxObjectNumber=Math.max(this.maxObjectNumber,i);break;case o.st_layer:this.layer=this.layersMap[i];break;case o.st_font_ref:this.fontId=i;break;case o.st_object_member:if(this.setObjectMember(i))return;break;default:}return i},e.prototype.parseFloat=function(){var e=this.stream,t=e.getVarints(),i=e.getFloat32();switch(t){case o.st_miter_angle:break;
case o.st_miter_length:break;case o.st_object_member:if(this.setObjectMember(i))return;break;default:}return i},e.prototype.parseCircularArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,o.st_arc,"parseCircularArc")){var i=this.parsePointPositions(),r=e.getVarints(),n=e.getFloat32(),s=e.getFloat32();this.actOnCircularArc(i[0],i[1],n,s,this.sx(r))}},e.prototype.parseCircle=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,o.st_arc,"parseCircle")){var i=this.parsePointPositions(),r=e.getVarints();this.actOnCompleteCircle(i[0],i[1],this.sx(r))}},e.prototype.parseArc=function(){var e=this.stream,t=e.getVarints();if(!this.parserAssert(t,o.st_arc,"parseArc")){var i=this.parsePointPositions(),r=e.getVarints(),n=e.getVarints(),s=e.getFloat32(),a=e.getFloat32(),l=e.getFloat32();this.actOnArc(i[0],i[1],a,l,this.sx(r),this.sy(n),s)}},e.prototype.parseDataType=function(){var e=this.stream.getVarints();switch(e){case n.dt_void:this.parseVoid();break;case n.dt_int:this.parseInt();break;case n.dt_object:this.parseObject();break;case n.dt_varint:this.parseVarint();break;case n.dt_point_varint:this.parsePoint();break;case n.dt_float:this.parseFloat();break;case n.dt_point_varint_array:this.parsePointsArray();break;case n.dt_circular_arc:this.parseCircularArc();break;case n.dt_circle:this.parseCircle();break;case n.dt_arc:this.parseArc();break;case n.dt_int_array:this.parseIntArray();break;case n.dt_varint_array:this.parseVarintArray();break;case n.dt_byte_array:this.parseByteArray();break;case n.dt_string:this.parseString();break;case n.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,i.logger.info("Data type not supported yet: "+e)}},e.prototype.parse=function(){var e=this.stream=new r.InputStream(this.data),t=e.getString(3);if("F2D"!=t)return i.logger.error("Invalid F2D header : "+t),void 0;var n=e.getString(2);if("01"!=n)return i.logger.error("Only support f2d major version 1; actual version is : "+n),void 0;var o=e.getString(1);if("."!=o)return i.logger.error("Invalid version delimiter."),void 0;for(e.getString(2);e.byteLength>e.offset&&(this.parseDataType(),!this.error);)this.opCount++;this.flushBuffer(0,!0),this.currentVbb=null,this.stream=null,this.data=null,i.logger.info("F2d parse: data types count : "+this.opCount)},e.prototype.parseFrames=function(e){if(this.data)for(var t=this.stream=new r.InputStream(this.data);t.byteLength>t.offset&&(this.parseDataType(),!this.error);)this.opCount++;else e||i.logger.warn("Unexpected F2D parse state: If there is no data, we only expect a flush command, but flush was false.");e&&this.flushBuffer(0,!0),this.stream=null,this.data=null},e.prototype.actOnPolylinePointsArray=function(e){this.flushBuffer(),this.numPolylines++;for(var t=e.length/2,i=0,r=e[0],n=e[1],o=1;t>o;++o){var s=e[2*o],a=e[2*o+1];this.currentVbb.addSegment(r,n,s,a,i,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId),i+=Math.sqrt((s-r)*(s-r)+(a-n)*(a-n)),r=s,n=a}this.numLineSegs+=t-1},e.prototype.actOnDot=function(e){var t=e[0],i=e[1];this.actOnCompleteCircle(t,i,this.sx(1))},e.prototype.actOnCompleteCircle=function(e,t,i){this.flushBuffer(),this.numCircles++,this.fill?this.currentVbb.addSegment(e,t,e,t,0,2*i,this.color,this.objectNumber,this.layer,this.currentVpId,!0,!1,!0):this.currentVbb.addArc(e,t,0,2*Math.PI,i,i,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},e.prototype.actOnCircularArc=function(e,t,i,r,n){this.numCircles++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,r,n,n,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},e.prototype.actOnArc=function(e,t,i,r,n,o,s){this.numEllipses++,this.flushBuffer(),this.currentVbb.addArc(e,t,i,r,n,o,s,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},e.prototype.actOnRaster=function(){if(this.manifestAvailable){this.flushBuffer(4,!0);var e=this.parseObjState.raster,t=e.position,i=e.imageId,r=this.imageId2URI[i],n=this.sx(e.width),o=this.sy(e.height),s=t[0]+.5*n,a=t[1]-.5*o;this.currentVbb.addTexturedQuad(s,a,n,o,0,4278255615,this.objectNumber,this.layer,this.currentVpId),this.currentImage={dataURI:r},this.flushBuffer(0,!0)}},e.prototype.actOnClip=function(){var e=this.parseObjState.clip;this.parseObjState.clip={},this.clips.push(e)},e.prototype.actOnText=function(){this.strings[this.currentStringNumber]=this.parseObjState.text.string,this.stringDbIds[this.currentStringNumber]=this.objectNumber,this.stringBoxes.push(this.currentStringBox.min.x,this.currentStringBox.min.y,this.currentStringBox.max.x,this.currentStringBox.max.y),this.currentStringBox.makeEmpty(),this.currentStringNumber=-1,-1>this.objectNumber&&(this.objectNumber=0)};var s=new LmvVector3;e.prototype.addPolyTriangle=function(e,t,r,n,a,l,h){function u(e,t){if(e>t){var i=e;e=t,t=i}if(f[e]){var r=f[e],n=r.lastIndexOf(t);-1==n?r.push(t):r[n]=-1}else f[e]=[t]}function d(){for(var r=0,o=f.length;o>r;r++){var s=f[r];if(s)for(var h=0;s.length>h;h++){var u=s[h];-1!=u&&(p.flushBuffer(4),p.currentVbb.addSegment(e[2*r],e[2*r+1],e[2*u],e[2*u+1],0,g,p.mapColor(t?t[r]:n,!0),a,l,p.currentVpId),t&&t[r]!=t[u]&&i.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}}}function c(r,o){if(r>o){var s=r;r=o,o=s}var h=f[r];if(h){var u=h.indexOf(o);-1!=u&&(p.flushBuffer(4),p.currentVbb.addSegment(e[2*r],e[2*r+1],e[2*o],e[2*o+1],0,g,p.mapColor(t?t[r]:n,!0),a,l,p.currentVpId),t&&t[r]!=t[o]&&i.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}}var p=this,f=null,g=-1;if(this.objectStack[this.objectStack.length-1]==o.st_text&&(g=-.5),h){f=Array(e.length/2);for(var m=0,v=r.length;v>m;m+=3){var y=r[m],b=r[m+1],E=r[m+2];u(y,b),u(b,E),u(E,y)}}if(-1!==this.currentStringNumber)for(var w=e.length/2,m=0;w>m;++m)s.set(e[2*m],e[2*m+1],0),this.currentStringBox.expandByPoint(s);if(this.currentVbb.useInstancing)for(var w=r.length,m=0;w>m;m+=3){var y=r[m],b=r[m+1],E=r[m+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(e[2*y],e[2*y+1],e[2*b],e[2*b+1],e[2*E],e[2*E+1],this.mapColor(t?t[y]:n,!0),a,l,this.currentVpId),h&&(c(y,b),c(b,E),c(E,y))}else{var w=e.length/2;this.flushBuffer(w);for(var _=this.currentVbb,T=_.vcount,m=0;w>m;++m){var S=e[2*m],x=e[2*m+1];_.addVertexPolytriangle(S,x,this.mapColor(t?t[m]:n,!0),a,l,this.currentVpId)}_.addIndices(r,T),h&&d()}},e.prototype.actOnPolyTriangle=function(){var e=this.parseObjState.polyTriangle;this.parseObjState.polyTriangle={};var t=e.points,r=e.indices,n=e.colors;return t&&r?(this.numPolytriangles++,this.numTriangles+=r.length/3,this.addPolyTriangle(t,n,r,this.color,this.objectNumber,this.layer,!0),void 0):(i.logger.warn("Malformed polytriangle."),void 0)},e.prototype.actOnViewport=function(){var e=this.parseObjState.viewport;this.parseObjState.viewport={},this.viewports.push(e),this.currentVpId=this.viewports.length-1},e.prototype.createLayerGroups=function(e){function t(e){var i=Object.keys(e.childrenByName).map(function(t){return e.childrenByName[t]});if(delete e.childrenByName,i.length){e.children=i,e.childCount=0;for(var r=0;i.length>r;++r)e.childCount+=t(i[r]);i.sort(function(e,t){return e.isLayer&&!t.isLayer?-1:!e.isLayer&&t.isLayer?1:e.name.localeCompare(t.name,void 0,{sensitivity:"base",numeric:!0})})}return e.isLayer?1:e.childCount}var i=this.layersRoot={name:"root",id:"root",childrenByName:{},isLayer:!1},r=0,n=0;for(var o in e){var s=parseInt(o),a=e[o],l="string"==typeof a?a:a.name;l||(l=o);var h=l.split("|"),u=i;if(h.length>1)for(var d=0;h.length-1>d;++d){var c=h[d],p=u.childrenByName[c];p||(p={name:c,id:"group-"+r++,childrenByName:{},isLayer:!1},u.childrenByName[c]=p),u=p}u.childrenByName[l]={name:l,index:s,id:n++,childrenByName:{},isLayer:!0}}t(this.layersRoot)},r.F2D=e,r.F2dDataType=n,r.F2dSemanticType=o}(),function(){"use strict";function e(){this.data=null,this.frameStart=0,this.frameEnd=0,this.stream=null,this.opCount=0,this.marker={frameStart:this.frameStart,frameEnd:this.frameEnd}}var t=Autodesk.LMVTK;e.prototype.load=function(e){return this.data=e,this.frameStart=0,this.stream?(this.stream.reset(this.data),this.stream.seek(0),this.frameEnd=0):(this.stream=new t.CheckedInputStream(this.data),this.stream.seek(8),this.frameStart=8,this.frameEnd=8),this.probe(),this.marker.frameStart=this.frameStart,this.marker.frameEnd=this.frameEnd,this.marker};var i=t.F2dDataType,r=t.F2dSemanticType;e.prototype.readColor=function(){var e=this.stream;e.getVarints(),e.getVarints(),e.skipUint32()},e.prototype.parsePointPositions=function(){this.stream.getVarints(),this.stream.getVarints()},e.prototype.unhandledTypeWarning=function(e,t){avp.logger.warn("Unhandled semantic type when probing F2d : "+t+" in function "+e)},e.prototype.parseObject=function(){this.stream.getVarints()},e.prototype.parseString=function(){var e=this.stream;e.getVarints();var t=e.getVarints();e.skipBytes(t)},e.prototype.parsePoint=function(){this.stream.getVarints(),this.parsePointPositions()},e.prototype.parseVarintArray=function(){var e=this.stream;e.getVarints();for(var t=e.getVarints(),i=0;t>i;++i)e.getVarints()},e.prototype.parseByteArray=function(){var e=this.stream;e.getVarints();var t=e.getVarints();e.skipBytes(t)},e.prototype.parseEndOfObject=function(){var e=this.stream;e.getVarints(),e.getVarints()},e.prototype.parsePointsArray=function(){var e=this.stream;e.getVarints();var t=e.getVarints();if(t){t/=2;for(var i=0;t>i;++i)this.parsePointPositions()}},e.prototype.parsePoint=function(){var e=this.stream;e.getVarints(),this.parsePointPositions()},e.prototype.parseInt=function(){var e=this.stream,t=e.getVarints();switch(t){case r.st_color:e.skipUint32();break;case r.st_fill:e.skipUint32();break;default:e.skipUint32(),this.unhandledTypeWarning("parseInt",t)}},e.prototype.parseVoid=function(){var e=this.stream.getVarints();switch(e){case r.st_fill_off:break;default:this.unhandledTypeWarning("parseVoid",e)}},e.prototype.parseVarint=function(){this.stream.getVarints(),this.stream.getVarints()},e.prototype.parseIntArray=function(){var e=this.stream;e.getVarints();for(var t=e.getVarints(),i=0;t>i;++i)e.skipUint32()},e.prototype.parseFloat=function(){var e=this.stream;e.getVarints(),e.getFloat32()},e.prototype.parseDoubleArray=function(){var e=this.stream;e.getVarints();for(var t=e.getVarints(),i=0;t>i;++i)e.skipFloat64()},e.prototype.parseCircularArc=function(){var e=this.stream;e.getVarints(),this.parsePointPositions(),e.getVarints(),e.getFloat32(),e.getFloat32()},e.prototype.parseCircle=function(){var e=this.stream;e.getVarints(),this.parsePointPositions(),e.getVarints()},e.prototype.parseArc=function(){var e=this.stream;e.getVarints(),this.parsePointPositions(),e.getVarints(),e.getVarints(),e.getFloat32(),e.getFloat32(),e.getFloat32()},e.prototype.parseDataType=function(){var e=this.stream.getVarints();switch(e){case i.dt_void:this.parseVoid();break;case i.dt_int:this.parseInt();break;case i.dt_object:this.parseObject();break;case i.dt_varint:this.parseVarint();break;case i.dt_float:this.parseFloat();break;case i.dt_point_varint:this.parsePoint();break;case i.dt_point_varint_array:this.parsePointsArray();break;case i.dt_circular_arc:this.parseCircularArc();break;case i.dt_circle:this.parseCircle();break;case i.dt_arc:this.parseArc();break;case i.dt_varint_array:this.parseVarintArray();break;case i.dt_int_array:this.parseIntArray();break;case i.dt_byte_array:this.parseByteArray();break;case i.dt_string:this.parseString();break;case i.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,avp.logger.error("Bad op code encountered : "+e+" , bail out.")}this.error||(this.frameEnd=this.stream.offset)},e.prototype.probe=function(){var e=this.stream;try{for(;e.byteLength>e.offset&&(this.parseDataType(),!this.error);)this.opCount++}catch(t){t.stack?""+t.stack:"..."}},t.F2DProbe=e}(),function(){"use strict";function e(e){this.buffer=e,this.offset=0,this.byteLength=e.length,this.convBuf=new ArrayBuffer(8),this.convUint8=new Uint8Array(this.convBuf),this.convUint16=new Uint16Array(this.convBuf),this.convInt32=new Int32Array(this.convBuf),this.convUint32=new Uint32Array(this.convBuf)}function t(e){this.offset=e,this.message="try to access an offset that is out of bounds: "+this.offset,this.toString=function(){return this.message}}var i=Autodesk.LMVTK;e.prototype.boundsCheck=function(e){if(e>=this.byteLength)throw new t(e)},e.prototype.seek=function(e){this.boundsCheck(e),this.offset=e},e.prototype.getBytes=function(e){this.boundsCheck(this.offset+e);var t=new Uint8Array(this.buffer.buffer,this.offset,e);return this.offset+=e,t},e.prototype.skipBytes=function(e){this.boundsCheck(this.offset+e),this.offset+=e},e.prototype.getVarints=function(){var e,t=0,i=0;do this.boundsCheck(this.offset),e=this.buffer[this.offset++],t|=(127&e)<<i,i+=7;while(128&e);return t},e.prototype.getUint8=function(){return this.boundsCheck(this.offset+1),this.buffer[this.offset++]},e.prototype.getUint16=function(){return this.boundsCheck(this.offset+2),this.convUint8[0]=this.buffer[this.offset++],this.convUint8[1]=this.buffer[this.offset++],this.convUint16[0]},e.prototype.getInt16=function(){var e=this.getUint16();return e>32767&&(e=4294901760|e),e},e.prototype.getInt32=function(){this.boundsCheck(this.offset+4);var e=this.buffer,t=this.convUint8,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,this.convInt32[0]},e.prototype.getUint32=function(){this.boundsCheck(this.offset+4);var e=this.buffer,t=this.convUint8,i=this.offset;return t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2],t[3]=e[i+3],this.offset+=4,this.convUint32[0]},e.prototype.skipUint32=function(){this.boundsCheck(this.offset+4),this.offset+=4},e.prototype.getFloat32=function(){return this.boundsCheck(this.offset+4),this.offset+=4,0},e.prototype.getFloat64=function(){return this.boundsCheck(this.offset+8),this.offset+=8,0},e.prototype.skipFloat64=function(){this.boundsCheck(this.offset+8),this.offset+=8},e.prototype.reset=function(e){this.buffer=e,this.offset=0,this.byteLength=e.length},i.CheckedInputStream=e}(),function(){"use strict";function e(e){var t=e.split("/");if(0==t.length)return e;for(var i=[],r=0;t.length>r;++r){var n=t[r];"."!==n&&(".."===n&&i.length?i.pop():i.push(n))}return 0==i.length?"":i.join("/")}function t(e,t){for(var i=e.length-t,r=new ArrayBuffer(i),n=new Uint8Array(r,0),o=0,s=t;i>o;o++,s++)n[o]=255&e.charCodeAt(s);return n}function i(e,t){return-1!==t.indexOf("file://")?!1:-1!==t.indexOf("://")?!0:e?!0:void 0}function r(e,t,i,r){function n(e){if("json"==r.responseType)try{return JSON.parse(e.toString("utf8"))}catch(t){i(t)}return e}0===e.indexOf("file://")&&(e=e.substr(7)),require("fs").readFile(e,function(o,s){o?i(0,0,{httpStatusText:o,url:e}):31==s[0]&&139==s[1]?require("zlib").gunzip(s,null,function(o,s){o?i(0,0,{httpStatusText:o,url:e}):(s=n(s),r.ondata&&r.ondata(s),t(s))}):(s=n(s),r.ondata&&r.ondata(s),t(s))})}function n(e,t){t.hasOwnProperty("asynchronous")?t.asynchronous||s.logger.warn("LMV: Sync XHR used. Performance warning."):t.asynchronous=!0,t.hasOwnProperty("responseType")||(t.responseType="arraybuffer"),t.withCredentials=!!e.auth,t.headers=e.headers,t.queryParams=e.queryParams,t.endpoint=e.endpoint}var o=Autodesk.Viewing,s=o.Private;s.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window;var a;"undefined"!=typeof XMLHttpRequest?a=XMLHttpRequest:(a=require("xhr2"),a.prototype._restrictedHeaders.cookie=!1);var l={},h=!1;l.OSS_PREFIX="urn:adsk.objects:os.object:",l.getDirectOSSUrl=function(t,i){var r=i.indexOf(l.OSS_PREFIX);if(-1!==r){var n=i.substr(r+l.OSS_PREFIX.length),s=n.substr(0,n.indexOf("/")),a=n.substr(n.indexOf("/")+1);return a=e(a),o.makeOssPath(t.endpoint,s,a)}},l.generateUrl=function(t,i,r){if(r=e(r),0!==r.indexOf("urn:"))return r;switch("items"!==i&&(r=r.substr(4)),i){case"items":return o.getItemApi(t)+r;case"bubbles":return o.getManifestApi(t)+r;case"thumbnails":return o.getThumbnailApi(t)+r}},l.rawGet=function(e,n,u,d,c,p){function f(){c&&c(v.status,v.statusText,{url:u})}function g(e){if(200===v.status)if(v.response&&v.response instanceof ArrayBuffer){var t=new Uint8Array(v.response);if(!p.skipDecompress&&31==t[0]&&139==t[1]){h||(h=!0,s.logger.warn("An LMV resource ("+u+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{t=new Zlib.Gunzip(t).decompress()}catch(i){c(o.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:u,exception:""+i,stack:i.stack})}}d(t)}else d(v.response||v.responseText);else f(e)}var p=p?p:{};if(o.isNodeJS&&!i(e,u))return r(u,d,c,p),void 0;var m=l.getDirectOSSUrl(p,u);u=m?m:l.generateUrl(e,n,u),p.queryParams&&(u=u+"?"+p.queryParams);var v=new a;try{var y=p.hasOwnProperty("asynchronous")?p.asynchronous:!0;if(v.open(p.noBody?"HEAD":"GET",u,y),p.hasOwnProperty("responseType")&&(v.responseType=p.responseType),v.withCredentials=!0,p.hasOwnProperty("withCredentials")&&(v.withCredentials=p.withCredentials),p.headers)for(var b in p.headers)v.setRequestHeader(b,p.headers[b]),"authorization"===b.toLocaleLowerCase()&&(v.withCredentials=!1);y&&(v.onload=g,v.onerror=f,v.ontimeout=f,p.ondata&&(v.overrideMimeType("text/plain; charset=x-user-defined"),p._dlProgress={streamOffset:0,counter:0},v.onreadystatechange=function(){if(v.readyState>2){var e=v.responseText;if(p._dlProgress.streamOffset>=e.length)return;var i=t(e,p._dlProgress.streamOffset);p._dlProgress.streamOffset=e.length,p.ondata(i)}})),v.send(),p.skipAssetCallback||(s.inWorkerThread?self.postMessage({assetRequest:[u,p.headers,null]}):s.assets.push([u,p.headers,null])),y||g()}catch(E){c(v.status,v.statusText,{url:u,exception:E})}},l.defaultFailureCallback=function(e,t,i){403==e?this.raiseError(o.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:i.url,httpStatus:e,httpStatusText:t}):404==e?this.raiseError(o.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:i.url,httpStatus:e,httpStatusText:t}):e>=500&&600>e?this.raiseError(o.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:i.url,httpStatus:e,httpStatusText:t}):i.exception?this.raiseError(o.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:i.url,exception:""+i.exception,stack:i.exception.stack}):this.raiseError(o.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:i.url,httpStatus:e,httpStatusText:t,data:i})},l.getItem=function(e,t,i,r,o){o=o||{},n(e,o),l.rawGet(e.endpoint,"items",t,i,r,o)},l.getManifest=function(e,t,i,r,o){o=o||{},o.hasOwnProperty("responseType")||(o.responseType="json"),n(e,o),l.rawGet(e.endpoint,"bubbles",t,i,r,o)},l.getThumbnail=function(e,t,i,r,o){if(o=o||{},n(e,o),!o.queryParams){var s=o.role||"rendered",a=o.size||400;o.queryParams="guid="+encodeURIComponent(o.guid)+"&role="+s+"&width="+a+"&height="+a}l.rawGet(e.endpoint,"thumbnails",t,i,r,o)},l.getACMSession=function(e,t,i,r){var n,s={};for(var a in t)"oauth2AccessToken"===a?n=t[a]:-1!==a.indexOf("x-ads-acm")&&(s[a]=t[a]),o.isMobileDevice()&&(o.HTTP_REQUEST_HEADERS=s);s.application="autodesk";var l=new XMLHttpRequest;l.open("POST",e+"/oss-ext/v1/acmsessions",!0),l.setRequestHeader("Content-Type","application/json"),l.setRequestHeader("Authorization","Bearer "+n),l.responseType="json",l.onload=function(){if(200===l.status&&l.response){var e="string"==typeof l.response?JSON.parse(l.response):l.response;e&&e.acmsession?i(e.acmsession):r(l.status,"Can't get acm session from response.")}else r(l.status)},l.onerror=r,l.ontimeout=r,l.send(JSON.stringify(s)),delete s.application},s.ViewingService=l}(),function(){function e(e,t){try{t()}catch(r){e.raiseError(i.ErrorCodes.BAD_DATA,"Unhandled exception while reading pack file",{url:e.url,exception:""+r,stack:r.stack})}}function t(t){function o(n){s.postMessage({url:t.url,workerId:t.workerId,progress:.5}),e(t,function(){for(var e=new r.PackFileReader(n),o=!1,a=0,l=0,h=e.getEntryCounts();h>l;l++){var u=r.readGeometry(e,l,null,null,0,!0);a+=u&&u.sharedBufferBytes||0}for(var d=a?new ArrayBuffer(a):null,c=0,p={packId:t.packId,workerId:t.workerId,progress:1,meshes:[],sharedBuffer:d},f=d?[d]:[],l=0,h=e.getEntryCounts();h>l;l++){var u=r.readGeometry(e,l,null,d,c);u?(c+=u.sharedBufferBytes||0,p.meshes[l]=u):(o||(s.raiseError(i.ErrorCodes.BAD_DATA,"Unable to load geometry",{url:t.url}),o=!0),s.postMessage(p))}s.postMessage(p,f)})}var s=t.worker;n.ViewingService.getItem(t,t.url,o,t.onFailureCallback)}var i=Autodesk.Viewing,r=Autodesk.LMVTK,n=i.Private;r.doGeomLoad=t}(),function(){"use strict";function e(e,t){try{t()}catch(i){e.worker.raiseError(r.ErrorCodes.BAD_DATA,"Unhandled exception while loading SVF",{url:e.url,exception:""+i,stack:i.stack}),e.worker.postMessage(null)}}function t(t){var i=t.worker;e(t,function(){function e(e,o){if("svf"==e){var s,a,l=n.fragments,h=[l.transforms.buffer,l.packIds.buffer,l.entityIndexes.buffer,l.fragId2dbId.buffer];n.bvh?(a={nodes:n.bvh.nodes.getRawData(),primitives:n.bvh.primitives,useLeanNodes:32==n.bvh.nodes.bytes_per_node},h.push(a.nodes),h.push(a.primitives.buffer),h.push(l.boxes.buffer),h.push(l.polygonCounts.buffer),h.push(l.materials.buffer),s={svf:n,bvh:a,progress:1}):s={svf:n,progress:.8},i.postMessage(s,h)}else if("bvh"==e)a={nodes:n.bvh.nodes.getRawData(),primitives:n.bvh.primitives,useLeanNodes:32==n.bvh.nodes.bytes_per_node},i.postMessage({bvh:a,basePath:n.basePath,progress:1},[a.nodes,a.primitives.buffer]);else if("mesh"==e){var u=[];o.mesh&&u.push(o.mesh.vb.buffer),i.postMessage(o,u)}else"done"==e?i.postMessage({progress:1}):(i.raiseError(r.ErrorCodes.BAD_DATA,"Failure while loading SVF",{url:t.url}),i.postMessage(null))}var n=t.svf;t.loadDoneCB=e,n.loadRemainingSvf(t)})}function i(i){function r(r){s.postMessage({progress:.5}),e(i,function(){var e;e="gltf"===a||"glb"===a?new o.GltfPackage(r):i.perfOpt&&i.perfOpt.memoryOptimizedSvfLoading?new o.PackageLess(new Uint8Array(r)):new o.Package(new Uint8Array(r)),i.svf=e,e.loadManifest(i),i.interceptManifest?s.postMessage({manifest:e.manifest}):(i.manifest=e.manifest,t(i))})}var s=i.worker;s.postMessage({progress:.01});var a="svf",l=i.url.toLocaleLowerCase();l.lastIndexOf(".gltf")===l.length-5&&(a="gltf"),l.lastIndexOf(".glb")===l.length-4&&(a="glb");var h={responseType:"gltf"===a?"json":"arraybuffer"};n.ViewingService.getItem(i,i.url,r,i.onFailureCallback,h),n.ViewingService.getItem(i,i.basePath+"0.pf",function(){},function(){},h)}var r=Autodesk.Viewing,n=r.Private,o=Autodesk.LMVTK;o.doLoadSvf=i,o.doLoadSvfContinued=t}(),function(){"use strict";function e(e,i,r){function n(){var e=[];return e.push({filename:"objects_attrs.json",storage:a.attrs}),e.push({filename:"objects_vals.json",storage:a.values}),e.push({filename:"objects_avs.json",storage:a.avs}),e.push({filename:"objects_offs.json",storage:a.offsets}),e.push({filename:"objects_ids.json",storage:a.ids}),e}function o(i){if(c--,i||p++,!c)if(p){if(d)return e.worker.propdbFailed=!0,r(null),void 0;d=!0,h=n(),c=h.length,p=0,h.forEach(function(i){t(i.filename,e,o,i.storage)})}else e.worker.propdb=new l.PropertyDatabase(a),r(e.worker.propdb),e.worker.propdbFailed=!1,e.worker.propdbURL=e.url}if(e.worker.propdb)return r(e.worker.propdb),void 0;if(e.worker.propdbFailed)return r(null),void 0;var s=e.propertydb;if(!s)return e.worker.propdbFailed=!0,r(null),void 0;var a={ids:{},attrs:{},offsets:{},values:{},avs:{}},h=[];h.push({filename:s.attrs.length?s.attrs[0]:"objects_attrs.json.gz",storage:a.attrs}),h.push({filename:s.values.length?s.values[0]:"objects_vals.json.gz",storage:a.values}),h.push({filename:s.avs.length?s.avs[0]:"objects_avs.json.gz",storage:a.avs}),h.push({filename:s.offsets.length?s.offsets[0]:"objects_offs.json.gz",storage:a.offsets}),h.push({filename:s.ids.length?s.ids[0]:"objects_ids.json.gz",storage:a.ids});for(var u=0;h.length>u;u++)h[u].filename=h[u].filename.replace(/\\/g,"/");var d=!1,c=h.length,p=0;h.forEach(function(i){t(i.filename,e,o,i.storage)})}function t(e,t,i,r){function n(e,r,n){404!==e&&t.onFailureCallback(e,r,n),i(null)}var o=t.url+e,s=function(t){r[e]=t,i(t)};u.ViewingService.getItem(t,o,s,n)}function i(t){function i(e){if(e)if(n!==void 0){var i=[];if(n&&n.length)for(var s=0;n.length>s;s++){var a=e.getObjectProperties(n[s],o);a&&i.push(a)}else for(var s=1,l=e.getObjectCount();l>=s;s++){var a=e.getObjectProperties(s,o);a&&i.push(a)}t.worker.postMessage({cbId:t.cbId,result:i})}else{var a=e.getObjectProperties(r,o);t.worker.postMessage({cbId:t.cbId,result:a})}}var r=t.dbId,n=t.dbIds,o=t.propFilter;e(t,r,i)}function r(e,t,i){function r(t,i,r){var n=e.getIndex(t);o(t,n);for(var s=6*r,l=6*n,h=0;3>h;h++)a[s+h]>a[l+h]&&(a[s+h]=a[l+h]),a[l+h+3]>a[s+h+3]&&(a[s+h+3]=a[l+h+3])}function n(e,t,r){for(var n=6*e,o=6*r,s=0;3>s;s++)a[o+s]>i[n+s]&&(a[o+s]=i[n+s]),i[n+s+3]>a[o+s+3]&&(a[o+s+3]=i[n+s+3])}function o(t,i){var o=6*i;a[o]=a[o+1]=a[o+2]=1/0,a[o+3]=a[o+4]=a[o+5]=-1/0,e.getNumChildren(t)&&e.enumNodeChildren(t,r,!0),e.getNumFragments(t)&&e.enumNodeFragments(t,n)}var s=e.getIndex(t),a=e.nodeBoxes;o(t,s)}function n(e){for(var t={},i=0,r=e.length;r>i;i++){var n=e[i];Array.isArray(n)||(n=[n]);for(var o=0;n.length>o;o++){var s=n[o],a=t[s];void 0===a?t[s]=i:Array.isArray(a)?a.push(i):t[s]=[a,i]}}return t}function o(t){function i(e){if(!e)return o.postMessage({cbId:t.cbId,error:{instanceTree:null,maxTreeDepth:0}}),void 0;var i;t.fragToDbId&&(i=n(t.fragToDbId)),t.worker.rootsDone||(t.worker.idroots=e.findRootNodes(),t.worker.objCount=e.getObjectCount(),t.worker.rootsDone=!0);var s,a,l=[0],h=[],d=t.worker.idroots;if(d&&d.length){if(a=new u.InstanceTreeStorage(e.getObjectCount(),t.fragToDbId.length),1==d.length)s=d[0],e.buildObjectTreeFlat(s,0,i,0,l,a);else{s=0;for(var c=[],p=0;d.length>p;p++)e.buildObjectTreeFlat(d[p],0,i,0,l,a),c.push(d[p]);a.setNode(0,0,"",0,c,!1)}if(a.flatten(),h.push(a.nodes.buffer),h.push(a.children.buffer),t.fragBoxes){var f=new u.InstanceTreeAccess(a,s);r(f,s,t.fragBoxes),h.push(f.nodeBoxes.buffer)}}o.postMessage({cbId:t.cbId,result:{rootId:s,instanceTreeStorage:a,instanceBoxes:f?f.nodeBoxes:void 0,maxTreeDepth:l[0],objectCount:t.worker.objCount}},h)}var o=t.worker;e(t,null,i)}function s(t){function i(e){if(e){var i=e.bruteForceSearch(t.searchText,t.attributeNames,t.completeInfo);r.postMessage({cbId:t.cbId,result:i})}}var r=t.worker;e(t,null,i)}function a(t){function i(e){if(e){var i=e.getExternalIdMapping();r.postMessage({cbId:t.cbId,result:i})}}var r=t.worker;e(t,null,i)}var l=Autodesk.LMVTK,h=Autodesk.Viewing,u=h.Private;l.doBuildExternalIdMapping=a,l.doPropertyGet=i,l.doPropertySearch=s,l.doObjectTreeParse=o}(),function(){"use strict";function e(e){var t=e.worker,i=base64.decode(e.delta);i=i.split("").map(function(e){return e.charCodeAt(0)});for(var r=new Zlib.Inflate(i),n=r.decompress(),o="",s=0;n.length>s;s++)o+=String.fromCharCode(n[s]);o=JSON.parse(o),t.postMessage({cbId:e.cbId,index:e.index,res:o})}var t=Autodesk.LMVTK;t.doDecompressDelta=e}(),function(){"use strict";function e(e,t){try{t()}catch(i){e.raiseError(r.ErrorCodes.BAD_DATA,"",{exception:""+i,stack:i.stack}),e.postMessage(null)}}function t(t){var i=t.worker;if(i.postMessage({progress:.01}),t.data){i.postMessage({progress:.5});var o=new n.F2D(t.metadata,t.manifest,t.basePath,t.f2dLoadOptions);t.loadDoneCB=function(e){if(e){var t={f2d:o};i.postMessage(t)}else i.raiseError(r.ErrorCodes.BAD_DATA,"",{}),i.postMessage(null)},e(i,function(){o.load(t,t.data)})}else i.postMessage(null)}function i(t){function i(e,i){if(e){if(!s.meshes.length&&!i)return;var n={f2dframe:!0,meshes:s.meshes,baseIndex:s.F2D_MESH_COUNT_OLD,bbox:s.bbox};t.finalFrame&&(n.cumulativeProps={maxObjectNumber:s.maxObjectNumber,viewports:s.viewports,clips:s.clips,strings:s.strings,stringDbIds:s.stringDbIds,stringBoxes:s.stringBoxes},n.finalFrame=i);for(var a=[],l=0,h=s.meshes.length;h>l;++l)a.push(s.meshes[l].vb.buffer),a.push(s.meshes[l].indices.buffer);o.postMessage(n,a),s.F2D_MESH_COUNT_OLD+=s.meshes.length,s.meshes=[]}else o.raiseError(r.ErrorCodes.BAD_DATA,"",{}),o.postMessage(null)}var o=t.worker,s=o.f2d;if(!s){o.postMessage({progress:.5}),s=o.f2d=new n.F2D(t.metadata,t.manifest,t.basePath,t.f2dLoadOptions),s.F2D_MESH_COUNT_OLD=0;var a={f2dframe:s};o.postMessage(a)}t.loadDoneCB=i,e(o,function(){s.loadFrames(t)})}var r=Autodesk.Viewing,n=Autodesk.LMVTK;n.doParseF2D=t,n.doParseF2DFrame=i}(),function(){"use strict";function e(e,t,i){var r=e.basePath+t;n.ViewingService.getItem(e,r,i,null)}function t(t){var n=t.worker;n.postMessage({progress:.01});var s,a,l=0;e(t,"metadata.json.gz",function(e){try{s=JSON.parse(o.utf8ArrayToString(e)),l++}catch(n){self.raiseError(r.ErrorCodes.BAD_DATA,"")}2===l&&i(t,a,s)}),e(t,"manifest.json.gz",function(e){try{e&&(a=JSON.parse(o.utf8ArrayToString(e))),l++}catch(r){}2===l&&i(t,a,s)})}function i(e,t,i){function r(r){if(h.postMessage({type:"F2DAssetURL",urls:d}),d=null,s){var n={type:"F2DSTREAM",finalFrame:!0,finished:!0,progress:1};return b||(n.manifest=t,n.metadata=i,n.basePath=e.basePath,b=!0),h.debug("Total text bytes count : "+r.length),h.postMessage(n),void 0}m.length>v&&(m=new Uint8Array(m.buffer.slice(0,v)));var o;if(31==m[0]&&139==m[1])try{o=new Uint8Array(m.buffer,0,v),o=new Zlib.Gunzip(o).decompress()}catch(a){}var n={type:"F2DBLOB",metadata:i,manifest:t,basePath:e.basePath,progress:1,buffer:o.buffer},l=[];l.push(o.buffer),h.postMessage(n,l)}function a(r){if(r.length+v>m.length){var o=Math.max(2*m.length,r.length+v),a=new Uint8Array(o);a.set(m),m=a}if(m.set(r,v),v+=r.length,s){if(g&&(g=!1,31==m[0]&&139==m[1]))return n.logger.error("F2D streaming broken by non-streaming unzip!"),s=!1,void 0;var u=new Uint8Array(m.buffer,y,v-y);try{var d=f.load(u);if(d.frameEnd>d.frameStart){var c=m.buffer.slice(y+d.frameStart,y+d.frameEnd);y+=d.frameEnd;var p=[];p.push(c);var E={type:"F2DSTREAM",frames:c,finalFrame:!1};l&&(E.progress=y/l),b||(E.manifest=t,E.metadata=i,E.basePath=e.basePath,b=!0),h.postMessage(E,p)}}catch(w){debug(w)}}}var l,h=e.worker,u=e.url,d=[];if(t&&t.assets)for(var c=t.assets,p=0;c.length>p;p++)if(-1!=u.indexOf(c[p].URI)){l=c[p].usize||0;break}var f=new o.F2DProbe,g=!0,m=new Uint8Array(65536),v=0,y=0,b=!1;n.ViewingService.getItem(e,u,r,e.onFailureCallback,{ondata:a,responseType:""})}var r=Autodesk.Viewing,n=r.Private,o=Autodesk.LMVTK,s=!0;o.doStreamF2D=t}(),function(){function e(e,t,i,r,n){function o(e){r(null,e)}function s(e){r(e)}l.ViewingService.getItem(e,t,o,s,{responseType:i,skipAssetCallback:!0,noBody:n})}function t(e,t,i,r,n){function o(e){r(null,e)}function s(e){r(e)}var a="urn:"+t;l.ViewingService.getThumbnail(e,a,o,s,{asynchronous:!0,role:"rendered",size:400,guid:i,skipAssetCallback:!0,noBody:n})}function i(e,t){-1!==e.indexOf("$file$")&&(e=e.replace("$file$",""));var i=e.slice(0,e.lastIndexOf("/")+1),r=i.slice(i.indexOf("/")+1),n="";t.urn=e,t.basePath=i,t.localPath=n+r,t.rootFileName=e.slice(e.lastIndexOf("/")+1)}function r(t,r,n,o){var a=[];(function h(e){if("Autodesk.CloudPlatform.PropertyDatabase"===e.role||"graphics"===e.role||"Autodesk.CloudPlatform.DesignDescription"===e.role){var t={mime:e.mime};i(e.urn,t),a.push(t)}if("geometry"===e.type&&"true"===e.hasThumbnail){var t={mime:"thumbnail",urn:r.urn,guid:e.guid};t.localPath="thumbnails/",a.push(t)}e.children&&e.children.forEach(function(e){h(e)})})(r,""),l.logger.log("Manifests to process: ",a.length);for(var u=0,d=0,c=0,p={},f=function(){function i(){if(d++,a.length>d)o(d/a.length),setTimeout(f,0);else if(d===a.length){o(1);var e={list:a,totalSize:c};n(null,e)}}if(!(u>=a.length)){var r,h=a[u++],g=h.files=[];if("thumbnail"!==h.mime&&(r=h.basePath),l.stopCacheWorker)u=a.length,d=a.length-1,i();else if("application/autodesk-db"===h.mime)g.push("objects_attrs.json.gz"),g.push("objects_vals.json.gz"),g.push("objects_avs.json.gz"),g.push("objects_offs.json.gz"),g.push("objects_ids.json.gz"),i();else if("thumbnail"===h.mime)h.files.push(h.guid+".png"),i();else if("application/autodesk-svf"===h.mime){var m=h.urn.slice(r.length);
g.push(m),function(){var r=h;e(t,h.urn,"arraybuffer",function(e,t){if(t){var n;try{var o=new Zlib.Unzip(new Uint8Array(t)),a=o.decompress("manifest.json"),u=new s.InputStream(a);n=JSON.parse(u.getString(a.byteLength))}catch(d){l.logger.error("SVF unzip",d.message)}if(n&&n.assets)for(var f=0;n.assets.length>f;f++){var g=n.assets[f];0!==g.URI.indexOf("embed:/")&&(0!==g.URI.indexOf("../")?(c+=g.size,r.files.push(g.URI)):p[h.basePath]||(c+=g.size/4))}p[h.basePath]=1}i()})}()}else if("application/autodesk-f2d"===h.mime){g.push("manifest.json.gz");var v=r+"manifest.json.gz";(function(){var r=h;e(t,v,"arraybuffer",function(e,t){if(t){c+=t.byteLength;var n;try{var o=new s.InputStream(t);n=JSON.parse(o.getString(t.length))}catch(a){l.logger.error("Gunzip",a.message)}if(n&&n.assets)for(var h=0;n.assets.length>h;h++){var u=n.assets[h];0!==u.URI.indexOf("../")&&(c+=u.size,r.files.push(u.URI))}}i()})})()}else g.push(h.rootFileName),i()}},g=0;6>g;g++)f()}function n(i,r,n,o){for(var s=0,a=0,h=[],u=0;r.length>u;u++)for(var d=r[u],c=0;d.files.length>c;c++){var p={basePath:d.basePath,localPath:d.localPath,fileName:d.files[c]};d.urn&&(p.urn=d.urn,p.guid=d.guid,p.mime=d.mime),h.push(p)}l.logger.log("Total items to download:",h.length);for(var f=0,g=0,m=function(){if(!(f>=h.length)){var r=h[f++],u=function(e){e?(a++,l.logger.error("Failed to download file.",r.localPath+r.fileName,e)):s++,g++,h.length>g?(o(g/h.length),setTimeout(m,0)):g===h.length&&(o(1),n(a,s))};l.stopCacheWorker?(f=h.length,g=h.length-1,u()):r.mime&&"thumbnail"===r.mime?t(i,r.urn,r.guid,u,!0):e(i,r.basePath+encodeURIComponent(r.fileName),null,u,!0)}},v=0;6>v;v++)m()}function o(e){var t=e.bubble;if(e.headers||(e.headers={}),t){l.stopCacheWorker=!1;var i=e.worker;r(e,t,function(t,r){l.stopCacheWorker?i.postMessage({type:"done",canceled:!0}):r?(l.logger.log("Got file list, starting download"),i.postMessage(r),n(e,r.list,function(e,t){i.postMessage({type:"done",canceled:l.stopCacheWorker,failed:e,succeeded:t})},function(e){i.postMessage({type:"progress",value:.2+.8*e})})):i.postMessage({type:"done",error:t})},function(e){i.postMessage({type:"progress",value:.2*e})})}else l.stopCacheWorker=!0}var s=Autodesk.LMVTK,a=Autodesk.Viewing,l=a.Private;l.stopCacheWorker=!1,s.doPopulateCache=o}(),function(){"use strict";var e=Autodesk.Viewing;e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.fireEvent=e.EventDispatcher.prototype.fireEvent,t.dispatchEvent=e.EventDispatcher.prototype.fireEvent},addEventListener:function(e,t){e&&(void 0===this.listeners&&(this.listeners={}),this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].push(t))},hasEventListener:function(e,t){if(!e)return!1;if(void 0===this.listeners)return!1;var i=this.listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(e&&(void 0===this.listeners&&(this.listeners={}),this.listeners[e]instanceof Array))for(var i=this.listeners[e],r=0,n=i.length;n>r;r++)if(i[r]===t){i.splice(r,1);break}},fireEvent:function(e){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof e&&(e={type:e}),!e.target)try{e.target=this}catch(t){}if(!e.type)throw Error("event type unknown.");if(this.listeners[e.type]instanceof Array)for(var i=this.listeners[e.type].slice(),r=0;i.length>r;r++)i[r].call(this,e)}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};e.ModelUnits=i;var r=function(e){WGS.RenderModel.call(this),this.myData=e,this.sharedPath=null,this.propWorker=null,this.getInstanceTree=function(){return this.myData?this.myData.instanceTree:null},this.getBoundingBox=function(){return this.myData?this.myData.bbox:null},this.is2d=function(){return!(!this.myData||!this.myData.is2d)}};e.EventDispatcher.prototype.apply(r.prototype),r.prototype.constructor=r,r.prototype.setData=function(e){this.myData=e},r.prototype.getData=function(){return this.myData},r.prototype.getDocumentNode=function(){return this.myData.loadOptions?this.myData.loadOptions.bubbleNode||null:null},r.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},r.prototype.getRootId=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0},r.prototype.getUnitScale=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}},r.prototype.getUnitString=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},r.prototype.getDisplayUnit=function(){var e;switch(e=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.getMetadata("distance unit","value",null),e&&(e=e.toLowerCase()),e){case"meter":case"meters":case"m":return i.METER;case"feet and inches":case"foot":case"feet":case"ft":return i.FOOT;case"inch":case"inches":case"in":return i.INCH;case"centimeter":case"centimeters":case"cm":return i.CENTIMETER;case"millimeter":case"millimeters":case"mm":return i.MILLIMETER;default:return null}},r.prototype.getMetadata=function(e,t,i){if(this.myData){var r=this.myData.metadata;if(r){var n=r[e];if(void 0!==n){if(!t)return n;var o=n[t];if(void 0!==o)return o}}}return i},r.prototype.getDefaultCamera=function(){var e=this.myData;if(!e)return null;var t=null,i=e.cameras?e.cameras.length:0;if(i>0){var r=this.getMetadata("default camera","index",null);if(null!==r&&e.cameras[r])t=e.cameras[r];else{for(var n=0;i>n;n++){var o=e.cameras[n];if(o.isPerspective){t=o;break}}t||(t=e.cameras[0])}}return t},r.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},r.prototype.geomPolyCount=function(){return this.myData?this.myData.geomPolyCount:null},r.prototype.instancePolyCount=function(){return this.myData?this.myData.instancePolyCount:null},r.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(t.logger.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},r.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},r.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},r.prototype.getProperties=function(e,t,i){this.myData&&this.myData.propWorker&&e>0&&this.myData.propWorker.getProperties(e,t,i)},r.prototype.getBulkProperties=function(e,t,i,r){this.myData&&this.myData.propWorker&&this.myData.propWorker.getBulkProperties(e,t,i,r)},r.prototype.getExternalIdMapping=function(e,t){this.myData&&this.myData.propWorker.getExternalIdMapping(e,t)},r.prototype.getObjectTree=function(e,t){this.myData&&this.myData.propWorker?this.myData.propWorker.getObjectTree(e,t):t&&t()},r.prototype.search=function(e,t,i,r,n){var o=this;this.isLoadDone()?this.myData.propWorker.searchProperties(e,r,t,i,n):this.getObjectTree(function(){o.myData.propWorker.searchProperties(e,r,t,i,n)})};var n=function(e){var t=.001,i=e;if(t>Math.abs(i[0]))if(Math.abs(i[4])>t)for(var r=0;4>r;r++){var n=i[r];i[r]=i[r+4],i[r+4]=n}else for(var r=0;4>r;r++){var n=i[r];i[r]=i[r+8],i[r+8]=n}if(t>Math.abs(i[5]))for(var r=4;8>r;r++){var n=i[r];i[r]=i[r+4],i[r+4]=n}},o=function(e,t,i,r){var n,o,s,a,l,h,u=!1;s=r[i[i.length-1]].x,a=r[i[i.length-1]].y,n=a>=t;for(var d=0,c=i.length;c>d;++d)l=r[i[d]].x,h=r[i[d]].y,o=h>=t,n!=o&&(h-t)*(s-l)>=(l-e)*(a-h)==o&&(u=!u),n=o,s=l,a=h;return u};r.prototype.pointInPolygon=function(e,t,i,r){for(var n=!1,s=0;i.length>s;s++)o(e,t,i[s],r)&&(n=!n);return n},r.prototype.getPageToModelTransform=function(e){if(this.myData.pageToModelTransform)return this.myData.pageToModelTransform;var t=this.myData,i=t.metadata,r=i.page_dimensions,o=t.viewports[e];if(!o)return new THREE.Matrix4;t.viewportTransforms||(t.viewportTransforms=Array(t.viewports.length));var s=t.viewportTransforms[e];if(s)return s;var a=new LmvMatrix4(!0).set(r.logical_width/r.page_width,0,0,r.logical_offset_x,0,r.logical_height/r.page_height,0,r.logical_offset_y,0,0,1,0,0,0,0,1),l=o.transform.slice();n(l);var h=new LmvMatrix4(!0);h.elements.set(l);var u=new LmvMatrix4(!0);return u.getInverse(h),u.multiply(a),t.viewportTransforms[e]=u,u},r.prototype.pageToModel=function(e,t,i){var r=this.getPageToModelTransform(i),n=(new THREE.Vector3).set(e.x,e.y,0).applyMatrix4(r),o=(new THREE.Vector3).set(t.x,t.y,0).applyMatrix4(r);e.x=n.x,e.y=n.y,t.x=o.x,t.y=o.y},r.prototype.pointInClip=function(e,t){for(var i=this.myData.clips,r=[],n=1;i.length>n;n++)if(n!==t){for(var o=[],s=[],a=i[n].contourCounts,l=i[n].points,h=0,u=[],d=0;a.length>d;d++){for(var c=0;a[d]>c;c++)o.push(h),h++;s.push(o),o=[]}for(var d=0;l.length>d;d+=2){var p={x:l[d],y:l[d+1]};u.push(p)}var f=this.pointInPolygon(e.x,e.y,s,u);f&&r.push(n)}return r},r.prototype.getClip=function(e){for(var t=this.myData.clips,i=[],r=[],n=t[e].contourCounts,o=t[e].points,s=0,a=[],l=0;n.length>l;l++){for(var h=0;n[l]>h;h++)i.push(s),s++;r.push(i),i=[]}for(var l=0;o.length>l;l+=2){var u={x:o[l],y:o[l+1]};a.push(u)}return{contours:r,points:a}},r.prototype.getTopoIndex=function(e){if(this.myData&&this.myData.fragments){var t=this.myData.fragments.topoIndexes;if(t)return t[e]}},r.prototype.getTopology=function(e){if(this.myData){var t=this.myData.topology;if(t){var i=t[e];if(i)return i}}},r.prototype.hasTopology=function(){if(this.myData){var e=this.myData.topology;if(e)return!0}return!1},r.prototype.hasGeometry=function(){return this.myData?this.myData.isLeaflet?!0:this.myData.fragments.length>0:!1},e.Model=r}(),function(){"use strict";function e(e,n,o){if(e.urlPattern=o.urn,e.tileSize=o.tileSize?o.tileSize:512,e.texWidth=o.resolution[0],e.texHeight=o.resolution[1],e.paperWidth=o.paperWidth,e.paperHeight=o.paperHeight,e.paperUnits=o.paperUnits,e.levelOffset=i.LeafletLoader.computeLevelOffset(e.tileSize),i.offline&&t.isMobileDevice()){var s=r.getSubItemsWithProperties(n,{role:"leaflet-zip"},!1);s.length>0&&(e.maxLevel=s[0].max_level-e.levelOffset)}}var t=Autodesk.Viewing,i=Autodesk.Viewing.Private,r=function(e,t,r){function n(e){if(e){var t,r=e.children?e.children.length:0;if("geometry"===e.type&&r){var o=0;for(t=0;r>t;t++){var a=e.children[t];a&&"view"===a.type&&(s.myViewGeometry[a.guid]=e,o++)}s.myNumViews[e.guid]=o}else if("application/autodesk-db"==e.mime&&e.urn)s.myPropertyDb=0===e.urn.indexOf(i.ViewingService.OSS_PREFIX)?e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):e.urn.substr(0,e.urn.lastIndexOf("/")+1);else if(r>0)for(t=0;r>t;t++)n(e.children[t])}}function o(e){if(e)for(var t=e.children?e.children.length:0,i=0;t>i;i++)e.children[i].parent=e,o(e.children[i])}this.myPath=t,this.myData=e,this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null,this.acmSessionId=r;var s=this;n(e),o(this.myData)};r.prototype.constructor=r,r.load=function(e,n,o,s){function a(e){if(-1===e.indexOf("urn:")){if(-1!==e.indexOf("://"))return e;var t=e;return"undefined"!=typeof window?(0!==t.indexOf("/")&&(t="/"+t),window.location.protocol+"//"+window.location.host+t):t}return e}function l(e){var t=r.getSubItemsWithProperties(e.getRootItem(),{type:"folder",role:"viewable"},!0),i=t[0],n=r.getSubItemsWithProperties(i,{type:"geometry"},!0);return n.length}function h(e,t){var i=[],r=0,n=0;t=t||"children";var o=function(e){var s=e[t]||[],a=e.messages||[],l=a.filter(function(e){return"error"===e.type});l.length>0&&(r+=1),"inprogress"===e.status&&(n+=1),Array.prototype.push.apply(i,a.slice(0));for(var h=s.length;h--;o(s[h]));};o(e);var s="translated";s=r>0?"failed":s,s=n>0?"processing":s;for(var a=i.length;a--;i[a].$translation=s);return i}function u(s){function d(e){var i=/<[^>]*script/;if(i.test(e))return o&&o(t.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading"),void 0;var a="string"==typeof e?JSON.parse(e):e,u=new r(a,f,s),d=l(u);if(d>0)p=h(u.getRootItem()),n&&n(u,p);else if(o){p=h(u.getRootItem());var c=t.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT,g="No viewable content";o(c,g,p)}}function c(e,r,n){if(401===e&&void 0===LMV_THIRD_PARTY_COOKIE)LMV_THIRD_PARTY_COOKIE=!1,i.refreshRequestHeader(i.token.accessToken),u(s);else{var a=h(n);if(o){var l="Error: "+e+" ("+r+")",d=t.Private.ErrorHandler.getErrorCode(e);o(d,l,e,r,a)}}}var p,f=a(e),g={queryParams:s?"acmsession="+s:""};i.ViewingService.getManifest(i.initLoadContext(g),f,d,c)}"function"!=typeof arguments[1]&&(i.logger.warn("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(n=arguments[2]),"function"==typeof arguments[3]&&(o=arguments[3])),s?i.ViewingService.getACMSession(t.getApiEndpoint(),s,u,o):u()},r.requestThumbnailWithSecurity=function(e,t){var r=function(e){t(null,e)},n=function(){t("error",null)},o={responseType:"blob",skipAssetCallback:!0,size:e.width,guid:e.guid},s="urn:"+e.urn;i.ViewingService.getThumbnail(i.initLoadContext(),s,r,n,o)},r.prototype.getFullPath=function(e){if(!e)return e;var r=e;return i.offline?r=decodeURIComponent(t.Private.offlineResourcePrefix)+r.substr(r.indexOf("/")):0===e.indexOf("urn")?r=t.getItemApi()+e:0===e.indexOf("$file$")&&-1!==this.myPath.indexOf("/bubble.json")&&(r=this.myPath.replace("/bubble.json","")+e.replace("$file$","")),r},r.prototype.getThumbnailOptions=function(e,t,i){var r=t?t:200,n=i?i:200;return{urn:this.myData.urn,width:r,height:n,guid:encodeURIComponent(e.guid),acmsession:this.acmSessionId}},r.prototype.getThumbnailPath=function(e,i,r){var n=this.getThumbnailOptions(e,i,r),o=t.getThumbnailApi()+n.urn+"?guid="+n.guid+"&width="+n.width+"&height="+n.height;return n.acmsession&&(o+="&acmsession="+n.acmsession),o},r.prototype.getViewablePath=function(t,i){if("geometry"===t.type){var n=[];if("3d"===t.role?n=r.getSubItemsWithProperties(t,{mime:"application/autodesk-svf"},!1):"2d"===t.role&&(n=r.getSubItemsWithProperties(t,{role:"leaflet"},!1),n.length>0&&i&&e(i,t,n[0]),0===n.length&&(n=r.getSubItemsWithProperties(t,{mime:"application/autodesk-f2d"},!1)),0===n.length&&(n=r.getSubItemsWithProperties(t,{role:"tileRoot"},!0))),n.length>0)return this.getFullPath(n[0].urn)}else if("view"===t.type){var o=this.getViewGeometry(t);if(o)return this.getViewablePath(o)}return""},r.prototype.getPropertyDbPath=function(){return this.myPropertyDb},r.prototype.getRootItem=function(){return this.myData},r.prototype.getPath=function(){return this.myPath},r.prototype.getItemById=function(e){function t(i){if(!i)return null;for(var r in i){var n=i[r];if("guid"===r&&n===e)return i;if(null!==n&&"object"==typeof n&&"parent"!==r){var o=t(n);if(o)return o}}return null}return t(this.myData)},r.getSubItemsWithProperties=function(e,t,i){function n(e,t){for(var i in t)if(!(i in e)||t[i]!==e[i])return!1;return!0}var o=[];if(!e)return[];for(var s=e.children?e.children.length:0,a=0;s>a;a++){var l=e.children[a];n(l,t)&&o.push(l),i&&o.push.apply(o,r.getSubItemsWithProperties(l,t,i))}return o},r.prototype.getViewGeometry=function(e){return this.myViewGeometry[e.guid]},r.prototype.getNumViews=function(e){return this.myNumViews[e.guid]||0},r.prototype.getParentId=function(e){var t=this.getItemById(e);if(!t)return null;var i=t.parent;return i?i.guid:null},r.prototype.getMessages=function(e,t){var i=[];if(!e)return i;var r=null;t&&(r=this.getRootItem());for(var n=e;n&&(!t||parent!==r);){if(n.messages)for(var o=0;n.messages.length>o;o++)i.push(n.messages[o]);n=n.parent}return i},t.Document=r}(),function(){"use strict";function e(e,t,i){this.nodeAccess=e,this.maxDepth=i,this.objectCount=t,this.numHidden=0,this.numOff=0}var t=Autodesk.Viewing,i=t.Private,r=2,n=3,o=4,s=5,a=7,l=536870912,h=1073741824,u=2147483648;t.SelectionMode={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2},e.prototype.setFlagNode=function(e,t,i){var r=this.nodeAccess.getNodeFlags(e);return!!(r&t)==i?!1:(i?this.nodeAccess.setNodeFlags(e,r|t):this.nodeAccess.setNodeFlags(e,r&~t),!0)},e.prototype.setFlagGlobal=function(e,t){var i=this.nodeAccess,r=0,n=i.numNodes;if(t)for(;n>r;r++)i.setNodeFlags(r,i.getNodeFlags(r)|e);else for(var o=~e;n>r;r++)i.setNodeFlags(r,i.getNodeFlags(r)&o)},e.prototype.setNodeOff=function(e,t){var i=this.setFlagNode(e,h,t);return i&&(t?this.numOff++:this.numOff--),i},e.prototype.isNodeOff=function(e){return!!(this.nodeAccess.getNodeFlags(e)&h)},e.prototype.setNodeHidden=function(e,t){var i=this.setFlagNode(e,u,t);return i&&(t?this.numHidden++:this.numHidden--),i},e.prototype.isNodeHidden=function(e){return!!(this.nodeAccess.getNodeFlags(e)&u)},e.prototype.getNodeType=function(e){return this.nodeAccess.getNodeFlags(e)&a},e.prototype.isNodeSelectable=function(e){return!(this.nodeAccess.getNodeFlags(e)&l)},e.prototype.getNodeParentId=function(e){return this.nodeAccess.getParentId(e)},e.prototype.getRootId=function(){return this.nodeAccess.rootId},e.prototype.getNodeName=function(e){return this.nodeAccess.name(e)},e.prototype.getChildCount=function(e){return this.nodeAccess.getNumChildren(e)},e.prototype.getNodeBox=function(e,t){this.nodeAccess.getNodeBox(e,t)},e.prototype.enumNodeFragments=function(e,t,i){function r(e){o.nodeAccess.enumNodeFragments(e,t),i&&o.enumNodeChildren(e,function(e){r(e)})}var n;"number"==typeof e?n=e:e&&(n=e.dbId);var o=this;r(n)},e.prototype.enumNodeChildren=function(e,t,i){function r(e){o.nodeAccess.enumNodeChildren(e,function(e){t(e),i&&r(e)})}var n;"number"==typeof e?n=e:e&&(n=e.dbId);var o=this;i&&t(n),r(n)},e.prototype.findNodeForSelection=function(e,i){if(i===t.SelectionMode.LEAF_OBJECT)return e;var a,l,h=e;if(i===t.SelectionMode.FIRST_OBJECT){var u=[];for(a=e;a;)u.push(a),a=this.getNodeParentId(a);for(var d=u.length-1;d>=0;d--)if(l=this.getNodeType(u[d]),l!==s&&l!==r&&l!==n){h=u[d];break}}else if(i===t.SelectionMode.LAST_OBJECT)for(a=e;a;){if(l=this.getNodeType(a),l===o){h=a;break}a=this.getNodeParentId(a)}return h},i.InstanceTree=e}(),function(){"use strict";function e(){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=[],this.nameSuffixes=[],this.getIndex(0)}function t(e){var t=new Int32Array(e.length);return t.set(e),t}function i(e,t,i){this.nodes=e.nodes,this.children=e.children,this.dbIdToIndex=e.dbIdToIndex,this.names=e.names,this.nameSuffixes=e.nameSuffixes,this.strings=e.strings,this.rootId=t,this.numNodes=this.nodes.length/o,this.visibleIds=null,this.nodeBoxes=i||new Float32Array(6*this.numNodes)}var r=Autodesk.Viewing,n=r.Private,o=5,s=1,a=2,l=3,h=4;e.prototype.getIndex=function(e){var t=this.dbIdToIndex[e];if(t)return t;t=this.nextNode++,this.nodes.push(e);for(var i=1;o>i;i++)this.nodes.push(0);return this.dbIdToIndex[e]=t,t},e.prototype.setNode=function(e,t,i,r,u,d){var c=this.getIndex(e),p=c*o;this.nodes[p+s]=t,this.nodes[p+a]=this.nextChild,this.nodes[p+l]=d?-u.length:u.length,this.nodes[p+h]=r;for(var f=0;u.length>f;f++)this.children[this.nextChild++]=d?u[f]:this.getIndex(u[f]);this.nextChild>this.children.length&&n.logger.error("Child index out of bounds -- should not happen"),this.processName(c,i)},e.prototype.processName=function(e,t){var i,r,n=-1,o=-1;if(t&&(o=t.lastIndexOf("]"),n=t.lastIndexOf("["),(-1===n||-1===o)&&(n=t.lastIndexOf(":"),o=t.length)),n>=0&&o>n){i=t.slice(0,n+1);var s=t.slice(n+1,o);r=parseInt(s,10),r&&r+""===s||(i=t,r=0)}else i=t,r=0;var a=this.s2i[i];void 0===a&&(this.strings.push(i),a=this.strings.length-1,this.s2i[i]=a),this.names[e]=a,this.nameSuffixes[e]=r},e.prototype.flatten=function(){this.nodes=t(this.nodes),this.children=t(this.children),this.names=t(this.names),this.nameSuffixes=t(this.nameSuffixes),this.s2i=null},i.prototype.getNumNodes=function(){return this.numNodes},i.prototype.getIndex=function(e){return this.dbIdToIndex[e]},i.prototype.name=function(e){var t=this.dbIdToIndex[e],i=this.strings[this.names[t]],r=this.nameSuffixes[t];if(r){var n=i.charAt(i.length-1);return"["===n?i+r+"]":i+r}return i},i.prototype.getParentId=function(e){return this.nodes[this.dbIdToIndex[e]*o+s]},i.prototype.getNodeFlags=function(e){return this.nodes[this.dbIdToIndex[e]*o+h]},i.prototype.setNodeFlags=function(e,t){this.nodes[this.dbIdToIndex[e]*o+h]=t},i.prototype.getNumChildren=function(e){var t=this.nodes[this.dbIdToIndex[e]*o+l];return t>0?t:0},i.prototype.getNumFragments=function(e){var t=this.nodes[this.dbIdToIndex[e]*o+l];return 0>t?-t:0},i.prototype.getNodeBox=function(e,t){for(var i=6*this.getIndex(e),r=0;6>r;r++)t[r]=this.nodeBoxes[i+r]},i.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map(function(e){return parseInt(e)})),this.visibleIds},i.prototype.enumNodeChildren=function(e,t){var i=this.dbIdToIndex[e],r=this.nodes[i*o+a],n=this.nodes[i*o+l];if(n>0)for(var s=0;n>s;s++){var h=this.nodes[this.children[r+s]*o];t(h,e,i)}},i.prototype.enumNodeFragments=function(e,t){var i=this.dbIdToIndex[e],r=this.nodes[i*o+a],n=this.nodes[i*o+l];if(0>n){n=-n;for(var s=0;n>s;s++)t(this.children[r+s],e,i)}},n.InstanceTreeStorage=e,n.InstanceTreeAccess=i}(),function(){"use strict";var e=(Autodesk.Viewing,Autodesk.Viewing.Private);2*Math.PI;var t=0,i=1,r=2,n=3,o=4,s=5,a=7,l=8,h=9;e.VertexBufferReader=function(e){this.vb=e.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.stride=e.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!1},e.VertexBufferReader.prototype.getDbIdAt=function(e){return this.vbi[e*this.stride+a]},e.VertexBufferReader.prototype.getVertexFlagsAt=function(e){return this.vbi[e*this.stride+l]},e.VertexBufferReader.prototype.getLayerIndexAt=function(e){return 65535&this.vbi[e*this.stride+h]},e.VertexBufferReader.prototype.getViewportIndexAt=function(e){return 65535&this.vbi[e*this.stride+h]>>16},e.VertexBufferReader.prototype.decodeLineAt=function(e,t,i,r){if(r.onLineSegment){var n=this.stride*e,o=this.vbf[n],s=this.vbf[n+1],a=this.vbf[n+2],l=this.vbf[n+3],h=o+l*Math.cos(a),u=s+l*Math.sin(a);r.onLineSegment(o,s,h,u,i)}},e.VertexBufferReader.prototype.decodeCircularArcAt=function(e,t,i,r){if(r.onCircularArc){var n=this.stride*e,o=this.vbf[n],s=this.vbf[n+1],a=this.vbf[n+2],l=this.vbf[n+3],h=this.vbf[n+5];r.onCircularArc(o,s,a,l,h,i)}},e.VertexBufferReader.prototype.decodeEllipticalArcAt=function(e,t,i,r){if(r.onEllipticalArc){var n=this.stride*e,o=this.vbf[n],s=this.vbf[n+1],a=this.vbf[n+2],l=this.vbf[n+3],h=this.vbf[n+5],u=this.vbf[n+10],d=this.vbf[n+11];r.onEllipticalArc(o,s,a,l,h,u,d,i)}},e.VertexBufferReader.prototype.decodeTriangleVertex=function(e,t,i,r){if(r.onTriangleVertex){var n=this.stride*e,o=this.vbf[n],s=this.vbf[n+1];r.onTriangleVertex(o,s,i)}},e.VertexBufferReader.prototype.enumGeomsForObject=function(e,a){for(var l=0;this.vcount>l;){var h=this.getVertexFlagsAt(l),u=255&h>>8,d=this.getLayerIndexAt(l),c=this.getViewportIndexAt(l);if(this.getDbIdAt(l)===e)switch(u){case t:this.decodeTriangleVertex(l,d,c,a);break;case i:this.decodeLineAt(l,d,c,a);break;case r:this.decodeCircularArcAt(l,d,c,a);break;case n:this.decodeEllipticalArcAt(l,d,c,a);break;case o:break;case s:break;default:}l+=this.useInstancing||u==t?1:4}}}(),function(){"use strict";function e(e,t){if(!e||!e.colors)return new THREE.Color(1,0,0);var i=e.colors[t];if(!i)return new THREE.Color(0,0,0);var r=i.values;if(!r||!r.length)return new THREE.Color(1,0,0);var n=r[0];return new THREE.Color(n.r,n.g,n.b)}function t(e,t,i){if(!e||!e.scalars)return i;var r=e.scalars[t];return r?r.values[0]:i}function i(e,t,i){if(!e||!e.booleans)return i;var r=e.booleans;return r?r[t]:i}function r(e,t,i,r){if(!e||!e[t])return r;var n=e[t][i];return n?n.values[0]:r}function n(e,t,i){var r={bands:0,weights:new THREE.Vector4(1,1,1,1),frequencies:new THREE.Vector4(1,1,1,1)};if(!e||!e[t])return r;var n=e[t][i];if(!(n&&n.values&&n.values instanceof Array))return r;var o=n.values;r.bands=o.length/2;for(var s=0;r.bands>s;++s)r.frequencies.setComponent(s,1/o[2*s]),r.weights.setComponent(s,o[2*s+1]);return r}function o(e,t,i,r){if(!e||!e.scalars)return r;var n=e.scalars[t];return n?h(n.values[0],n.units,i):r}function s(e,t,i,r){if(!e||!e[t])return r;var n=e[t][i];if(!n)return r;var o=n.connections;return o?n.connections[0]:r}function a(e){var t=e;return.04045>=t?t/=12.92:t=Math.pow((t+.055)/1.055,2.4),t}function l(e){var t,i,r;return t=a(e.r),i=a(e.g),r=a(e.b),new THREE.Color(t,i,r)}function h(e,t,i){var r=T[i];r||(r=1,_.logger.warn("Unsupported unit: "+i));var n=T[t];return n||(n=1,_.logger.warn("Unsupported unit: "+t)),e*r/n}function u(e,t,i){if(0===t){var n=o(e,"bumpmap_Depth",i,0),s=1,a=1;return null!=r(e,"scalars","texture_RealWorldScale")?s=a=o(e,"texture_RealWorldScale",i,1):(s=o(e,"texture_RealWorldScaleX",i,1),a=o(e,"texture_RealWorldScaleY",i,1)),s=0===s?1:1/s,a=0===a?1:1/a,new THREE.Vector2(s*n,a*n)}var l=r(e,"scalars","bumpmap_NormalScale",1);return new THREE.Vector2(l,l)}function d(e,t){var i=o(e,"texture_RealWorldOffsetX",t,0),n=o(e,"texture_RealWorldOffsetY",t,0),s=r(e,"scalars","texture_UOffset",0),a=r(e,"scalars","texture_VOffset",0);i+=s,n+=a;var l=1,h=1;null!=r(e,"scalars","texture_RealWorldScale")?l=h=o(e,"texture_RealWorldScale",t,1):(l=o(e,"texture_RealWorldScaleX",t,1),h=o(e,"texture_RealWorldScaleY",t,1)),l=0===l?1:1/l,h=0===h?1:1/h;var u=r(e,"scalars","texture_UScale",1),d=r(e,"scalars","texture_VScale",1);l*=u,h*=d;var c=r(e,"scalars","texture_WAngle",1);c*=Math.PI/180;var p={elements:[Math.cos(c)*l,Math.sin(c)*h,0,-Math.sin(c)*l,Math.cos(c)*h,0,i,n,1]};return p}function c(){var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=new Uint8Array(e),i=new THREE.DataTexture(t,256,1,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);i.generateMipmaps=!1,i.flipY=!1,i.needsUpdate=!0;var r=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],n=new Uint8Array(r),o=new THREE.DataTexture(n,256,1,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);o.generateMipmaps=!1,o.flipY=!1,o.needsUpdate=!0;for(var s,a,l,h,u,d,c,p,f=function(t){return e[t%256]},g=Array(262144),m=0;256>m;++m)for(p=0;256>p;++p)s=f(p)+m,a=f(s),l=f(s+1),h=f(p+1)+m,u=f(h),d=f(h+1),c=4*(256*m+p),g[c]=a,g[c+1]=l,g[c+2]=u,g[c+3]=d;var v=new Uint8Array(g),y=new THREE.DataTexture(v,256,256,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0;var b=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],w=Array(1024);for(p=0;256>p;++p){var _=e[p]%16;w[4*p]=127*b[3*_]+128,w[4*p+1]=127*b[3*_+1]+128,w[4*p+2]=127*b[3*_+2]+128,w[4*p+3]=0}var T=new Uint8Array(w),S=new THREE.DataTexture(T,256,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);S.generateMipmaps=!1,S.flipY=!1,S.needsUpdate=!0,E={permutation:i,gradient:o,perm2D:y,permGrad:S}}function p(e,t,i){e[i+"_enable"]=r(t,"booleans",i+"_enable",0);var o=n(t,"scalars",i+"_prof");e[i+"_bands"]=o.bands,e[i+"_weights"]=o.weights,e[i+"_frequencies"]=o.frequencies}function f(n,o){var a,h,u=n.materials,d=u[n.userassets[0]],f=d.properties,g=o?_.createPrismMaterial():new THREE.MeshPhongMaterial;if(g.proteinMat=n,g.packedNormals=!0,d&&o){g.tag=d.tag,g.prismType=d.definition,void 0===g.prismType&&(g.prismType=""),void 0!==n.IsSingleSided&&n.IsSingleSided===!1&&(g.side=THREE.DoubleSide);var m=g.mapList;switch(g.transparent=!1,g.envExponentMin=1,g.envExponentMax=512,g.envExponentCount=10,g.surface_albedo=l(e(f,"surface_albedo",new THREE.Color(1,0,0))),m.surface_albedo_map=s(f,"colors","surface_albedo",null),g.surface_anisotropy=r(f,"scalars","surface_anisotropy",0),m.surface_anisotropy_map=s(f,"scalars","surface_anisotropy",null),g.surface_rotation=r(f,"scalars","surface_rotation",0),m.surface_rotation_map=s(f,"scalars","surface_rotation",null),g.surface_roughness=r(f,"scalars","surface_roughness",0),m.surface_roughness_map=s(f,"scalars","surface_roughness",null),m.surface_cutout_map=s(f,"textures","surface_cutout",null),m.surface_normal_map=s(f,"textures","surface_normal",null),g.prismType){case"PrismOpaque":g.opaque_albedo=l(e(f,"opaque_albedo",new THREE.Color(1,0,0))),m.opaque_albedo_map=s(f,"colors","opaque_albedo",null),g.opaque_luminance_modifier=l(e(f,"opaque_luminance_modifier",new THREE.Color(0,0,0))),m.opaque_luminance_modifier_map=s(f,"colors","opaque_luminance_modifier",null),g.opaque_f0=r(f,"scalars","opaque_f0",0),m.opaque_f0_map=s(f,"scalars","opaque_f0",null),g.opaque_luminance=r(f,"scalars","opaque_luminance",0);break;case"PrismMetal":g.metal_f0=l(e(f,"metal_f0",new THREE.Color(1,0,0))),m.metal_f0_map=s(f,"colors","metal_f0",null);break;case"PrismLayered":g.layered_bottom_f0=l(e(f,"layered_bottom_f0",new THREE.Color(1,1,1))),m.layered_bottom_f0_map=s(f,"colors","layered_bottom_f0",null),g.layered_diffuse=l(e(f,"layered_diffuse",new THREE.Color(1,0,0))),m.layered_diffuse_map=s(f,"colors","layered_diffuse",null),g.layered_anisotropy=r(f,"scalars","layered_anisotropy",0),m.layered_anisotropy_map=s(f,"scalars","layered_anisotropy",null),g.layered_f0=r(f,"scalars","layered_f0",0),m.layered_f0_map=s(f,"scalars","layered_f0",null),g.layered_fraction=r(f,"scalars","layered_fraction",0),m.layered_fraction_map=s(f,"scalars","layered_fraction",null),g.layered_rotation=r(f,"scalars","layered_rotation",0),m.layered_rotation_map=s(f,"scalars","layered_rotation",null),g.layered_roughness=r(f,"scalars","layered_roughness",0),m.layered_roughness_map=s(f,"scalars","layered_roughness",null),m.layered_normal_map=s(f,"textures","layered_normal",null);
break;case"PrismTransparent":g.transparent_color=l(e(f,"transparent_color",new THREE.Color(1,0,0))),g.transparent_distance=r(f,"scalars","transparent_distance",0),g.transparent_ior=r(f,"scalars","transparent_ior",0),g.transparent=!0;break;case"PrismWood":p(g,f,"wood_fiber_cosine"),p(g,f,"wood_fiber_perlin"),g.wood_fiber_perlin_scale_z=r(f,"scalars","wood_fiber_perlin_scale_z",0),p(g,f,"wood_growth_perlin"),g.wood_latewood_ratio=r(f,"scalars","wood_latewood_ratio",0),g.wood_earlywood_sharpness=r(f,"scalars","wood_earlywood_sharpness",0),g.wood_latewood_sharpness=r(f,"scalars","wood_latewood_sharpness",0),g.wood_ring_thickness=r(f,"scalars","wood_ring_thickness",0),p(g,f,"wood_earlycolor_perlin"),g.wood_early_color=l(e(f,"wood_early_color",new THREE.Color(1,0,0))),g.wood_use_manual_late_color=r(f,"booleans","wood_use_manual_late_color",0),g.wood_manual_late_color=l(e(f,"wood_manual_late_color",new THREE.Color(1,0,0))),p(g,f,"wood_latecolor_perlin"),g.wood_late_color_power=r(f,"scalars","wood_late_color_power",0),p(g,f,"wood_diffuse_perlin"),g.wood_diffuse_perlin_scale_z=r(f,"scalars","wood_diffuse_perlin_scale_z",0),g.wood_use_pores=r(f,"booleans","wood_use_pores",0),g.wood_pore_type=r(f,"choicelists","wood_pore_type",0),g.wood_pore_radius=r(f,"scalars","wood_pore_radius",0),g.wood_pore_cell_dim=r(f,"scalars","wood_pore_cell_dim",0),g.wood_pore_color_power=r(f,"scalars","wood_pore_color_power",0),g.wood_pore_depth=r(f,"scalars","wood_pore_depth",0),g.wood_use_rays=r(f,"booleans","wood_use_rays",0),g.wood_ray_color_power=r(f,"scalars","wood_ray_color_power",0),g.wood_ray_seg_length_z=r(f,"scalars","wood_ray_seg_length_z",0),g.wood_ray_num_slices=r(f,"integers","wood_ray_num_slices",0),g.wood_ray_ellipse_z2x=r(f,"scalars","wood_ray_ellipse_z2x",0),g.wood_ray_ellipse_radius_x=r(f,"scalars","wood_ray_ellipse_radius_x",0),g.wood_use_latewood_bump=r(f,"booleans","wood_use_latewood_bump",0),g.wood_latewood_bump_depth=r(f,"scalars","wood_latewood_bump_depth",0),g.wood_use_groove_roughness=r(f,"booleans","wood_use_groove_roughness",0),g.wood_groove_roughness=r(f,"scalars","wood_groove_roughness",0),g.wood_diffuse_lobe_weight=r(f,"scalars","wood_diffuse_lobe_weight",0),g.wood_curly_distortion_enable=r(f,"booleans","wood_curly_distortion_enable",0),g.wood_curly_distortion_scale=r(f,"scalars","wood_curly_distortion_scale",0),m.wood_curly_distortion_map=s(f,"scalars","wood_curly_distortion_map",null),g.transparent=!1,E||c(),g.uniforms.permutationMap.value=E.permutation,g.uniforms.gradientMap.value=E.gradient,g.uniforms.perm2DMap.value=E.perm2D,g.uniforms.permGradMap.value=E.permGrad;break;default:_.logger.warn("Unknown prism type: "+g.prismType)}g.defines={},g.textureMaps={};for(var v in m)if(m[v]){var y=u[m[v]];h=y.properties;var b="BumpMap"==y.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",w=h.uris[b].values[0];w&&(a={mapName:v,uri:w,textureObj:y,isPrism:!0},g.textureMaps[a.mapName]=a,g.defines["USE_"+v.toUpperCase()]="")}return g.defines[g.prismType.toUpperCase()]="",g}if(d&&!o&&"SimplePhong"==d.definition){g.tag=d.tag,g.proteinType=d.proteinType,void 0===g.proteinType&&(g.proteinType=null);var T=g.ambient=e(f,"generic_ambient"),S=g.color=e(f,"generic_diffuse"),x=g.specular=e(f,"generic_specular"),M=g.emissive=e(f,"generic_emissive");0===S.r&&0===S.g&&0===S.b&&0===x.r&&0===x.g&&0===x.b&&0===T.r&&0===T.g&&0===T.b&&0===M.r&&0===M.g&&0===M.b&&(S.r=S.g=S.b=.4),g.shininess=t(f,"generic_glossiness",30),g.opacity=1-t(f,"generic_transparency",0),g.reflectivity=t(f,"generic_reflectivity_at_0deg",0);var k=i(f,"generic_bump_is_normal"),R=t(f,"generic_bump_amount",0);null==R&&(R=1),k?(R>1&&(R=1),g.normalScale=new THREE.Vector2(R,R)):(R>=1&&(R=.03),g.bumpScale=R);var C=i(f,"generic_is_metal");void 0!==C&&(g.metal=C);var A=i(f,"generic_backface_cull");void 0===A||A||(g.side=THREE.DoubleSide),g.transparent=d.transparent,g.textureMaps={};var P=d.textures;for(var I in P)if(a={},a.textureObj=u[P[I].connections[0]],h=a.textureObj.properties,a.uri=h.uris.unifiedbitmap_Bitmap.values[0],a.uri){if("generic_diffuse"==I)a.mapName="map",(!g.color||0===g.color.r&&0===g.color.g&&0===g.color.b)&&g.color.setRGB(1,1,1);else if("generic_bump"==I)a.mapName=k?"normalMap":"bumpMap";else if("generic_specular"==I)a.mapName="specularMap";else{if("generic_alpha"!=I)continue;a.mapName="alphaMap",g.transparent=!0}g.textureMaps[a.mapName]=a}}else g.ambient=197379,g.color=7829367,g.specular=3355443,g.shininess=30,g.shading=THREE.SmoothShading;return g}function g(e,t,i){var n=e.properties;t.clampS=!r(n,"booleans","texture_URepeat",!1),t.clampT=!r(n,"booleans","texture_VRepeat",!1),t.wrapS=t.clampS?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping,t.wrapT=t.clampT?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping,t.matrix=d(n,i),"UnifiedBitmap"==e.definition&&(t.invert=r(n,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==e.definition&&(t.bumpmapType=r(n,"choicelists","bumpmap_Type",0),t.bumpScale=u(n,t.bumpmapType,i))}function m(e,r){if(e){var n=e.properties;r.invert=i(n,"unifiedbitmap_Invert"),r.clampS=!i(n,"texture_URepeat",!0),r.clampT=!i(n,"texture_VRepeat",!0),r.wrapS=r.clampS?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping,r.wrapT=r.clampT?THREE.ClampToEdgeWrapping:THREE.RepeatWrapping;var o=t(n,"texture_UScale",1),s=t(n,"texture_VScale",1),a=t(n,"texture_UOffset",0),l=t(n,"texture_VOffset",0),h=t(n,"texture_WAngle",0);r.matrix={elements:[Math.cos(h)*o,Math.sin(h)*s,0,-Math.sin(h)*o,Math.cos(h)*s,0,a,l,1]}}}function v(e,t,i,r){r?g(e,t,i):m(e,t)}function y(e){var t=e.materials,i=t[e.userassets[0]];if(i){var r=i.definition;return"PrismLayered"==r||"PrismMetal"==r||"PrismOpaque"==r||"PrismTransparent"==r||"PrismWood"==r}return!1}function b(e,t){var i=new THREE.MeshPhongMaterial;i.packedNormals=!0,i.textureMaps={};var r=e.values,n=r.diffuse;if(n)if(Array.isArray(n))i.color=new THREE.Color(n[0],n[1],n[2]);else if("string"==typeof n){i.color=new THREE.Color(1,1,1);var o={};o.mapName="map";var s=t.gltf.textures[n];o.uri=s.source,o.flipY=!1,i.textureMaps[o.mapName]=o}var a=r.specular;return a&&(i.specular=new THREE.Color(a[0],a[1],a[2])),r.shininess&&(i.shininess=r.shininess),i.reflectivity=0,i}var E,w=Autodesk.Viewing,_=w.Private,T={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,"in":39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361};_.MaterialConverter={convertMaterial:f,convertTexture:v,isPrismMaterial:y,convertMaterialGltf:b}}(),function(){"use strict";function e(e,i,r,n){if(o.getUseCredentials()){var a=-1===e.indexOf("://")||-1!==e.indexOf(window.location.host)||s.urlIsApiViewingOrDev(e);THREE.ImageUtils.crossOrigin=a?"use-credentials":"anonymous"}var l=e.indexOf("urn:");if(-1!==l){e=e.substr(0,l)+encodeURIComponent(e.substr(l));var h=o.getUseCredentials()&&!o.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",u=h;n&&(u&&(u+="&"),u+="acmsession="+n),u&&(e+="?"+u)}var d=s.ViewingService.getDirectOSSUrl({endpoint:o.getApiEndpoint()},e);if(d&&(e=d),".dds"===e.slice(e.length-4).toLocaleLowerCase()){if(o.isIOSDevice()){var c=e.slice(0,e.length-4)+".pvr";return(new THREE.PVRLoader).load(c,r)}return(new THREE.DDSLoader).load(e,r)}return!LMV_THIRD_PARTY_COOKIE&&a?t(e,i,r):THREE.ImageUtils.loadTexture(e,i,r)}function t(e,t,r){function n(e){return i(e,a,r)}function o(e,t){var i="Error: "+e+" ("+t+")";s.logger.error(i)}var a=new THREE.Texture(void 0,t);return s.ViewingService.getItem(s.initLoadContext(),e,n,o),a}function i(e,t,i){function r(e){for(var t="",i=new Uint8Array(e),r=i.byteLength,n=0;r>n;n++)t+=String.fromCharCode(i[n]);var o="data:image/jpeg;base64,"+window.btoa(t);return o}var n=new Image;t.image=n,n.onload=function(){t.needsUpdate=!0,i&&i(t)},n.onerror=function(e){s.logger.error(e)},n.src=r(e)}function r(e){var t=e.width,i=e.height;if(0===(t&t-1)&&0===(i&i-1))return e;for(var r=1;t>2*r;)r*=2;for(var n=1;i>2*n;)n*=2;var o=document.createElement("canvas"),s=o.getContext("2d");return o.width=r,o.height=n,s.drawImage(e,0,0,r,n),o}function n(t){function i(e){return-1!=e.indexOf("__lineMaterial__")}function n(e,t){return i(t)?t:e.basePath+"|mat|"+t}this.viewer=t;var a=this,l=this.materials={},h=this.materialsNonHDR={};this.textures={},this.layerMaskTex=null,this.reflectionCube=null,this.irradianceMap=null;var u=1,d=0,c=1,p=[];this.hasPrism=!1,this.renderPrism=!0;var f=[];this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0}),this.dtor=function(){this.cleanup(),THREE.Cache.clear(),this.viewer=null,a=null},this.findMaterial=function(e,t){var i=l[n(e,t)];return i||(s.logger.warn("Unknown material "+t+". Using default."),i=this.defaultMaterial),i},this.setRenderPrism=function(e){this.renderPrism=e},this.convertMaterials=function(e){if(!e.materials)return 0;{if(!e.gltfMaterials){var t=e.materials.materials,i=e.proteinMaterials?e.proteinMaterials.materials:null,r=this.renderPrism,a=0;for(var l in t){var h=!1;i&&(h=r&&s.MaterialConverter.isPrismMaterial(i[l]));var u=h?i[l]:t[l],d=s.MaterialConverter.convertMaterial(u,h);!o.isIE11&&e.doubleSided&&(d.side=THREE.DoubleSide),h&&d.transparent&&d.side===THREE.FrontSide&&(d.side=THREE.DoubleSide),h&&d.transparent&&d.side===THREE.DoubleSide&&d.depthTest&&(d.twoPassTransparency=!0);var c=n(e,l);if(this.addMaterial(c,d,h),a++,u.decals){d.decals=[];for(var p=0,f=u.decals.length;f>p;p++){var g=u.decals[p];h=r&&s.MaterialConverter.isPrismMaterial(g.material);var m=s.MaterialConverter.convertMaterial(g.material,h);d.decals.push({uv:g.uv||0,material:m}),this.addMaterial(c+"|decal|"+p,m,h)}}}return a}var v=e.materials.materials;for(var l in v){var y=v[l],b=s.MaterialConverter.convertMaterialGltf(y,e),c=n(e,l);this.addMaterial(c,b,!1)}}},this.updateMaterials=function(){for(;p.length;)for(var e=p.pop(),t=0;e.mats.length>t;t++)e.mats[t][e.slot]=e.tex,e.mats[t].needsUpdate=!0,this.viewer.invalidate(!0,!1,!1)},this.loadTexture=function(t,i){if(t.textureMaps&&!t.texturesLoaded&&(t.texturesLoaded=!0,!o.isNodeJS)){var n=t.textureMaps;for(var l in n){var h=n[l],u=i.basePath+h.uri+h.mapName,d=a.textures[u];if(d)d.tex?(t[h.mapName]=d.tex,t.needsUpdate=!0):(a.textures[u].mats.push(t),a.textures[u].slots.push(h.mapName));else{var c=null,f=t.proteinType&&t.proteinType.length,g=f&&0===t.proteinType.indexOf("Prism"),m=(g&&PRISM_ROOT||f&&PROTEIN_ROOT)&&(0===h.uri.indexOf("1/Mats")||0===h.uri.indexOf("2/Mats")||0===h.uri.indexOf("3/Mats"));if(m)c=g?PRISM_ROOT+h.uri:PROTEIN_ROOT+h.uri;else{for(var v=0;i.manifest.assets.length>v;++v){var y=i.manifest.assets[v];if(y.id==h.uri){c=s.pathToURL(i.basePath+y.URI);break}}c||(c=s.pathToURL(i.basePath+h.uri))}a.textures[u]={mats:[t],slots:[h.mapName],tex:null};var b=function(t,n){return e(n,THREE.UVMapping,function(e){if(a){e.image=r(e.image);var i=a.textures[t];if(i){i.tex||(i.tex=e);for(var n=0;i.mats.length>n;n++)i.mats[n][i.slots[n]]=e;p.push(i)}}},i.acmSessionId)}(u,c);b.anisotropy="bumpMap"==h.mapName||"normalMap"==h.mapName?0:this.viewer.renderer().getMaxAnisotropy(),b.flipY=void 0!==h.flipY?h.flipY:!0,b.invert=!1,b.wrapS=THREE.RepeatWrapping,b.wrapT=THREE.RepeatWrapping,s.MaterialConverter.convertTexture(h.textureObj,b,i.materials.scene.SceneUnit,h.isPrism)}}}},this.loadTextures=function(e){for(var t in l)if(-1!=t.indexOf(e.basePath)){var i=l[t];this.loadTexture(i,e)}},this.create2DMaterial=function(t,i,s,a){var h="__lineMaterial__";if(i.image&&(h+="|image:"+i.image.name),i.clip&&(h+="|clip:"+JSON.stringify(i.clip)),s&&(h+="|id"),a&&(h+="|selection"),i.skipEllipticals&&(h+="|skipEllipticals"),i.skipCircles&&(h+="|skipCircles"),i.skipTriangleGeoms&&(h+="|skipTriangleGeoms"),i.useInstancing&&(h+="|useInstancing"),t&&(h+=t.basePath),h=n(null,h),!l.hasOwnProperty(h)){var u=o.Shaders,d=u.createShaderMaterial(u.LineShader);if(d.transparent=!0,d.depthWrite=!1,d.depthTest=!1,d.side=THREE.DoubleSide,d.blending=THREE.NormalBlending,s?(d.defines.ID_COLOR=1,d.blending=THREE.NoBlending):a?(this.setSelectionTexture(d),d.defines.SELECTION_RENDERER=1,d.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):this.viewer.renderer().hasMRT()&&(d.mrtIdBuffer=this.viewer.renderer().settings.numIdTargets),i.skipEllipticals||(d.defines.HAS_ELLIPTICALS=1),i.skipCircles||(d.defines.HAS_CIRCLES=1),i.skipTriangleGeoms||(d.defines.HAS_TRIANGLE_GEOMS=1),i.useInstancing&&(d.defines.USE_INSTANCING=1),i.image&&!o.isNodeJS){var c=this,p=function(e){c.viewer&&(e.image=r(e.image),e.wrapS=THREE.ClampToEdgeWrapping,e.wrapT=THREE.ClampToEdgeWrapping,e.minFilter=THREE.LinearMipMapLinearFilter,e.magFilter=THREE.LinearFilter,e.anisotropy=1,e.flipY=!0,e.generateMipmaps=!0,e.needsUpdate=!0,d.defines.HAS_RASTER_QUADS=1,d.uniforms.tRaster.value=e,-1!=i.image.dataURI.indexOf("png")&&(d.transparent=!0),d.needsUpdate=!0,c.viewer.invalidate(!1,!0,!1))};e(i.image.dataURI,THREE.UVMapping,p,t.acmSessionId)}d.modelScale=i.modelScale||1,this.add2DMaterial(h,d)}return h},this.add2DMaterial=function(e,t){this.layerMaskTex&&(t.defines.HAS_LAYERS=1,t.uniforms.tLayerMask.value=a.layerMaskTex),this.lineStyleTex&&(t.defines.HAS_LINESTYLES=1,t.defines.MAX_LINESTYLE_LENGTH=a.lineStyleTex.image.width,t.uniforms.tLineStyle.value=a.lineStyleTex,t.uniforms.vLineStyleTexSize.value.set(a.lineStyleTex.image.width,a.lineStyleTex.image.height)),l[e]=t},this.addMaterial=function(e,t,i){function r(e){return.299*e.r+.587*e.g+.114*e.b}var n=t.proteinMat?t.proteinMat:null,o=t.proteinType&&-1!=t.proteinType.indexOf("Prism");if(this.hasPrism=o||this.hasPrism,!i){if(t.metal)t.reflectivity||(t.reflectivity=r(t.specular)),n&&(1===t.reflectivity&&(t.reflectivity=r(t.specular)),0===t.color.r&&0===t.color.g&&0===t.color.b||(t.color.r*=.1,t.color.g*=.1,t.color.b*=.1));else if(o){var s=!1;if("PrismLayered"==t.proteinType&&(t.clearcoat=!0,t.reflectivity=.06,n)){var h=n.materials[n.userassets[0]],p=h.categories;p&&p.length&&-1!=p[0].indexOf("Metal")&&(s=!0)}t.reflectivity=Math.sqrt(t.reflectivity),s?t.specular.copy(t.color):(t.specular.r=t.reflectivity,t.specular.g=t.reflectivity,t.specular.b=t.reflectivity)}else t.reflectivity?t.reflectivity>.3?(t.metal=!0,t.specular.r=t.color.r,t.specular.g=t.color.g,t.specular.b=t.color.b,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1):(t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):1!==t.color.r||1!==t.color.g||1!==t.color.b||1!==t.specular.r||1!==t.specular.g||1!==t.specular.b||t.textureMaps&&(t.textureMaps.map||t.textureMaps.specularMap)?(t.reflectivity=.01+.06*r(t.specular),t.specular.r*=t.reflectivity,t.specular.g*=t.reflectivity,t.specular.b*=t.reflectivity):(t.metal=!0,t.reflectivity=.7,t.color.r*=.1,t.color.g*=.1,t.color.b*=.1),1>t.opacity&&(t.reflectivity=1);(t.transparent||t.textureMaps&&(t.textureMaps.map&&-1!=t.textureMaps.map.uri.toLowerCase().indexOf(".png")||t.textureMaps.opacityMap))&&(t.alphaTest=.01)}if(t.textureMaps&&t.textureMaps.normalMap){var g=t.bumpScale;(void 0===g||g>=1)&&(g=1),t.normalScale=new THREE.Vector2(g,g)}else void 0===t.bumpScale&&t.textureMaps&&(t.textureMaps.map||t.textureMaps.bumpMap)?t.bumpScale=.03:t.bumpScale>=1&&(t.bumpScale=.03);void 0!==t.shininess&&(t.shininess*=.25),a.reflectionCube&&!t.disableEnvMap&&(t.envMap=a.reflectionCube),a.irradianceMap&&(t.irradianceMap=a.irradianceMap),t.exposureBias=Math.pow(2,this.viewer.renderer().getExposureBias()),t.tonemapOutput=this.viewer.renderer().getToneMapMethod(),t.envMapExposure=u,t.envRotationSin=d,t.envRotationCos=c,this.viewer.renderer().applyMRTFlags(t),t.side==THREE.DoubleSide&&this.viewer.renderer().toggleTwoSided(!0),t.doNotCut||(t.cutplanes=f),l[e]=t},this.addMaterialNonHDR=function(e,t){t.doNotCut||(t.cutplanes=f),h[e]=t},this.togglePolygonOffset=function(e){for(var t in l){var i=l[t];i instanceof THREE.MeshPhongMaterial&&(i.polygonOffset=!0,i.polygonOffsetFactor=e?1:0,i.polygonOffsetUnits=e?.1:0,i.needsUpdate=!0)}},this.applyGeometryFlagsToMaterial=function(e,t){t.attributes.color&&(e.vertexColors=THREE.VertexColors,e.needsUpdate=!0),!e.proteinType&&t.attributes.uv&&t.attributes.uv.isPattern&&(e.map&&!e.bumpMap&&(e.bumpMap=e.map,e.needsUpdate=!0),e.textureMaps&&e.textureMaps.map&&!e.textureMaps.bumpMap&&(e.textureMaps.bumpMap=e.textureMaps.map,e.needsUpdate=!0))},this.toggleMRTSetting=function(){for(var e in l){var t=l[e];i(e)||this.viewer.renderer().applyMRTFlags(t)}},this.updatePixelScale=function(e){var t=l;for(var r in t)if(i(r)){var n=t[r];n.uniforms.aaRange.value=.5/(e*n.modelScale),n.uniforms.pixelsPerUnit.value=e*n.modelScale}},this.updateSwapBlackAndWhite=function(e){var t=l;for(var r in t)if(i(r)){var n=t[r];n.uniforms.swap.value=e?1:0}},this.updateViewportId=function(e){var t=l;for(var r in t)if(i(r)){var n=t[r];n.uniforms.viewportId.value=e,n.needsUpdate=!0}this.viewer.invalidate(!0)},this.setCubeMapFromColors=function(e,t){var i=s.CreateCubeMapFromColors(e,t);a.reflectionCube=i,a.reflectionCube.isBgColor=!0;for(var r in l){var n=l[r];n.disableEnvMap||(n.envMap=i,n.needsUpdate=!0)}return this.viewer.invalidate(!0),a.reflectionCube},this.setCubeMap=function(e,t){var i=this,r=function(e){if(i.reflectionCube=e,i.reflectionCube)for(var t in l){var r=l[t];r.disableEnvMap||(r.envMap=a.reflectionCube,r.needsUpdate=!0)}else i.setCubeMapFromColors(i.viewer.clearColorTop,i.viewer.clearColorBottom);i.viewer.invalidate(!0)},n=function(i){i?(i.mapping=THREE.CubeReflectionMapping,i.LogLuv=-1!=e.indexOf("logluv"),i.RGBM=-1!=e.indexOf("rgbm"),s.DecodeEnvMap(i,t,!1,r)):r(i)};return Array.isArray(e)?(this.reflectionCube=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,n),this.reflectionCube.format=THREE.RGBFormat):"string"==typeof e?-1!=e.toLowerCase().indexOf(".dds")?this.reflectionCube=(new THREE.DDSLoader).load(e,n):(this.reflectionCube=THREE.ImageUtils.loadTexture(e,THREE.SphericalReflectionMapping,r),this.reflectionCube.format=THREE.RGBFormat):e?r(e):r(null),i.reflectionCube},this.setIrradianceMap=function(e,t){var i=this,r=function(e){for(var t in l){var r=l[t];r.irradianceMap=e,r.needsUpdate=!0}i.irradianceMap=e,i.viewer.invalidate(!0)},n=function(n){n?(n.mapping=THREE.CubeReflectionMapping,n.LogLuv=-1!=e.indexOf("logluv"),n.RGBM=-1!=e.indexOf("rgbm"),s.DecodeEnvMap(n,t,!1,r)):i.irradianceMap&&r(null)};return THREE.ImageUtils.crossOrigin="",Array.isArray(e)?(a.irradianceMap=THREE.ImageUtils.loadTextureCube(e,THREE.CubeReflectionMapping,r),a.irradianceMap.format=THREE.RGBFormat):"string"==typeof e?-1!=e.toLowerCase().indexOf(".dds")&&(this.irradianceMap=(new THREE.DDSLoader).load(e,n)):e?r(e):r(null),i.irradianceMap},this.setTonemapMethod=function(e){for(var t in l){var i=l[t];i.tonemapOutput=e,i.needsUpdate=!0}},this.setEnvExposure=function(e){var t=Math.pow(2,e);u=t;for(var i in l){var r=l[i];r.envMapExposure=t,r.needsUpdate=!0}},this.setEnvRotation=function(e){d=Math.sin(e),c=Math.cos(e);for(var t in l){var i=l[t];i.envRotationSin=d,i.envRotationCos=c,i.needsUpdate=!0}},this.setTonemapExposureBias=function(e){var t=Math.pow(2,e);for(var i in l){var r=l[i];r.exposureBias=t,r.needsUpdate=!0}},this.initLayersTexture=function(e){for(var t=e.getData().layerCount,i=256,r=256,n=new Uint8Array(i*r),o=0,s=t;s>o;o++)n[o]=255;var a=new THREE.DataTexture(n,i,r,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,this.layerMaskTex=a,this.layersMap=e.getData().layersMap},this.initLineStyleTexture=function(){this.lineStyleTex=s.CreateLinePatternTexture()},this.initSelectionTexture=function(e){for(var t=e||1,i=4096,r=0|Math.ceil(t/i),n=1;r>n;)n*=2;r=n;for(var o=new Uint8Array(i*r),s=0;t>s;s++)o[s]=0;var a=new THREE.DataTexture(o,i,r,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);a.generateMipmaps=!1,a.flipY=!1,a.needsUpdate=!0,this.selectionTex=a},this.setSelectionTexture=function(e){if(this.selectionTex){var t=this.selectionTex.image;e.uniforms.tSelectionTexture.value=this.selectionTex,e.uniforms.vSelTexSize.value.set(t.width,t.height),e.needsUpdate=!0}},this.init2DSelectionMaterial=function(e){this.selectionTex||this.initSelectionTexture(e.myData.maxObjectNumber);var t=this.create2DMaterial(e.getData(),{},!1,!0),i=l[t];return i},this.setLayerVisible=function(e,t){for(var r=this.layerMaskTex,n=r.image.data,o=this.layersMap,s=t?255:0,a=0;e.length>a;++a){var h=e[a];n[o[h]]=s}r.needsUpdate=!0;for(var u in l)i(u)&&(l[u].needsUpdate=!0);this.viewer.invalidate(!0)},this.isLayerVisible=function(e){return!!this.layerMaskTex.image.data[this.layersMap[e]]},this.highlightObject2D=function(e,t){var i=this.selectionTex.image.data;i[e]=t?255:0,this.selectionTex.needsUpdate=!0,this.viewer.invalidate(!1,!1,!0)},this.cloneMaterial=function(e){var t=e.isPrismMaterial?s.clonePrismMaterial(e):e.clone();return(t instanceof THREE.MeshPhongMaterial||t.isPrismMaterial)&&(t.packedNormals=e.packedNormals,t.exposureBias=e.exposureBias,t.irradianceMap=e.irradianceMap,t.envMapExposure=e.envMapExposure,t.envRotationSin=e.envRotationSin,t.envRotationCos=e.envRotationCos,t.proteinType=e.proteinType,t.proteinMat=e.proteinMat,t.tonemapOutput=e.tonemapOutput,t.cutplanes=e.cutplanes),this.viewer.renderer().applyMRTFlags(t),t},this.getCutPlanes=function(){return f.slice()},this.getCutPlanesRaw=function(){return f},this.setCutPlanes=function(e){if(f.length!==(e?e.length||0:0)){var t;for(t in l){var i=l[t];i.doNotCut||(i.needsUpdate=!0,e&&e.length>0&&(i.side=THREE.DoubleSide))}for(t in h)h[t].doNotCut||(h[t].needsUpdate=!0)}for(;f.length>0;)f.pop();if(e)for(var r=0;e.length>r;r++)f.push(e[r].clone())},this.cleanup=function(e){var t={};for(var r in this.textures){var n=this.textures[r];-1===r.indexOf(e.basePath)?t[r]=n:n.tex&&(n.tex.dispose(),n.tex.needsUpdate=!0)}this.textures=t;var o={},s={type:"dispose"};for(var a in l)if(e&&-1===a.indexOf(e.basePath))o[a]=l[a];else{var u=l[a];if(u.dispatchEvent(s),u.needsUpdate=!0,u.envMap=null,i(a)){u.uniforms.tLayerMask.value=null,u.uniforms.tLineStyle.value=null;var d=u.uniforms.tRaster;d&&d.value instanceof THREE.Texture&&(d.value.dispose(),d.value.needsUpdate=!0)}}l=this.materials=o;var c={};for(var a in h)if(e&&-1===a.indexOf(e.basePath))c[a]=h[a];else{var u=h[a];u.dispatchEvent(s),u.needsUpdate=!0}h=c},this.addSimpleMaterial=function(e,t,i){var r=s.MaterialConverter.convertMaterial(t),o=n(i,e);this.addMaterial(o,r),this.loadTexture(r,i)},this.addMaterial("__defaultMaterial__",this.defaultMaterial),this.removeMaterial=function(e){delete l[e]},this.exportModelMaterials=function(e){var t=e.getData(),i={};for(var r in l)if(-1!==r.indexOf(t.basePath)){var n=l[r],o=n.defines&&n.defines.hasOwnProperty("SELECTION_RENDERER");o||(i[r]=n)}var s={};for(var r in h)-1!==r.indexOf(t.basePath)&&(s[r]=h[r]);var a={};for(var u in this.textures)-1!==u.indexOf(t.basePath)&&(a[u]=this.textures[u]);return this.cleanup(t),{mats:i,matsNonHDR:s,textures:a}},this.importModelMaterials=function(e){for(var t in e.mats)i(t)?this.add2DMaterial(t,e.mats[t]):this.addMaterial(t,e.mats[t],!0);for(var t in e.matsNonHDR)this.addMaterialNonHDR(t,e.matsNonHDR[t]);for(var r in e.textures)this.textures[r]=e.textures[r]},this.setShadowParams=function(e){for(var t in l){var i=l[t];e.apply(i)}}}var o=Autodesk.Viewing,s=o.Private;Autodesk.Viewing.Private.MaterialManager=n,Autodesk.Viewing.Private.loadTextureWithSecurity=e}(),function(){"use strict";function e(){function e(){function e(e){e.material.blending=THREE.NoBlending,e.material.depthWrite=!1,e.material.depthTest=!1}var t=tt.NormalsShader;o=tt.createShaderMaterial(t),o.blending=THREE.NoBlending,o.packedNormals=!0,o._noCutplanesMaterial=o.clone(),o._noCutplanesMaterial.cutplanes=null,o._noCutplanesMaterial.blending=THREE.NoBlending,o._noCutplanesMaterial.packedNormals=!0,o.getCustomOverrideMaterial=function(e){var t=e.cutplanes?e.cutplanes.length:0;return 0===t?o._noCutplanesMaterial:null},c=new tt.LmvShaderPass(tt.SAOShader),e(c),d=new tt.LmvShaderPass(tt.SAOBlurShader),e(d),f=new tt.LmvShaderPass(tt.SAOMinifyFirstShader),e(f),p=new tt.LmvShaderPass(tt.SAOMinifyShader),e(p),g=new tt.LmvShaderPass(tt.FXAAShader),e(g),m=new tt.LmvShaderPass(tt.CelShader),e(m),v=new tt.LmvShaderPass(tt.BlendShader),e(v),u=new tt.LmvShaderPass(tt.BackgroundShader),e(u),y=new tt.LmvShaderPass(tt.CopyShader),e(y)}function r(e,t){var i=3*e[1],r=3*(e[3]-e[1])-i,n=1-i-r;return((n*t+r)*t+i)*t}var n,o,s,a,l,h,u,d,c,p,f,g,m,v,y,b,E,w,_,T,S,x,M,k=!1,R=!1,C=null,A=null,P=null,I=null,D=null,L=[],O=0,V=0,N=0,F=1,U=!1,H=new Uint8Array(4),B=(new THREE.Color).setRGB(1,1,1),z=(new THREE.Color).setRGB(0,0,0),G=null,W=!1,j=!1,q=!1,Y=!1,J=0,K=0,Z=0,X=[.42,0,1,1],Q=.004,$={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1,numIdTargets:1},et={},tt=Autodesk.Viewing.Shaders;this.settings=$,this.init=function(r,o,s){if(e(),!r)return i.logger.error("You need a gl context to make a renderer. Things will go downhill from here."),void 0;W=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS");var a=-1!=window.navigator.userAgent.indexOf("Firefox");M=a?THREE.RGBAFormat:THREE.RGBFormat,j=t.isMobileDevice(),$.idbuffer=!j,S=o,x=s,n=r},this.overlayUpdate=function(){if(0===K||-1===K)return!1;var e=v.uniforms.highlightIntensity.value,t=(performance.now()-J)*Q;t=Math.min(t,1);var i=r(X,t);return e!=i?(v.uniforms.highlightIntensity.value=i,!0):!1},this.beginScene=function(e,t,r,o){if(a=t,h=e.fog,l=r,k=!1,R=!1,!A&&S)this.initPostPipeline($.sao,$.antialias);else if(!A&&!S)return U||(i.logger.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance."),U=!0),void 0;o&&(G&&!$.envMapBg?(n.setClearColor(G,1),n.clearTarget(A,!0,!0,!1)):(u.uniforms.uCamDir.value=a.worldUpTransform?a.getWorldDirection().clone().applyMatrix4(a.worldUpTransform):a.getWorldDirection(),u.uniforms.uCamUp.value=a.worldUpTransform?a.up.clone().applyMatrix4(a.worldUpTransform):a.up,u.uniforms.uResolution.value.set(S,x),u.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*a.fov)),n.clearTarget(A,!1,!0,!1),u.render(n,A,null)));for(var s=0;L.length>s;s++)n.setClearColor(B,1),n.clearTarget(L[s],!0,!1,!1);if($.sao||$.toonShaded){o&&(n.setClearColor(z,0),n.clearTarget(T,!0,!1,!1));var d=t.near,p=t.far;c.uniforms.cameraNear.value=d,c.uniforms.cameraFar.value=p,m.uniforms.cameraNear.value=d,m.uniforms.cameraFar.value=p,f.uniforms.cameraNear.value=d,f.uniforms.cameraInvNearFar.value=1/(d-p);var g=t.projectionMatrix.elements;t.isPerspective?(c.uniforms.projInfo.value.set(-2/(A.width*g[0]),-2/(A.height*g[5]),(1-g[8])/g[0],(1+g[9])/g[5]),m.uniforms.projInfo.value.copy(c.uniforms.projInfo.value),c.uniforms.isOrtho.value=0,m.uniforms.isOrtho.value=0):(c.uniforms.projInfo.value.set(-2/(A.width*g[0]),-2/(A.height*g[5]),(1-g[12])/g[0],(1-g[13])/g[5]),m.uniforms.projInfo.value.copy(c.uniforms.projInfo.value),c.uniforms.isOrtho.value=1,m.uniforms.isOrtho.value=1);var y=.25;c.uniforms.projScale.value=.5*y*A.height*g[5]}$.sao||(v.uniforms.useAO.value=0),this.renderScenePart(e,!0,!0,!1,!0)},this.renderScenePart=function(e,t,i,r,u){k=!1,R=!1;var d=u?l:void 0;e.fog=h;var c;q&&Y?$.idbuffer&&r&&($.sao||$.toonShaded)?n.render(e,a,[A,T].concat(L),!1,d):$.sao||$.toonShaded?n.render(e,a,[A,T],!1,d):$.idbuffer&&r?n.render(e,a,[A].concat(L)):n.render(e,a,A,!1,d):Y?($.idbuffer&&r?n.render(e,a,[A].concat(L),!1,d):n.render(e,a,A,!1,d),($.sao||$.toonShaded)&&i&&(c=e.overrideMaterial,e.overrideMaterial=o,n.render(e,a,T,!1,void 0),e.overrideMaterial=c)):(t&&n.render(e,a,A,!1,d),$.idbuffer&&r&&s&&(c=e.overrideMaterial,e.overrideMaterial=s,n.render(e,a,L[0],!1,void 0),e.overrideMaterial=c),($.sao||$.toonShaded)&&i&&(c=e.overrideMaterial,e.overrideMaterial=o,n.render(e,a,T,!1,void 0),e.overrideMaterial=c))},this.clearAllOverlays=function(){n.clearTarget(P,!0,!1,!1)},this.renderOverlays=function(e,t){var i=0;for(var r in e){var o=e[r],s=o.scene,l=o.camera?o.camera:a;s.children.length&&(i||(i=1,n.setClearColor(z,0),n.clearTarget(P,!0,!1,!1)),o.materialPre&&(s.overrideMaterial=o.materialPre),n.render(s,l,P,!1,t),o.materialPost&&(s.overrideMaterial=o.materialPost,n.context.depthFunc(n.context.GREATER),n.render(s,l,P,!1,t),n.context.depthFunc(n.context.LEQUAL)),s.overrideMaterial=null)}v.uniforms.useOverlay.value=i},this.computeSSAO=function(e){if(e||!$.sao||$.toonShaded)v.uniforms.useAO.value=0;else{if(!k){if(C){var t=C[0];f.uniforms.resolution.value.set(1/t.width,1/t.height),f.render(n,t,T);for(var i=1;C.length>i;i++){var r=C[i];p.uniforms.resolution.value.set(1/r.width,1/r.height),p.render(n,r,t),t=r}}c.render(n,D,A),d.uniforms.axis.value.set(1,0),d.render(n,I,D),d.uniforms.axis.value.set(0,1),d.render(n,D,I),k=!0}v.uniforms.useAO.value=1}},this.presentBuffer=function(e){if(n){var t=!($.sao||v.uniforms.useOverlay.value||0!==K&&-1!==K||0!==Z&&-1!==Z);t?$.antialias?e?(g.render(n,I,A),e.render(n,null,I)):$.toonShaded?(m.render(n,I,A),g.render(n,null,I)):g.render(n,null,A):e?e.render(n,null,A):$.toonShaded?(m.render(n,I,A),y.render(n,null,I)):y.render(n,null,A):$.antialias?(v.render(n,I,A),e?(g.render(n,D,I),e.render(n,null,D)):$.toonShaded?(m.render(n,D,I),g.render(n,null,D)):g.render(n,null,I)):e?(v.render(n,I,A),e.render(n,null,I)):$.toonShaded?(v.render(n,I,A),m.render(n,D,I),y.render(n,null,D)):v.render(n,null,A)}},this.composeFinalFrame=function(e,t){$.sao&&!$.toonShaded&&this.computeSSAO(e),t||this.presentBuffer()},this.cleanup=function(){if(A&&(A.dispose(),A=null),T&&(T.dispose(),T=null),P&&(P.dispose(),P=null),I&&(I.dispose(),I=null),D&&(D.dispose(),D=null),C){for(var e=0;C.length>e;e++)C[e].dispose();C=[]}},this.setSize=function(e,r,o){if(S=e,x=r,$.logicalWidth=e,$.logicalHeight=r,0===e&&0===r||!n)return this.cleanup(),void 0;var s=0|e*n.getPixelRatio(),a=0|r*n.getPixelRatio();$.deviceWidth=s,$.deviceHeight=a,n.setSize(e,r),i.logger.log("width: "+s+" height: "+a);var l=1/s,h=1/a;if(($.useSSAA||$.toonShaded&&1>=n.getPixelRatio())&&(s*=2,a*=2,o=!0),(o||!A||A.width!=s||A.height!=a)&&(i.logger.log("Reallocating render targets."),this.cleanup(),A=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:$.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1}),A.generateMipmaps=!1,P=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),P.generateMipmaps=!1,P.shareDepthFrom=A,T=null,I=null,D=null,C=[]),($.antialias||$.sao||$.customPresentPass||$.toonShaded)&&(o||!I||I.width!=s||I.height!=a)&&(I=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),I.generateMipmaps=!1),$.sao||$.toonShaded){if(o||!T||T.width!=s||T.height!=a){var u=THREE.FloatType;t.isMobileDevice()&&(u=THREE.HalfFloatType),T=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:M,type:u,stencilBuffer:!1}),T.shareDepthFrom=A,C=[];for(var p=0;5>p;p++){var f=new THREE.WebGLRenderTarget(0|s/(2<<p),0|a/(2<<p),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});f.generateMipmaps=!1,C.push(f),c.uniforms["tDepth_mip"+(p+1)].value=f}q=!W&&n.verifyMRTWorks([A,T]),D=I.clone()}!D&&$.antialias&&$.customPresentPass&&(D=I.clone()),c.uniforms.size.value.set(s,a),c.uniforms.resolution.value.set(l,h),c.uniforms.tDepth.value=T,d.uniforms.size.value.set(s,a),d.uniforms.resolution.value.set(l,h),m.uniforms.tDepth.value=T}if($.idbuffer){if(o||!L[0]||L[0].width!=s||L[0].height!=a){L=[];for(var y=0;$.numIdTargets>y;y++)L[y]=new THREE.WebGLRenderTarget(s,a,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1}),L[y].generateMipmaps=!1,L[y].shareDepthFrom=A,L[y].canReadPixels=!0;
Y=!W&&n.verifyMRTWorks([A].concat(L)),Y||i.logger.warn("ID buffer requested, but MRT is not supported. Some features will not work.")}m.uniforms.tID.value=L[0]}else if(L[0])for(var y=0;L.length>y;y++)L[y].dispose(),L[y]=null;g.uniforms.uResolution.value.set(l,h),m.uniforms.resolution.value.set(l,h),v.uniforms.tOverlay.value=P,v.uniforms.tAO.value=D,v.uniforms.useAO.value=$.sao?1:0,v.uniforms.resolution.value.set(l,h),v.uniforms.tID.value=L[0]},this.getMaxAnisotropy=function(){return n.getMaxAnisotropy()},this.hasMRT=function(){return!W&&n&&n.supportsMRT()},this.applyMRTFlags=function(e){var t=e.mrtNormals,i=e.mrtIdBuffer;e.mrtNormals=this.hasMRT()&&q&&($.sao||$.toonShaded),e.mrtIdBuffer=this.hasMRT()&&Y&&$.idbuffer?$.numIdTargets:void 0,(e.mrtNormals!==t||e.mrtIdBuffer!==i)&&(e.needsUpdate=!0)},this.getAntialiasing=function(){return $.antialias},this.initPostPipeline=function(e,i){$.sao=e&&!t.isIE11,$.antialias=i&&!t.isIE11,$.sao&&($.toonShaded=!1),$.haveTwoSided&&(o.side=THREE.DoubleSide,o._noCutplanesMaterial.side=o.side),o.needsUpdate=!0,o._noCutplanesMaterial.needsUpdate=!0,c.material.needsUpdate=!0,d.material.needsUpdate=!0,f.material.needsUpdate=!0,p.material.needsUpdate=!0,g.material.needsUpdate=!0,m.material.needsUpdate=!0,v.material.needsUpdate=!0,u.material.needsUpdate=!0,y.material.needsUpdate=!0,this.setSize(S,x)},this.setClearColors=function(e,t){G=t?e.equals(t)||j?new THREE.Color(.5*(e.x+t.x),.5*(e.y+t.y),.5*(e.z+t.z)):void 0:e.clone(),G||(u.uniforms.color1.value.copy(e),u.uniforms.color2.value.copy(t))},this.setAOEnabled=function(e){$.sao=e},this.setAOOptions=function(e,i){void 0!==e&&(c.uniforms.radius.value=e,c.uniforms.bias.value=e*t.isMobileDevice()?.1:.01,d.uniforms.radius.value=e),void 0!==i&&(c.uniforms.intensity.value=i),k=!1},this.getAOEnabled=function(){return $.sao},this.getAORadius=function(){return c.uniforms.radius.value},this.getAOIntensity=function(){return c.uniforms.intensity.value},this.setCubeMap=function(e){u.material.envMap=e},this.setEnvRotation=function(e){V=e,u.material.envRotationSin=Math.sin(e),u.material.envRotationCos=Math.cos(e)},this.getEnvRotation=function(){return V},this.setEnvExposure=function(e){u.uniforms.envMapExposure.value=Math.pow(2,e),u.material.envMapExposure=Math.pow(2,e),u.material.needsUpdate=!0},this.setTonemapExposureBias=function(e){O=e,u.uniforms.exposureBias.value=Math.pow(2,e)},this.getExposureBias=function(){return O},this.setTonemapMethod=function(e){N=e,n.gammaInput=0===e?!1:!0,u.material.tonemapOutput=N,u.material.needsUpdate=!0},this.getToneMapMethod=function(){return N},this.toggleTwoSided=function(e){$.haveTwoSided!=e&&o&&(o.side=e?THREE.DoubleSide:THREE.FrontSide,o.needsUpdate=!0,o._noCutplanesMaterial.side=o.side,o._noCutplanesMaterial.needsUpdate=!0),$.haveTwoSided=e},this.toggleCelShading=function(e){$.sao=!e,$.toonShaded=e,$.idbuffer=e,this.initPostPipeline($.sao,$.antialias)},this.toggleEnvMapBackground=function(e){$.envMapBg=e,u.uniforms.envMapBackground.value=e},this.enter2DMode=function(e){s=e,et.sao=$.sao,et.toonShaded=$.toonShaded,et.antialias=$.antialias,et.idbuffer=$.idbuffer,$.idbuffer=!0,$.toonShaded=!1,v.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){s=null,$.idbuffer=et.idbuffer,$.toonShaded=et.toonShaded,delete v.material.defines.IS_2D,this.initPostPipeline(et.sao,et.antialias)},this.idAtPixel=function(e,t,i){if(!L[0])return 0;var r=0|.5*(e+1)*L[0].width,o=0|.5*(t+1)*L[0].height;if(R&&r===b&&o===E)return i&&(i[0]=w,i[1]=_),w;n.readRenderTargetPixels(L[0],r,o,1,1,H);var s=H[2]<<16|H[1]<<8|H[0],a=0;return L[1]?(n.readRenderTargetPixels(L[1],r,o,1,1,H),a=H[1]<<8|H[0],a=a<<16>>16,s=s<<8>>8):s=s<<8>>8,b=r,E=o,w=s,_=a,R=!0,i&&(i[0]=s,i[1]=a),s},this.idAtPixels=function(e,t,i,r){function o(){for(var e,t=0,n=0,o=0,s=-1,a=0;i*i>a;a++){var u=t+(i-1)/2,d=n+(i-1)/2;if(u>=0&&i>=u&&d>=0&&i>=d){var c=u+d*i;if(e=l[4*c+2]<<16|l[4*c+1]<<8|l[4*c],e=e<<8>>8,e>=0){if(h){var p=h[4*c+1]<<8|h[4*c];p=p<<16>>16,r[0]=e,r[1]=p}break}}if(t==n||0>t&&t==-n||t>0&&t==1-n){var f=o;o=-s,s=f}t+=o,n+=s}return e}if(!L[0])return 0;var s=.5*(e+1)*L[0].width-.5*(i-1),a=.5*(t+1)*L[0].height-.5*(i-1),l=new Uint8Array(4*i*i);n.readRenderTargetPixels(L[0],s,a,i,i,l);var h=void 0;return r&&L[1]&&(h=new Uint8Array(4*i*i),n.readRenderTargetPixels(L[1],s,a,i,i,h)),o()},this.readbackTargetId=function(){if(!L[0])return null;var e=new Uint8Array(4*L[0].width*L[0].height);return n.readRenderTargetPixels(L[0],0,0,L[0].width,L[0].height,e),{buffer:e,width:L[0].width,height:L[0].height}},this.rolloverObjectViewport=function(e,t,i){var r=i?i[0]:this.idAtPixel(e,t);return this.rolloverObjectId(r,i)},this.rolloverObjectId=function(e,t,i){return i=i||0,e===K&&i===Z?!1:(v.uniforms.highlightIntensity.value=0,v.uniforms.objID.value=e,J=performance.now(),K=e,Z=i,t?(t.length>1&&t.shift(),v.uniforms.highlightRange.value=1,v.uniforms.objIDStart.value=t[0],v.uniforms.objIDEnd.value=t[t.length-1]):(v.uniforms.highlightRange.value=0,0>=e&&(e=0),v.uniforms.objIDv3.value.set((255&e)/255,(255&e>>8)/255,(255&e>>16)/255)),!0)},this.setUnitScale=function(e){F=e},this.getUnitScale=function(){return F},this.getBlendPass=function(){return v},this.getColorTarget=function(){return A},this.getDepthMaterial=function(){return o}}var t=Autodesk.Viewing,i=t.Private;i.RenderContext=e}(),function(){"use strict";function e(e,t){var i=255*t[2]+t[3],r=Math.pow(2,(i-127)/2),n=r/t[1],o=t[0]*n,s=a[0]*o+a[3]*r+a[6]*n,l=a[1]*o+a[4]*r+a[7]*n,h=a[2]*o+a[5]*r+a[8]*n;0>s&&(s=0),0>l&&(l=0),0>h&&(h=0),e[0]=s,e[1]=l,e[2]=h}function t(e,t,i){var r=.0625*Math.sqrt(t[0]*i),n=.0625*Math.sqrt(t[1]*i),o=.0625*Math.sqrt(t[2]*i),s=Math.max(Math.max(r,n),Math.max(o,1e-6));s>1&&(s=1);var a=Math.ceil(255*s)/255;r>1&&(r=1),n>1&&(n=1),o>1&&(o=1),e[3]=a;var l=1/a;e[0]=r*l,e[1]=n*l,e[2]=o*l}function i(e,t,i){var r=Math.sqrt(t[0]*i),n=Math.sqrt(t[1]*i),o=Math.sqrt(t[2]*i),s=65504;r>s&&(r=s),n>s&&(n=s),o>s&&(o=s),e[0]=r,e[1]=n,e[2]=o}function r(e){for(var t=[],i=Array.isArray(e.image)?e.image:[e.image],r=0;i.length>r;r++)for(var n=i[r],o=0;n.mipmaps.length>o;o++){var s=n.mipmaps[o];t.push(s.data.buffer)}return t}var n=(Autodesk.Viewing,Autodesk.Viewing.Private),o=Autodesk.LMVTK;n.DefaultLightPreset=1,n.DefaultLightPreset2d=0,n.ModelSettingsEnvironment=null,n.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var s=n.BackgroundPresets;n.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.2,.225,.25],lightMultiplier:1,bgColorGradient:s["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.5,-.2,-.06],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:s["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:s["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25,.25,.25],lightMultiplier:1,bgColorGradient:s.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[.35,-.35,-.5],bgColorGradient:s["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-.15,-.5],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.5,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.5,-.6,0],bgColorGradient:s["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[-.2,-.18,.72],bgColorGradient:s.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,lightDirection:[0,-1,0],bgColorGradient:s.Snow,darkerFade:!1,rotation:0}],n.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s.Midnight,darkerFade:!1,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["Sky Blue"],darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:s["RaaS SBS"],darkerFade:!1,rotation:0}],n.ENABLE_DEBUG&&(n.LightPresets=n.LightPresets.concat(n.DebugEnvironments)),n.copyLightPreset=function(e,t){t.name=e.name+" (copy)",t.path=e.path,t.type=e.type,t.tonemap=e.tonemap,t.E_bias=e.E_bias,t.directLightColor=e.directLightColor,t.ambientColor=e.ambientColor,t.lightMultiplier=e.lightMultiplier,t.bgColorGradient=e.bgColorGradient,t.darkerFade=e.darkerFade,t.rotation=e.rotation},n.CreateCubeMapFromColors=function(e,t){for(var i=255*e.x,r=255*e.y,n=255*e.z,o=255*t.x,s=255*t.y,a=255*t.z,l=new Uint8Array(16),h=new Uint8Array(16),u=new Uint8Array(16),d=0;4>d;d++)l[4*d]=i,l[4*d+1]=r,l[4*d+2]=n,l[4*d+3]=255,h[4*d]=o,h[4*d+1]=s,h[4*d+2]=a,h[4*d+3]=255,d>1?(u[4*d]=i,u[4*d+1]=r,u[4*d+2]=n,u[4*d+3]=255):(u[4*d]=o,u[4*d+1]=s,u[4*d+2]=a,u[4*d+3]=255);var c=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),f=new THREE.DataTexture(h,2,2,THREE.RGBAFormat),g=new THREE.DataTexture(l,2,2,THREE.RGBAFormat),m=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),v=new THREE.DataTexture(u,2,2,THREE.RGBAFormat),y=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);return y.image=[p,c,g,f,v,m],y.needsUpdate=!0,y};var a=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],l=new Float32Array(4),h=new Float32Array(4);n.DecodeEnvMap=function(r,o,s,a){if(!r.LogLuv)return n.logger.warn("Environment map expected to be in LogLuv format."),void 0;for(var u=Math.pow(2,o),d=Array.isArray(r.image)?r.image:[r.image],c=0;d.length>c;c++)for(var p=d[c],f=0;p.mipmaps.length>f;f++){var g,m=p.mipmaps[f],v=m.data;s?(g=new Uint16Array(3*(v.length/4)),m.data=g):g=v.buffer;for(var y=0,b=0;v.length>b;b+=4)l[0]=v[b]/255,l[1]=v[b+1]/255,l[2]=v[b+2]/255,l[3]=v[b+3]/255,e(h,l),s?(i(l,h,u),g[y++]=n.FloatToHalf(l[0]),g[y++]=n.FloatToHalf(l[1]),g[y++]=n.FloatToHalf(l[2])):(t(l,h,u),v[b]=Math.round(255*l[0]),v[b+1]=Math.round(255*l[1]),v[b+2]=Math.round(255*l[2]),v[b+3]=Math.round(255*l[3]))}r.LogLuv=!1,s?(r.type=THREE.HalfFloatType,r.format=THREE.RGBFormat,r.RGBM=!1,r.GammaEncoded=!0):r.RGBM=!0,a&&a(r)},n.imageWorker=null;var u=1;n.DecodeEnvMapAsync=function(e,t,i,o){if(!e.LogLuv)return n.logger.warn("Environment map expected to be in LogLuv format."),void 0;n.imageWorker||(n.imageWorker=n.createWorker());var s=u++,a=function(t){if(t.data.id===s){n.imageWorker.removeEventListener("message",a);var r=t.data.map;e.image=r.image,e.LogLuv=!1,i?(e.type=THREE.HalfFloatType,e.format=THREE.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0,o(e)}};n.imageWorker.addEventListener("message",a),n.imageWorker.postMessage({operation:"DECODE_ENVMAP",map:e,exposure:t,useHalfFloat:i,id:s},r(e))},o.doDecodeEnvmap=function(e){n.DecodeEnvMap(e.map,e.exposure,e.useHalfFloat),self.postMessage({map:e.map,id:e.id},r(e.map))}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private;t.init_UnifiedCamera=function(t){if(void 0===e.UnifiedCamera){var i=function(e,i){t.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=e/i,this.left=-e/2,this.right=e/2,this.top=i/2,this.bottom=-i/2,this.clientWidth=e,this.clientHeight=i,this.target=new t.Vector3(0,0,-1),this.worldup=new t.Vector3(0,1,0),this.orthographicCamera=new t.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new t.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()};i.ORTHO_FOV=180*2*Math.atan(.5)/Math.PI,i.prototype=Object.create(t.Camera.prototype),i.prototype.clone=function(){var e=new i(2*this.right,2*this.top);return t.Camera.prototype.clone.call(this,e),e.position.copy(this.position),e.up.copy(this.up),this.target&&(e.target=this.target.clone()),this.worldup&&(e.worldup=this.worldup.clone()),this.worldUpTransform&&(e.worldUpTransform=this.worldUpTransform.clone()),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.fov=this.fov,e.aspect=this.aspect,e.zoom=this.zoom,e.isPerspective=this.isPerspective,this.updateProjectionMatrix(),e},i.prototype.__computeFovPosition=function(e){if(1e-4>=Math.abs(this.fov-e))return this.position.clone();var i=this.target.clone().sub(this.position),r=t.Math.degToRad(this.fov),n=t.Math.degToRad(e),o=i.length()*Math.tan(.5*r)/Math.tan(.5*n),s=i.normalize().multiplyScalar(-o);return this.target.clone().add(s)},i.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},i.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var e=i.ORTHO_FOV;this.position.copy(this.__computeFovPosition(e)),this.fov=e}this.orthoScale=this.target.clone().sub(this.position).length();var t=.5*this.orthoScale,r=t*this.aspect;this.left=this.orthographicCamera.left=-r,this.right=this.orthographicCamera.right=r,this.top=this.orthographicCamera.top=t,this.bottom=this.orthographicCamera.bottom=-t,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},i.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},i.prototype.setSize=function(e,t){this.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},i.prototype.setFov=function(e){this.fov=e,this.updateProjectionMatrix()},i.prototype.setLens=function(e,i){void 0===i&&(i=24);var r=2*t.Math.radToDeg(Math.atan(i/(2*e)));return this.setFov(r),r},i.prototype.getCameraChangedEvent=function(){return{type:e.CAMERA_CHANGE_EVENT,camera:this}},e.UnifiedCamera=i}}}(),function(){"use strict";function e(e,t){function n(){return t.getData().instanceTree}function o(){}function s(i){var r=n();if(p[i]>0)p[i]--,0==p[i]&&e.highlightObjectNode(t,i,!1);else if(0>p[i])throw"Selection State machine broken. Negatively selected object!";r&&r.enumNodeChildren(i,function(e){s(e)},!1)}function a(i,r){var o=n();p[i]?p[i]++:(e.highlightObjectNode(t,i,!0,r),p[i]=1),o&&o.enumNodeChildren(i,function(e){a(e,!0)},!1)}function l(e){return void 0!==e&&c.selectedObjectIds[e]?!0:void 0}function h(e){var t=n();if(!t||(e=t.findNodeForSelection(e,c.selectionMode),t.isNodeSelectable(e))){var i=l(e);i||(c.selectedObjectIds[e]=e,c.selectionCount++,a(e))}}function u(e){var t=l(e);t&&(s(e),c.selectedObjectIds[e]=0,c.selectionCount--)}function d(e){if(c.selectionCount!==e.length)return!1;for(var t=0;e.length>t;t++)if(!l(e[t]))return!1;return!0}var c=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=i.SelectionMode.LEAF_OBJECT;var p={};this.getInstanceTree=n,this.getSelectionLength=function(){return c.selectionCount},this.getSelection=function(){var e=[],t=c.selectedObjectIds;for(var i in t)if(t[i]){var r=parseInt(i);e.push(r)}return e},this.clearSelection=function(e){if(this.selectionCount>0){var t=c.selectedObjectIds;for(var i in t){var r=parseInt(i);void 0!==r&&s(r)}c.selectedObjectIds={},c.selectionCount=0,e||o()}},this.deselectInvisible=function(){var i=!1,r=c.selectedObjectIds;n();var s=e.visibilityManager;for(var a in r){var l=parseInt(a);l&&!s.isNodeVisible(t,l)&&(u(l),i=!0)}return i&&o(),i},this.toggleSelection=function(e){return e?(l(e)?u(e):h(e),o(),void 0):(r.logger.error("Attempting to select node 0."),void 0)},this.setSelectionMode=function(e){this.clearSelection(!0),this.selectionMode=e},this.setSelection=function(e){if(!d(e)&&(this.clearSelection(!0),null!=e&&0!==e.length)){for(var t=0;e.length>t;t++)h(e[t]);o()}},this.getSelectionBounds=function(){var e=new THREE.Box3,i=new THREE.Box3,r=n(),o=t.getFragmentList(),s=c.selectedObjectIds;for(var a in s){var l=parseInt(a);r.enumNodeFragments(l,function(t){o.getWorldBounds(t,i),e.union(i)},!0)}return e},this.getSelectionVisibility=function(){var e=!1,t=!1,i=c.selectedObjectIds;for(var r in i){var o=parseInt(r);if(o){var s=n();if(s&&s.isNodeHidden(o)?t=!0:e=!0,e&&t)break}}return{hasVisible:e,hasHidden:t}},this.dtor=function(){this.selectedObjectIds=null}}function t(t){function n(){a.length>1&&r.logger.warn("This selection call does not yet support multiple models.")}function o(){for(var e=[],r=0;a.length>r;r++){var n=[],o=[],s=a[r].selector.selectedObjectIds,l=a[r].selector.getInstanceTree();for(var h in s)if(s[h]){var u=parseInt(h);u&&(n.push(u),l&&l.enumNodeFragments(u,function(e){o.push(e)},!1))}n.length&&e.push({fragIdsArray:o,dbIdArray:n,nodeArray:n,model:a[r]})}var d;1===a.length&&(d={type:i.SELECTION_CHANGED_EVENT,fragIdsArray:e[0]?e[0].fragIdsArray:[],dbIdArray:e[0]?e[0].dbIdArray:[],nodeArray:e[0]?e[0].dbIdArray:[],model:a[0]},t.api.fireEvent(d)),d={type:i.AGGREGATE_SELECTION_CHANGED_EVENT,selections:e},t.api.fireEvent(d)}function s(){for(var e=!1,t=0;a.length>t;t++)e=a[t].selector.deselectInvisible()||e;e&&o()}var a=[];this.addModel=function(i){-1==a.indexOf(i)&&(i.selector=new e(t,i),a.push(i))},this.removeModel=function(e){var t=a.indexOf(e);e.selector.getSelection(),e.selector.clearSelection(),e.selector=null,a.splice(t,1)},this.getSelectionLength=function(){for(var e=0,t=0;a.length>t;t++)e+=a[t].selector.getSelectionLength();return e},this.getSelection=function(){return n(),a.length>1&&r.logger.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),a[0].selector.getSelection()},this.getAggregateSelection=function(){for(var e=[],t=0;a.length>t;t++){var i=a[t].selector.getSelection();i&&i.length&&e.push({model:a[t],selection:i})}return e},this.clearSelection=function(e){for(var t=0;a.length>t;t++)a[t].selector.clearSelection(e);e||o()},this.toggleSelection=function(e,t){t||(n(),t=a[0]),t.selector.toggleSelection(e),o()},this.setSelectionMode=function(e){for(var t=0;a.length>t;t++)a[t].selector.setSelectionMode(e)},this.setSelection=function(e,t){if(e&&0!==e.length){if(t)for(var i=0;a.length>i;i++)a[i]!==t&&a[i].selector.clearSelection();else n(),t=a[0];t.selector.setSelection(e)}else this.clearSelection();o()},this.getSelectionBounds=function(){if(1==a.length)return a[0].selector.getSelectionBounds();for(var e=new THREE.Box3,t=0;a.length>t;t++){var i=a[t].selector.getSelectionBounds();e.union(i)}return e},this.getSelectionVisibility=function(){return n(),a[0].selector.getSelectionVisibility()},this.dtor=function(){for(var e=0;a.length>e;e++)a[e].selector.dtor()},t.api.addEventListener(i.ISOLATE_EVENT,function(){s()}),t.api.addEventListener(i.HIDE_EVENT,function(){s()})}var i=Autodesk.Viewing,r=i.Private;r.Selector=e,r.MultiModelSelector=t}(),function(){"use strict";function e(e){this.viewer=e,this.models=[]}var t=Autodesk.Viewing,i=t.Private,r=function(e,t){this.viewerImpl=e,this.model=t,this.isolatedNodes=[],this.hiddenNodes=[]};r.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},r.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},r.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},r.prototype.setAllVisibility=function(e){var t=this.model?this.model.getRootId():null;t&&this.setVisibilityOnNode(t,e);var i=this.model.getData().is2d;i&&this.model.setAllVisibility(e)},r.prototype.isNodeVisible=function(e){var t=this.getInstanceTree();return t?!t.isNodeHidden(e):-1==this.hiddenNodes.indexOf(e)&&(0==this.isolatedNodes.length||-1!=this.isolatedNodes.indexOf(e))},r.prototype.isolate=function(e){var t=this.getInstanceTree(),i=t?t.getRootId():null,r="number"==typeof e&&e===i||"object"==typeof e&&e.dbId===i;e&&!r?this.isolateMultiple(Array.isArray(e)?e:[e]):this.isolateNone()},r.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0),this.setAllVisibility(!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0);var e={type:t.ISOLATE_EVENT,nodeIdArray:[],model:this.model};this.viewerImpl.api.fireEvent(e)},r.prototype.isolateMultiple=function(e){if(e&&0!=e.length){this.setAllVisibility(!1),this.model.getData().is2d||(this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0)),this.isolatedNodes=e.slice(0),this.hiddenNodes=[];for(var i=0;e.length>i;i++)this.setVisibilityOnNode(e[i],!0);var r={type:t.ISOLATE_EVENT,nodeIdArray:e,model:this.model};this.viewerImpl.api.fireEvent(r)}else this.isolateNone();this.viewerImpl.invalidate(!0)},r.prototype.hide=function(e){var i;if(Array.isArray(e)){for(var r=0;e.length>r;++r)this.setVisibilityOnNode(e[r],!1);e.length>0&&(i={type:t.HIDE_EVENT,nodeIdArray:e})}else this.setVisibilityOnNode(e,!1),i={type:t.HIDE_EVENT,nodeIdArray:[e]};i&&this.viewerImpl.api.fireEvent(i)},r.prototype.show=function(e){var i;if(Array.isArray(e)){for(var r=0;e.length>r;++r)this.setVisibilityOnNode(e[r],!0);e.length>0&&(i={type:t.SHOW_EVENT,nodeIdArray:e})}else this.setVisibilityOnNode(e,!0),i={type:t.SHOW_EVENT,nodeIdArray:[e]};i&&this.viewerImpl.api.fireEvent(i)},r.prototype.toggleVisibility=function(e){var i=this.getInstanceTree().isNodeHidden(e);this.setVisibilityOnNode(e,i);var r={type:i?t.SHOW_EVENT:t.HIDE_EVENT,nodeIdArray:[e]};this.viewerImpl.api.fireEvent(r)},r.prototype.setVisibilityOnNode=function(e,t){var i=this.viewerImpl,r=this.model,n=this.getInstanceTree(),o=!t,s=r.getData().is2d;this.viewerImpl.matman(),n?n.enumNodeChildren(e,function(e){n.setNodeHidden(e,o),s?r.getFragmentList().setObject2DGhosted(e,!t):n.enumNodeFragments(e,function(e){r.setVisibility(e,t)},!1)},!0):s?r.getFragmentList().setObject2DGhosted(e,!t):r.setVisibility(e,t),i.sceneUpdated(!0),this.updateNodeVisibilityTracking(e,t)},r.prototype.updateNodeVisibilityTracking=function(e,t){var i=t;if(this.isolatedNodes.length>0){var r=this.isolatedNodes.indexOf(e);i&&-1===r?this.isolatedNodes.push(e):i||-1===r||this.isolatedNodes.splice(r,1)}else{var n=this.hiddenNodes.indexOf(e);i||-1!==n?i&&-1!==n&&this.hiddenNodes.splice(n,1):this.hiddenNodes.push(e)}var o=this.getInstanceTree();o&&o.root&&o.root.dbId===e&&(t?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[e]))},r.prototype.setNodeOff=function(e,t){var i=this.viewerImpl,r=this.model,n=this.getInstanceTree(),o=r.getData().is2d;n?n.enumNodeChildren(e,function(e){n.setNodeOff(e,t),o?r.getFragmentList().setObject2DVisible(e,!t):n.enumNodeFragments(e,function(e){r.getFragmentList().setFragOff(e,t)},!1)},!0):o?r.getFragmentList().setObject2DVisible(e,!t):r.getFragmentList().setFragOff(e,t),i.sceneUpdated(!0)},t.Private.VisibilityManager=r,e.prototype.addModel=function(e){-1==this.models.indexOf(e)&&(e.visibilityManager=new r(this.viewer,e),this.models.push(e))},e.prototype.removeModel=function(e){var t=this.models.indexOf(e);e.visibilityManager.isolateNone(),e.visibilityManager=null,this.models.splice(t,1)},e.prototype.warn=function(){this.models.length>1&&i.logger.warn("This selection call does not yet support multiple models.")},e.prototype.getIsolatedNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getIsolatedNodes()},e.prototype.getHiddenNodes=function(e){return e||(this.warn(),e=this.models[0]),e.visibilityManager.getHiddenNodes()},e.prototype.isNodeVisible=function(e,t){return e||(this.warn(),e=this.models[0]),e.visibilityManager.isNodeVisible(t)},e.prototype.isolate=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.isolate(e)},e.prototype.hide=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.hide(e)},e.prototype.show=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.show(e)},e.prototype.toggleVisibility=function(e,t){t||(this.warn(),t=this.models[0]),t.visibilityManager.toggleVisibility(e)},e.prototype.setVisibilityOnNode=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setVisibilityOnNode(e,t)},e.prototype.setNodeOff=function(e,t,i){i||(this.warn(),i=this.models[0]),i.visibilityManager.setNodeOff(e,t)},t.Private.MultiModelVisibilityManager=e}(),function(){"use strict";function e(e){function t(){var e=s.size(),t=l.aspect,i=e.x/t,r=e.y;return Math.max(i,r)}var i=6.88,r=100,n=1e-6,o=1e-5;this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__lockSettings={orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1},this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=n,this.__minDistance=o;var s=void 0,a=void 0,l=null,h={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(e){e!==l&&(l=e,e&&(e.hasOwnProperty("target")||(e.target=new THREE.Vector3(0,0,0)),e.hasOwnProperty("pivot")||(e.pivot=new THREE.Vector3(0,0,0)),e.worldup=e.up.clone(),e.dirty=!0))},this.getCamera=function(){return l},this.setScreenViewport=function(e){h=e},this.getScreenViewport=function(){return h},this.__setUp=function(e){if(e&&l){var t=e.clone().normalize(),i=t.sub(l.worldup);if(0!==i.lengthSq())return l.worldup.copy(e).normalize(),l.dirty=!0,!0}return!1},this.__getUp=function(){return l?l.worldup:new THREE.Vector3(0,1,0)},this.setView=function(e,t){l&&e&&t&&(l.position.copy(e),l.target.copy(t),l.dirty=!0)},this.orientCameraUp=function(){l&&this.isActionEnabled("roll")&&(l.up.copy(this.getAlignedUpVector()),l.dirty=!0)},this.getPivotPoint=function(){return l?l.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(e){l&&e&&(l.pivot.copy(e),l.dirty=!0)},this.getPosition=function(){return l?l.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(e){l&&e&&(l.position.copy(e),l.dirty=!0)},this.setTarget=function(e){l&&e&&(l.target.copy(e),l.dirty=!0)},this.getTarget=function(){return l?l.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return l?l.target.clone().sub(l.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return i},this.getFovMax=function(){return r},this.isPointVisible=function(e){var t=(new THREE.Frustum).setFromMatrix(l.projectionMatrix.clone().multiply(l.matrixWorldInverse));return t.containsPoint(e)},this.setVerticalFov=function(e,t){if((!l||l.isPerspective)&&(i>e?e=i:e>r&&(e=r),l&&this.isActionEnabled("fov"))){if(n>=Math.abs(l.fov-e))return;if(t){var o=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),s=this.getPosition(),a=this.getEyeVector(),h=THREE.Math.degToRad(l.fov),u=THREE.Math.degToRad(e),d=o?this.getPivotPlaneDistance():a.length(),c=d*Math.tan(.5*h)/Math.tan(.5*u),p=a.normalize().multiplyScalar(d-c);this.setPosition(s.add(p)),o&&this.setTarget(this.getTarget().add(p))}l.setFov(e),l.dirty=!0}},this.computeFit=function(e,t,i,n){if(!n||n.empty())return{position:e,target:t};var o=n.center(),s=n.size(),a=.5*Math.sqrt(s.x*s.x+s.y*s.y+s.z*s.z);if(0===a&&(a=1),!this.getIs2D()){var l=Math.max(1,.9+.5*(i/r));a*=l}var h=e.clone().sub(t).normalize(),u=a/Math.tan(THREE.Math.degToRad(.5*i));h.multiplyScalar(u);var d=o.clone().add(h);return{position:d,target:o}},this.computeOrthogonalUp=function(e,t){var i=this.__getUp(),r=t.clone().sub(e);if(0===r.lengthSq())return r.copy(i);var n=r.clone().cross(i);return 0===n.lengthSq()&&(i.z>i.y?r.y-=1e-4:r.z-=1e-4,n.crossVectors(r,i)),n.cross(r).normalize()},this.fitBounds=function(e,t,i){var r=this.getTarget(),n=this.getPosition();if(!this.isActionEnabled("gotoview")||!t||t.empty())return{position:n,target:r};var o=this.getVerticalFov(),s=this.computeFit(n,r,o,t),a=i?this.computeOrthogonalUp(n,r):l.up;return e?(l.up.copy(a),this.setView(s.position,s.target)):this.setRequestTransitionWithUp(!0,s.position,s.target,o,a),this.setPivotPoint(s.target),this.setPivotSetFlag(!0),s},this.applyDollyConstraint2D=function(e){if(!this.__is2D||!s&&!a)return e;var i=e;if(s){var r=this.getEyeVector(),n=2*t(),o=n/-r.z;o=Math.max(o,1),i=Math.min(i,o)}if(a){var h=l.clientHeight/a,u=h/-r.z;u=Math.min(u,1),i=Math.max(i,u)}return i},this.applyPanningConstraint2D=function(e){if(this.__is2D&&s){var t=l.position.x+e.x,i=l.position.y+e.y;
t=THREE.Math.clamp(t,s.min.x,s.max.x),i=THREE.Math.clamp(i,s.min.y,s.max.y);var r=t-l.position.x,n=i-l.position.y,o=Math.min(e.x,0),a=Math.min(e.y,0),h=Math.max(e.x,0),u=Math.max(e.y,0);r=THREE.Math.clamp(r,o,h),n=THREE.Math.clamp(n,a,u),e.x=r,e.y=n}},this.updateCamera=function(){l&&(l.updateProjectionMatrix(),this.orient(l,l.target,l.position,l.up),l.dirty=!1)},this.setCamera(e),this.setConstraints2D=function(e,t){s=e,a=t}}var t=Autodesk.Viewing,i=t.Private;e.prototype.constructor=e,e.prototype.setIs2D=function(e){this.__is2D=!!e},e.prototype.getIs2D=function(){return this.__is2D},e.prototype.setIsTouchDevice=function(e){this.__isTouchDevice=!!e},e.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},e.prototype.orient=function(){function e(){t||(t=new THREE.Matrix4,i=new THREE.Vector3,r=new THREE.Vector3,n=new THREE.Vector3)}var t,i,r,n;return function(o,s,a,l){e();var h=t.elements;n.subVectors(a,s).normalize(),0===n.lengthSq()&&(n.z=1),i.crossVectors(l,n).normalize(),0===i.lengthSq()&&(l.z>l.y?n.y-=1e-4:n.z+=1e-4,i.crossVectors(l,n).normalize()),r.crossVectors(n,i),h[0]=i.x,h[4]=r.x,h[8]=n.x,h[1]=i.y,h[5]=r.y,h[9]=n.y,h[2]=i.z,h[6]=r.z,h[10]=n.z,o.setRotationFromMatrix(t)}}(),e.prototype.fov2fl=function(e){var t=12,i=THREE.Math.degToRad(e);return 0>=i&&(i=1e-4),Math.round(t/Math.tan(.5*i))},e.prototype.fl2fov=function(e){var t=12;0>=e&&(e=1e-4);var i=2*Math.atan(t/e);return THREE.Math.radToDeg(i)},e.prototype.setCameraUpVector=function(e){if(this.isActionEnabled("roll")){var t=this.getCamera();t.up.copy(e),t.dirty=!0}},e.prototype.getCameraUpVector=function(){var e=this.getCameraRightVector(!1),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getAlignedUpVector=function(){var e=this.getCameraRightVector(!0),t=this.getEyeVector();return e.cross(t).normalize()},e.prototype.getCameraRightVector=function(e){var t=new THREE.Vector3,i=e?this.getWorldUpVector():this.getCamera().up,r=this.getEyeVector();return t.crossVectors(r,i),0===t.lengthSq()&&(i.z>i.y?r.y-=1e-4:r.z+=1e-4,t.crossVectors(r,i)),t.normalize()},e.prototype.setWorldUpVector=function(e,t){this.isActionEnabled("roll")&&(this.__setUp(e),t&&this.orientCameraUp())},e.prototype.getWorldUpVector=function(){return this.__getUp().clone()},e.prototype.getWorldRightVector=function(){var e=new THREE.Vector3;return e.copy(this.__getUp()),Math.abs(e.y)>=Math.abs(e.z)?e.set(e.y,-e.x,0):e.z>=0?e.set(e.z,0,-e.x):e.set(-e.z,0,e.x),e.normalize()},e.prototype.getVerticalFov=function(){return this.getCamera().fov},e.prototype.getHorizontalFov=function(){var e=this.getScreenViewport();return this.getCamera().fov*(e.width/e.height)},e.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},e.prototype.setFocalLength=function(e,t){this.setVerticalFov(this.fl2fov(e),t)},e.prototype.setReverseZoomDirection=function(e){this.__options.reverseDolly=!!e},e.prototype.setReverseHorizontalLookDirection=function(e){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"),void 0):(this.__options.reverseHorizontalLookDirection=!!e,void 0)},e.prototype.setReverseVerticalLookDirection=function(e){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"),void 0):(this.__options.reverseVerticalLookDirection=!!e,void 0)},e.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},e.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},e.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},e.prototype.setZoomTowardsPivot=function(e){this.__options.dollyToPivot=!!e},e.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},e.prototype.setOrbitPastWorldPoles=function(e){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"),void 0):(this.__options.orbitPastPoles=!!e,void 0)},e.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(i.logger.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},e.prototype.setUsePivotAlways=function(e){this.__options.usePivotAlways=!!e},e.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},e.prototype.setUseLeftHandedInput=function(e){this.__options.useLeftHandedInput=!!e},e.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},e.prototype.setIsLocked=function(e){this.__options.lockNavigation=!!e},e.prototype.getIsLocked=function(){return this.__options.lockNavigation},e.prototype.setLockSettings=function(e){for(var t in this.__lockSettings)e.hasOwnProperty(t)&&(this.__lockSettings[t]=e[t])},e.prototype.getLockSettings=function(){var e={};for(var t in this.__lockSettings)e[t]=this.__lockSettings[t];return e},e.prototype.isActionEnabled=function(e){return!this.__options.lockNavigation||this.__lockSettings[e]===!0},e.prototype.setPivotSetFlag=function(e){this.__pivotIsSetFlag=!!e},e.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},e.prototype.setRequestFitToView=function(e){this.isActionEnabled("gotoview")&&(this.__fitToViewRequested=!!e)},e.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},e.prototype.setRequestHomeView=function(e){this.isActionEnabled("gotoview")&&(this.__homeViewRequested=!!e)},e.prototype.getRequestHomeView=function(){return this.__homeViewRequested},e.prototype.setRequestTransition=function(e,t,i,r,n,o){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:r,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:n,pivot:o?o.clone():i.clone()}:null},e.prototype.setRequestTransitionWithUp=function(e,t,i,r,n,o,s){this.__destinationView=e?{position:t.clone(),coi:i.clone(),fov:r,up:n.clone(),worldUp:o?o:this.getWorldUpVector(),reorient:!1,pivot:s?s.clone():i.clone()}:null},e.prototype.getRequestTransition=function(){return this.__destinationView},e.prototype.setTransitionActive=function(e){this.__transitionActive=!!e},e.prototype.getTransitionActive=function(){return this.__transitionActive},e.prototype.getWorldSize=function(e){var t=this.getScreenViewport(),i=t.width/t.height,r=2*e*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),n=r*i;return new THREE.Vector2(n,r)},e.prototype.getWorldPoint=function(e,t){t=1-t,e=2*e-1,t=2*t-1;var i,r=this.getCamera();r.isPerspective&&(i=new THREE.Vector3(e,t,1),i=i.unproject(r));var n,o,s=this.getEyeVector(),a=this.getPosition();if(!r.isPerspective||isNaN(i.x)){var l=this.getWorldSize(s.length()),h=this.getCameraRightVector(!1).multiplyScalar(.5*e*l.x),u=this.getCameraUpVector().multiplyScalar(.5*t*l.y);n=s.clone().add(h).add(u).normalize()}else n=i.sub(a).normalize();var d=this.getPivotPoint(),c=this.__pivotIsSetFlag&&(this.getIs2D()||r.isPerspective&&this.isPointVisible(d));if(c){var p=n.dot(s);o=0!==p?Math.abs(d.sub(a).dot(s))/p:d.sub(a).length()}else o=r.isPerspective?.5*(r.near+r.far):r.orthoScale;return n.multiplyScalar(o).add(a)},e.prototype.getPivotPlaneDistance=function(){var e=this.getPivotPoint(),t=this.getEyeVector(),i=this.getPosition();return e.sub(i).dot(t.normalize())},e.prototype.panRelative=function(e,t,i){if(this.isActionEnabled("pan")){var r=this.getWorldSize(i),n=e*r.x,o=t*r.y,s=this.getCameraRightVector(!1).multiplyScalar(n),a=this.getCameraUpVector().multiplyScalar(o),l=s.add(a);this.applyPanningConstraint2D(l),this.setView(this.getPosition().add(l),this.getTarget().add(l))}},e.prototype.dollyFromPoint=function(e,t){if(this.isActionEnabled("zoom")&&!(this.__kEpsilon>=Math.abs(e))){var i=this.getPosition(),r=t.clone().sub(i),n=r.length(),o=n+e;this.__minDistance>o&&(o=this.__minDistance);var s=o/n;if(s=this.applyDollyConstraint2D(s),Math.abs(s-1)>this.__kEpsilon){r.multiplyScalar(s),r.set(-r.x,-r.y,-r.z);var a=r.add(t),l=this.getEyeVector();this.getCamera().isPerspective||l.multiplyScalar(s),this.setView(a,l.add(a))}}},e.prototype.toPerspective=function(){if(this.getIs2D())return i.logger.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D"),void 0;var e=this.getCamera();e.isPerspective||(e.toPerspective(),e.dirty=!0)},e.prototype.toOrthographic=function(){var e=this.getCamera();e.isPerspective&&(e.toOrthographic(),e.dirty=!0)},e.snapToAxis=function(e){var t=new THREE.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z));return t.x>t.y&&t.x>t.z?e.set(e.x>0?1:-1,0,0):t.y>t.x&&t.y>t.z?e.set(0,e.y>0?1:-1,0):e.set(0,0,e.z>0?1:-1),e},Autodesk.Viewing.Navigation=e}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=function(){function e(e,t){return r.hasOwnProperty(e)?!1:(r[e]=t,!0)}function t(e){return r.hasOwnProperty(e)?r[e]:null}function i(e){return r.hasOwnProperty(e)?(delete r[e],!0):!1}var r={};return{registerExtension:e,getExtension:t,unregisterExtension:i}},r=new i,n=function(){};n.prototype={loadExtension:function(i,n){this.loadedExtensions||(this.loadedExtensions={});var o=!1;if(this.getExtension(i))t.logger.info("Extension already loaded: "+i);else{var s=r.getExtension(i);if(s){var a=new s(this,n);a.id=i,o=a.load(),o&&(this.loadedExtensions[i]=a,t.logger.info("Extension loaded: "+i),this.fireEvent({type:e.EXTENSION_LOADED_EVENT,extensionId:i}))}else t.logger.warn("Extension not found: "+i)}return o},getExtension:function(e){return this.loadedExtensions&&e in this.loadedExtensions?this.loadedExtensions[e]:null},unloadExtension:function(i){var r=!1,n=this.getExtension(i);return n?(r=n.unload(),t.logger.info("Extension unloaded: "+i),delete this.loadedExtensions[i],this.fireEvent({type:e.EXTENSION_UNLOADED_EVENT,extensionId:i})):t.logger.warn("Extension not found: "+i),r},apply:function(e){var t=n.prototype;e.loadExtension=t.loadExtension,e.getExtension=t.getExtension,e.unloadExtension=t.unloadExtension}},Autodesk.Viewing.theExtensionManager=r,Autodesk.Viewing.ExtensionMixin=n}(),function(){"use strict";function e(e){for(var t=0;o.length>t;++t)document.addEventListener(o[t],e,!1)}function t(e){for(var t=0;o.length>t;++t)document.removeEventListener(o[t],e,!1)}function i(t){this.viewer=t,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===r.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener)}var r=Autodesk.Viewing,n=r.Private,o=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];r.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},r.ScreenModeDelegate=i,i.prototype.uninitialize=function(){t(this.bindFullscreenEventListener),this.viewer=null},i.prototype.isModeSupported=function(){return!0},i.prototype.setMode=function(e){var t=this.getMode();return e!==t&&this.isModeSupported(e)?(this.doScreenModeChange(t,e),this.onScreenModeChanged(t,e),!0):!1},i.prototype.getMode=function(){throw"Implement getMode() in derived class"},i.prototype.getNextMode=function(){var e,t=this.getMode(),i=r.ScreenMode;return t===i.kNormal&&this.isModeSupported(i.kFullBrowser)?e=i.kFullBrowser:t===i.kNormal&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kFullScreen)?e=i.kFullScreen:t===i.kFullBrowser&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kNormal)?e=i.kNormal:t===i.kFullScreen&&this.isModeSupported(i.kFullBrowser)&&(e=i.kFullBrowser),e},i.prototype.getEscapeMode=function(){return this.getMode()!==r.ScreenMode.kNormal?r.ScreenMode.kNormal:void 0},i.prototype.fullscreenEventListener=function(){if(r.inFullscreen())this.viewer.resize();else{var e=r.ScreenMode;this.doScreenModeChange(e.kFullScreen,e.kNormal),this.onScreenModeChanged(e.kFullScreen,e.kNormal)}},i.prototype.doScreenModeChange=function(){throw"Implement doScreenModeChange() in derived class"},i.prototype.onScreenModeChanged=function(i,n){i===r.ScreenMode.kFullScreen?t(this.bindFullscreenEventListener):n===r.ScreenMode.kFullScreen&&e(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:r.FULLSCREEN_MODE_EVENT,mode:n})},r.AppScreenModeDelegate=function(e){r.ScreenModeDelegate.call(this,e)},r.AppScreenModeDelegate.prototype=Object.create(r.ScreenModeDelegate.prototype),r.AppScreenModeDelegate.prototype.constructor=r.AppScreenModeDelegate,r.AppScreenModeDelegate.prototype.isModeSupported=function(e){return e!==r.ScreenMode.kFullBrowser},r.AppScreenModeDelegate.prototype.getMode=function(){return r.inFullscreen()?r.ScreenMode.kFullScreen:r.ScreenMode.kNormal},r.AppScreenModeDelegate.prototype.doScreenModeChange=function(e,t){var i=this.viewer.container;t===r.ScreenMode.kNormal?(i.classList.remove("viewer-fill-browser"),r.exitFullscreen()):t===r.ScreenMode.kFullScreen&&(i.classList.add("viewer-fill-browser"),r.launchFullscreen(i))},r.ApplicationScreenModeDelegate=r.AppScreenModeDelegate,r.NullScreenModeDelegate=function(e){r.ScreenModeDelegate.call(this,e)},r.NullScreenModeDelegate.prototype=Object.create(r.ScreenModeDelegate.prototype),r.NullScreenModeDelegate.prototype.constructor=r.ScreenModeDelegate,r.NullScreenModeDelegate.prototype.isModeSupported=function(){return!1},r.NullScreenModeDelegate.prototype.getMode=function(){return r.ScreenMode.kNormal},r.ScreenModeMixin=function(){},r.ScreenModeMixin.prototype={setScreenModeDelegate:function(e){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.screenModeDelegateClass=e?e:null===e?r.NullScreenModeDelegate:r.AppScreenModeDelegate},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(e){return this.getScreenModeDelegate().isModeSupported(e)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(e){var t={category:"screen_mode",value:e};return n.logger.track(t),this.getScreenModeDelegate().setMode(e)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var e=this.getScreenModeDelegate().getNextMode();return void 0!==e?this.setScreenMode(e):!1},escapeScreenMode:function(){var e=this.getScreenModeDelegate().getEscapeMode();return void 0!==e?this.setScreenMode(e):!1},apply:function(e){var t=r.ScreenModeMixin.prototype;e.setScreenModeDelegate=t.setScreenModeDelegate,e.getScreenModeDelegate=t.getScreenModeDelegate,e.isScreenModeSupported=t.isScreenModeSupported,e.canChangeScreenMode=t.canChangeScreenMode,e.setScreenMode=t.setScreenMode,e.getScreenMode=t.getScreenMode,e.nextScreenMode=t.nextScreenMode,e.escapeScreenMode=t.escapeScreenMode}}}(),function(){"use strict";var e=Autodesk.Viewing,t=e.Private;e.ESCAPE_EVENT="escape",e.PROGRESS_UPDATE_EVENT="progress",e.FULLSCREEN_MODE_EVENT="fullScreenMode",e.NAVIGATION_MODE_CHANGED_EVENT="navmode",e.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",e.VIEWER_RESIZE_EVENT="viewerResize",e.VIEWER_INITIALIZED="viewerInitialized",e.VIEWER_UNINITIALIZED="viewerUninitialized",e.MODEL_ROOT_LOADED_EVENT="svfLoaded",e.GEOMETRY_LOADED_EVENT="geometryLoaded",e.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",e.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",e.MODEL_UNLOADED_EVENT="modelUnloaded",e.EXTENSION_LOADED_EVENT="extensionLoaded",e.EXTENSION_UNLOADED_EVENT="extensionUnloaded",e.SELECTION_CHANGED_EVENT="selection",e.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",e.ISOLATE_EVENT="isolate",e.HIDE_EVENT="hide",e.SHOW_EVENT="show",e.CAMERA_CHANGE_EVENT="cameraChanged",e.EXPLODE_CHANGE_EVENT="explodeChanged",e.CUTPLANES_CHANGE_EVENT="cutplanesChanged",e.TOOL_CHANGE_EVENT="toolChanged",e.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",e.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",e.RESET_EVENT="reset",e.PREF_CHANGED_EVENT="PrefChanged",e.PREF_RESET_EVENT="PrefReset",e.ANIMATION_READY_EVENT="animationReady",e.HYPERLINK_EVENT="hyperlink",e.LOAD_GEOMETRY_EVENT="load_geometry",e.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};var i=e.isMobileDevice(),r=0;e.DefaultSettings={ambientShadows:!0,antialiasing:!i,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,swapBlackAndWhite:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!i,lineRendering:!0,lightPreset:t.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:i,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNavigation:!0,envMapBackground:!1,renderPrism:!0,firstPersonToolPopup:!0};var n=function(i,n){if(THREE===void 0&&t.logger.warn("Initializing LMV without the THREE.js dependency is not supported.","Call Autodesk.Viewing.Initializer() first or preload the dependencies manually."),i){if(this.clientContainer=i,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(e.isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=n,this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this;var o={prefix:"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.",localStorage:!0};this.prefs=new t.Preferences(this,o)}this.extensionCache=null,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.id=r++,this.impl=new t.Viewer3DImpl(this.canvas,this)};n.prototype.constructor=n,e.EventDispatcher.prototype.apply(n.prototype),e.ScreenModeMixin.prototype.apply(n.prototype),e.ExtensionMixin.prototype.apply(n.prototype),n.ScreenMode=e.ScreenMode,n.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"],offObject:["deselectAll"]},clickShift:{onObject:["selectToggle"],offObject:["deselectAll"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},n.prototype.start=function(e,t,i,r){if(this.started)return 0;this.started=!0;var n=this,o=n.initialize();return 0!==o?(r&&setTimeout(function(){r(o)},1),o):(setTimeout(function(){n.setUp(n.config)},1),e&&this.loadModel(e,t,i,r),0)},n.prototype.registerUniversalHotkeys=function(){var t,i,r,n=this,o=e.theHotkeyManager.KEYCODES;t=function(){return n.navigation.setRequestFitToView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[o.f],onPress:t}]),t=function(){return n.navigation.setRequestHomeView(!0),!0},e.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[o.h],onPress:t},{keycodes:[o.HOME],onPress:t}]),i=function(){return n.objectContextMenu&&n.objectContextMenu.hide()?!0:(n.fireEvent({type:e.ESCAPE_EVENT}),!0)},e.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[o.ESCAPE],onRelease:i}]),t=function(){return r=n.getActiveNavigationTool(),n.setActiveNavigationTool("pan")},i=function(){return n.setActiveNavigationTool(r)};var s=[{keycodes:[o.SHIFT],onPress:t,onRelease:i},{keycodes:[o.SPACE],onPress:t,onRelease:i}];e.theHotkeyManager.pushHotkeys("Autodesk.Pan",s,{tryUntilSuccess:!0})},n.prototype.createControls=function(){var t=this,i=t.impl;return t.navigation=new e.Navigation(i.camera),t.__initAutoCam(i),t.utilities=new e.ViewingUtilities(i,t.autocam,t.navigation),t.clickHandler=new e.DefaultHandler(i,t.navigation,t.utilities),t.toolController=new e.ToolController(i,t,t.autocam,t.utilities,t.clickHandler),t.toolController.registerTool(new e.GestureHandler(t)),t.toolController.registerTool(e.theHotkeyManager),t.toolController.activateTool(e.theHotkeyManager.getName()),t.registerUniversalHotkeys(),t.toolController.registerTool(new e.OrbitDollyPanTool(i,t)),t.toolController.activateTool("gestures"),t.toolController},n.prototype.initialize=function(){this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);var i=this.getDimensions();if(this.canvas.width=i.width,this.canvas.height=i.height,e.isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl.initialize(),!this.impl.glrenderer()){var r=e.detectWebGL();if(0>=r)return-1===r?e.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:e.ErrorCodes.BROWSER_WEBGL_DISABLED}var o=this;this.onResizeCallback=function(){o.resize()},window.addEventListener("resize",this.onResizeCallback,!1),this.initContextMenu(),this.localize(),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var s=this.config&&this.config.canvasConfig?this.config.canvasConfig:n.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(s),!s.disableSpinner){this.loadSpinner=document.createElement("div"),this.loadSpinner.className="spinner",this.container.appendChild(this.loadSpinner);for(var a=1;3>=a;a++){var l=document.createElement("div");l.className="bounce"+a,this.loadSpinner.appendChild(l)}}return this.initSettings(),this.viewerState=new t.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,this.fireEvent(e.VIEWER_INITIALIZED),0},n.prototype.setUp=function(e){if(this.config=e,this.config&&this.config.hasOwnProperty("extensions"))for(var t=this.config.extensions,i=0;t.length>i;++i)this.loadExtension(t[i],this.config);var r=this.config&&this.config.canvasConfig?this.config.canvasConfig:n.kDefaultCanvasConfig;this.setCanvasClickBehavior(r)},n.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var e in this.loadedExtensions)try{this.unloadExtension(e)}catch(i){t.logger.error("Failed to unload extension: "+e,i),t.logger.track({category:"error_unload_extension",extensionId:e,error_message:i.message,call_stack:i.stack})}this.loadedExtensions=null}t.logger.reportRuntimeStats(!0),this.loadSpinner&&(this.loadSpinner.style.display="block"),this.model=null,this.liveReviewClient&&(this.liveReviewClient.destroy(),this.liveReviewClient=null),this.impl.unloadCurrentModel()},n.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},n.prototype.localize=function(){e.i18n.localize()},n.prototype.__initAutoCam=function(e){function i(e){n.autocamCamera.isPerspective!==o.isPerspective&&(n.autocamCamera.isPerspective?n.navigation.toPerspective():n.navigation.toOrthographic()),n.navigation.setVerticalFov(n.autocamCamera.fov,!1),n.navigation.setView(n.autocamCamera.position,n.autocamCamera.target),n.navigation.setPivotPoint(n.autocamCamera.pivot),n.navigation.setCameraUpVector(n.autocamCamera.up),e&&n.navigation.setWorldUpVector(n.autocamCamera.worldup),n.impl.syncCamera(e)}function r(e){n.utilities?n.utilities.pivotActive(e,!1):n.impl.controls.pivotActive(e,!1)}var n=this,o=e.camera;o.pivot||(o.pivot=new THREE.Vector3(0,0,0)),o.target||(o.target=new THREE.Vector3(0,0,0)),o.worldup||(o.worldup=o.up.clone()),n.autocamCamera=o.clone(),n.autocamCamera.target=o.target.clone(),n.autocamCamera.pivot=o.pivot.clone(),n.autocamCamera.worldup=o.worldup.clone(),n.autocam=new t.Autocam(n.autocamCamera,n.navigation),n.autocam.cameraChangedCallback=i,n.autocam.pivotDisplayCallback=r,n.autocam.canvas=n.canvas,n.addEventListener("cameraChanged",function(e){var t=e.camera;n.autocam.sync(t)}),n.autocam.sync(o)},n.prototype.uninitialize=function(){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,t.logger.reportRuntimeStats(),t.logger.track({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loadSpinner=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,e.theHotkeyManager.popHotkeys("Autodesk.FitToView"),e.theHotkeyManager.popHotkeys("Autodesk.Home"),e.theHotkeyManager.popHotkeys("Autodesk.Escape"),e.theHotkeyManager.popHotkeys("Autodesk.Pan"),e.theHotkeyManager.popHotkeys("Autodesk.Orbit"),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.extensionCache=null,this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,this.viewCubeUi&&(this.viewCubeUi.uninitialize(),this.viewCubeUi=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.fireEvent(e.VIEWER_UNINITIALIZED),this.listeners={},t.logger.log("viewer destroy")},n.prototype.finish=function(){this.tearDown(),this.uninitialize()},n.prototype.load=function(e,t,i,r,n,o){var s={ids:null,sharedPropertyDbPath:t,acmSessionId:n,loadOptions:o};return this.loadModel(e,s,i,r)},n.prototype.loadModel=function(t,i,r,n,o){function s(){if(e.theHotkeyManager)if(u.model.is2d())e.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var t,i=function(){return t=u.getActiveNavigationTool(),u.setActiveNavigationTool("orbit")},r=function(){return u.setActiveNavigationTool(t)},n=[{keycodes:[e.theHotkeyManager.KEYCODES.ALT],onPress:i,onRelease:r}];e.theHotkeyManager.pushHotkeys("Autodesk.Orbit",n,{tryUntilSuccess:!0})}}function a(e){u.model=e,u.impl.addModel(u.model),u.loadSpinner&&(u.loadSpinner.style.display="None"),u.model.is2d()&&u.activateLayerState("Initial"),s(),r&&r(u.model)}function l(e,t,i,r){u.loadSpinner&&(u.loadSpinner.style.display="None"),n&&n(e,t,i,r)}function h(){u.impl.needsRender=!0,u.removeEventListener(e.GEOMETRY_LOADED_EVENT,h)}var u=this;i=i||{},this.addEventListener(e.GEOMETRY_LOADED_EVENT,h);var d,c=t.toLowerCase().match(/\.([a-z0-9]+)(\?|$)/),p=c?c[1]:null;return d=i&&i.fileLoader?i.fileLoader:e.FileLoaderManager.getFileLoaderForExtension(p),new d(this.impl).loadFile(t,i,a,l,o)},n.prototype.getDimensions=function(){if(this.container){var t={};return this.getScreenMode()===e.ScreenMode.kFullScreen?(t.width=screen.width,t.height=screen.height):t=this.container.getBoundingClientRect(),{width:t.width,height:t.height}}return null},n.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},n.prototype.getCamera=function(){return this.impl.camera},n.prototype.getState=function(e){return this.viewerState.getState(e)},n.prototype.restoreState=function(t,i,r){var n=this.viewerState.restoreState(t,i,r);return n&&this.fireEvent({type:e.VIEWER_STATE_RESTORED_EVENT,value:n}),n},n.prototype.setViewFromArray=function(e){this.setActiveNavigationTool("orbit");var t=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},i={position:new THREE.Vector3(e[0]-t.x,e[1]-t.y,e[2]-t.z),target:new THREE.Vector3(e[3]-t.x,e[4]-t.y,e[5]-t.z),up:new THREE.Vector3(e[6],e[7],e[8]),aspect:e[9],fov:THREE.Math.radToDeg(e[10]),orthoScale:e[11],isPerspective:!e[12]};this.impl.setViewFromCamera(i)},n.prototype.setViewFromViewBox=function(e,i){var r=this.model;if(r&&!r.is2d())return t.logger.warn("Viewer3D.setViewFromViewBox is not applicable to 3D"),void 0;if(i&&i.length){var n,o=r.getData().metadata,s=o.views;for(n=0;s.length>n&&s[n].name!=i;n++);if(s.length>n){var a=s[n].layer_state;a&&this.activateLayerState(a)}}this.impl.setViewFromViewBox(this.model,e,i,!1)},n.prototype.activateLayerState=function(t){if(t&&t.length){var i=this.model.getData().metadata,r=i?i.layer_states:null;if(!r)return;var n;for(n=0;r.length>n&&r[n].name!=t;n++);if(r.length>n){var o=r[n],s=o.visible_layers,a={};if(s&&s.length>0)for(var l=0;s.length>l;l++)a[s[l]]=1;var h=[],u=[];for(var d in i.layers){var c=i.layers[d].name;1===a[c]?h.push(d):u.push(d)}this.impl.setLayerVisible(h,!0),this.impl.setLayerVisible(u,!1),this.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}}},n.prototype.getLayerStates=function(){function e(e,t){var i=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(i.length!==r.length)return!1;for(var n=0;i.length>n;++n){var o=i[n];if(e[o]!==t[o])return!1}return!0}var t=this.model,i=t?t.getData().metadata:null,r=i?i.layers:null,n=i?i.layer_states:null;if(!r||!n)return null;var o,s={},a={};for(var l in r)if(r.hasOwnProperty(l)){var h=parseInt(l),u=r[l];o="string"==typeof u?u:u.name,s[o]=!0,this.impl.isLayerVisible(h)&&(a[o]=!0)}var d,c,p=[];for(d=0;n.length>d;++d){var f=n[d],g=f.visible_layers,m={};if(!f.hidden){if(g&&g.length>0)for(c=0;g.length>c;++c)o=g[c],s.hasOwnProperty(o)&&(m[o]=!0);p.push({name:f.name,description:f.description,active:e(a,m)})}}return p.length>0?p:null},n.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},n.prototype.getProperties=function(i,r,n){t.logger.track({name:"get_props_count",aggregate:"count"}),this.model?this.model.getProperties(i,r,n):n&&n(e.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},n.prototype.getObjectTree=function(t,i){this.model?this.model.getObjectTree(t,i):i&&i(e.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},n.prototype.setCanvasClickBehavior=function(e){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(e),this.clickHandler&&this.clickHandler.setClickBehavior(e),e&&e.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),e&&e.disableTwoFingerSwipe){var t=this.toolController.getTool("gestures");t&&t.disableTwoFingerSwipe()}},n.prototype.search=function(t,i,r,n,o){this.searchText=t,this.model?this.model.search(t,i,r,n,o):r&&r(e.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},n.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},n.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},n.prototype.isolate=function(e){if(this.model){var i=this.model.getData();if(i&&i.is2d&&i.loadDone&&"hasObjectProperties"in i)this.impl.visibilityManager.isolate(e);else{var r=this;this.model.getObjectTree(function(){t.logger.track({name:"isolate_count",aggregate:"count"}),r.impl.visibilityManager.isolate(e)})}}},n.prototype.isolateById=function(e){return t.logger.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(e)},n.prototype.setBackgroundColor=function(e,t,i,r,n,o){this.impl.setClearColors(e,t,i,r,n,o)},n.prototype.toggleSelect=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.toggleSelect is not yet implemented for 2D"),void 0):(this.impl.selector.toggleSelection(e),void 0)},n.prototype.select=function(e){"number"==typeof e&&(e=[e]),this.impl.selector.setSelection(e)},n.prototype.clearSelection=function(){this.impl.selector.clearSelection(),t.logger.track({name:"clearselection",aggregate:"count"})},n.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()
},n.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},n.prototype.setSelectionMode=function(e){this.impl.selector.setSelectionMode(e)},n.prototype.getSelection=function(){return this.impl.selector.getSelection()},n.prototype.getAggregateSelection=function(e){var t=this.impl.selector.getAggregateSelection();if(e)for(var i=0;t.length>i;i++)for(var r=0;t[i].selection.length>r;r++)e(t[i].model,t[i].selection[r]);return t},n.prototype.hide=function(e){t.logger.track({name:"hide",aggregate:"count"}),this.impl.visibilityManager.hide(e)},n.prototype.hideById=function(e){this.hide(e)},n.prototype.show=function(e){this.impl.visibilityManager.show(e)},n.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0),t.logger.track({name:"showall",aggregate:"count"})},n.prototype.toggleVisibility=function(e){this.impl.visibilityManager.toggleVisibility(e)},n.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},n.prototype.explode=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.explode is not applicable to 2D"),void 0):(t.logger.track({name:"explode_count",aggregate:"count"}),this.impl.explode(e),void 0)},n.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},n.prototype.setQualityLevel=function(e,i){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setQualityLevel is not applicable to 2D"),void 0):(this.prefs.set("ambientShadows",e),this.prefs.set("antialiasing",i),this.impl.togglePostProcess(e,i),void 0)},n.prototype.setGhosting=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGhosting is not applicable to 2D"),void 0):(this.prefs.set("ghosting",e),this.impl.toggleGhosting(e),void 0)},n.prototype.setGroundShadow=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundShadow is not applicable to 2D"),void 0):(this.prefs.set("groundShadow",e),this.impl.toggleGroundShadow(e),void 0)},n.prototype.setGroundReflection=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundReflection is not applicable to 2D"),void 0):(this.prefs.set("groundReflection",e),this.impl.toggleGroundReflection(e),void 0)},n.prototype.setEnvMapBackground=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"),void 0):(this.prefs.set("envMapBackground",e),this.impl.toggleEnvMapBackground(e),void 0)},n.prototype.setRenderPrism=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setRenderPrism is not applicable to 2D"),void 0):(this.prefs.set("renderPrism",e),this.impl.toggleRenderPrism(e),void 0)},n.prototype.setFirstPersonToolPopup=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setFirstPersonToolPopup is not applicable to 2D"),void 0):(this.prefs.set("firstPersonToolPopup",e),void 0)},n.prototype.getFirstPersonToolPopup=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getFirstPersonToolPopup is not applicable to 2D"),void 0):this.prefs.firstPersonToolPopup},n.prototype.setProgressiveRendering=function(e){this.prefs.set("progressiveRendering",e),this.impl.toggleProgressive(e)},n.prototype.setSwapBlackAndWhite=function(e){this.prefs.set("swapBlackAndWhite",e),this.impl.toggleSwapBlackAndWhite(e)},n.prototype.setOptimizeNavigation=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"),void 0):(this.prefs.set("optimizeNavigation",e),this.impl.setOptimizeNavigation(e),void 0)},n.prototype.setNavigationLock=function(t){this.navigation.getIsLocked()!==t&&(this.navigation.setIsLocked(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()}))},n.prototype.getNavigationLock=function(){return this.navigation.getIsLocked()},n.prototype.setNavigationLockSettings=function(t){this.navigation.setLockSettings(t),this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getActiveNavigationTool()})},n.prototype.getNavigationLockSettings=function(){return this.navigation.getLockSettings()},n.prototype.setActiveNavigationTool=function(t){if(t===this._pushedTool||!t&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this.impl.controls.setToolActiveName(this.getDefaultNavigationToolName()),this._pushedTool=null}var i=!t||t===this.getDefaultNavigationToolName();return i&&null===this._pushedTool?(this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):this.impl.controls.activateTool(t)?(this._pushedTool=t,this.fireEvent({type:e.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):!1},n.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},n.prototype.setDefaultNavigationTool=function(e){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(e),this._defaultNavigationTool=e,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},n.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},n.prototype.getFOV=function(){return this.navigation.getVerticalFov()},n.prototype.setFOV=function(e){this.navigation.setVerticalFov(e,!0)},n.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},n.prototype.setFocalLength=function(e){this.navigation.setFocalLength(e,!0)},n.prototype.hideLines=function(t){function i(){r.impl.hideLines(t),r.removeEventListener(e.GEOMETRY_LOADED_EVENT,i)}this.prefs.set("lineRendering",!t);var r=this;this.impl.hideLines(t)||this.addEventListener(e.GEOMETRY_LOADED_EVENT,i)},n.prototype.applyCamera=function(e,t){this.impl.setViewFromCamera(e,!0),t&&this.fitToView()},n.prototype.fitToView=function(i){var r=this,n=!0,o=r.model,s=function(){var t=null;if(Array.isArray(i)&&i.length>0){for(var l=new THREE.Box3,h=new THREE.Box3,u=o.getData().instanceTree,d=o.getFragmentList(),c=0;i.length>c;c++)u.enumNodeFragments(i[c],function(e){d.getWorldBounds(e,h),l.union(h)},!0);l.empty()||(t=l)}return(!t||t.empty())&&(t=r.impl.getFitBounds()),r.navigation.fitBounds(!1,t),r.removeEventListener(e.OBJECT_TREE_CREATED_EVENT,a),r.removeEventListener(e.GEOMETRY_LOADED_EVENT,s),n},a=function(){o&&o.isLoadDone()?s():(n=!1,r.addEventListener(e.GEOMETRY_LOADED_EVENT,s))},l=o.getData().propertydb,h=l&&l.attrs.length>0;t.logger.track({name:"fittoview",aggregate:"count"}),!o.is2d()&&h&&null!==i&&void 0!==i?o&&o.isObjectTreeCreated()?a():(n=!1,this.addEventListener(e.OBJECT_TREE_CREATED_EVENT,a)):this.navigation.fitBounds(!1,this.impl.getFitBounds(!0))},n.prototype.setClickConfig=function(e,t,i){var r=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in r){var n=r[e];if(t in n)return n[t]=i,!0}return!1},n.prototype.getClickConfig=function(e,t){var i=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(e in i){var r=i[e];if(t in r)return r[t]}return null},n.prototype.setClickToSetCOI=function(e,t){t!==!1&&this.prefs.set("clickToSetCOI",e);var i=this.getClickConfig("click","onObject");e?-1===i.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):i.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},n.prototype.initSettings=function(){this.prefs.load(e.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","lightPreset","envMapBackground","renderPrism","firstPersonToolPopup"]),this.prefs.untag("3d",["swapBlackAndWhite"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setSwapBlackAndWhite(this.prefs.swapBlackAndWhite),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setRenderPrism(this.prefs.renderPrism),this.setFirstPersonToolPopup(this.prefs.firstPersonToolPopup),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);var t=this.prefs.backgroundColorPreset;if(t)try{var i=JSON.parse(t);this.impl.setClearColors(i[0],i[1],i[2],i[3],i[4],i[5])}catch(r){this.prefs.set("backgroundColorPreset",null)}var n=this.prefs.lightPreset;this.impl.setLightPreset(n)},n.prototype.setLightPreset=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setLightPreset is not applicable to 2D"),void 0):(this.prefs.set("lightPreset",e),this.impl.setLightPreset(e),void 0)},n.prototype.setUsePivotAlways=function(e){this.prefs.set("alwaysUsePivot",e),this.navigation.setUsePivotAlways(e)},n.prototype.setReverseZoomDirection=function(e){this.prefs.set("reverseMouseZoomDir",e),this.navigation.setReverseZoomDirection(e)},n.prototype.setReverseHorizontalLookDirection=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"),void 0):(this.prefs.set("reverseHorizontalLookDirection",e),this.navigation.setReverseHorizontalLookDirection(e),void 0)},n.prototype.setReverseVerticalLookDirection=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"),void 0):(this.prefs.set("reverseVerticalLookDirection",e),this.navigation.setReverseVerticalLookDirection(e),void 0)},n.prototype.setZoomTowardsPivot=function(e){this.prefs.set("zoomTowardsPivot",e),this.navigation.setZoomTowardsPivot(e)},n.prototype.setOrbitPastWorldPoles=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"),void 0):(this.prefs.set("orbitPastWorldPoles",e),this.navigation.setOrbitPastWorldPoles(e),void 0)},n.prototype.setUseLeftHandedInput=function(e){this.prefs.set("leftHandedMouseSetup",e),this.navigation.setUseLeftHandedInput(e)},n.prototype.setLayerVisible=function(i,r,n){function o(e){var t=[];if(e.isLayer)t.push(e.index);else if(e.children)for(var i=e.children,r=0;i.length>r;++r)t=t.concat(o(i[r]));return t}if(this.model&&!this.model.is2d())return t.logger.warn("Viewer3D.setLayerVisible is not yet implemented for 3D"),void 0;var s=this,a=s.model.getLayersRoot();if(a&&0!==a.childCount){null===i&&(i=[a]),Array.isArray(i)||(i=[i]),n&&(s.impl.setLayerVisible(o(a),!1),r=!0);for(var l=[],h=0;i.length>h;++h)l=l.concat(o(i[h]));s.impl.setLayerVisible(l,r),s.fireEvent({type:e.LAYER_VISIBILITY_CHANGED_EVENT})}},n.prototype.isLayerVisible=function(e){return this.model&&!this.model.is2d()?(t.logger.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(e&&e.isLayer&&this.impl.isLayerVisible(e.index))},n.prototype.anyLayerHidden=function(){function e(t){if(t.isLayer)return!i.impl.isLayerVisible(t.index);for(var r=t.children,n=0;r.length>n;++n)if(e(r[n]))return!0;return!1}if(this.model&&!this.model.is2d())return t.logger.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1;var i=this,r=i.model.getLayersRoot();return!(!r||!e(r))},n.prototype.setGroundShadowColor=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"),void 0):(this.impl.setGroundShadowColor(e),void 0)},n.prototype.setGroundShadowAlpha=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"),void 0):(this.impl.setGroundShadowAlpha(e),void 0)},n.prototype.setGroundReflectionColor=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"),void 0):(this.impl.setGroundReflectionColor(e),void 0)},n.prototype.setGroundReflectionAlpha=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"),void 0):(this.impl.setGroundReflectionAlpha(e),void 0)},n.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},n.prototype.setCutPlanes=function(e){return this.model&&this.model.is2d()?(t.logger.warn("Viewer3D.getCutPlanes is not applicable to 2D"),void 0):(this.impl.setCutPlanes(e),void 0)},n.prototype.getScreenShot=function(e,t,i){return this.impl.getScreenShot(e,t,i)},n.prototype.getScreenShotBuffer=function(e,t,i){return this.impl.getScreenShotBuffer(e,t,i)},n.prototype.setContextMenu=function(e){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=e||null},n.prototype.setDefaultContextMenu=function(){var e=Autodesk.Viewing.Extensions;return e&&e.ViewerObjectContextMenu?(this.setContextMenu(new e.ViewerObjectContextMenu(this)),!0):!1},n.prototype.triggerContextMenu=function(e){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(e),this.contextMenu?(this.contextMenu.show(e),!0):!1},n.prototype.triggerSelectionChanged=function(e){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(e)},n.prototype.triggerDoubleTapCallback=function(e){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(e)},n.prototype.triggerSingleTapCallback=function(e){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(e)},n.prototype.initContextMenu=function(){function e(e){var t=e.button;"buttons"in e&&(!i.__firefoxLMBfix||1&e.buttons?2===t&&1&e.buttons&&(t=0,i.__firefoxLMBfix=!0):(i.__firefoxLMBfix=!1,t=0));var r=i.navigation?i.navigation.getUseLeftHandedInput():!1,n=r?0:2;return t===n?!0:!1}var t=!this.config||(this.config.hasOwnProperty("disableBrowserContextMenu")?this.config.disableBrowserContextMenu:!0);t&&(this.onDefaultContextMenu=function(e){e.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var i=this,r=this.canvas||this.container;r.addEventListener("mousedown",function(t){e(t)&&(i.startX=t.clientX,i.startY=t.clientY)}),r.addEventListener("mouseup",function(t){return e(t)&&t.clientX===i.startX&&t.clientY===i.startY&&i.triggerContextMenu(t),!0},!1)},n.prototype.registerContextMenuCallback=function(e,t){this.contextMenuCallbacks[e]=t},n.prototype.unregisterContextMenuCallback=function(e){return e in this.contextMenuCallbacks?(delete this.contextMenuCallbacks[e],!0):!1},n.prototype.runContextMenuCallbacks=function(e,t){for(var i in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(i)&&this.contextMenuCallbacks[i](e,t)},n.prototype.playAnimation=function(e){var t=this.impl.keyFrameAnimator;t&&t.play(0,e)},n.prototype.joinLiveReview=function(e){this.liveReviewClient||(this.liveReviewClient=new t.LiveReviewClient(this));var i=this.liveReviewClient;t.loadDependency("lmv_io","socket.io-1.3.5.js",function(){i.joinLiveReviewSession(e)})},n.prototype.leaveLiveReview=function(){this.liveReviewClient&&this.liveReviewClient.leaveLiveReviewSession()},n.prototype.setModelUnits=function(e){this.model&&(this.model.getData().overriddenUnits=e)},n.prototype.worldToClient=function(e){return this.impl.worldToClient(e)},n.prototype.clientToWorld=function(e,t,i){return this.impl.clientToWorld(e,t,i)},n.prototype.modelHasTopology=function(){return this.model&&this.model.getData().topology?!0:!1},n.prototype.setSelectionColor=function(e){this.impl.setSelectionColor(e)},n.prototype.createViewCube=function(){this.viewCubeUi||(this.viewCubeUi=new t.ViewCubeUi(this)),this.viewCubeUi.create()},n.prototype.displayViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.displayViewCube(e,!1)},n.prototype.displayViewCubeUI=function(e){this.viewCubeUi&&this.viewCubeUi.display(e)},n.prototype.setViewCube=function(e){this.viewCubeUi&&this.viewCubeUi.cube&&this.viewCubeUi.cube.cubeRotateTo(e)},n.prototype.setThemingColor=function(e,t,i){i=i||this.model,i.setThemingColor(e,t),this.impl.invalidate(!0)},n.prototype.clearThemingColors=function(e){e=e||this.model,e.clearThemingColors(),this.impl.invalidate(!0)},n.prototype.transferModel=function(e,t){var i=this.impl.findModel(e);if(i){var r=[];this.getAggregateSelection(function(t,i){t.id==e&&r.push(i)});var n=this.impl.visibilityManager.getIsolatedNodes(i),o=this.impl.visibilityManager.getHiddenNodes(i),s=this.impl.matman().exportModelMaterials(i);this.impl.removeModel(i),t.model=i,t.impl.addModel(i),t.impl.matman().importModelMaterials(s),t.loadSpinner&&(t.loadSpinner.style.display="None"),i.loader&&i.loader.viewer3DImpl===this.impl&&(i.loader.viewer3DImpl=t.impl),i.getData().loadDone&&t.impl.onLoadComplete(i),t.impl.selector.setSelection(r,i),0!=n.length?t.impl.visibilityManager.isolate(n,i):0!=o.length&&t.impl.visibilityManager.hide(o,i)}},Autodesk.Viewing.Viewer3D=n}();var av=Autodesk.Viewing,avp=Autodesk.Viewing.Private,ENABLE_DEBUG=avp.ENABLE_DEBUG||!0,ENABLE_TRACE=avp.ENABLE_TRACE||!0;(function(){"use strict";function e(e,t){function i(e){if(!e)return null;var t=window.devicePixelRatio;t||(t=1);var i=av.InitParametersSetting;i.canvas=e,i.devicePixelRatio=t;var r=new avp.FireflyWebGLRenderer(i);return r.context?(r.autoClear=!1,r.sortObjects=!1,r):null}function r(e){var t=D,i=!0,r=t==avp.RENDER_NORMAL,n=T.settings.idbuffer&&t!=avp.RENDER_HIDDEN;t==avp.RENDER_HIDDEN?e.overrideMaterial=C.fadeMaterial:t==avp.RENDER_HIGHLIGHTED&&(e.overrideMaterial=C.highlightMaterial),T.renderScenePart(e,i,r,n),e.overrideMaterial=null}function n(e){Z++,J>0&&(K=.8*K+.2*(e-J)),C.fpsCallback&&C.fpsCallback(C.fps())}function o(e){if(C.keyFrameAnimator){var t=J>0?(e-J)/1e3:0,i=C.keyFrameAnimator.update(t);if(i&&(C.sceneUpdated(!0),i&C.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function s(){y&&(C.camera.aspect=b/E,C.camera.clientWidth=b,C.camera.clientHeight=E,T.setSize(b,E),C.controls.handleResize(),k&&k.setSize(b,E),C.invalidate(!0,!0,!0),y=!1,C.api.fireEvent({type:av.VIEWER_RESIZE_EVENT,width:b,height:E}))}function a(){if((M.enabled||k)&&!C.is2d){var e;if(e=C.model&&!C.model.isLoadDone()?C.model.getData().bbox:C.getVisibleBounds(!0,!1)){M.needClear=!0;var t=C.camera,i=e.clone(),r=new THREE.Vector3(1,0,0),n=U.clone();t.worldUpTransform&&(i.applyMatrix4(t.worldUpTransform),r.applyMatrix4(t.worldUpTransform),n.applyMatrix4(t.worldUpTransform)),i.min.y-=.005*(i.max.y-i.min.y),S&&S.expandByGroundShadow(i,n);var o=i.size(),s=i.center();if(S||(o.x*=1.25,o.z*=1.25,o.x=o.z=Math.max(o.x,o.z)),t.worldUpTransform){var a=(new THREE.Matrix4).getInverse(t.worldUpTransform);s.applyMatrix4(a)}if(M.setTransform(s,o,t.worldup,r),k){var l=(new THREE.Vector3).subVectors(s,t.worldup.clone().multiplyScalar(o.y/2));k.setTransform(l,t.worldup,o)}S&&S.setGroundShadowTransform(s,o,t.worldup,r)}}}function l(){W&&(a(),W=!1)}function h(){for(var e in C.selectionMeshes){var t=C.selectionMeshes[e];t.model.getFragmentList().getWorldMatrix(t.fragId,t.matrix)}}function u(){S&&(S.state=avp.SHADOWMAP_NEEDS_UPDATE)}function d(e){if(!S||!C)return e;var t=B||H;if(D==avp.RENDER_SHADOWMAP){if(t)return D=avp.RENDER_FINISHED,e;e=S.continueUpdate(R,e,w),S.state==avp.SHADOWMAP_VALID&&(D=avp.RENDER_FINISHED,H=!0,B=!0)}return S.state==avp.SHADOWMAP_NEEDS_UPDATE?e=S.startUpdate(R,e,C.camera,U,w):t||D==avp.RENDER_FINISHED&&S.state==avp.SHADOWMAP_INCOMPLETE&&(e=S.startUpdate(R,e,C.camera,U,w),D=avp.RENDER_SHADOWMAP),e}function c(e){w.updateMaterials();var t=o(e),i=C.controls.update(e),a=R&&R.update(e),u=i||t||x||a,c=y;y&&s(),H=H||u,z=z||u,z&&h(e),z=z||T.overlayUpdate(e);var p=C.model&&(C.model.isLoadDone()||C.model.myData.partPacksLoadDone===!0),f=C.progressiveRender?C.targetFrameTime:1e10,g=f,m=R;if(W&&l(e),g=d(g),!S||D!=avp.RENDER_SHADOWMAP){var v=!1;if(!M||C.is2d||X||(v=M.prepareGroundShadow(C)),H||B){if(u&&C.skipAOWhenMoving&&T.settings.sao&&!$&&(T.setAOEnabled(!1),$=!0),p&&C.signalProgress(0),q>0){var b=e-q;Y=.75*Y+.25*b}q=e,P>Y&&A>f?C.targetFrameTime+=1:Y>P&&f>I&&(C.targetFrameTime-=1),C.updateCameraMatrices(),T.beginScene(C.scene,C.camera,C.lightsOn?C.lights:C.no_lights,H),(u||c)&&C.api.fireEvent(C.cameraChangedEvent),v&&!k&&C.renderGroundShadow(),m&&(m.hasHighlighted()?(D=avp.RENDER_HIGHLIGHTED,m.reset(C.camera,D,u|H)):(D=avp.RENDER_NORMAL,m.reset(C.camera,D,u|H)))}else q=-1;if(k&&!C.is2d&&!X){var E=k.prepareGroundReflection(C,M,H);E&&R.isDone()&&C.showGhosting&&!R.areAllVisible()&&(D=avp.RENDER_HIDDEN,R.reset(C.camera,D))}var _=!1;m.isEmpty()||m.isDone()||(_=!0,g=m.renderSome(r,g),m.isDone()&&D===avp.RENDER_HIGHLIGHTED&&(D=avp.RENDER_NORMAL,m.reset(C.camera,D),g=m.renderSome(r,g)),m.isDone()?(D===avp.RENDER_NORMAL&&!m.areAllVisible()&&C.showGhosting?(!k||k.finished)&&(D=avp.RENDER_HIDDEN,m.reset(C.camera,D),g=m.renderSome(r,g)):(D=avp.RENDER_FINISHED,T.renderScenePart(C.sceneAfter,!0,!0,!0)),p&&C.signalProgress(100)):p&&C.signalProgress(100*m.getRenderProgress()),n(e)),z&&(_=!0,T.renderScenePart(C.sceneAfter,!0,!0,!0),!m.isEmpty()&&m.isDone()||C.showOverlaysWhileMoving?(C.renderOverlays(),m.isEmpty()||m.isDone()||(z=!0)):T.clearAllOverlays());var L=!0;C.skipAOWhenMoving&&(u||!m.isDone()?L=!1:V&&(_=!0,$&&(et=!0))),_&&T.composeFinalFrame(!L),V=u,J=e,m&&m.needsRender()?(B=!0,m.resetNeedsRender()):B=!1,H=!1,x=!1,et&&(et=!1,T.setAOEnabled(!0),$=!1,C.invalidate(!0,!0))}}function p(e,t){st=st||new THREE.Box3,t.updateMatrixWorld(!0),t.traverse(function(t){var i=t.geometry;void 0!==i&&i.visible&&(i.boundingBox||i.computeBoundingBox(),st.copy(i.boundingBox),st.applyMatrix4(t.matrixWorld),e.union(st))})}function f(){var e=new THREE.Box3,t=C.overlayScenes;for(var i in t)t.hasOwnProperty(i)&&p(e,t[i].scene);return p(e,C.scene),e}function g(e){var t,i,r,n=";base64,";if(-1==e.indexOf(n))return t=e.split(","),i=t[0].split(":")[1],r=decodeURIComponent(t[1]),new Blob([r],{type:i});t=e.split(n),i=t[0].split(":")[1],r=window.atob(t[1]);for(var o=r.length,s=new Uint8Array(o),a=0;o>a;++a)s[a]=r.charCodeAt(a);return new Blob([s],{type:i})}var m,v,y,b,E,w,_,T,S,x,M,k,R,C=this,A=1e3/15,P=1e3/30,I=1e3/120,D=avp.RENDER_NORMAL,L=-1,O=-1,V=!1,N="y",F=null,U=null,H=!1,B=!1,z=!1,G={type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,percent:0},W=!1,j=0,q=0,Y=0,J=0,K=1e3/60,Z=0,X=!0,Q=!1,$=!1,et=!1,tt=!1,it=1,rt=null,nt=null;e&&setInterval(function(){X||60>Z||C.track({name:"fps",value:Number(C.fps().toFixed(2)),aggregate:"last"})},3e4),this.api=t,this.canvas=e,this.loader=null,this.initialize=function(){if(m=new THREE.Vector3(0,1,0),R=new avp.RenderScene,_=i(e)){T=new avp.RenderContext,T.init(_,e?e.clientWidth:0,e?e.clientHeight:0),w=new avp.MaterialManager(this),avp.init_UnifiedCamera(THREE),this.camera=new av.UnifiedCamera(e?e.clientWidth:512,e?e.clientHeight:512),this.lightsOn=!1,this.lights=[],this.no_lights=[],rt=(new THREE.Color).setRGB(1,1,1),nt=(new THREE.Color).setRGB(1,1,1),this.cameraChangedEvent=this.camera.getCameraChangedEvent(),F=new THREE.Vector3(1,1,1),U=(new THREE.Vector3).copy(F),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,ot("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,w.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,w.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,this.swapBlackAndWhite=!1,av.isMobileDevice()&&(A*=2,I*=2,P*=2),this.targetFrameTime=P,this.controls={update:function(){this.camera.lookAt(this.camera.target),this.camera.updateProjectionMatrix(),this.camera.dirty=!1},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){}},this.selector=new avp.MultiModelSelector(this),this.visibilityManager=new avp.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null;var t=avp.LightPresets[avp.DefaultLightPreset].bgColorGradient;this.setClearColors(t[0],t[1],t[2],t[3],t[4],t[5]),M=new av.Shaders.GroundShadow(_),M.enabled=!0,w.addMaterialNonHDR("groundShadowDepthMaterial",M.getDepthMaterial()),w.addMaterialNonHDR("normalsMaterial",T.getDepthMaterial()),T.beginScene(this.scene,this.camera,this.noLights,!0),T.composeFinalFrame(!0)}},this.renderGroundShadow=function(e){S?S.state==avp.SHADOWMAP_VALID&&S.renderGroundShadow(C.camera,e||T.getColorTarget()):(M.renderShadow(C.camera,e||T.getColorTarget()),M.rendered=!0)},this.run=function(){v=0,setTimeout(function(){(function e(t){v=window.requestAnimationFrame(e),c(t)})()},1)},this.toggleProgressive=function(e){this.progressiveRender=e,H=!0},this.toggleSwapBlackAndWhite=function(e){this.swapBlackAndWhite=e,H=!0},this.toggleGhosting=function(e){this.showGhosting=e,H=!0},this.toggleOverlaysWhileMoving=function(e){this.showOverlaysWhileMoving=e},this.togglePostProcess=function(e,t){T.initPostPipeline(e,t),this.fireRenderOptionChanged(),H=!0},this.toggleCelShading=function(e){T.toggleCelShading(e),this.fireRenderOptionChanged(),H=!0},this.toggleGroundShadow=function(e){M.enabled!==e&&(M.enabled=e,M.clear(),a(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(e){M.enabled&&(M.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(e){M.enabled&&(M.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(e){e&&k||!e&&!k||(e?(k=new av.Shaders.GroundReflection(_,this.canvas.clientWidth,this.canvas.clientHeight),k.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),k.toggleEnvMapBackground(Q),k.setEnvRotation(T.getEnvRotation()),a()):(k.cleanup(),k=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(e){k&&(k.setColor(e),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(e){k&&(k.setAlpha(e),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(e){Q=e,T.toggleEnvMapBackground(e),k&&k.toggleEnvMapBackground(e),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return Q},this.toggleRenderPrism=function(e){w.setRenderPrism(e)},this.setOptimizeNavigation=function(e){this.skipAOWhenMoving=e},this.renderOverlays=function(){var e=this.lightsOn;e||this.toggleLights(!0,!0);var t;this.dir_light1&&(t=this.dir_light1.intensity,this.dir_light1.intensity=1),T.renderOverlays(this.overlayScenes,this.lightsOn?this.lights:this.no_lights),e||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=t),z=!1},this.setLayerVisible=function(e,t){this.matman().setLayerVisible(e,t)},this.isLayerVisible=function(e){return this.matman().isLayerVisible(e)},this.updateCameraMatrices=function(){function e(){t=new THREE.Matrix4,i=new THREE.Matrix4,r=new THREE.Box3}var t,i,r;return function(){r||e();var n=this.camera;if(t.compose(n.position,n.quaternion,n.scale),i.getInverse(t),n.worldup&&this.setWorldUp(n.worldup),this.model){var o=this.getVisibleBounds(!0,z);if(r.copy(o),k){var s=new THREE.Vector3;s.multiplyVectors(r.max,n.worldup);var a=new THREE.Vector3;a.multiplyVectors(r.min,n.worldup),s.sub(a),s.x>=0?r.min.x-=s.x:r.max.x-=s.x,s.y>=0?r.min.y-=s.y:r.max.y-=s.y,s.z>=0?r.min.z-=s.z:r.max.z-=s.z}S&&S.groundShapeBox&&r.union(S.groundShapeBox),r.applyMatrix4(i);var l=1e-5*(r.max.z-r.min.z),h=.5*(r.max.y-r.min.y),u=-(r.max.z+l)-h,d=-(r.min.z-l)+h;n.isPerspective&&(u=Math.max(u,Math.min(1,1e-4*Math.abs(d-u)))),d=Math.max(d,u),n.near=u,n.far=d,n.updateProjectionMatrix();var c;if(this.model.is2d()){var p=this.intersectGroundViewport(new THREE.Vector3(0,0,1));c=p?n.position.distanceTo(p):n.position.distanceTo(o.center());var f=T.settings.deviceHeight/(2*c*Math.tan(THREE.Math.degToRad(.5*n.fov)));w.updatePixelScale(f),w.updateSwapBlackAndWhite(this.swapBlackAndWhite)}else{var g,m=w.getCutPlanesRaw();if(m&&m.length){var v=m[0],y=n.target.clone().sub(n.position).normalize(),b=y.dot(v);if(0===b)g=o.center();else{var E=-(n.position.clone().dot(v)+v.w)/b;g=o.clampPoint(y.multiplyScalar(E).add(n.position))}}else g=o.center();c=n.position.distanceTo(g);var f=T.settings.deviceHeight/(2*c*Math.tan(THREE.Math.degToRad(.5*n.fov)));w.updatePixelScale(f)}}}}(),this.initLights=function(){this.dir_light1=new THREE.DirectionalLight(rt,it),this.dir_light1.position.set(-1,0,1),this.amb_light=new THREE.AmbientLight(nt),this.lights=[this.dir_light1,this.amb_light],this.camera.add(this.dir_light1),this.camera.add(this.dir_light1.target),tt=!0},this.toggleLights=function(e,t){if(this.amb_light){this.lightsOn=e;var i=avp.LightPresets[L],r=i.ambientColor,n=i.directLightColor;r=r||nt.toArray(),n=n||rt.toArray(),this.lightsOn?(t&&this.amb_light?this.amb_light.color.setRGB(.5*n[0],.5*n[1],.5*n[2]):this.amb_light&&this.amb_light.color.setRGB(r[0],r[1],r[2]),this.dir_light1&&this.dir_light1.color.setRGB(n[0],n[1],n[2])):this.amb_light&&t&&this.amb_light.color.setRGB(r[0],r[1],r[2])}},this.syncCamera=function(e){this.camera.updateProjectionMatrix(),e&&this.setWorldUp(this.api.navigation.getWorldUpVector()),x=!0},this.setViewFromFile=function(e,t){var i,r=e.getDefaultCamera();if(r)i=r;else{i={};var n=e.getBoundingBox(),o=n.size();if(i.target=n.center(),e.is2d()){i.isPerspective=!1;var s=o.x/o.y,a=this.camera.aspect;i.orthoScale=a>s?o.y:o.x/a,i.up=new THREE.Vector3(0,0,1),i.position=i.target.clone(),i.position.z+=i.orthoScale,i.target.y+=1e-6*o.y}else i.isPerspective=!0,i.fov=this.camera.fov,i.up=this.camera.up.clone(),i.position=i.target.clone(),i.position.z+=1.5*Math.max(o.x,o.y,o.z)}this.setViewFromCamera(i,t)},this.adjustOrthoCamera=function(e){if(!e.isPerspective&&this.model){var t=this.model.getBoundingBox(),i=t.size(),r=e.target.clone().sub(e.position);if(r.length()>1e3*i.length()){var n=e.position.distanceTo(t.center());e.target.copy(e.position).add(r.normalize().multiplyScalar(n))}else e.position.copy(e.target).add(r.normalize().multiplyScalar(-e.orthoScale))}},this.setViewFromCamera=function(e,t){this.adjustOrthoCamera(e);var i=!1,r=this.model?this.model.getUpVector():null;this.model&&-1!=this.model.getData().basePath.indexOf("SaRang")&&(r=[0,0,1]);var n;n=r?(new THREE.Vector3).fromArray(r):i?e.up.clone():av.Navigation.snapToAxis(e.up.clone()),i?this.api.prefs&&this.api.prefs.set("fusionOrbitConstrained",n.equals(e.up)):e.up=n;var o=this.api.navigation;
if(o)if(t){var s=this.camera;s.up.copy(e.up),s.position.copy(e.position),s.target.copy(e.target),e.isPerspective?s.fov=e.fov:(s.saveFov=e.fov,s.fov=av.UnifiedCamera.ORTHO_FOV),s.isPerspective=e.isPerspective,s.orthoScale=e.orthoScale,s.dirty=!0,o.setWorldUpVector(i?n:s.up),o.setView(s.position,s.target),o.setPivotPoint(s.target),this.syncCamera(!0)}else if(this.camera.isPerspective=e.isPerspective,i)o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,e.up,n);else{var a=o.computeOrthogonalUp(e.position,e.target);o.setRequestTransitionWithUp(!0,e.position,e.target,e.fov,a,n)}x=!0},this.setViewFromViewBox=function(e,t,i,r){if(e.is2d()){var n={},o=e.getBoundingBox(),s={width:t[2]-t[0],height:t[3]-t[1]};s.aspect=s.width/s.height,s.centerX=t[0]+s.width/2,s.centerY=t[1]+s.height/2;var a=this.camera.aspect;n.orthoScale=a>s.aspect?s.height:s.width/a,n.isPerspective=!1,n.position=new THREE.Vector3(s.centerX,s.centerY,o.center().z+n.orthoScale),n.target=new THREE.Vector3(s.centerX,s.centerY,o.center().z),n.target.y+=1e-6*s.height,n.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(n,r)}},this.setWorldUp=function(e){if(!m.equals(e)){m.copy(e);var t=Math.abs(e.x);N="x",Math.abs(e.y)>t&&(N="y",t=Math.abs(e.y)),Math.abs(e.z)>t&&(N="z");var i=function(e,t){var i=(new THREE.Vector3).crossVectors(t,e).normalize(),r=Math.acos(e.dot(t));return(new THREE.Matrix4).makeRotationAxis(i,r)},r=new THREE.Vector3(0,1,0);C.camera.worldUpTransform=i(r,e),this.sceneUpdated(!1)}},this.addModel=function(e){if(e){var t=!!this.model,i=e.is2d(),r=0;if(!this.model){this.model=e,T.setUnitScale(e.getUnitScale());var n=e.getData().bbox;r=n.size().length()}if(R.addModel(e),this.selector.addModel(e),this.visibilityManager.addModel(e),i){w.initLayersTexture(e);var o=w.create2DMaterial(e.getData(),{},!0),s=w.findMaterial(e.getData(),o);if(T.enter2DMode(s),!t){this.is2d=!0,O=L,this.setLightPreset(avp.DefaultLightPreset2d);var a=e.getData();if(a.hidePaper){var l=a.bgColor,h=255&l>>16,u=255&l>>8,d=255&l;this.setClearColors(h,u,d,h,u,d)}}}if(this.api.navigation){this.api.navigation.setIs2D(i&&!t),this.api.setActiveNavigationTool();var c=e.getData();c.isLeaflet?this.api.navigation.setConstraints2D(c.bbox,c.maxPixelPerUnit):this.api.navigation.setConstraints2D()}t||(this.setViewFromFile(e,!0),this.controls.recordHomeView()),i||this.setLightPresetFromFile(e)||(O>=0?(this.setLightPreset(O,!0),O=-1):this.setLightPreset(L,!1)),r>0&&T.setAOOptions(Math.min(10,.05*r)),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.getSvfMaterialId=function(e){return this.model.getFragmentList().getSvfMaterialId(e)},this.getMaterials=function(){return w},this.setupMesh=function(e,t,i,r){var n=e.getData(),o={geometry:t,matrix:r,isLine:t.isLines,is2d:t.is2d};if(t.isLines){var s=!!t.attributes.color,a=new THREE.LineBasicMaterial({vertexColors:s});if(!s){var l=w.findMaterial(n,i);a.color=l.color}w.addMaterialNonHDR(n.basePath+i+"_line_"+a.id,a),o.material=a,n.hasLines=!0}else{var a=w.findMaterial(n,i);a&&(a.svfMatId=i),w.applyGeometryFlagsToMaterial(a,t),o.material=a}return o},this.onLoadComplete=function(e){function t(){if(i.animations){n.keyFrameAnimator=new avp.KeyFrameAnimator(n,i.animations.duration);for(var e in i.animations.animations)n.keyFrameAnimator.add(i.animations.animations[e]);n.keyFrameAnimator.goto(0),n.api.fireEvent({type:av.ANIMATION_READY_EVENT})}n.api.removeEventListener(av.OBJECT_TREE_CREATED_EVENT,t)}X=!1,this.signalProgress(100),this.sceneUpdated(!1),this.is2d&&(this.selectionMaterial2d=w.init2DSelectionMaterial(e),this.createOverlayScene("selection2d",this.selectionMaterial2d));var i=e.getData(),r=R.getGeometryList();r&&R.getGeometryList().printStats(),i.hasLines&&w.togglePolygonOffset(!0);var n=this;e.isObjectTreeCreated()?t():this.api.addEventListener(av.OBJECT_TREE_CREATED_EVENT,t),e.hasGeometry()||avp.logger.warn("Loaded model has not geometry."),this.api.fireEvent({type:av.GEOMETRY_LOADED_EVENT,model:e})},this.signalProgress=function(e){G.percent!==e&&(G.percent=e,this.api.fireEvent(G))},this.resize=function(e,t){y=!0,b=e,E=t},this.unloadModel=function(e){if(this.removeModel(e)){if(e.isLoadDone()){var t=e.getData().propWorker;t&&t.dtor()}e.loader&&e.loader.dtor()}},this.removeModel=function(e){return R.removeModel(e)?(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),e.dtor(this.glrenderer()),w.cleanup(e.getData()),this.selector.removeModel(e),this.visibilityManager.removeModel(e),e===this.model&&(this.model=null,R.isEmpty()||(this.model=R.getModels()[0])),this.api.fireEvent({type:av.MODEL_UNLOADED_EVENT,model:e}),this.invalidate(!0,!0,!0),!0):!1},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlayScene("selection2d"),T.exit2DMode(),L=O),T.beginScene(this.scene,this.camera,this.lightsOn?this.lights:this.no_lights,!0),T.composeFinalFrame(!0);for(var e=R.getModels(),t=e.length-1;t>=0;t--)this.unloadModel(e[t])};var ot=function(e,t,i){t.depthWrite=!1,t.depthTest=!0,t.side=THREE.DoubleSide,i.depthWrite=!1,i.depthTest=!0,i.side=THREE.DoubleSide,C.createOverlayScene(e,t,i)};this.createOverlayScene=function(e,t,i,r){t&&w.addMaterialNonHDR(e+"_pre",t),i&&w.addMaterialNonHDR(e+"_post",i);var n=new THREE.Scene;n.__lights=this.scene.__lights,this.overlayScenes[e]={scene:n,camera:r,materialPre:t,materialPost:i}},this.removeOverlayScene=function(e){var t=this.overlayScenes[e];t&&(delete this.overlayScenes[e],this.invalidate(!1,!1,!0))},this.addOverlay=function(e,t){this.overlayScenes[e].scene.add(t),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.addOverlay(e,t[i])},this.removeOverlay=function(e,t){this.overlayScenes[e]&&(this.overlayScenes[e].scene.remove(t),this.invalidate(!1,!1,!0))},this.removeMultipleOverlays=function(e,t){for(var i in t)t.hasOwnProperty(i)&&this.removeOverlay(e,t[i])},this.clearOverlay=function(e){if(this.overlayScenes[e]){var t,i,r=this.overlayScenes[e].scene;for(i=r.children.length-1;i>=0;--i)t=r.children[i],t&&r.remove(t);this.invalidate(!1,!1,!0)}},this.setClearColors=function(e,t,i,r,n,o){if(this.clearColorTop=new THREE.Vector3(e/255,t/255,i/255),this.clearColorBottom=new THREE.Vector3(r/255,n/255,o/255),!w.reflectionCube||w.reflectionCube.isBgColor){var s=w.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);T.setCubeMap(s)}T.setClearColors(this.clearColorTop,this.clearColorBottom),k&&k.setClearColors(this.clearColorTop,this.clearColorBottom,av.isAndroidDevice()||av.isIOSDevice()),H=!0,this.fireRenderOptionChanged()};var st;this.getVisibleBounds=function(e,t){var i=new THREE.Box3;return R.isEmpty()||(p(i,this.scene),i=R.getVisibleBounds(e).union(i),t&&(i=f().union(i))),i},this.getFitBounds=function(e){var t;return this.is2d&&(e=!0),e||null===this.selector||(t=this.selector.getSelectionBounds()),(!t||t.empty())&&(t=this.getVisibleBounds()),t},this.getRenderProxy=function(e,t){return e.getFragmentList().getVizmesh(t)},this.getFragmentProxy=function(e,t){return new avp.FragmentPointer(e.getFragmentList(),t)},this.getRenderProxyCount=function(e){return e.getFragmentList().getCount()},this.getRenderProxyDbIds=function(e,t){return e.getFragmentList().getDbIds(t)},this.isWholeModelVisible=function(){return R?R.areAllVisible():!0},this.highlightObjectNode=function(e,t,i,r){e.is2d()&&w.highlightObject2D(t,i);var n=this,o=e.getData().instanceTree;if(o&&!e.is2d())o.enumNodeFragments(t,function(t){n.highlightFragment(e,t,i,r)},!1);else{var s=t;if(e.is2d()&&(s=e.getData().fragments.dbId2fragId[t]),Array.isArray(s))for(var a=0;s.length>a;a++)n.highlightFragment(e,s[a],i,r);else n.highlightFragment(e,s,i,r)}},this.highlightFragment=function(e,t,i,r){var n=this.getRenderProxy(e,t);if(n){var o=!r||n.is2d,s=e.id+":"+t;if(o){var a=e.is2d()?"selection2d":"selection";if(i){var l=new THREE.Mesh(n.geometry,n.material);l.matrix.copy(n.matrixWorld),l.matrixAutoUpdate=!1,l.matrixWorldNeedsUpdate=!0,l.frustumCulled=!1,l.model=e,l.fragId=t,this.addOverlay(a,l),this.selectionMeshes[s]=l}else this.selectionMeshes[s]&&(this.removeOverlay(a,this.selectionMeshes[s]),delete this.selectionMeshes[s])}o&&i||e.setHighlighted(t,i)&&this.invalidate(!0)}},this.explode=function(e){e!=j&&(j=e,R.explode(e),this.sceneUpdated(!0),this.api.fireEvent({type:av.EXPLODE_CHANGE_EVENT,scale:e}))},this.getExplodeScale=function(){return j},this.setGhostingBrightness=function(e){this.fadeMaterial.color=e?new THREE.Color(1052688):new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.setLightPreset=function(e,t){if(tt||this.initLights(),L!=e||t){(0>e||e>=avp.LightPresets.length)&&(e=avp.DefaultLightPreset),L=e;var i=avp.LightPresets[e];if(i&&i.path){var r="res/environments/"+i.path,n=avp.getResourceUrl(r+"_mipdrop."+(i.type||"")+".dds"),o=avp.getResourceUrl(r+"_irr."+(i.type||"")+".dds");w.setIrradianceMap(o,i.E_bias);var s=w.setCubeMap(n,i.E_bias);T.setCubeMap(s),w.setEnvExposure(-i.E_bias),T.setEnvExposure(-i.E_bias),this.setTonemapExposureBias(i.E_bias),this.setTonemapMethod(i.tonemap),this.setGhostingBrightness(i.darkerFade)}else{w.setIrradianceMap(null);var s=w.setCubeMap(null);T.setCubeMap(s),w.setEnvExposure(0),T.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1)}var a=av.Shaders.SAOShader.uniforms.radius.value,l=av.Shaders.SAOShader.uniforms.intensity.value;i.hasOwnProperty("saoRadius")&&(a=i.saoRadius),i.hasOwnProperty("saoIntensity")&&(l=i.saoIntensity),T.setAOOptions(a,l);var h=i.bgColorGradient;h||(h=avp.BackgroundPresets.Custom),this.setClearColors(h[0],h[1],h[2],h[3],h[4],h[5]);var d=it;null!==i.lightMultiplier&&void 0!==i.lightMultiplier&&(d=i.lightMultiplier),U.copy(F),i.lightDirection&&U.fromArray(i.lightDirection).negate(),S&&u(),this.dir_light1&&(this.dir_light1.intensity=d,i.lightDirection&&this.dir_light1.position.set(-i.lightDirection[0],-i.lightDirection[1],-i.lightDirection[2])),w.setEnvRotation(i.rotation||0),T.setEnvRotation(i.rotation||0),k&&k.setEnvRotation(i.rotation||0),this.toggleLights(0!==d),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(e){if(!e||e.is2d())return!1;var t=e.getMetadata("renderEnvironmentStyle","value",null);if(null===t||""===t)return!1;var i=e.getMetadata("renderEnvironmentGroundReflection","value",null);null!==i&&(this.api.prefs.hasTag("groundReflection","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundReflection is locked. No changes."):(this.api.prefs.tag("no-storage","groundReflection"),this.api.setGroundReflection(i)));var r=e.getMetadata("renderEnvironmentGroundShadow","value",null);null!==r&&(this.api.prefs.hasTag("groundShadow","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): groundShadow is locked. No changes."):(this.api.prefs.tag("no-storage","groundShadow"),this.api.setGroundShadow(r)));var n=e.getMetadata("renderEnvironmentAmbientShadows","value",null);null!==n&&(this.api.prefs.hasTag("ambientShadows","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): ambientShadows is locked. No changes."):(this.api.prefs.tag("no-storage","ambientShadows"),this.api.setQualityLevel(n,T.getAntialiasing())));var o=e.getMetadata("renderEnvironmentDisplayLines","value",null);null!==o&&(this.api.prefs.hasTag("lineRendering","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): lineRendering is locked. No changes."):(this.api.prefs.tag("no-storage","lineRendering"),this.api.hideLines(!o)));var s=avp.LightPresets.filter(function(e){return e.name===t});if(s=s[0]||null)if(this.api.prefs.hasTag("lightPreset","ignore-producer"))avp.logger.debug("setLightPresetFromFile(): lightPreset is locked. No changes.");else{this.api.prefs.tag("no-storage","lightPreset");var a=avp.ModelSettingsEnvironment;a||(a=avp.ModelSettingsEnvironment={},avp.LightPresets.push(a)),avp.copyLightPreset(s,a),a.name="(Custom: Model defined)";var l=e.getMetadata("renderEnvironmentExposureBias","value",null),h=e.getMetadata("renderEnvironmentExposureBase","value",null);null!==l&&null!==h&&(a.E_bias=l+h);var u=e.getMetadata("renderEnvironmentBackgroundColor","value",null);this.api.prefs.hasTag("backgroundColorPreset","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): backgroundColorPreset is locked. No changes."):u&&(a.bgColorGradient=[255*u[0],255*u[1],255*u[2],255*u[0],255*u[1],255*u[2]]);var d=e.getMetadata("renderEnvironmentRotation","value",null);null!==d&&(a.rotation=d);var c=avp.LightPresets.indexOf(a);this.api.setLightPreset(c)}var p=e.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);return null!==p&&(this.api.prefs.hasTag("envMapBackground","ignore-producer")?avp.logger.debug("setLightPresetFromFile(): envMapBackground is locked. No changes."):(this.api.prefs.tag("no-storage","envMapBackground"),this.api.setEnvMapBackground(p))),s},this.setTonemapMethod=function(e){e!=T.getToneMapMethod()&&(T.setTonemapMethod(e),w.setTonemapMethod(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(e){e!=T.getExposureBias()&&(T.setTonemapExposureBias(e),w.setTonemapExposureBias(e),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(v),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,R=null,T=null,w.dtor(),w=null},this.hideLines=function(e){return R&&!R.isEmpty()?(R.hideLines(e),this.sceneUpdated(!0),!0):!1},this.getCutPlanes=function(){return w.getCutPlanes()},this.setCutPlanes=function(e){w.setCutPlanes(e),this.sceneUpdated(),this.api.fireEvent({type:av.CUTPLANES_CHANGE_EVENT,planes:e})},this.fireRenderOptionChanged=function(){w.toggleMRTSetting(),this.api.fireEvent({type:av.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(e,t){var i=this.camera;e.z=-1;var r=new THREE.Vector3(e.x,e.y,1);return e=e.unproject(i),r=r.unproject(i),r.sub(e).normalize(),t||(t=new THREE.Ray),t.set(i.isPerspective?i.position:e,r),t},this.rayIntersect=function(e,t,i,r){var n=R.rayIntersect(e.origin,e.direction,t,i,r);if(this.sceneAfter.children.length){var o=new THREE.Raycaster(e.origin,e.direction,this.camera.near,this.camera.far),s=[];avp.VBIntersector.intersectObject(this.sceneAfter,o,s,!0),s.length&&(!n||n.distance>s[0].distance)&&(n=s[0])}if(!n)return null;var a=n.fragId,l=n.point,h=n.face,u=n.model,d=n.dbId;if(void 0===d&&void 0!==a){d=u.getFragmentList().getDbIds(a);var c=u.getData().instanceTree;c||(d=a)}return{dbId:d,fragId:a,intersectPoint:l,face:h,model:u}},this.castRayViewport=function(){var e;return function(t,i,r,n){return e=e||new THREE.Ray,R?(this.viewportToRay(t,e),this.rayIntersect(e,i,r,n)):{}}}(),this.clientToViewport=function(e,t){var i=C.canvas.getBoundingClientRect();return new THREE.Vector3(2*((e+.5)/i.width)-1,2*-((t+.5)/i.height)+1,1)},this.viewportToClient=function(e,t){var i=C.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(e+1)*i.width-.5,(t-1)*-.5*i.height-.5,0)},this.castRay=function(e,t,i){return this.castRayViewport(this.clientToViewport(e,t),i)},this.intersectGroundViewport=function(e){var t=this.camera,i="z";this.is2d||(i=N);var r=e;r.z=-1;var n=new THREE.Vector3(r.x,r.y,1);r=r.unproject(t),n=n.unproject(t),n.sub(r).normalize();var o=n;if(1e-6>Math.abs(o[i]))return null;var s;s=t.isPerspective?t.position:r;var a=this.model?this.model.getBoundingBox().min[i]:0,l=(a-s[i])/o[i];return o.multiplyScalar(l),o.add(s),o},this.intersectGround=function(e,t){return this.intersectGroundViewport(this.clientToViewport(e,t))},this.hitTestViewport=function(e,t){var i;if(C.is2d){var r,n=[];if(r=av.isMobileDevice()?T.idAtPixels(e.x,e.y,45,n):T.idAtPixels(e.x,e.y,5,n),0>=r)return null;var o=this.intersectGroundViewport(e),s=R.findModel(n[1])||C.model;i={intersectPoint:o,dbId:r,fragId:s.getData().fragments.dbId2fragId[r],model:s}}else i=this.castRayViewport(e,t);return i},this.hitTest=function(e,t,i){return C.hitTestViewport(this.clientToViewport(e,t),i)},this.snappingHitTestViewport=function(e,t){var i;if(C.is2d){var r;if(r=av.isMobileDevice()?T.idAtPixels(e.x,e.y,45):T.idAtPixels(e.x,e.y,17),0>r)return null;var n=this.intersectGroundViewport(e),o=C.model.getData().fragments,s=o?o.dbId2fragId[r]:-1;i={intersectPoint:n,dbId:r,fragId:s}}else{var r=T.idAtPixel(e.x,e.y);i=this.castRayViewport(e,t,r>0?[r]:null)}return i},this.snappingHitTest=function(e,t,i){return this.snappingHitTestViewport(this.clientToViewport(e,t),i)},this.rolloverObjectViewport=function(e){T.rolloverObjectViewport(e.x,e.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(e,t){this.rolloverDisabled||this.rolloverObjectViewport(this.clientToViewport(e,t))},this.disableRollover=function(e){this.rolloverDisabled=e},this.rolloverObjectNode=function(e){var t=[],i=C.model.getData().instanceTree;if(i){if(i.enumNodeChildren(e,function(e){t.push(e)},!0),t.length>1){var r=t.shift();t.sort(function(e,t){return e-t}),t.unshift(r)}}else t.push(e);T.rolloverObjectViewport(null,null,t)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(e,t,i){T.presentBuffer();var r=C.canvas.toDataURL("image/png"),n=av.isSafari();if(n&&(e=e?e:b,t=t?t:E),!e||!t)return r;var o,s,a=0,l=0;e>t||e/t>b/E?(o=e,s=E/b*e,l=t/2-s/2):(s=t,o=b/E*t,a=e/2-o/2);var h=window.URL.createObjectURL(g(C.canvas.toDataURL("image/png"))),u=new Image;u.src=h;var d=document.createElement("canvas"),c=d.getContext("2d");d.width=e,d.height=t,u.onload=function(){n&&(c.translate(0,s),c.scale(1,-1)),c.drawImage(u,a,l,o,s);var e=d.toDataURL("image/png"),t=window.URL.createObjectURL(g(d.toDataURL("image/png")));i?i(e):window.open(t)}},this.getScreenShot=function(e,t,i){function r(e,t,i,r,n){if(r||t&&i){var o,s,a=0,l=0;t>i||t/i>b/E?(o=t,s=E/b*t,l=i/2-s/2):(s=i,o=b/E*i,a=t/2-o/2);var h=new Image;h.src=e;var u=document.createElement("canvas"),d=u.getContext("2d");u.width=t,u.height=i,h.onload=function(){r&&(d.translate(0,s),d.scale(1,-1)),d.drawImage(h,a,l,o,s);var e=window.URL.createObjectURL(g(u.toDataURL("image/png")));n?n(e):window.open(e)}}else n&&n(e)}T.presentBuffer();var n=window.URL.createObjectURL(g(C.canvas.toDataURL("image/png"))),o=av.isSafari();o&&(e=e?e:b,t=t?t:E),r(n,e,t,o,i)},this.modelQueue=function(){return R},this.glrenderer=function(){return _},this.renderer=function(){return T},this.shadowMaps=function(){return S},this.worldUp=function(){return m},this.worldUpName=function(){return N},this.setUserRenderContext=function(e){T=e?e:new RenderContext,T.init(_,this.canvas.clientWidth,this.canvas.clientHeight),T.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(e,t,i){H=H||e,B=B||t,z=z||i},this.sceneUpdated=function(e){this.invalidate(!0,!1,!0),R&&e&&R.invalidateVisibleBounds(),W=!0,u()},this.currentLightPreset=function(){return L},this.matman=function(){return w},this.fps=function(){return 1e3/K},this.setFPSTargets=function(e,t,i){A=1e3/i,I=1e3/e,P=1e3/t,this.targetFrameTime=P},this.track=function(e){avp.logger.track(e)},this.worldToClient=function(e){var t=new THREE.Vector4(e.x,e.y,e.z,1);return t.applyMatrix4(this.camera.matrixWorldInverse),t.applyMatrix4(this.camera.projectionMatrix),t.w>0&&(t.x/=t.w,t.y/=t.w,t.z/=t.w),this.viewportToClient(t.x,t.y)},this.clientToWorld=function(e,t,i){var r=null,n=this.model,o=n.getData();if(n.is2d()){var s=this.intersectGround(e,t);if(s){s.z=0;var a=o.bbox;(o.hidePaper||a.containsPoint(s))&&(r={point:s,model:n})}}else r=this.hitTest(e,t,i),r&&(r.point=r.intersectPoint);return r},this.setSelectionColor=function(e){this.selectionMaterialBase.color.set(e),this.selectionMaterialTop.color.set(e),this.invalidate(!1,!1,!0)},this.updateViewportId=function(e){w.updateViewportId(e)},this.findModel=function(e){return R.findModel(e)},this.setShadowLightDirection=function(e){U.copy(e),u(),this.invalidate(!0,!1,!1),a()},this.getShadowLightDirection=function(e){var t=e?e:new THREE.Vector3;return t.copy(U),t},this.toggleShadows=function(e){!!S!=!!e&&(e?S=new avp.ShadowMaps(_):(S.cleanup(w),S=null),a(),this.invalidate(!0,!0,!1))}}av.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1,depth:!1,devicePixelRatio:null},e.prototype.constructor=e,avp.Viewer3DImpl=e})(),function(){"use strict";var e=function(){function e(e,t,i){return n[e]?!1:(n[e]={loader:i,extensions:t},!0)}function t(e){return n[e]?n[e].loader:null}function i(e){return n[e]?(delete n[e],!0):!1}function r(e){e=e?e.toLowerCase():"";for(var t in n){var i=n[t];if(i)for(var r=0;i.extensions.length>r;r++)if(i.extensions[r].toLowerCase()===e)return i.loader}return null}var n={};return{registerFileLoader:e,getFileLoader:t,getFileLoaderForExtension:r,unregisterFileLoader:i}},t=Autodesk.Viewing;t.FileLoaderManager=new e}(),function(){var e=Autodesk.LMVTK,t=Autodesk.Viewing,i=t.Private;i.logger=i.logger||console,i.workerMain=function(t){if(t.hasOwnProperty("operation")){if(t.basePath="",t.url){var r=t.url.lastIndexOf("/");-1!=r&&(t.basePath=t.url.substr(0,r+1))}t.raiseError=function(){t.worker.raiseError.apply(t.worker,arguments)},t.onFailureCallback=i.ViewingService.defaultFailureCallback.bind(t);var n=t.operation;switch(n){case"LOAD_GEOMETRY":e.doGeomLoad(t);break;case"LOAD_SVF":e.doLoadSvf(t);break;case"LOAD_SVF_CONTD":e.doLoadSvfContinued(t);break;case"GET_PROPERTIES":e.doPropertyGet(t);break;case"SEARCH_PROPERTIES":e.doPropertySearch(t);break;case"BUILD_EXTERNAL_ID_MAPPING":e.doBuildExternalIdMapping(t);break;case"GET_OBJECT_TREE":e.doObjectTreeParse(t);break;case"PARSE_F2D":e.doParseF2D(t);break;case"PARSE_F2D_FRAME":e.doParseF2DFrame(t);break;case"STREAM_F2D":e.doStreamF2D(t);break;case"DECOMPRESS_DELTA":e.doDecompressDelta(t);break;case"POPULATE_CACHE":e.doPopulateCache(t);break;case"DECODE_ENVMAP":e.doDecodeEnvmap(t)}}}}();var lmv=Autodesk.LMVTK,av=Autodesk.Viewing,avp=av.Private;avp.createWorker=function(){return new MainWorker},avp.createWorkerWithIntercept=function(){return avp.createWorker()},avp.initWorkerScript=function(e){e&&e()},function(){"use strict";var e=Autodesk.Viewing,t=e.Private,i=e.isNodeJS?10:e.isMobileDevice()?2:6,r="LOAD_GEOMETRY",n="LOAD_SVF",o="LOAD_SVF_CONTD",s=function(i){this.viewer3DImpl=i,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.tmpMatrix=new THREE.Matrix4,this.logger=t.logger,this.loadTime=0,this.domainParam=e.getUseCredentials()&&!e.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"",this.onDemandLoading=!1,this.cullGeometryOnLoading=!1,this.pageOutGeometryEnabled=!1};s.prototype.dtor=function(){if(this.svf=null,this.options=null,this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null),this.pack_workers){for(var e=0;this.pack_workers.length>e;e++)this.pack_workers[e].clearAllEventListenerWithIntercept(),this.pack_workers[e].terminate();this.pack_workers=null}},t.pathToURL=function(e){if(-1!==e.indexOf("://")||0===e.indexOf("urn:"))return e;if("undefined"==typeof window)return e;var t=window.location.pathname,i=t.lastIndexOf("/");t=t.substr(0,i+1);var r=window.location.protocol+"//"+window.location.host+t+e;return r},s.prototype.loadFile=function(e,i,r,n,o){if(this.loading)return t.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.dtor();var s=e.indexOf("urn:");if(-1!=s){e=decodeURIComponent(e);var a=e.substr(s,e.substr(s).indexOf("/"));t.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=i.sharedPropertyDbPath,this.currentLoadPath=e;var h=this.currentLoadPath.lastIndexOf("/");-1!=h&&(this.basePath=this.currentLoadPath.substr(0,h+1)),this.acmSessionId=i.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=i;var u=this;return t.initWorkerScript(function(){u.loadSvfCB(e,i,r,n,o)}),!0},s.prototype.interceptManifest=void 0,s.prototype.loadSvfCB=function(r,s,a,l,h){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null;var u=!0,d=this,c={url:t.pathToURL(r),basePath:this.currentLoadPath,objectIds:s.ids,globalOffset:s.globalOffset,placementTransform:s.placementTransform,applyRefPoint:s.applyRefPoint,queryParams:this.queryParam,bvhOptions:s.bvhOptions||{isWeakDevice:e.isMobileDevice()}};t.memoryOptimizedSvfLoading&&(c.perfOpt={memoryOptimizedSvfLoading:t.memoryOptimizedSvfLoading,forceMemoryOptimizedMode:t.forceMemoryOptimizedModeOnSvfLoading});var p=this.svfWorker=t.createWorkerWithIntercept(),f=function(r){var n=function(){p.clearAllEventListenerWithIntercept(),p.terminate(),d.svfWorker=null,p=null};if(u&&h&&(u=!1,h()),r.data&&r.data.manifest)d.interceptManifest(r.data.manifest),c.operation=o,c.manifest=r.data.manifest,p.doOperation(c);else if(r.data&&r.data.svf){var s=d.svf=r.data.svf;d.failedToLoadSomeGeometryPacks&&(l&&l(d.failedToLoadSomeGeometryPacks.code,d.failedToLoadSomeGeometryPacks.msg),d.failedToLoadSomeGeometryPacks=null),d.onModelRootLoadDone(s),a&&a(d.model),d.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:s,model:d.model}),d.svf.loadDone=!1;var f=!1;if(d.svf.metadata&&d.svf.metadata.gltf&&(f=!0),!f){var g=s.geompacks.length;if(0==g)d.onGeomLoadDone();else if(s.fragments.length>t.FRAGS_PERSISTENT_MAX_COUNT?(d.onDemandLoading=t.onDemandLoading,d.cullGeometryOnLoading=t.cullGeometryOnLoading):(d.onDemandLoading=!1,d.cullGeometryOnLoading=!1),t.logger.log("SVF on demand loading: "+d.onDemandLoading),t.logger.log("SVF culling geometry on loading: "+d.cullGeometryOnLoading),d.onDemandLoading)d.loadedPacksCount=0;else if(g)for(var m=Math.min(g,i),v=0;m>v;v++){var y=s.geompacks[d.next_pack++];y.loading=!0,t.isNodeJS?d.loadGeometryPack(y.id,y.uri):function(e){setTimeout(function(){d.loadGeometryPack(e.id,e.uri)},200*v)}(y)}}1==r.data.progress&&(d.loading=!1,n()),s.fragments.polygonCounts||(s.fragments.polygonCounts=new Int32Array(s.fragments.length))}else r.data&&r.data.bvh?(d.svf.bvh||(d.svf.bvh=r.data.bvh,d.model.setBVH(new t.NodeArray(d.svf.bvh.nodes,d.svf.bvh.useLeanNodes),d.svf.bvh.primitives,d.options.bvhOptions),d.viewer3DImpl.invalidate(!1,!0)),d.loading=!1,n()):r.data&&r.data.mesh?(d.processReceivedMesh(r.data),1===r.data.progress&&(d.onGeomLoadDone(),d.loading=!1,n())):r.data&&r.data.progress?1==r.data.progress&&(d.loading=!1,n()):r.data&&r.data.error?(d.loading=!1,n(),l&&l(r.data.error.code,r.data.error.msg,r.data.error.args.httpStatus,r.data.error.args.httpStatusText)):r.data&&r.data.debug?t.logger.debug(r.data.message):(t.logger.error("SVF download failed."),d.loading=!1,n())};return p.addEventListenerWithIntercept(f),c.operation=n,c.interceptManifest=!!this.interceptManifest,p.doOperation(t.initLoadContext(c)),!0},s.prototype.loadGeometryPackOnDemand=function(e){var n=this;if(n.onDemandLoading){var o=n.svf.geompacks[e];if(!o.loading){var s,a=function(e){if(e.data&&e.data.meshes){for(var i=e.data.meshes,r={packId:e.data.packId,meshIndex:0,mesh:null},o=0;i.length>o;o++){var s=i[o];s&&(r.meshIndex=o,r.mesh=s,n.processReceivedMesh(r))}if(e.data.progress>=1){n.pack_workers[e.data.workerId].queued-=1,n.svf.geompacks[e.data.packId].loading=!1;var a=n.model.geomPacksMissingLastFrame(),l=a.indexOf(e.data.packId);l>=0&&a.splice(l,1);for(var h=!0,u=0;n.pack_workers.length>u;u++)if(0!=n.pack_workers[u].queued){h=!1;break}-1==n.loadedPacks.indexOf(e.data.packId)&&n.loadedPacks.push(e.data.packId),h&&0==n.model.geomPacksMissingLastFrame().length&&(n.loadedPacks.length==n.svf.geompacks.length?n.onGeomLoadDone():n.onGeomPackFilesLoadDone())}}else if(e.data&&e.data.progress){n.pack_workers[e.data.workerId].queued-=1,n.loadedPacksCount++;var d,c=null,a=n.model.geomPacksMissingLastFrame();for(o=0;a.length>o&&(d=a[o],c=n.svf.geompacks[d],c.loading);++o);c&&!c.loading&&n.loadGeometryPackOnDemand(d),n.viewer3DImpl.signalProgress(100*n.loadedPacks.length/n.svf.geompacks.length)}else e.data&&e.data.debug?t.logger.debug(e.data.message):e.data&&e.data.error?n.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}:(n.pack_workers[e.data.workerId].queued-=2,n.svf.geompacks[e.data.packId].loading=!1)};if(!this.pack_workers)for(this.pack_workers=[],s=0;i>s;s++){var l=t.createWorkerWithIntercept();l.addEventListenerWithIntercept(a),l.queued=0,this.pack_workers.push(l)}var h=0,u=this.pack_workers[0].queued;for(s=1;i>s;s++)u>this.pack_workers[s].queued&&(h=s,u=this.pack_workers[s].queued);if(u>2)return n.model.addGeomPackMissingLastFrame(e),void 0;var d,c,p=o.uri;d=this.pack_workers[h],d.queued+=2,c=h,o.loading=!0,n.svf.partPacksLoadDone=!1;var f=t.pathToURL(this.svf.basePath+p),g={operation:r,url:f,packId:parseInt(e),workerId:c,queryParams:this.queryParam};d.doOperation(t.initLoadContext(g))}}},s.prototype.loadGeometryPack=function(e,n){var o,s,a,l,h=this;if(this.svf){var u=function(e){if(e.data&&e.data.meshes){for(var i=e.data.meshes,r={packId:e.data.packId,meshIndex:0,mesh:null},n=0;i.length>n;n++){var o=i[n];o&&(r.meshIndex=n,r.mesh=o,h.processReceivedMesh(r))}if(e.data.progress>=1){h.pack_workers[e.data.workerId].queued-=1,h.loadedPacksCount++,h.viewer3DImpl.signalProgress(100*h.loadedPacksCount/h.svf.geompacks.length);var s=!0;for(l=0;h.pack_workers.length>l;l++)if(0!=h.pack_workers[l].queued){s=!1;break}if(s){for(l=0;h.pack_workers.length>l;l++)h.pack_workers[l].clearAllEventListenerWithIntercept(),h.pack_workers[l].terminate();h.pack_workers=null}h.svf.fragments.numLoaded==h.svf.fragments.length&&h.onGeomLoadDone()}}else if(e.data&&e.data.progress){if(h.pack_workers[e.data.workerId].queued-=1,h.svf.geompacks.length>h.next_pack){var a=null,u=h.model.geomPacksMissingLastFrame();for(n=0;u.length>n&&(a=h.svf.geompacks[u[n]],!a||a.loading);++n);if(!a||a.loading)for(;h.svf.geompacks.length>h.next_pack&&(a=h.svf.geompacks[h.next_pack++],a.loading););a&&!a.loading?(a.loading=!0,h.loadGeometryPack(a.id,a.uri)):(h.viewer3DImpl.modelQueue().enforceBvh=!1,h.svf.fragments.packIds=null)}}else e.data&&e.data.debug?t.logger.debug(e.data.message):e.data&&e.data.error?h.failedToLoadSomeGeometryPacks={code:e.data.error.code,msg:e.data.error.msg}:h.pack_workers[e.data.workerId].queued-=2},d=this.pack_workers;if(d||(d=this.pack_workers=[]),i>d.length){for(var c=!0,a=0;d.length>a;a++)if(0===d.queued){c=!1;break}if(c){var p=t.createWorkerWithIntercept();p.addEventListenerWithIntercept(u),p.queued=0,d.push(p)}}var f=0,g=d[0].queued;for(a=1;d.length>a;a++)g>d[a].queued&&(f=a,g=d[a].queued);o=d[f],o.queued+=2,s=f;var m=t.pathToURL(this.svf.basePath+n),v={operation:r,url:m,packId:parseInt(e),workerId:s,queryParams:this.queryParam};o.doOperation(t.initLoadContext(v))}},s.prototype.processReceivedMesh=function(e){var i=e.packId+":"+e.meshIndex,r=this.svf,n=r.fragments,o=n.mesh2frag[i];if(void 0===o)return t.logger.warn("Mesh "+i+" was not referenced by any fragments."),void 0;if(Array.isArray(o)||(o=[o]),this.cullGeometryOnLoading){for(var s=!0,a=0;o.length>a;++a){if(t.FRAGS_PERSISTENT_COUNT>o[a]){s=!1;break}if(s=s&&this.viewer3DImpl.modelQueue().checkCull(o[a],!0,!0),!s)break}if(s)return e.mesh=null,void 0}t.BufferGeometryUtils.meshToGeometry(e);var l=o.length,h=this.model,u=h.getFragmentList().getGeometryId(o[0]),d=h.getGeometryList().addGeometry(e.geometry,l,u);this.cullGeometryOnLoading&&l>1&&null==h.getFragmentList().geomidsmap[d]&&(h.getFragmentList().geomidsmap[d]={n:l,t:0});for(var c=e.geometry.attributes.index.array||e.geometry.ib,p=c.length/3,a=0;o.length>a;a++){var f=0|o[a];h.getFragmentList().getOriginalWorldMatrix(f,this.tmpMatrix);var g=""+n.materials[f];n.polygonCounts&&(n.polygonCounts[f]=p);var m=this.viewer3DImpl.setupMesh(this.model,e.geometry,g,this.tmpMatrix);h.activateFragment(f,m,!!r.placementTransform)}this.onDemandLoading||(n.mesh2frag[i]=null),n.numLoaded+=o.length,r.geomPolyCount>r.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),r.numRepaints++,r.nextRepaintPolys+=1e4*Math.pow(1.5,r.numRepaints),this.viewer3DImpl.invalidate(!1,!0))
},s.prototype.onModelRootLoadDone=function(i){i.geomPolyCount=0,i.instancePolyCount=0,i.geomMemory=0,i.fragments.numLoaded=0,i.meshCount=0,i.gpuNumMeshes=0,i.gpuMeshMemory=0,i.nextRepaintPolys=0,i.numRepaints=0,i.urn=this.svfUrn,i.acmSessionId=this.acmSessionId,i.basePath=this.basePath,i.loadOptions=this.options;var r=Date.now();this.loadTime+=r-this.t0,t.logger.log("SVF load: "+(r-this.t0));var n=this.model=new e.Model(i);n.initialize(this),n.loader=this;var o=!(this.onDemandLoading&&t.isMobileDevice());o&&!this.options.skipPropertyDb&&this.loadPropertyDb();var s=this.viewer3DImpl.matman().convertMaterials(i);if(this.t0=r,i.bbox=(new THREE.Box3).copy(i.bbox),i.modelBox&&(i.modelBox=(new THREE.Box3).copy(i.modelBox)),i.refPointTransform&&(i.refPointTransform=new LmvMatrix4(!0).copy(i.refPointTransform)),i.placementTransform&&(i.placementTransform=new LmvMatrix4(!0).copy(i.placementTransform)),i.cameras)for(var a=0;i.cameras.length>a;a++){var l=i.cameras[a];l.position=(new THREE.Vector3).copy(l.position),l.target=(new THREE.Vector3).copy(l.target),l.up=(new THREE.Vector3).copy(l.up)}i.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(i),t.logger.log("scene bounds: "+JSON.stringify(i.bbox));var h={category:"metadata_load_stats",urn:i.urn,has_topology:!!i.topology,has_animations:!!i.animations,cameras:i.cameras?i.cameras.length:0,lights:i.lights?i.lights.length:0,materials:s};t.logger.track(h),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!1)},s.prototype.addTransparencyFlagsToMaterials=function(e){for(var t in e){var i=e[t],r=i.userassets;if(r){var n=i.materials,o=n[r[0]];i.transparent=o.transparent}}},s.prototype.makeBVH=function(i){var r=performance.now(),n=i.materials?i.materials.materials:null;n&&this.addTransparencyFlagsToMaterials(n),i.bvh=new t.BVHBuilder(i.fragments,n),i.bvh.build(this.options.bvhOptions||{isWeakDevice:e.isMobileDevice()});var o=performance.now();t.logger.log("BVH build time: "+(o-r))},s.prototype.onGeomPackFilesLoadDone=function(){t.logger.log("Part of geom pack files are load done."),this.svf.partPacksLoadDone=!0,this.viewer3DImpl.invalidate(!1,!0)},s.prototype.onGeomLoadDone=function(){function i(t){var i={command:"assets",data:t};e.isBrowser&&window.webkit.messageHandlers.callbackHandler.postMessage(i)}this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||this.viewer3DImpl.matman().loadTextures(this.svf),this.onDemandLoading||(this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null);var r=Date.now(),n="Fragments load time: "+(r-this.t0);this.loadTime+=r-this.t0;var o=this.firstPixelTimestamp-this.t0;n+=" (first pixel time: "+o+")",(!this.svf.bvh||this.svf.placementTransform)&&(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),t.logger.log(n);var s={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};o>0&&(s.first_pixel_time=o),t.logger.track(s,!0),t.assets&&e.isBrowser&&window.webkit&&(i(t.assets),t.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},s.prototype.loadPropertyDb=function(){this.svf.propWorker=new t.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propWorker.load()},t.SvfLoader=s,e.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],t.SvfLoader)}(),function(){"use strict";function e(e){this.viewer3DImpl=e,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=i.logger,this.loadTime=0,this.domainParam=t.getUseCredentials()&&!t.isNodeJS?"domain="+encodeURIComponent(window.location.origin):""}var t=Autodesk.Viewing,i=t.Private,r="PARSE_F2D",n="STREAM_F2D",o="PARSE_F2D_FRAME";e.prototype.dtor=function(){this.svf=null,this.options=null,this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null)},e.prototype.loadFile=function(e,t,r,n,o){if(this.loading)return i.logger.log("Loading of F2D already in progress. Ignoring new request."),!1;this.dtor();var s=e.indexOf("urn:");if(-1!=s){e=decodeURIComponent(e);var a=e.substr(s,e.substr(s).indexOf("/"));i.logger.log("Extracted URN: "+a);var l=a.lastIndexOf(":");this.svfUrn=a.substr(l+1)}else this.svfUrn=e;this.sharedDbPath=t.sharedPropertyDbPath,this.currentLoadPath=e,this.acmSessionId=t.acmSessionId,this.queryParam=this.domainParam,this.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.acmSessionId),this.options=t,this.modelScale=this.options.placementTransform?this.options.modelScale||this.options.placementTransform.getMaxScaleOnAxis():this.options.modelScale||1,this.isf2d=!0;var h=this;return i.initWorkerScript(function(){h.loadFydoCB(e,t,r,n,o)}),!0},e.prototype.loadFydoCB=function(e,s,a,l,h){this.t0=Date.now();var u=i.pathToURL(e),d=this.streamingWorker=i.createWorker(),c=this.parsingWorker=i.createWorker(),p=this,f=!0,g=function(e){if(f&&h&&(f=!1,h()),e.data&&"F2DBLOB"==e.data.type){var t={operation:r,data:e.data.buffer,metadata:e.data.metadata,manifest:e.data.manifest,basePath:e.data.basePath,f2dLoadOptions:{modelSpace:s.modelSpace,bgColor:s.bgColor},url:u};c.doOperation(t,[t.data]),d.terminate()}else if(e.data&&"F2DSTREAM"==e.data.type){var t={operation:o,data:e.data.frames,url:u,f2dLoadOptions:{modelSpace:s.modelSpace,bgColor:s.bgColor}};e.data.metadata&&(t.metadata=e.data.metadata,t.manifest=e.data.manifest),e.data.finalFrame&&(t.finalFrame=!0),e.data.progress&&p.viewer3DImpl.signalProgress(100*e.data.progress),c.doOperation(t,t.data?[t.data]:void 0),e.data.finalFrame&&d.terminate()}else e.data&&"F2DAssetURL"==e.data.type?i.assets=i.assets.concat(e.data.urls):e.data&&e.data.assetRequest?i.assets.push(e.data.assetRequest):e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(p.loading=!1,d.terminate(),l&&l.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed."),p.loading=!1,d.terminate()))},m=function(e){if(f&&h&&(f=!1,h()),e.data&&e.data.f2d){var r=p.svf=e.data.f2d;c.terminate(),i.logger.info("Num polylines: "+r.numPolylines),i.logger.info("Line segments: "+r.numLineSegs),i.logger.info("Circular arcs: "+r.numCircles),i.logger.info("Ellipitcal arcs:"+r.numEllipses),i.logger.info("Plain triangles:"+r.numTriangles),i.logger.info("Total # of op codes generated by fydo.parse: "+r.opCount),p.onModelRootLoadDone(p.svf),a&&a(p.model),p.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:p.svf,model:p.model});for(var n=0;r.meshes.length>n;n++)p.processReceivedMesh2D(r.meshes[n],n);r.meshes=null,p.onGeomLoadDone(),p.loading=!1}else if(e.data&&e.data.f2dframe){var o=0;if(e.data.meshes){var s=e.data.bbox;p.svf.bbox=new THREE.Box3(s.min,s.max),o=e.data.baseIndex}else p.svf=e.data.f2dframe,o=e.data.baseIndex;var r=p.svf;if(r.fragments&&r.fragments.initialized||(p.onModelRootLoadDone(r),a&&a(p.model),p.viewer3DImpl.api.fireEvent({type:t.MODEL_ROOT_LOADED_EVENT,svf:r,model:p.model})),e.data.meshes&&e.data.meshes.length)for(var n=0;e.data.meshes.length>n;n++)p.processReceivedMesh2D(e.data.meshes[n],o+n);if(e.data.finalFrame){var u=e.data.cumulativeProps;for(var d in u)r[d]=u[d];p.onGeomLoadDone(),p.loading=!1,c.terminate()}}else e.data&&e.data.progress||(e.data&&e.data.debug?i.logger.debug(e.data.message):e.data&&e.data.error?(p.loading=!1,c.terminate(),i.logger.error("Error while parsing F2d: "+JSON.stringify(e.data.error.args)),l&&l.call(this,e.data.error.code,e.data.error.msg,e.data.error.args.httpStatus,e.data.error.args.httpStatusText)):(i.logger.error("F2D download failed."),p.loading=!1,c.terminate()))};d.addEventListener("message",g,!1),c.addEventListener("message",m,!1);var v={operation:n,url:u,objectIds:s.ids,queryParams:this.queryParam};return d.doOperation(i.initLoadContext(v)),!0},e.prototype.processReceivedMesh=function(e){var t=e.packId+":"+e.meshIndex,r=this.svf,n=r.fragments,o=n.mesh2frag[t];if(void 0===o)return i.logger.warn("Mesh "+t+" was not referenced by any fragments."),void 0;Array.isArray(o)||(o=[o]),i.BufferGeometryUtils.meshToGeometry(e);var s=o.length,a=this.model;a.getGeometryList().addGeometry(e.geometry,s);for(var l=e.geometry.attributes.index.array||e.geometry.ib,h=l.length/3,u=0;o.length>u;u++){var d=0|o[u];a.getFragmentList().getOriginalWorldMatrix(d,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var c=""+n.materials[d];n.polygonCounts&&(n.polygonCounts[d]=h);var p=this.viewer3DImpl.setupMesh(this.model,e.geometry,c,this.tmpMatrix);a.activateFragment(d,p)}n.mesh2frag[t]=null,n.numLoaded+=o.length;var f=n.numLoaded;r.geomPolyCount>r.nextRepaintPolys&&(r.numRepaints++,r.nextRepaintPolys+=1e4*Math.pow(1.5,r.numRepaints),this.viewer3DImpl.invalidate(!1,!0)),0==f%20&&this.viewer3DImpl.invalidate(!1,!0)},e.prototype.processReceivedMesh2D=function(e,t){var i={mesh:e,is2d:!0,packId:"0",meshIndex:t},r="0:"+t,n=this.svf.fragments,o=Object.keys(i.mesh.dbIds).map(function(e){return parseInt(e)});n.fragId2dbId[t]=o;for(var s=0;o.length>s;s++){var a=o[s],l=n.dbId2fragId[a];Array.isArray(l)?l.push(t):n.dbId2fragId[a]=l!==void 0?[l,t]:t}n.mesh2frag[r]=t,e.material.modelScale=this.modelScale,n.materials[t]=this.viewer3DImpl.matman().create2DMaterial(this.svf,e.material),n.length++,this.processReceivedMesh(i)},e.prototype.onModelRootLoadDone=function(e){e.fragments={},e.fragments.mesh2frag={},e.fragments.materials=[],e.fragments.fragId2dbId=[],e.fragments.dbId2fragId=[],e.fragments.length=0,e.fragments.initialized=!0,e.geomPolyCount=0,e.instancePolyCount=0,e.geomMemory=0,e.fragments.numLoaded=0,e.meshCount=0,e.gpuNumMeshes=0,e.gpuMeshMemory=0,e.nextRepaintPolys=1e4,e.numRepaints=0,e.urn=this.svfUrn,e.acmSessionId=this.acmSessionId,e.basePath="";var r=this.currentLoadPath.lastIndexOf("/");-1!=r&&(e.basePath=this.currentLoadPath.substr(0,r+1)),e.loadOptions=this.options;var n=Date.now();this.loadTime+=n-this.t0,i.logger.log("SVF load: "+(n-this.t0)),this.t0=n,e.bbox=(new THREE.Box3).copy(e.bbox);var o=this.model=new t.Model(e);o.initialize(this),o.loader=this,this.svf.propWorker=new i.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),i.logger.log("scene bounds: "+JSON.stringify(e.bbox));var s={category:"metadata_load_stats",urn:e.urn,layers:e.layerCount};i.logger.track(s),this.viewer3DImpl.signalProgress(5),this.viewer3DImpl.invalidate(!1,!1)},e.prototype.onGeomLoadDone=function(){function e(e){if(t.isBrowser){var i=window.webkit.messageHandlers.callbackHandler,r=i.doOperation||i.postMessage;r&&r({command:"assets",data:e})}}this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var r=Date.now(),n="Fragments load time: "+(r-this.t0);this.loadTime+=r-this.t0,this.options.skipPropertyDb||this.loadPropertyDb(),i.logger.log(n);var o={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};i.logger.track(o,!0),i.assets&&t.isBrowser&&window.webkit&&(e(i.assets),i.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},e.prototype.loadPropertyDb=function(){this.svf.propWorker.load()},i.F2DLoader=e,t.FileLoaderManager.registerFileLoader("f2d",["f2d"],i.F2DLoader)}(),function(){"use strict";function e(e){var t=e.data;if(t&&t.debug)return r.logger.debug(t.message),void 0;if(t.cbId){var i=d[t.cbId];t&&t.error?i[1]&&i[1](t.error):i[0]&&i[0](t.result),delete d[t.cbId]}}function t(e,t){var i=u++;return d[i]=[e,t],i}var i=Autodesk.Viewing,r=i.Private,n="GET_PROPERTIES",o="SEARCH_PROPERTIES",s="BUILD_EXTERNAL_ID_MAPPING",a="GET_OBJECT_TREE",l=function(e,t,r){this.sharedDbPath=e,this.propWorker=null,this.eventTarget=r,this.model=t,this.svf=t.getData();var n=i.getUseCredentials()&&!i.isNodeJS?"domain="+encodeURIComponent(window.location.origin):"";this.queryParam=n,this.svf.acmSessionId&&(this.queryParam&&(this.queryParam+="&"),this.queryParam+="acmsession="+this.svf.acmSessionId)};l.prototype.dtor=function(){this.propWorker&&!this.sharedDbPath&&(this.propWorker.clearAllEventListenerWithIntercept(),this.propWorker.terminate(),this.propWorker=null)};var h={},u=1,d={};l.prototype.processLoadResult=function(e){var t=this;if(e.instanceTreeStorage){var n=new r.InstanceTreeAccess(e.instanceTreeStorage,e.rootId,e.instanceBoxes);t.svf.instanceTree=new r.InstanceTree(n,e.objectCount,e.maxTreeDepth),t.svf.fragToNodeDone=!0}else e.objectCount&&(t.svf.hasObjectProperties=e.objectCount);t.eventTarget.fireEvent({type:i.OBJECT_TREE_CREATED_EVENT,svf:t.svf,model:t.model})},l.prototype.processLoadError=function(e){var t=this;t.propertyDbError=e,t.eventTarget.fireEvent({type:i.OBJECT_TREE_UNAVAILABLE_EVENT,svf:t.svf,model:t.model})},l.prototype.load=function(){var i=this,n=function(e){i.processLoadResult(e);var t=!!i.sharedDbPath,r=t&&h[i.sharedDbPath];if(r&&r.waitingLoaders){for(var n=0;r.waitingLoaders.length>n;n++)r.waitingLoaders[n].processLoadResult(e);r.waitingLoaders=null,r.workerResult=e}},o=function(e){i.processLoadError(e);var t=!!i.sharedDbPath,r=t&&h[i.sharedDbPath];if(r&&r.waitingLoaders){for(var n=0;r.waitingLoaders.length>n;n++)r.waitingLoaders[n].processLoadError(e);r.waitingLoaders=null,r.workerError=e}},s=!!this.sharedDbPath,l=s&&h[this.sharedDbPath];if(l?(r.logger.log("Using cached property worker for ",this.sharedDbPath),this.propWorker=l):(this.propWorker=r.createWorkerWithIntercept(),this.propWorker.addEventListenerWithIntercept(e),s&&(h[this.sharedDbPath]=this.propWorker)),this.svf.instanceTree&&this.svf.instanceBoxes){var u=this.svf;return setTimeout(function(){n(u)},0),void 0}var d=t(n,o),c=r.pathToURL(this.svf.basePath);this.sharedDbPath&&!this.svf.propertydb.values.length&&(c=this.sharedDbPath,r.logger.log("Using shared property db: "+c));var p={operation:a,url:c,propertydb:this.svf.propertydb,fragToDbId:this.svf.fragments.fragId2dbId,fragBoxes:this.svf.fragments.boxes,cbId:d,queryParams:this.queryParam};this.propWorker.doOperation(r.initLoadContext(p))},l.prototype.asyncPropertyOperation=function(e,r,n){var o=this;if(o.svf.instanceTree||o.svf.hasObjectProperties)e.cbId=t(r,n),this.propWorker.doOperation(e);else if(o.propertyDbError)n&&n(o.propertyDbError);else{var s=function(t){o.eventTarget.removeEventListener(i.OBJECT_TREE_CREATED_EVENT,s),o.eventTarget.removeEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,s),t.svf.instanceTree||t.svf.hasObjectProperties||o.propertyDbError?o.asyncPropertyOperation(e,r,n):n&&n({code:i.UNKNOWN_FAILURE,msg:"Failed to load properties"})};o.eventTarget.addEventListener(i.OBJECT_TREE_CREATED_EVENT,s),o.eventTarget.addEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,s)}},l.prototype.getProperties=function(e,t,i){this.asyncPropertyOperation({operation:n,dbId:e},t,i)},l.prototype.getBulkProperties=function(e,t,i,r){this.asyncPropertyOperation({operation:n,dbIds:e,propFilter:t},i,r)},l.prototype.searchProperties=function(e,t,i,r,n){this.asyncPropertyOperation({operation:o,searchText:e,attributeNames:t,completeInfo:n},i,r)},l.prototype.getExternalIdMapping=function(e,t){this.asyncPropertyOperation({operation:s},e,t)},l.prototype.getObjectTree=function(e,t){var r=this;if(r.svf.instanceTree)e(r.svf.instanceTree);else if(r.propertyDbError||"hasObjectProperties"in r.svf)t&&t(r.propertyDbError);else{var n=function(){r.eventTarget.removeEventListener(i.OBJECT_TREE_CREATED_EVENT,n),r.eventTarget.removeEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,n),r.getObjectTree(e,t)};r.eventTarget.addEventListener(i.OBJECT_TREE_CREATED_EVENT,n),r.eventTarget.addEventListener(i.OBJECT_TREE_UNAVAILABLE_EVENT,n)}},r.PropDbLoader=l}(),function(){var e=Autodesk.Viewing;e.Private;var t="",i=!1,r=!1;e.HTTP_REQUEST_HEADERS={},e.getApiEndpoint=function(){return t},e.setApiEndpoint=function(e,i){t=e,r=i},e.getViewingUrl=function(e){return(e||t)+"/viewingservice/v1"},e.getUseCredentials=function(){return i},e.setUseCredentials=function(e){i=e},e.getManifestApi=function(t){var i=e.getViewingUrl(t);return r?i+"/bubbles/":i+"/"},e.getItemApi=function(t){return e.getViewingUrl(t)+"/items/"},e.getThumbnailApi=function(t){return e.getViewingUrl(t)+"/thumbnails/"},e.makeOssPath=function(t,i,r){return e.getViewingUrl(t)+"/oss/v1/buckets/"+i+"/objects/"+encodeURIComponent(decodeURIComponent(r))}}(),function(){var e=Autodesk.Viewing,t=e.Private,i=e.getGlobal();i.PROTEIN_ROOT=null,i.PRISM_ROOT=null,i.LOCALIZATION_REL_PATH="",i.LMV_VIEWER_VERSION="@build_version@",i.LMV_VIEWER_PATCH="@build_number@",i.LMV_BUILD_TYPE="@build_type@",i.LMV_RESOURCE_VERSION=null,i.LMV_RESOURCE_ROOT="",i.LMV_THIRD_PARTY_COOKIE=void 0,"v"===LMV_VIEWER_VERSION.charAt(0)&&(LMV_VIEWER_VERSION=LMV_VIEWER_VERSION.substr(1)),i.stderr=function(){console.warn('"stderr" is deprecated; please use "Autodesk.Viewing.Private.logger" instead')},t.env=null,t.docItemId=null,t.token={accessToken:null,getAccessToken:null,tokenRefreshInterval:null},t.memoryOptimizedSvfLoading=!1,t.forceMemoryOptimizedModeOnSvfLoading=!1,t.assets=[],t.offline=!1,t.offlineResourcePrefix=null;var r={local:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},n={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},o={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},s={stg:{CLIENT_ID:"lmv-stag",CLIENT_KEY:"kjemi1rwAgsqIqyvDUtc9etPD6MsAzbV",ENDPOINT:"https://ase-stg.autodesk.com"},prod:{CLIENT_ID:"lmv-prod",CLIENT_KEY:"iaoUM2CRGydfn703yfPq4MAogZi8I5u4",ENDPOINT:"https://ase.autodesk.com"}};t.EnvironmentConfigurations={Local:{ROOT:"",LMV:r.local},Development:{ROOT:n.dev,LMV:r.dev,isOldViewingEndpoint:!0},Staging:{ROOT:n.stg,LMV:r.stg,isOldViewingEndpoint:!0},Production:{ROOT:n.prod,LMV:r.prod,isOldViewingEndpoint:!0},AutodeskDevelopment:{ROOT:o.dev,LMV:r.dev},AutodeskStaging:{ROOT:o.stg,LMV:r.stg},AutodeskProduction:{ROOT:o.prod,LMV:r.prod}},t.initializeEnvironmentVariable=function(e){var i;if(e&&e.env&&(i=e.env),i||(i=t.getParameterByName("env")),e&&e.offlineResourcePrefix&&(t.offlineResourcePrefix=e.offlineResourcePrefix),e&&e.offline&&"true"===e.offline&&(t.offline=!0),!i)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":i="Development";break;case"viewing-staging.api.autodesk.com":i="Staging";break;case"viewing.api.autodesk.com":i="Production";break;case"developer-dev.api.autodesk.com":i="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":i="AutodeskStaging";break;case"developer.api.autodesk.com":i="AutodeskProduction";break;case"localhost.autodesk.com":i="Local";break;case"":i="Local";break;case"127.0.0.1":i="Local";break;default:i="AutodeskProduction"}t.ENABLE_TRACE&&("undefined"!=typeof window&&console.log("Host name : "+window.location.hostname),console.log("Environment initialized as : "+i)),t.env=i},t.initializeServiceEndPoints=function(i){var r=i.endpoint,n=i.isOldViewingEndpoint;if(!r){var o=t.EnvironmentConfigurations[t.env];r=o.ROOT,n=o.isOldViewingEndpoint}if(e.setApiEndpoint(r,n),!e.isNodeJS){var s=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"];i&&i.hasOwnProperty("libraryName")&&s.push(i.libraryName);for(var a,l,h=0;s.length>h;h++){var u=t.getScript(s[h]);l=u?u.src:"";var d=l.indexOf(s[h]);if(d>=0){a=l.substr(0,d);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;var c=t.getParameterByNameFromPath("v",l);c&&c.length&&c!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+c+" vs. "+LMV_RESOURCE_VERSION+". Using "+c),LMV_RESOURCE_VERSION=c):c&&c.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT=a||LMV_RESOURCE_ROOT}},t.initLoadContext=function(t){t=t||{},t.auth=e.getUseCredentials(),t.endpoint=e.getApiEndpoint(),t.headers||(t.headers={});for(var i in e.HTTP_REQUEST_HEADERS)t.headers[i]=e.HTTP_REQUEST_HEADERS[i];return t},t.refreshCookie=function(i,r,n){var o=new XMLHttpRequest;if(o.onload=r,o.onerror=n,o.ontimeout=n,0===t.env.indexOf("Autodesk")){var s=t.EnvironmentConfigurations[t.env].ROOT;o.open("POST",s+"/utility/v1/settoken",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.withCredentials=!0,o.send("access-token="+i),e.isIE11&&(t.accessToken=i)}else{var i={oauth:{token:i}};o.open("POST",e.getViewingUrl()+"/token",!0),o.setRequestHeader("Content-Type","application/json"),o.withCredentials=!0,o.send(JSON.stringify(i))}},t.refreshRequestHeader=function(t){e.HTTP_REQUEST_HEADERS.Authorization="Bearer "+t},t.refreshToken=function(e,i,r){function n(){LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,r):(t.refreshRequestHeader(e),i())}t.token.accessToken=e,void 0===LMV_THIRD_PARTY_COOKIE?t.refreshCookie(e,i,r):n()},t.initializeAuth=function(i,r){function n(e,o){a=e,t.refreshToken(a,t.token.tokenRefreshInterval?null:i);var s=o-60;0>=s&&(s=o),t.token.tokenRefreshInterval=1e3*s,setTimeout(function(){r.getAccessToken(n)},t.token.tokenRefreshInterval)}var o=r?r.shouldInitializeAuth:void 0;if(void 0===o){var s=t.getParameterByName("auth");o="false"!==s.toLowerCase()}if("Local"==t.env||!o)return setTimeout(i,0),e.setUseCredentials(r.useCredentials!==void 0?r.useCredentials:!1),e.getUseCredentials();e.isNodeJS&&(LMV_THIRD_PARTY_COOKIE=!1),e.setUseCredentials(r.useCredentials!==void 0?r.useCredentials:!0);var a;return r&&r.getAccessToken?(t.token.getAccessToken=r.getAccessToken,a=r.getAccessToken(n),"string"==typeof a&&a&&t.refreshToken(a,i)):r&&r.accessToken?(a=r.accessToken,t.refreshToken(a,i)):(a=t.getParameterByName("accessToken"),a||(a="9AMaRKBoPCIBy61JmQ8OLLLyRblS",t.logger.warn("Warning : no access token is provided. Use built in token : "+a)),t.refreshToken(a,i)),e.getUseCredentials()},t.initializeLogger=function(i){var r={eventCallback:i?i.eventCallback:void 0};if(t.logger.initialize(r),!(i&&i.hasOwnProperty("useADP")&&0==i.useADP||e.isNodeJS)){var n="https://ase-cdn.autodesk.com/adp/v1.0.3/js/adp-web-analytics-sdk.min.js",o=function(){if("undefined"==typeof Adp)return t.logger.warn("Autodesk Data Platform SDK not found"),void 0;var e;switch(LMV_BUILD_TYPE){case"Production":e=s.prod;break;default:e=s.stg}var i={product:{name:"LMV",line_name:"LMV",key:e.CLIENT_ID,id:e.CLIENT_KEY,id_provider:"appkey",build_id:LMV_VIEWER_VERSION+"."+LMV_VIEWER_PATCH,build_tag:LMV_BUILD_TYPE}},r={server:e.ENDPOINT,enable_geo_data:!1,enable_browser_data:!0,enable_session_messages:!0};t.logger.adp=new Adp(i,r)};"undefined"!=typeof requirejs?requirejs([n],function(e){window.Adp=e,o()}):t.loadDependency("Adp",n,o)}},t.initializeProtein=function(){if((!t.ENABLE_DEBUG||"Local"!=t.env||e.getUseCredentials())&&!t.offline){var i=new XMLHttpRequest;i.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),i.responseType="json",i.onload=function(){var e=i.response.url;e&&e.length&&(e=e.replace("http://","https://"),PROTEIN_ROOT=e+"/",t.logger.info("Protein root is: "+PROTEIN_ROOT))},i.send();var r=new XMLHttpRequest;r.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),r.responseType="json",r.onload=function(){var e=r.response.url;e&&e.length&&(e=e.replace("http://","https://"),PRISM_ROOT=e+"/",t.logger.info("Prism root is: "+PRISM_ROOT))},r.send()}},t.getParameterByName=function(e){return"undefined"==typeof window?"":t.getParameterByNameFromPath(e,window.location.href)},t.getParameterByNameFromPath=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+e+"=([^&#]*)",r=RegExp(i),n=r.exec(t);return null==n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.urlIsApiViewingOrDev=function(e){return-1!==e.indexOf("developer.api.autodesk.com")||-1!==e.indexOf("developer-stg.api.autodesk.com")||-1!==e.indexOf("developer-dev.api.autodesk.com")||-1!==e.indexOf("viewing.api.autodesk.com")||-1!==e.indexOf("viewing-staging.api.autodesk.com")||-1!==e.indexOf("viewing-dev.api.autodesk.com")},t.getDemoDocumentURN=function(){var e;switch(t.env){case"Development":e="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case"Staging":e="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case"Production":e="FIXME";break;default:e="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return e},t.setLanguage=function(e,t){var i={lng:e,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+e+"/",Autodesk.Viewing.i18n.init(i,function(){Autodesk.Viewing.i18n.clearDebugLocString(),t&&t()})},t.initializeLocalization=function(e){var i=e&&e.language||navigator.language,r=i.split("-");i=r.length>1?r[0].toLowerCase()+"-"+r[1].toUpperCase():r[0].toLowerCase();var n=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];-1===n.indexOf(i)&&(i=i.indexOf("zh-CN")>-1?"zh-HANS":i.indexOf("zh-TW")>-1?"zh-HANT":r.length>1&&n.indexOf(r[0])>-1?r[0]:"en"),t.setLanguage(i)},t.initializeUserInfo=function(e){e&&e.userInfo&&(t.setUserName(e.userInfo.name),e.comment2Token&&(t.comment2Token=e.comment2Token))},t.getScript=function(e){e=e.toLowerCase();var t=document.getElementsByTagName("SCRIPT");if(t&&t.length>0)for(var i=0;t.length>i;++i)if(t[i].src&&-1!==t[i].src.toLowerCase().indexOf(e))return t[i];return null},t.getResourceUrl=function(e){var t=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+e+(t?"?v="+t:"")},t.loadDependency=function(e,i,r){if(window[e]===void 0){var n=document.createElement("SCRIPT");n.src=i.indexOf("://")>0?i:t.getResourceUrl(i),document.head.appendChild(n),r&&(n.onload=r)}else r&&r()},Autodesk.Viewing.Initializer=function(i,r){function n(){t.initializeLegacyNamespaces(),THREE.warn=t.logger.warn.bind(t.logger),init_three_dds_loader(),init_three_pvr_loader(),t.initializeAuth(r,i),t.initializeLocalization(i),t.initializeUserInfo(i)}e.isNodeJS?(t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeAuth(r,i)):(t.WEBGL_HELP_LINK=i?i.webGLHelpLink:null,t.initializeEnvironmentVariable(i),t.initializeServiceEndPoints(i),t.initializeLogger(i),t.initializeProtein(),t.initWorkerScript(),t.loadDependency("THREE","three.min.js",function(){t.loadDependency("WGS","wgs.js",n)}))}}(),function(){function e(e,t,r){i.EventEmitter.call(this),this.endpoint=e,this.key=t,this.secret=r,this.currentToken=null,this.timeoutId=void 0}var t=require("https"),i=require("events");e.Event={TOKEN_REFRESH:"tokenRefresh",TOKEN_ERROR:"tokenError"},e.prototype.__proto__=i.EventEmitter.prototype,e.prototype.getTokenString=function(){return this.currentToken.access_token},e.prototype.refreshToken=function(i){var r=this;this.timeoutId&&clearTimeout(this.timeoutId);var n="client_id="+this.key+"&client_secret="+this.secret+"&grant_type=client_credentials",o={"Content-Type":"application/x-www-form-urlencoded"},s={host:this.endpoint,port:443,path:"/authentication/v1/authenticate",method:"POST",headers:o,rejectUnauthorized:!1,requestCert:!0,agent:!1},a=t.request(s,function(t){t.setEncoding("utf8");var n="";t.on("data",function(e){n+=e}),t.on("end",function(){if(200==t.statusCode){var o=JSON.parse(n);r.currentToken=o,console.log("Got a token: "+o.access_token);var s=1e3*(o.expires_in-5);s>0&&(r.timeoutId=setTimeout(function(){r.refreshToken(i)},s)),i&&i(null,o),r.emit(e.Event.TOKEN_REFRESH,o)}else console.log("Token fetch failed.",t.statusCode,n),i&&i(t.statusCode,null),r.emit(e.Event.TOKEN_ERROR,t.statusCode),r.timeoutId=setTimeout(function(){r.refreshToken(i)},5e3)})});a.write(n),a.end()},exports.AdskAuth=e}(),function(){function e(e){try{return JSON.parse(e)}catch(t){return e}}function t(e,t){var i=c.createHash("sha1"),r=a.ReadStream(e);r.on("data",function(e){i.update(e)}),r.on("end",function(){t(null,i.digest("hex"))}),r.on("error",function(e){t(e)})}function i(e,t,i){g={host:e,getTokenString:t,route:i||f}}function r(e,t){return{host:g.host,port:"443",method:e,path:g.route+(t?"/"+t:""),headers:{authorization:"Bearer "+g.getTokenString()}}}function n(t,i){t.setEncoding("utf8"),t.pipe(u(function(r){var n=e(r);if(200==t.statusCode)i(null,n);else{var o={statusCode:t.statusCode,statusMessage:t.statusMessage,error:n};i(o)}}))}function o(e,t,i){e.headers.accept="application/json",t&&(e.headers["content-type"]="application/json");var r=s.request(e,function(e){n(e,i)});r.on("error",i),t&&r.write(JSON.stringify(t)),r.end()}var s=require("https"),a=require("fs"),l=require("zlib"),h=require("temp"),u=require("concat-stream"),d=require("path"),c=require("crypto"),p=require("mkdirp"),f="/oss/v2/buckets",g=void 0;i.prototype.setupRequest=r,i.prototype.createBucket=function(e,t,i){var n={bucketKey:e,allow:[],policyKey:t||"persistent"};console.log("oss: create bucket: %s",JSON.stringify(n));var s=r("POST","");o(s,n,i)},i.prototype.deleteBucket=function(e,t){console.log("oss: delete bucket: %s",e);var i=r("DELETE",e);o(i,null,t)},i.prototype.listBuckets=function(e){console.log("oss: list buckets");var t=r("GET","");o(t,null,e)},i.prototype.listObjects=function(e,t,i){console.log("oss: listing objects in %s",e);var n=[],s=function(a){var l="limit=100";t&&(l+="&beginsWith="+encodeURIComponent(t)),a&&(l+="&startAt="+encodeURIComponent(a));var h=r("GET",e+"/objects?"+l);o(h,null,function(e,t){t?(n=n.concat(t.items),t.next?s(t.items.pop().objectKey):i(null,n)):i(e)})};s()},i.prototype.getBucketDetails=function(e,t){console.log("oss: get bucket details: %s",e);var i=r("GET",e+"/details");o(i,null,t)},i.prototype.uploadData=function(e,t,i,o,a){console.log("oss: upload data to: %s/%s [%s bytes]",e,t,i.length);var l=r("PUT",e+"/objects/"+encodeURIComponent(t));l.headers.accept="application/json",l.headers["content-type"]=o||"application/stream",l.headers["content-length"]=i.length;var h=s.request(l,function(e){n(e,a)});h.on("error",a),h.write(i),h.end()},i.prototype.uploadFile=function(e,t,i,o){i=i||d.basename(t);var l;try{l=a.createReadStream(t)}catch(u){return o(u),void 0}var c=h.path(),p=function(e,t){a.unlink(c),o&&o(e,t)};l.pipe(a.createWriteStream(c)).on("finish",function(){a.stat(c,function(o,l){if(o)return p(o),void 0;console.log('oss: upload file to: %s/%s, from: "%s" [%s bytes]',e,i,t,l.size);var h=r("PUT",e+"/objects/"+encodeURIComponent(i));h.headers.accept="application/json",h.headers["content-type"]="application/stream",h.headers["content-length"]=l.size;var u=s.request(h,function(e){n(e,p)});u.on("error",p),a.createReadStream(c).pipe(u).on("finish",function(){u.end()})})})},i.prototype.updateFile=function(e,i,r,n){r=r||d.basename(i);var o=this;this.getObjectDetails(e,r,function(s,a){return s?(o.uploadFile(e,i,r,n),void 0):(t(i,function(t,s){return t?(n(t),void 0):(s!==a.sha1?(console.log("oss: file exits, but SHA1 differs: %s/%s, %s (local file) vs. %s (oss)",e,r,s,a.sha1),o.uploadFile(e,i,r,n)):(console.log("oss: file with same key and hash already exists, skipping upload: %s/%s: %s",e,r,s),n(null,a)),void 0)}),void 0)})},i.prototype.downloadStream=function(e,t,i,n){console.log("oss: download data from: %s/%s",e,t);
var o=r("GET",e+"/objects/"+encodeURIComponent(t));o.headers["accept-encoding"]="gzip";var a=s.request(o,function(e){if(200!==e.statusCode)return n(e.statusCode),void 0;var t=e;"gzip"===e.headers["content-encoding"]&&(t=t.pipe(l.createGunzip())),t.pipe(i).on("finish",function(){n(null,e.statusCode)})});a.on("error",n),a.end()},i.prototype.downloadFile=function(e,t,i,r){i=i||t,console.log('oss: download file from: %s/%s as: "%s"',e,t,i);try{p.sync(d.dirname(i));var n=a.createWriteStream(i);this.downloadStream(e,t,n,function(e,t){n.close(),r(e,t)})}catch(o){r(o)}},i.prototype.getObjectDetails=function(e,t,i){console.log("oss: get details for: %s/%s",e,t);var n=r("GET",e+"/objects/"+encodeURIComponent(t)+"/details");o(n,null,i)},i.prototype.signObject=function(e,t,i,n,s){console.log("Signing "+t);var a={minutesExpiration:i||60},l=r("POST",e+"/objects/"+encodeURIComponent(t)+"/signed?access="+(n||"read"));l.headers["content-type"]="application/json",o(l,a,s)},i.prototype.deleteObject=function(e,t,i){console.log("oss: delete object: %s/%s",e,t);var n=r("DELETE",e+"/objects/"+encodeURIComponent(t));o(n,null,i)},i.prototype.grantAccess=function(e,t,i,n){i=i||"read",console.log("oss: grant %s access to %s to %s.",i,e,t);var s=r("POST",e+"/grant");s.headers["content-type"]="application/json";var a={allow:[{authId:t,access:i}]};o(s,a,n)},exports.Oss=i}(),function(){function e(e,t){var i={host:o,port:"443",method:e,path:g+(t||""),headers:{}};return s&&(i.headers.Authorization="Bearer "+s.getTokenString()),"GET"===e&&(i.headers["Accept-Encoding"]="gzip, deflate"),i}function t(e,t){var i=e;return t||"gzip"!=e.headers["content-encoding"]||(i=e.pipe(u.createGunzip())),i}function i(e,i){var r=t(e);r.setEncoding("utf8"),r.pipe(h(function(e){var t;try{t=JSON.parse(e)}catch(r){console.log(e,r)}i(t)}))}function r(e,t,i){if(o=e,s=t,i)a=i;else{var r=exports.Oss||require("../oss/oss").Oss;a=new r(o,function(){return s.getTokenString()})}}function n(e,t){e=decodeURIComponent(e);var i=e.slice(0,e.lastIndexOf("/")+1),r=i.slice(i.indexOf("/")+1);i.slice(0,i.indexOf("/"));var n="";t.urn=e,t.basePath=i,t.localPath=n+r,t.rootFileName=e.slice(e.lastIndexOf("/")+1)}var o,s,a,l=require("https"),h=require("concat-stream"),u=require("zlib"),d=require("node-zip"),c=require("path"),p=require("mkdirp"),f=require("fs"),g="/derivativeservice/v2/",m=function(e){return new Buffer(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},v=function(e){for(e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";return""+new Buffer(e,"base64")},y=function(e){var t;if(e)try{p.sync(c.dirname(e)),t=f.createWriteStream(e)}catch(i){}return t};r.prototype.register=function(t,r,n,o,s){var a=!1;if(t)a=r&&r.designDescription;else if("string"==typeof r)t=r;else{if(!r||!r.designDescription)return s("Design URN not specified.",null),void 0;a=!0}var h,u={thumbnail:{},"2dviewing":{},"3dviewing":{}};h=a?{design:m(t),designDescription:r,registerType:u,channel:o||void 0}:{design:m(t),from:m(r),registerType:u,channel:o||void 0};var d=JSON.stringify(h);console.log(d);var c=e("POST","registration");c.headers["Content-Type"]="application/json; charset=utf-8",c.headers["Content-Length"]=Buffer.byteLength(d,"utf8"),n&&(c.headers["x-ads-force"]="true");var p=l.request(c,function(e){i(e,function(t){(200==e.statusCode||201==e.statusCode&&!n)&&(s?s(null,t):(console.log("Bad request: ",e.statusCode,JSON.stringify(h)),s&&s(t)))})});p.on("error",function(e){s(e,null)}),p.write(d),p.end()},r.prototype.getManifest=function(t,r,n,o){var s=0===t.indexOf("urn:")?m(t):t,a="manifest/"+s;r&&(a+="/"+r),n&&(a+="?guid="+n);var h=e("GET",a,!0),u=l.request(h,function(e){if(200==e.statusCode)i(e,function(e){e.urn=s,o(null,e)});else{var t=e.headers["x-ads-troubleshooting"];o(e.statusCode+(t?": "+t:""))}});u.on("error",function(e){o(e,null)}),u.end()},r.prototype.unregister=function(t,r){var n=0===t.indexOf("urn:")?m(t):t,o="registration/"+n,s=e("DELETE",o),a=l.request(s,function(e){i(e,function(t){200==e.statusCode?r(null,t):r(t?t:e.statusCode)})});a.on("error",function(e){r(e,null)}),a.end()},r.prototype.getItem=function(i,r,n){var o="derivatives/"+encodeURIComponent(i),s=e("GET",o),a=l.request(s,function(e){if(200!==e.statusCode)return n(e.statusCode),void 0;var i=y(r),o=t(e,!0);i&&200==e.statusCode?o.pipe(i).on("finish",function(){n(null,e.statusCode)}).on("error",n):r||200!==e.statusCode?o.pipe(h(function(t){n(e.statusCode+" : "+t.toString("utf8"))})):o.pipe(h(function(e){n(null,e)}))});a.on("error",function(e){n(e,null)}),a.end()},r.prototype.getThumbnail=function(i,r,n,o){var s=400,a="thumbnails/"+(0===i.indexOf("urn:")?m(i):i)+"?guid="+encodeURIComponent(r)+"&role=rendered"+"&width="+s+"&height="+s,u=e("GET",a),d=l.request(u,function(e){var i=y(n),r=t(e);i&&200==e.statusCode?r.pipe(i).on("finish",function(){o(null,e.statusCode)}).on("error",o):n||200!==e.statusCode?r.pipe(h(function(t){o(e.statusCode+" : "+t.toString("utf8"))})):r.pipe(h(function(e){o(null,e)}))});d.on("error",function(e){o(e,null)}),d.end()},r.prototype.getSupportedFormats=function(t){var r=e("GET","supported"),n=l.request(r,function(e){i(e,function(i){200==e.statusCode?t(null,i):t(i)})});n.on("error",function(e){t(e,null)}),n.end()},r.prototype.getChannelMapping=function(t){var r=e("GET","configuration/channel-mapping"),n=l.request(r,function(e){i(e,function(i){200==e.statusCode?t(null,i):t(i)})});n.on("error",function(e){t(e,null)}),n.end()},r.prototype.getDesignDescription=function(t,r){var n="designdescription/"+m(t),o=e("GET",n),s=l.request(o,function(e){i(e,function(t){200==e.statusCode?r(null,t):r(t)})});s.on("error",function(e){r(e,null)}),s.end()},r.prototype.listAllDerivativeFiles=function(e,t){var i=this,r=[];if(function o(t){if("Autodesk.CloudPlatform.PropertyDatabase"===t.role||"Autodesk.CloudPlatform.DesignDescription"===t.role||"Autodesk.CloudPlatform.IndexableContent"===t.role||"graphics"===t.role||"raas"===t.role||"pdf"===t.role||"leaflet-zip"===t.role||"preview"===t.role||"lod"===t.role){var i={mime:t.mime};n(t.urn,i),t.urn="$file$/"+i.localPath+i.rootFileName,r.push(i)}if("geometry"===t.type){if("true"===t.hasThumbnail){var i={mime:"thumbnail",urn:e.urn,guid:t.guid};i.localPath="thumbnails/",t.thumbnailUrn="$file$/thumbnails/"+i.guid+".png",r.push(i)}if(t.intermediateFile&&t.children){for(var s,a=0;t.children.length>a;a++)if("application/autodesk-f2d"===t.children[a].mime){s=t.children[a];break}if(s){var l=s.urn,h=l.indexOf(e.urn),u=l.substr(0,h+e.urn.length),i={mime:"application/octet-stream",urn:e.urn,guid:t.guid},d="/"+t.intermediateFile;0===u.indexOf("urn:adsk.objects")&&(d=encodeURIComponent(d));var c=u+d;n(c,i),r.push(i)}}}t.children&&t.children.forEach(function(e){o(e)})}(e,""),console.log("Manifests to process: ",r.length),0===r.length)return t(null,{list:[],totalSize:0}),void 0;for(var s=0,a=0,l=0,h={},c=function(){function e(){if(a++,console.log("Manifests done ",a),a===r.length){var e={list:r,totalSize:l};t(null,e)}else setTimeout(c,0)}if(!(s>=r.length)){var n,o=r[s++],p=o.files=[];if("thumbnail"!==o.mime&&(n=o.basePath),"application/autodesk-db"===o.mime)p.push("objects_attrs.json.gz"),p.push("objects_vals.json.gz"),p.push("objects_avs.json.gz"),p.push("objects_offs.json.gz"),p.push("objects_ids.json.gz"),e();else if("thumbnail"===o.mime)o.files.push(o.guid+".png"),e();else if("application/autodesk-svf"===o.mime){var f=o.urn.slice(n.length);p.push(f),function(){var t=o;i.getItem(o.urn,null,function(i,r){if(r){var n;try{var s=new d(r,{base64:!1,checkCRC32:!0});r=s.files["manifest.json"].asNodeBuffer(),n=JSON.parse(r.toString("utf8"))}catch(a){console.log(a.message)}if(n&&n.assets)for(var u=0;n.assets.length>u;u++){var c=n.assets[u];0!==c.URI.indexOf("embed:/")&&(0!==c.URI.indexOf("../")?(l+=c.size,t.files.push(c.URI)):h[o.basePath]||(l+=c.size/4))}h[o.basePath]=1}e()})}()}else if("application/autodesk-f2d"===o.mime){p.push("manifest.json.gz");var g=n+"manifest.json.gz";(function(){var t=o;i.getItem(g,null,function(i,r){if(r){l+=r.length;var n;try{31===r[0]&&139===r[1]&&(r=u.gunzipSync(r)),n=JSON.parse(r.toString("utf8"))}catch(o){console.log(o.message)}if(n&&n.assets)for(var s=0;n.assets.length>s;s++){var a=n.assets[s];0!==a.URI.indexOf("../")&&(l+=a.size,t.files.push(a.URI))}}e()})})()}else p.push(o.rootFileName),e()}},p=0;6>p;p++)c()},r.prototype.downloadAllDerivativeFiles=function(e,t,i){for(var r=this,n=0,o=0,s=[],a=0;e.length>a;a++)for(var l=e[a],h=0;l.files.length>h;h++){var u={basePath:l.basePath,localPath:t+l.localPath,fileName:l.files[h]};l.urn&&(u.urn=l.urn,u.guid=l.guid,u.mime=l.mime),s.push(u)}if(0===s.length)return i(o,n),void 0;for(var d=0,c=0,p=function(){if(!(d>=s.length)){var e=s[d++],t=function(t){c++,t?(o++,console.log("Failed to download file.",e.localPath+e.fileName,t)):(n++,console.log("Downloaded",e.localPath+e.fileName)),console.log("Progress:",0|100*(o+n)/s.length,"%"),c===s.length?i(o,n):setTimeout(p,0)};e.mime&&"thumbnail"===e.mime?r.getThumbnail(e.urn,e.guid,e.localPath+e.fileName,t):r.getItem(e.basePath+e.fileName,e.localPath+e.fileName,t)}},f=0;10>f;f++)p()},r.encodeUrn=m,r.decodeUrn=v,exports.Ds=r}(),function(){"use strict";function e(e){return"application/autodesk-db"==e.mime&&e.urn?0===e.urn.indexOf("urn:adsk.objects:os.object")?e.urn.substr(0,e.urn.lastIndexOf("%2F")+3):e.urn.substr(0,e.urn.lastIndexOf("/")+1):null}function t(r,n){if(this.parent=n,this.id=i++,this.data=r,this.isLeaf="geometry"===r.type&&("3d"===r.role||"2d"===r.role||"lod"===r.role),Array.isArray(r.children)){this.children=[];for(var o=r.children.length,s=0;o>s;s++)this.children[s]=new t(r.children[s],this);for(var s=0;o>s;s++){var a=e(r.children[s]);a&&(this.sharedPropertyDbPath=a),"lod"===r.children[s].role&&(this.lodNode=this.children[s])}}}var i=1;t.prototype.getRootNode=function(){return this.parent?this.parent.getRootNode():this},t.prototype.findPropertyDbPath=function(){return this.sharedPropertyDbPath?this.sharedPropertyDbPath:this.parent?this.parent.findPropertyDbPath():null},t.prototype._raw=function(){return this.data},t.prototype.name=function(){return this.data.name},t.prototype.guid=function(){return this.data.guid},t.prototype.urn=function(e){var t=this.data.urn;if(!e)return t;for(var i=this.parent;!t&&i;)t=i.data.urn,i=i.parent;return t},t.prototype.getTag=function(e){return(this.data.tags?this.data.tags:this.data)[e]},t.prototype.setTag=function(e,t){this.data.tags?this.data.tags[e]=t:this.data[e]=t},t.prototype.isGeomLeaf=function(){return this.isLeaf},t.prototype.isViewable=function(){return"viewable"===this.data.role},t.prototype.getLodNode=function(){return this.lodNode},t.prototype.isGeometry=function(){return"geometry"===this.data.type},t.prototype.is2D=function(){return"2d"===this.data.role},t.prototype.is3D=function(){return"3d"===this.data.role},t.prototype.is2DGeom=function(){return this.isGeometry()&&this.is2D()},t.prototype.is3DGeom=function(){return this.isGeometry()&&this.is3D()},t.prototype.getPlacementTransform=function(){return this.data.placement},t.prototype.isMetadata=function(){if(this.data.role){if(-1!==this.data.role.indexOf("Autodesk.CloudPlatform.DesignDescription"))return!0;if("Autodesk.CloudPlatform.PropertyDatabase"===this.data.role)return!0}return!1},t.prototype.findViewableParent=function(){for(var e=this;e&&!e.isViewable();)e=e.parent;return e},t.prototype.findParentGeom2Dor3D=function(){for(var e=this;e&&!e.is2DGeom()&&!e.is3DGeom();)e=e.parent;return e},t.prototype.getViewableRootPath=function(){if(!this.isGeomLeaf())return null;var e=this.is2D()?"application/autodesk-f2d":"application/autodesk-svf",t=this.search({mime:e});if(t&&t.length){var i=t[0].data.urn;return i}return null},t.prototype.findByGuid=function(e){var t=null;return this.traverse(function(i){return i.data.guid===e?(t=i,!0):void 0}),t},t.prototype.search=function(e){var t=[];return this.traverse(function(i){var r=!0;for(var n in e)if(!i.data.hasOwnProperty(n)||i.data[n]!==e[n]){r=!1;break}r&&t.push(i)}),t.length?t:null},t.prototype.searchByTag=function(e){var t=[];return this.traverse(function(i){var r=!0;for(var n in e)if(i.getTag(n)!==e[n]){r=!1;break}r&&t.push(i)}),t.length?t:null},t.prototype.traverse=function(e){if(e(this))return!0;if(this.children)for(var t=0;this.children.length>t;t++)if(this.children[t].traverse(e))return!0;return!1},t.prototype.getLevel=function(){var e=this.getTag("level");return Array.isArray(e)?e[0]:e},t.MODEL_NODE={role:"3d",type:"geometry"},t.GEOMETRY_SVF_NODE={role:"graphics",mime:"application/autodesk-svf"},t.SHEET_NODE={role:"2d",type:"geometry"},t.GEOMETRY_F2D_NODE={role:"graphics",mime:"application/autodesk-f2d"},t.VIEWABLE_NODE={role:"viewable"},Autodesk.Viewing.BubbleNode=t}(),exports.THREE=THREE,exports.WGS=WGS;