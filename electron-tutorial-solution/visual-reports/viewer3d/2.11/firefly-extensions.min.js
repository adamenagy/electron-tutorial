function init_WarpShader(){"undefined"==typeof window.WarpShader&&(WarpShader={uniforms:{tDiffuse:{type:"t",value:null},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,.22,.24,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(.996,-.004,1.014,0)}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 scale;","uniform vec2 scaleIn;","uniform vec2 lensCenter;","uniform vec4 hmdWarpParam;","uniform vec4 chromAbParam;","varying vec2 vUv;","vec4 sampleColor() {","vec2 uv = (vUv*2.0)-1.0;","vec2 theta = (uv-lensCenter)*scaleIn;","float rSq = theta.x*theta.x + theta.y*theta.y;","vec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);","  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);","  vec2 tcBlue = (lensCenter + scale * rBlue);","  tcBlue = (tcBlue+1.0)/2.0;","  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue)))","    return vec4(0.0, 0.0, 0.0, 1.0);","  vec2 tcGreen = lensCenter + scale * rvector;","  tcGreen = (tcGreen+1.0)/2.0;","  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);","  vec2 tcRed = lensCenter + scale * rRed;","  tcRed = (tcRed+1.0)/2.0;","  return vec4(texture2D(tDiffuse, tcRed).r, texture2D(tDiffuse, tcGreen).g, texture2D(tDiffuse, tcBlue).b, 1);","}","void main() {","vec4 texel = sampleColor();","gl_FragColor = texel;","}"].join("\n")})}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1),this.plane=c,this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b),this.plane.constant=b})}function init_TransformGizmos(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=h(a)/2/Math.PI+.5,d=i(a)/Math.PI+.5;return b.uv=new THREE.Vector2(c,1-d),b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d),t.copy(a).add(b).add(c).divideScalar(3);var e=h(t);k.faceVertexUvs[0].push([j(a.uv,a,e),j(b.uv,b,e),j(c.uv,c,e)])}function g(a,b){for(var c=Math.pow(2,b),d=(Math.pow(4,b),e(k.vertices[a.a])),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),i=[],j=0;j<=c;j++){i[j]=[];for(var l=e(d.clone().lerp(h,j/c)),m=e(g.clone().lerp(h,j/c)),n=c-j,o=0;o<=n;o++)0==o&&j==c?i[j][o]=l:i[j][o]=e(l.clone().lerp(m,o/n))}for(var j=0;j<c;j++)for(var o=0;o<2*(c-j)-1;o++){var p=Math.floor(o/2);o%2==0?f(i[j][p+1],i[j+1][p],i[j][p]):f(i[j][p+1],i[j+1][p+1],i[j+1][p])}}function h(a){return Math.atan2(a.z,-a.x)}function i(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function j(a,b,c){return c<0&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:d},c=c||1,d=d||0;for(var k=this,l=0,m=a.length;l<m;l+=3)e(new THREE.Vector3(a[l],a[l+1],a[l+2]));for(var n=this.vertices,o=[],l=0,p=0,m=b.length;l<m;l+=3,p++){var q=n[b[l]],r=n[b[l+1]],s=n[b[l+2]];o[p]=new THREE.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var t=new THREE.Vector3,l=0,m=o.length;l<m;l++)g(o[l],d);for(var l=0,m=this.faceVertexUvs[0].length;l<m;l++){var u=this.faceVertexUvs[0][l],v=u[0].x,w=u[1].x,x=u[2].x,y=Math.max(v,Math.max(w,x)),z=Math.min(v,Math.min(w,x));y>.9&&z<.1&&(v<.2&&(u[0].x+=1),w<.2&&(u[1].x+=1),x<.2&&(u[2].x+=1))}for(var l=0,m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,c,d,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||100,b=b||40,c=c||8,d=d||6,e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],i=0;i<=c;i++)for(var j=0;j<=d;j++){var k=j/d*e,l=i/c*Math.PI*2;f.x=a*Math.cos(k),f.y=a*Math.sin(k);var m=new THREE.Vector3;m.x=(a+b*Math.cos(l))*Math.cos(k),m.y=(a+b*Math.cos(l))*Math.sin(k),m.z=b*Math.sin(l),this.vertices.push(m),g.push(new THREE.Vector2(j/d,i/c)),h.push(m.clone().sub(f).normalize())}for(var i=1;i<=c;i++)for(var j=1;j<=d;j++){var n=(d+1)*i+j-1,o=(d+1)*(i-1)+j-1,p=(d+1)*(i-1)+j,q=(d+1)*i+j,r=new THREE.Face3(n,o,q,[h[n].clone(),h[o].clone(),h[q].clone()]);this.faces.push(r),this.faceVertexUvs[0].push([g[n].clone(),g[o].clone(),g[q].clone()]),r=new THREE.Face3(o,p,q,[h[o].clone(),h[p].clone(),h[q].clone()]),this.faces.push(r),this.faceVertexUvs[0].push([g[o].clone(),g[p].clone(),g[q].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var d=new THREE.Geometry;c=c?c:1;for(var e=0;e<=64*c;++e)"x"==b&&d.vertices.push(new THREE.Vector3(0,Math.cos(e/32*Math.PI),Math.sin(e/32*Math.PI)).multiplyScalar(a)),"y"==b&&d.vertices.push(new THREE.Vector3(Math.cos(e/32*Math.PI),0,Math.sin(e/32*Math.PI)).multiplyScalar(a)),"z"==b&&d.vertices.push(new THREE.Vector3(Math.sin(e/32*Math.PI),Math.cos(e/32*Math.PI),0).multiplyScalar(a));return d},d=function(a,b,c,d,e,f){var g=new THREE.Geometry,h=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,d,e,f));return h.position.y=.5,h.updateMatrix(),g.merge(h.geometry,h.matrix),g},e=function(a){var b=new THREE.Geometry;return"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),b};THREE.TransformGizmo=function(){var a=this,b=!1,c=!1;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;var c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d],c[d].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry)),b.merge(a.geometry,a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(a){a.visible=!1})},this.show=function(){this.traverse(function(c){c.visible=!0,c.parent!=a.pickers&&c.parent!=a.hemiPicker||(c.visible=b),c.parent==a.planes&&(c.visible=!1)}),this.activePlane.visible=c},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})},this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2],h=a[c][d][3];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),h&&(e.visble=h),b.add(e)}};this.setHandlePickerGizmos(),a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),a(this.highlightGizmos,this.highlights),a(this.hemiPickerGizmos,this.hemiPicker),a(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){f.name&&(f.name.search("E")!=-1?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):f.name.search("X")==-1&&f.name.search("Y")==-1&&f.name.search("Z")==-1||f.quaternion.setFromEuler(a))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(0,.05,.2,12,1,!1),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(g,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new a({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE),"RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=d(0,.05,.2,12,1,!1),c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));var e=.15;this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*e*Math.PI),new a({color:16711680})),[0,0,0],[e*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*e*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,(.5-e)*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*e*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[e*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*e*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,(.5-e)*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new a({color:255})),null,null,!1]]}},this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})}},this.show=function(){this.traverse(function(a){(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)&&(a.visible=!0),a.material&&(a.material.opacity=a.material.oldOpacity),a.parent!=b.pickers&&a.parent!=b.hemiPicker&&a.parent!=b.subPickers||(a.visible=!1),a.parent!=b.planes&&a.parent!=b.highlights||(a.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(c){c.material&&c.material.highlight&&(c.name==a?(c.parent!=b.highlights&&c.parent!=b.handles||(c.visible=!0),c.material.highlight(!0)):(c.material.highlight(!1),c.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(.125,.125,.125),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(a,b,c){function d(c,d){var e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width*2-1,g=2*-((c.clientY-e.top)/e.height)+1;a.isPerspective?(t.set(f,g,.5),t.unproject(a),s.set(a.position,t.sub(a.position).normalize())):(t.set(f,g,-1),t.unproject(a),u.set(0,0,-1),s.set(t,u.transformDirection(a.matrixWorld)));var h=s.intersectObjects(d,!0);return!!h[0]&&h[0]}switch(THREE.Object3D.call(this),b=void 0!==b?b:document,this.gizmo={},c){case"translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[c]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[c]),this.gizmo[c].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===c){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var f=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});e.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(e,f);var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var e=new THREE.CircleGeometry(.1,32),f=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:g});this.centerMark=new THREE.Mesh(e,f),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var f=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:g}),h=.12,i=.25,j=1.15;this.ticks.RX=new THREE.Object3D;var e=new THREE.PlaneBufferGeometry(h,i),k=new THREE.Mesh(e,f);k.position.set(0,0,-j-i/2),k.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,j+i/2,0),k.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,0,j+i/2),k.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,-j-i/2,0),k.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(k),this.ticks.RY=new THREE.Object3D,k=k.clone(),k.position.set(0,0,-j-i/2),k.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(k),k=k.clone(),k.position.set(-j-i/2,0,0),k.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(k),k=k.clone(),k.position.set(0,0,j+i/2),k.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(k),k=k.clone(),k.position.set(j+i/2,0,0),k.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(k)}var l=this,m=!1,n=c,o={type:"change"},p={type:"mouseDown"},q={type:"mouseUp",mode:n},r={type:"objectChange"},s=new THREE.Raycaster,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,z=1,A=new THREE.Matrix4,B=new THREE.Vector3,C=new THREE.Matrix4,D=new THREE.Vector3,E=new THREE.Quaternion,F=new THREE.Vector3,G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Quaternion,J=new THREE.Quaternion,K=new THREE.Quaternion,L=new THREE.Quaternion,M=new THREE.Quaternion,N=new THREE.Vector3,O=new THREE.Vector3,P=new THREE.Matrix4,Q=new THREE.Matrix4,R=new THREE.Vector3,S=new THREE.Vector3,T=new THREE.Euler,U=new THREE.Matrix4,V=new THREE.Vector3;new THREE.Euler;this.attach=function(a){l.object=a,this.gizmo[n].show(),l.update(),l.updateUnitVectors()},this.detach=function(a){l.object=void 0,this.axis=null,this.gizmo[n].hide()},this.setMode=function(a){n=a?a:n,"scale"==n&&(l.space="local"),this.gizmo[n].show(),this.update(),l.dispatchEvent(o)},this.getPicker=function(){return l.gizmo[n].hemiPicker.children},this.setPosition=function(a){this.object.position.copy(a),this.update()},this.setNormal=function(a){E.setFromUnitVectors(this.normal,a),this.unitX.applyQuaternion(E),this.unitY.applyQuaternion(E),this.unitZ.applyQuaternion(E),this.normal.copy(a),this.object&&this.object.quaternion.multiply(E),this.update()},this.setSnap=function(a,b){l.snap=a,l.snapDelta=b},this.setSize=function(a){l.size=a,this.update(),l.dispatchEvent(o)},this.setSpace=function(a){l.space=a,this.update(),l.dispatchEvent(o)},this.update=function(c){if(void 0!==l.object){l.object.updateMatrixWorld(),S.setFromMatrixPosition(l.object.matrixWorld),T.setFromRotationMatrix(C.extractRotation(l.object.matrixWorld)),a.updateMatrixWorld(),V.setFromMatrixPosition(a.matrixWorld),this.position.copy(S),this.quaternion.setFromEuler(T),this.normal.set(0,0,1),this.normal.applyEuler(T);var d=S.distanceTo(V),e=a.isPerspective?2*Math.tan(a.fov*Math.PI/360)*d:d,f=b.getBoundingClientRect();z=100*e/f.height,this.scale.set(z,z,z),c&&this.gizmo[n].highlight(l.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(T),this.unitY.applyEuler(T),this.unitZ.applyEuler(T)},this.showRotationGizmos=function(a){for(var b=this.gizmo[n].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0,d.name.search("R")!==-1&&(d.visible=a)}this.useAllPickers=a},this.highlight=function(){this.gizmo[n].highlight(this.axis||"Z")},this.onPointerHover=function(a){if(void 0===l.object||m===!0)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children),e=null,f="";return c&&(e=c.object.name,f=e.search("R")!=-1?"rotate":"translate"),l.axis!==e&&(l.axis=e,l.gizmo[n].activeMode=f,l.update(!0),l.dispatchEvent(o)),null===l.axis&&l.gizmo[n].show(),!!c},this.onPointerDown=function(b){if(void 0===l.object||m===!0)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){var e=d(c,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children),f=null,g="";e&&(f=e.object.name,g=f.search("R")!=-1?"rotate":"translate"),l.axis!==f&&(l.axis=f,l.gizmo[n].activeMode=g)}var e=null;if((0===c.button||void 0===c.button)&&(e=d(c,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children))){l.dispatchEvent(p),l.axis=e.object.name,l.update(),B.copy(a.position).sub(S).normalize(),l.gizmo[n].setActivePlane(l.axis,B);var h=d(c,[l.gizmo[n].activePlane]);if(h&&w.copy(h.point),N.copy(l.object.position),O.copy(l.object.scale),P.extractRotation(l.object.matrix),U.extractRotation(l.object.matrixWorld),l.object.parent?(Q.extractRotation(l.object.parent.matrixWorld),R.setFromMatrixScale(C.getInverse(l.object.parent.matrixWorld))):(Q.extractRotation(l.object.matrixWorld),R.setFromMatrixScale(C.getInverse(l.object.matrixWorld))),"transrotate"===n&&"rotate"===l.gizmo[n].activeMode){l.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(l.matrixWorld),l.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(l.matrixWorld),l.startLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.startLine);var i=l.object.geometry.getAttribute("position"),j=(new THREE.Vector3).fromAttribute(i,0).applyMatrix4(l.object.matrixWorld),k=(new THREE.Vector3).fromAttribute(i,1).applyMatrix4(l.object.matrixWorld),o=(new THREE.Vector3).fromAttribute(i,2).applyMatrix4(l.object.matrixWorld),q=(new THREE.Vector3).fromAttribute(i,3).applyMatrix4(l.object.matrixWorld);if("RX"===l.axis){j.lerp(o,.5),k.lerp(q,.5);var r=j.distanceTo(k);l.centerLine.material.dashSize=r/15,l.centerLine.material.gapSize=r/30,l.centerLine.geometry.vertices[0].copy(j),l.centerLine.geometry.vertices[1].copy(k)}else{j.lerp(k,.5),o.lerp(q,.5);var r=j.distanceTo(o);l.centerLine.material.dashSize=r/15,l.centerLine.material.gapSize=r/30,l.centerLine.geometry.vertices[0].copy(j),l.centerLine.geometry.vertices[1].copy(o)}l.centerLine.geometry.computeLineDistances(),l.centerLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.centerLine),l.ticks[l.axis].position.copy(l.position),l.ticks[l.axis].quaternion.copy(l.quaternion),l.ticks[l.axis].scale.copy(l.scale),l.parent.add(l.ticks[l.axis])}}return m=!0,!!e},this.onPointerMove=function(a){if(void 0===l.object||null===l.axis||m===!1)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,[l.gizmo[n].activePlane]);c&&v.copy(c.point);var e=l.gizmo[n].activeMode;if("translate"==e)v.sub(w),v.multiply(R),"local"==l.space&&(v.applyMatrix4(C.getInverse(U)),F.copy(this.unitX),G.copy(this.unitY),H.copy(this.unitZ),D.set(0,0,0),l.axis.search("X")!=-1&&(F.multiplyScalar(v.dot(this.unitX)),D.add(F)),l.axis.search("Y")!=-1&&(G.multiplyScalar(v.dot(this.unitY)),D.add(G)),l.axis.search("Z")!=-1&&(H.multiplyScalar(v.dot(this.unitZ)),D.add(H)),v.copy(D),v.applyMatrix4(P),l.object.position.copy(N),l.object.position.add(v)),"world"!=l.space&&l.axis.search("XYZ")==-1||(F.copy(this.unitX),G.copy(this.unitY),H.copy(this.unitZ),D.set(0,0,0),l.axis.search("X")!=-1&&(F.multiplyScalar(v.dot(this.unitX)),D.add(F)),l.axis.search("Y")!=-1&&(G.multiplyScalar(v.dot(this.unitY)),D.add(G)),l.axis.search("Z")!=-1&&(H.multiplyScalar(v.dot(this.unitZ)),D.add(H)),v.copy(D),v.applyMatrix4(C.getInverse(Q)),l.object.position.copy(N),l.object.position.add(v));else if("scale"==e)v.sub(w),v.multiply(R),"local"==l.space&&("XYZ"==l.axis?(z=1+v.y/50,l.object.scale.x=O.x*z,l.object.scale.y=O.y*z,l.object.scale.z=O.z*z):(v.applyMatrix4(C.getInverse(U)),"X"==l.axis&&(l.object.scale.x=O.x*(1+v.x/50)),"Y"==l.axis&&(l.object.scale.y=O.y*(1+v.y/50)),"Z"==l.axis&&(l.object.scale.z=O.z*(1+v.z/50))));else if("rotate"==e){if(v.sub(S),v.multiply(R),D.copy(w).sub(S),D.multiply(R),"RE"==l.axis){v.applyMatrix4(C.getInverse(A)),D.applyMatrix4(C.getInverse(A)),x.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),y.set(Math.atan2(D.z,D.y),Math.atan2(D.x,D.z),Math.atan2(D.y,D.x)),E.setFromRotationMatrix(C.getInverse(Q));var f=x.z-y.z;if(null!==l.snap){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}M.setFromAxisAngle(B,f),I.setFromRotationMatrix(U),E.multiplyQuaternions(E,M),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}else if("RXYZE"==l.axis){var h=v.clone().cross(D).normalize();E.setFromRotationMatrix(C.getInverse(Q));var i=-v.clone().angleTo(D);if(null!==l.snap){var g=Math.round(i/l.snap)*l.snap;Math.abs(g-i)<l.snapDelta&&(i=g)}J.setFromAxisAngle(h,i),I.setFromRotationMatrix(U),E.multiplyQuaternions(E,J),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}else if("local"==l.space){v.applyMatrix4(C.getInverse(U)),D.applyMatrix4(C.getInverse(U));var j=v.dot(this.unitX),k=v.dot(this.unitY),p=v.dot(this.unitZ),q=D.dot(this.unitX),s=D.dot(this.unitY),t=D.dot(this.unitZ);
x.set(Math.atan2(p,k),Math.atan2(j,p),Math.atan2(k,j)),y.set(Math.atan2(t,s),Math.atan2(q,t),Math.atan2(s,q));var u=x.x-y.x,T=x.y-y.y,f=x.z-y.z;if(null!==l.snap){if(l.axis.search("X")!=-1){var g=Math.round(u/l.snap)*l.snap;Math.abs(g-u)<l.snapDelta&&(u=g)}if(l.axis.search("Y")!=-1){var g=Math.round(T/l.snap)*l.snap;Math.abs(g-T)<l.snapDelta&&(T=g)}if(l.axis.search("Z")!=-1){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}}J.setFromAxisAngle(this.unitX,u),K.setFromAxisAngle(this.unitY,T),L.setFromAxisAngle(this.unitZ,f),I.setFromRotationMatrix(P),"RX"==l.axis&&I.multiplyQuaternions(I,J),"RY"==l.axis&&I.multiplyQuaternions(I,K),"RZ"==l.axis&&I.multiplyQuaternions(I,L),l.object.quaternion.copy(I)}else if("world"==l.space){var j=v.dot(this.unitX),k=v.dot(this.unitY),p=v.dot(this.unitZ),q=D.dot(this.unitX),s=D.dot(this.unitY),t=D.dot(this.unitZ);x.set(Math.atan2(p,k),Math.atan2(j,p),Math.atan2(k,j)),y.set(Math.atan2(t,s),Math.atan2(q,t),Math.atan2(s,q)),E.setFromRotationMatrix(C.getInverse(Q));var u=x.x-y.x,T=x.y-y.y,f=x.z-y.z;if(null!==l.snap){if(l.axis.search("X")!=-1){var g=Math.round(u/l.snap)*l.snap;Math.abs(g-u)<l.snapDelta&&(u=g)}if(l.axis.search("Y")!=-1){var g=Math.round(T/l.snap)*l.snap;Math.abs(g-T)<l.snapDelta&&(T=g)}if(l.axis.search("Z")!=-1){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}}J.setFromAxisAngle(this.unitX,u),K.setFromAxisAngle(this.unitY,T),L.setFromAxisAngle(this.unitZ,f),I.setFromRotationMatrix(U),"RX"==l.axis&&E.multiplyQuaternions(E,J),"RY"==l.axis&&E.multiplyQuaternions(E,K),"RZ"==l.axis&&E.multiplyQuaternions(E,L),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}"transrotate"===n&&(l.add(l.endLine),l.add(l.centerMark))}return l.object.matrixAutoUpdate=!0,l.update(!0),l.dispatchEvent(o),l.dispatchEvent(r),!!c},this.onPointerUp=function(a){return m&&null!==l.axis&&(q.mode=n,l.dispatchEvent(q)),m=!1,this.gizmo[n].show(),this.updateUnitVectors(),"transrotate"===n&&"rotate"===this.gizmo[n].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}!function(){"use strict";function a(a){var b="";a<0&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60),e=a%60,f=b;return c>0&&(f+=c+":"+(d<10?"0":"")),f+=d+":"+(e<10?"0":""),f+=e.toFixed(2)}var b=Autodesk.Viewing,c=b.UI,d=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.prevAnimationTime=-1};d.prototype=Object.create(b.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),a.model&&a.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),a.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},d.prototype.unload=function(){var a=this.viewer;if(this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),a.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var c=a.getToolbar(!1);c&&c.getControl(b.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return a.removeEventListener(b.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(b.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.removeEventListener(b.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.removeEventListener(b.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(a.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},d.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var a=this.viewer,b=a.impl.keyFrameAnimator;b&&(this.prevAnimationTime>0&&(b.goto(this.prevAnimationTime),this.prevAnimationTime=-1),b.play(0,this.onPlayCallbackBinded),this.updatePlayButton(b.isPaused),a.toolbar&&a.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},d.prototype.pause=function(){if(!this.isPaused()){var a=this.viewer.impl.keyFrameAnimator;a&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.isPlaying=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&(a.isPlaying&&!a.isPaused)},d.prototype.isPaused=function(){var a=this.viewer.impl.keyFrameAnimator;return!!a&&a.isPaused},d.prototype.rewind=function(){this.setTimelineValue(0)},d.prototype.setTimelineValue=function(a){var b=this.viewer.impl.keyFrameAnimator;if(b){a=Math.min(Math.max(0,a),1);var c=a*b.duration;b.goto(c),this.updateUI()}},d.prototype.prevKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.prev(),this.updateUI())},d.prototype.nextKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.next(),this.updateUI())},d.prototype.getDuration=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.duration:0},d.prototype.getDurationLabel=function(){return a(this.getDuration())},d.prototype.getCurrentTime=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.currentTime:0},d.prototype.getCurrentTimeLabel=function(){return a(this.getCurrentTime())},d.prototype.onAnimationReady=function(){var a=this.viewer;this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),a.impl.keyFrameAnimator&&(a.toolbar&&a.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),a.addEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},d.prototype.updateUI=function(){var b=this.viewer.impl.keyFrameAnimator;this.animTools&&b&&(this.animTools.input.value=b.duration>0?b.currentTime/b.duration*100:0,this.animTools.lapse.value=a(b.currentTime),this.animTools.lapseLeft.value=a(b.currentTime-b.duration),this.updatePlayButton(b.isPaused),this.updateToolbarBackground())},d.prototype.onPlayCallback=function(b){if(this.animTools){var c=this.viewer.impl.keyFrameAnimator;this.animTools.input.value=b,this.animTools.lapse.value=a(c.currentTime),this.animTools.lapseLeft.value=a(c.currentTime-c.duration),b>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},d.prototype.updatePlayButton=function(a){this.playButton&&(a?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play")):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause")))},d.prototype.resetExplode=function(a,b){var c=this.viewer;c.model.is2d()||0===c.getExplodeScale()||(b&&c.explodeSlider&&(c.explodeSlider.value=a),c.explode(a))},d.prototype.adjustToolbarPosition=function(){var a=this.viewer;if(a.toolbar){var b=a.toolbar.getDimensions().width,c=a.container.getBoundingClientRect().width;b>c&&(b=a.modelTools.getDimensions().width);var d=b-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12;this.animTools.input.style.width=d+"px",this.toolbar.container.style.left="calc(50% - "+b/2+"px)"}},d.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},d.prototype.updateToolbarBackground=function(){if(this.animTools){var a=this.animTools.input,b=a.value,c="#ffffff",d="#393939";a.style.background="-webkit-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-moz-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-ms-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-o-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="linear-gradient(to right,"+c+" "+b+"%, "+d+" "+b+"%)"}},d.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var a=this.viewer.impl.keyFrameAnimator;if(!a)return;a.isPlaying&&!a.isPaused&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(b.isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},d.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},d.prototype.onExplode=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(0!==a.currentTime&&(this.prevAnimationTime=a.currentTime,a.goto(0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},d.prototype.onToolbarCreated=function(){var d=this.viewer,e=this;this.onToolbarCreatedBinded&&(d.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new c.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),d.container.appendChild(this.toolbar.container),this.animTools=new c.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new c.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){e.isPaused()?e.play():e.pause()},d.modelTools.addControl(this.playButton),d.modelTools.resetModelButton&&(d.modelTools.resetModelButton.onClick=function(b){d.showAll();var c=d.impl.keyFrameAnimator;c&&(c.goto(0),g.value=0,f.value=a(0),i.value=a(-c.duration),e.updatePlayButton(!0)),e.resetExplode(0,!0),e.updateToolbarBackground()}),this.animTools.backwardButton=new c.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(a){var b=d.impl.keyFrameAnimator;void 0!==b&&b&&(b.prev(),e.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new c.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(a){var b=d.impl.keyFrameAnimator;void 0!==b&&b&&(b.next(),e.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new c.Control("toolbar-animationTimeLapse");var f=this.animTools.lapse=document.createElement("input");f.type="text",f.value="0",f.className="animationTimeLapse",f.disabled=!0,this.animTools.timeText.container.appendChild(f),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new c.Control("toolbar-animationTimeline");var g=this.animTools.input=document.createElement("input");g.type="range",g.value="0",g.className="animationTimeline",this.animTools.timeline.container.appendChild(g),g.addEventListener("input",function(b){var c=d.impl.keyFrameAnimator;if(void 0!==c&&c){var h=g.value*c.duration/100;f.value=a(h),i.value=a(h-c.duration),c.goto(h),e.updatePlayButton(c.isPaused),e.updateToolbarBackground()}});var h=document.createElement("div");h.className="adsk-control-tooltip",h.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(h),g.addEventListener("mouseover",function(a){a.target===g&&(h.style.visibility="visible")}),g.addEventListener("mouseout",function(a){a.target===g&&(h.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new c.Control("toolbar-animationRemainingTime");var i=this.animTools.lapseLeft=document.createElement("input");i.type="text",i.value="0",i.className="animationTimeLapse",i.disabled=!0,this.animTools.timeLeftText.container.appendChild(i),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new c.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){e.hideAnimateToolbar()},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=d,b.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),Autodesk.Viewing.Extensions.Oculus.StereoRenderContext=function(a){function b(a){w=a.hResolution/(2*a.vResolution);var b=-1-4*(a.hScreenSize/4-a.lensSeparationDistance/2)/a.hScreenSize;t=a.distortionK[0]+a.distortionK[1]*Math.pow(b,2)+a.distortionK[2]*Math.pow(b,4)+a.distortionK[3]*Math.pow(b,6),v=THREE.Math.radToDeg(2*Math.atan2(a.vScreenSize*t,2*a.eyeToScreenDistance)),u=4*(a.hScreenSize/4-a.interpupillaryDistance/2)/a.hScreenSize;var c=4*(a.hScreenSize/4-a.lensSeparationDistance/2)/a.hScreenSize;r.lensCenter=new THREE.Vector2(c,0),s.lensCenter=new THREE.Vector2(-c,0)}function c(a){d.aspect=e.aspect=w,d.fov=e.fov=v;var b=1/f.getUnitScale(),c=a.target.clone().sub(a.position).cross(a.up).normalize();c.multiplyScalar(1*q.interpupillaryDistance*b),e.position.add(c),e.target.add(c),d.toPerspective(),e.toPerspective(),e.projectionMatrix.elements[12]-=2*u}var d,e,f,g,h,i,j,k,l,m,n,o,p=!a||a.useWarp,q=a&&a.HMD?a.HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.0635,lensSeparationDistance:.0635,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},r={},s={},t=1,u=0,v=100,w=1;this.init=function(a,c,d){if(init_WarpShader(),h=a,i=c,j=d,k=h.getPixelRatio(),b(q),f=new RenderContext,g=new RenderContext,f.setAOEnabled(!1),g.setAOEnabled(!1),f.settings.antialias=g.settings.antialias=!1,f.settings.customPresentPass=g.settings.customPresentPass=p,f.init(h,i/2*t/k,j*t/k),g.init(h,j/2*t/k,j*t/k),this.settings=f.settings,p){l=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader),m=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader);for(var e=[l,m],n=0;n<2;n++)e[n].material.blending=THREE.NoBlending,e[n].material.depthWrite=!1,e[n].material.depthTest=!1,e[n].uniforms.hmdWarpParam.value.set(q.distortionK[0],q.distortionK[1],q.distortionK[2],q.distortionK[3]),e[n].uniforms.chromAbParam.value.set(q.chromaAbParameter[0],q.chromaAbParameter[1],q.chromaAbParameter[2],q.chromaAbParameter[3]),e[n].uniforms.scaleIn.value.set(1,1/w),e[n].uniforms.scale.value.set(1/t,1*w/t);e[0].uniforms.lensCenter.value.copy(r.lensCenter),e[1].uniforms.lensCenter.value.copy(s.lensCenter)}},this.revertCameraChanges=function(a){return console.log("REVERT Camera to normal"),d.fov=n,d.aspect=o,d},this.saveCameraState=function(a){console.log(a),n=a.fov,o=a.aspect},this.update=function(a){var b=f.update(a),c=g.update(a);return b||c},this.beginScene=function(a,b,h,i){d=b,e=b.clone(),c(b),f.beginScene(a,d,h,i),g.beginScene(a,e,h,i)},this.renderScenePart=function(a,b,c,d){f.renderScenePart(a,b,c,d),g.renderScenePart(a,b,c,d)},this.sceneDirty=function(a,b){f.sceneDirty(a,b),g.sceneDirty(a,b)},this.endScene=function(){f.endScene(),g.endScene()},this.clearAllOverlays=function(){f.clearAllOverlays(),g.clearAllOverlays()},this.renderOverlays=function(a){f.renderOverlays(a),g.renderOverlays(a)},this.composeFinalFrame=function(a){f.composeFinalFrame(a,!0),g.composeFinalFrame(a,!0),h.setViewport(0,0,i/2,j),f.presentBuffer(l),h.setViewport(i/2,0,i/2,j),g.presentBuffer(m),h.setViewport(0,0,i,j)},this.cleanup=function(){f.cleanup(),g.cleanup()},this.setSize=function(a,b,c){i=a,j=b,f.setSize(i/2*t/k,j*t/k,c),g.setSize(i/2*t/k,j*t/k,c),h.setSize(a,b)},this.getMaxAnisotropy=function(){return f.getMaxAnisotropy()},this.hasMRT=function(){return f.hasMRT()},this.initPostPipeline=function(a,b,c){a=!1,b=!1,c=!1,f.initPostPipeline(a,b,c),g.initPostPipeline(a,b,c)},this.setClearColors=function(a,b){f.setClearColors(a,b),g.setClearColors(a,b)},this.setAOOptions=function(a,b){f.setAOOptions(a,b),g.setAOOptions(a,b)},this.getAOEnabled=function(){f.getAOEnabled()},this.getAORadius=function(){return f.getAORadius()},this.getAOIntensity=function(){return f.getAOIntensity()},this.setTonemapExposureBias=function(a){f.setTonemapExposureBias(a),g.setTonemapExposureBias(a)},this.getExposureBias=function(){return f.getExposureBias()},this.setTonemapMethod=function(a){f.setTonemapMethod(a),g.setTonemapMethod(a)},this.getToneMapMethod=function(){return f.getToneMapMethod()},this.toggleTwoSided=function(a){f.toggleTwoSided(a),g.toggleTwoSided(a)},this.enter2DMode=function(a){f.enter2DMode(a),g.enter2DMode(a)},this.idAtPixel=function(a,b){return console.warn("idAtPixel not implemented in stereo context."),0},this.overlayUpdate=function(a){f.overlayUpdate(a),g.overlayUpdate(a)},this.rolloverObjectViewport=function(a,b){},this.screenCapture=function(){return console.warn("Screen capture not implemented by stereo render context"),null},this.setUnitScale=function(a){f.setUnitScale(a),g.setUnitScale(a)},this.getUnitScale=function(){return f.getUnitScale()}},AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),function(){function a(a){function b(){n.copy(d.matrixWorld),n.elements[12]=0,n.elements[13]=0,n.elements[14]=0,e&&m.set(e[1],e[2],e[3])}function c(){var a=new WebSocket("ws://localhost:8888/ws");a.onopen=function(){console.log("### Oculus Connected ####")},a.onmessage=function(a){var b=a.data;try{e=JSON.parse(b)}catch(a){console.log(b)}},a.onclose=function(){console.log("### Oculus Connection Closed ####")},f=a}var d,e,f,g=a,i=new THREE.Vector3(0,0,0),j=new THREE.Quaternion,k=new THREE.Quaternion,l=new THREE.Matrix4,m=new THREE.Vector3(0,0,0),n=new THREE.Matrix4,o=new THREE.Matrix4,p=0,q=1,r=10,s=.001,t=-1,u=0,v=0,w=0,x=0,y=0,z=0,A=0;h?e=[0,0,0,0,0,0,0,0]:c(),this.getNames=function(){return["headtracker"]},this.getName=function(){return"headtracker"};var B;this.activate=function(a){if(d=g.navigation.getCamera(),b(),g.model){q=1/g.model.getUnitScale();var c=g.model.getBoundingBox();r=1e-4*c.size().length()}(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(B=new Autodesk.Viewing.Extensions.GamepadModule(g),B.activate(this.getName()))},this.deactivate=function(a){d=null,B&&B.deactivate()},this.update=function(b){t<0&&(t=b);var c=b-t;if(d.isPerspective||a.navigation.toPerspective(),h){var g=h.getState();e[0]=p+1,g.orientation&&(e[4]=g.orientation.x,e[5]=g.orientation.y,e[6]=g.orientation.z,e[7]=g.orientation.w),g.position&&(e[1]=g.position.x,e[2]=g.position.y,e[3]=g.position.z)}if(e){var C=e[0];if(C>p){d.position.sub(i),i.set(e[1],e[2],e[3]),i.sub(m),i.multiplyScalar(q),i.applyMatrix4(n),d.position.add(i),u+=(z-A)*c*s,k.setFromAxisAngle(d.worldup,u),j.set(e[4],e[5],e[6],e[7]),k.multiply(j),o.makeRotationFromQuaternion(k),l.multiplyMatrices(n,o);var D=l.elements,E=new THREE.Vector3(-D[8],-D[9],-D[10]),F=d.target.clone().sub(d.position).length();d.up.set(D[4],D[5],D[6]);var G=new THREE.Vector3(D[0],D[1],D[2]),H=E.clone().multiplyScalar((v-x)*c*r);d.position.add(H);var I=G.multiplyScalar((y-w)*c*r);d.position.add(I),d.target.set(d.position.x,d.position.y,d.position.z),d.target.add(E.multiplyScalar(F))}p=C}return f&&1===f.readyState&&f.send("get\n"),B&&(d=B.update(d)),t=b,!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){var c=!1;switch(b){case 38:case 87:v=1,c=!0;break;case 40:case 83:x=1,c=!0;break;case 37:case 65:w=1,c=!0;break;case 39:case 68:y=1,c=!0;break;case 81:z=1,c=!0;break;case 69:A=1,c=!0}return c},this.handleKeyUp=function(a,c){var d=!1;switch(c){case 38:case 87:v=0,d=!0;break;case 40:case 83:x=0,d=!0;break;case 37:case 65:w=0,d=!0;break;case 39:case 68:y=0,d=!0;break;case 81:z=0,d=!0;break;case 69:A=0,d=!0;break;case 32:b(),d=!0}return d},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a,b){return!1},this.handleTouchChange=function(a,b){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=b.UI,f=c.Oculus,g=null,h=null;f.Oculus=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.context=null,this.initialized=!1},f.Oculus.prototype=Object.create(b.Extension.prototype),f.Oculus.prototype.constructor=c.Oculus,f.Oculus.prototype.toggleOculus=function(c){var d=this.viewer;c?this.context||(this.context=new f.StereoRenderContext({useWarp:!g}),this.context.saveCameraState(this.viewer.navigation.getCamera()),d.impl.setUserRenderContext(this.context),d.resize(d.canvas.clientWidth,d.canvas.clientHeight),d.displayViewCube(!1,!1),d.navigation.isPerspective||d.navigation.toPerspective(),g?b.launchFullscreen(d.impl.canvas,{vrDisplay:g}):b.launchFullscreen(d.impl.canvas),this.headTracker||(this.headTracker=new a(d),d.toolController.registerTool(this.headTracker)),d.toolController.activateTool("headtracker")):this.context&&(this.viewer.navigation.setCamera(this.context.revertCameraChanges()),this.context=null,d.impl.setUserRenderContext(null),d.displayViewCube(d.prefs.get("viewCube"),!1),d.toolController.deactivateTool("headtracker"),b.exitFullscreen())},f.Oculus.prototype.createUI=function(){var a=this,b=this.viewer;this.oculusButton=new e.Button("toolbar-oculusTool"),this.oculusButton.setToolTip("Oculus VR Mode"),this.oculusButton.setIcon("oculusIcon"),this.oculusButton.onClick=function(b){a.toggleOculus(!a.context)},b.modelTools.addControl(this.oculusButton)},f.Oculus.prototype.load=function(){function a(c){f.removeEventListener(b.TOOLBAR_CREATED_EVENT,a),i.createUI()}function c(){f.modelTools&&f.modelTools.getNumberOfControls()>0?i.createUI():f.addEventListener(b.TOOLBAR_CREATED_EVENT,a)}function e(a){for(var b=0;b<a.length;++b)if(a[b]instanceof HMDVRDevice){g=a[b];break}if(g){for(var b=0;b<a.length;++b)if(a[b]instanceof PositionSensorVRDevice&&a[b].hardwareUnitId==g.hardwareUnitId){h=a[b];break}g&&h?c():d.logger.warn("Didn't find a HMD and sensor!"),i.initialized=!0}}var f=this.viewer,i=this;return navigator.getVRDevices?navigator.getVRDevices().then(e):navigator.mozGetVRDevices?navigator.mozGetVRDevices(e):this.initialized=!0,!0},f.Oculus.prototype.unload=function(){return this.toggleOculus(!1),!0},b.theExtensionManager.registerExtension("Autodesk.Viewing.Oculus",f.Oculus)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions,d=c.Collaboration;d.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},d.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;b[1]===!0||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c){o&&this.detach(),this.viewer=o=c,w=new b.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),s.addEventListener("viewerState",d),o.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||o.addEventListener(a.CAMERA_CHANGE_EVENT,h),o.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(a.SELECTION_CHANGED_EVENT,l),o.addEventListener(a.ISOLATE_EVENT,l),o.addEventListener(a.HIDE_EVENT,l),o.addEventListener(a.SHOW_EVENT,l),o.addEventListener(a.EXPLODE_CHANGE_EVENT,l),o.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))},this.detach=function(){s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(a.CAMERA_CHANGE_EVENT,h),o.removeEventListener(a.SELECTION_CHANGED_EVENT,l),o.removeEventListener(a.ISOLATE_EVENT,l),o.removeEventListener(a.HIDE_EVENT,l),o.removeEventListener(a.SHOW_EVENT,l),o.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},d.ViewTransceiver.prototype.constructor=d.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(d.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Extensions,c=a.Private,d=a.UI,e=b.Collaboration;b.Collaboration.Collaboration=function(b,c){a.Extension.call(this,b,c),c&&c.rtc&&c.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},b.Collaboration.Collaboration.prototype=Object.create(a.Extension.prototype),b.Collaboration.Collaboration.prototype.constructor=b.Collaboration.Collaboration,b.Collaboration.Collaboration.prototype.initNetwork=function(a){this.p2p&&!a||(this.viewtx=new e.ViewTransceiver(this.client),this.interceptor=new e.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new c.P2PClient(this.client))},b.Collaboration.Collaboration.prototype.createUI=function(){var a=this,f=this.viewer;if(this.initNetwork(!1),this.panel=new e.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),b.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new d.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(b){var c=a.panel.isVisible();if(!document.getElementById("collabBox"))if(c||a.inviteDivInstantiated)a.panel.setVisible(!1,!0),a.panel.reset();else{var d=new e.CollabPromptBox,g=f.container;d.start(g,function(){a.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(b){if(b){if(f.model){var e=f.model.getData();a.viewtx.channelId=e.basePath,a.viewtx.attach(f),a.client.connect(a.viewtx.channelId),a.client.join(a.viewtx.channelId)}f.toolController.activateTool(a.interceptor.getName());a.collabButton.setState(d.Button.State.ACTIVE),c.logger.track({category:"viewer_rtc_start"})}else c.logger&&a.client.isConnected()&&c.logger.track({category:"viewer_rtc_stop"}),a.p2p.hangup(),a.viewtx.detach(f),a.viewtx.channelId=null,a.client.disconnect(),a.panel.reset(),f.toolController.deactivateTool(a.interceptor.getName()),a.collabButton.setState(d.Button.State.INACTIVE)}),f.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var g=new CollabPromptBox,h=f.container;g.start(h,function(){a.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},b.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},b.Collaboration.Collaboration.prototype.load=function(){function a(){function a(c){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),d.createUI()}d.client=c.MessageClient.GetInstance(d.options?d.options.messageServerURL:void 0),d.socketErrorHandler=function(a){c.ErrorHandler.reportError(b.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,a.data),d.close()},d.client.addEventListener("socketError",d.socketErrorHandler),d.presenceChannelId=window.location.host,d.client.isConnected(),b.modelTools?d.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a)}var b=this.viewer,d=this;return c.loadDependency("lmv_io","socket.io-1.3.5.js",a),!0},b.Collaboration.Collaboration.prototype.unload=function(){var a=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(a),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),a.toolController.deactivateTool(this.interceptor.getName()),
this.interceptor=null,a.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},a.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",b.Collaboration.Collaboration)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension,Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){function a(){return f=d.getActiveNavigationTool(),d.setActiveNavigationTool(c.tool.getName()),!0}function b(){return d.setActiveNavigationTool(f?f:d.defaultNavigationToolName),!0}var c=this,d=this.viewer,e=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(d.impl,d),d.toolController.registerTool(this.tool),this.createUI();var f;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";var g=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:a,onRelease:b}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,g),this.onToolChanged=function(a){if(a.toolName.indexOf("beeline")!==-1&&c.beelineButton){var b=a.active?e.Button.State.ACTIVE:e.Button.State.INACTIVE;c.beelineButton.setState(b)}},d.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar&&a.getSettingsPanel){var b=a.getToolbar(!0),c=Autodesk.Viewing.UI,d=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),e="toolbar-beelineTool",f=new c.Button(e);f.setToolTip("Walk to"),f.setIcon("adsk-icon-walk"),f.onClick=function(b){var d=f.getState();d===c.Button.State.INACTIVE?a.setActiveNavigationTool("beeline"):d===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.beelineButton=f;var g=d.getControl("toolbar-cameraSubmenuTool");g?d.addControl(this.beelineButton,{index:d.indexOf(g.getId())}):d.addControl(this.beelineButton);var h=this,i=function(){a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,i);var b=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,c=a.getSettingsPanel(!0);h.viewerOption_LookHorId=c.addCheckbox(b,"Reverse horizontal look direction",!1,function(b){a.setReverseHorizontalLookDirection(b)},"reverseHorizontalLookDirection"),h.viewerOption_LookVertId=c.addCheckbox(b,"Reverse vertical look direction",!1,function(b){a.setReverseVerticalLookDirection(b)},"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?i():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,i)}},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.beelineButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId()),this.beelineButton=null}return a.getSettingsPanel&&(a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId),a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId)),a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");var avp=Autodesk.Viewing.Private;Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(a,b){function c(){o.revertToStartState()}function d(a){var b={};b.target=a.target.clone(),b.worldup=a.worldup.clone(),b.position=a.position.clone(),b.up=a.up.clone();for(var c=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function e(a,b){var c=a.target.equals(b.target)&&a.position.equals(b.position)&&a.worldup.equals(b.worldup)&&a.up.equals(b.up);if(!c)return!1;for(var d=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],e=0;e<d.length;e++)if(a[d[e]]!==b[d[e]])return!1;return!0}function f(c){var d=new THREE.Vector3(c.x,c.y,1),e=a.hitTestViewport(d.clone(),!1);if(!e||!e.intersectPoint)return[];var f=new THREE.Raycaster,g=d.clone(),h=a.camera,i=new THREE.Vector3(g.x,g.y,1);g.z=-1,g=g.unproject(h),i=i.unproject(h),i.sub(g).normalize(),f.set(s.isPerspective?h.position:g,i);for(var j=[],k=e.fragId instanceof Array?e.fragId:[e.fragId],l=0;l<k.length;l++){var m=a.getRenderProxy(b.model,k[l]);avp.VBIntersector.meshRayCast(m,f,j)}return j.sort(function(a,b){return a.distance-b.distance}),j}function g(){s.isPerspective||(s.toPerspective(),t.activatePivot(!1)),s.getFocalLength()>k&&s.setFocalLength(k,!0)}var h={GO_TO:0,PASS_THROUGH:1,DEFAULT:0},i=1e3,j=.8,k=28,l=.7,m=0,n=1,o=this,p=b,q=b.container,r=b.autocam,s=b.navigation,t=b.utilities,u=["beeline"],v=m,w=!1,x=0,y=null,z=null,A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3,E=!1,F=new THREE.Vector3,G=new THREE.Vector3,H=null,I=null;this.getNames=function(){return u},this.getName=function(){return u[0]},this.activate=function(a){x=0,b.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),r.userLookSpeed=j,this.showHUDMessage(!0)},this.deactivate=function(){b.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),this.revertToStartState(),this.showHUDMessage(!1)},this.getCursor=function(){return w?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":x<=1?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":null},this.update=function(){var a=s.getCamera();w=!1;var c=!1;if(1===x){var e=F.clone().sub(G);if(0!==e.x||0!==e.y){w=!0,G.x+=e.x*l,G.y+=e.y*l;var f=s.getWorldUpVector().dot(s.getCameraUpVector()),g=b.prefs.reverseHorizontalLookDirection?-1:1,h=b.prefs.reverseVerticalLookDirection?-1:1;e.x*=f<0?-g:g,e.y*=h,r.sync(s.getCamera()),r.look(e),c=!0,H=d(a)}}return c},this.revertToStartState=function(){t.pivotActive(!1),v=m,E=!0},this.attemptFlight=function(a,b){if(s.isActionEnabled("walk")){var c=f(a);c.length>0&&(A=c[0].point,B=c[c.length-1].point,o.fly(i,b))}},this.fly=function(a,b){switch(t.setPivotPoint(b===h.GO_TO?A:B,!0,!0),g(),C=s.getPosition(),z=a,b){case h.GO_TO:D=C.clone().lerp(A,.8);break;case h.PASS_THROUGH:var c=2*r.camera.near,d=B.clone().sub(C).length(),e=c/d;t.setPivotPoint(C.clone().lerp(B,1+10*e),!0,!0),D=C.clone().lerp(B,1+e);break;default:return}v=n,E=!1,y=null,requestAnimationFrame(o.step)},this.step=function(a){var b=s.getCamera();if(!E){if(null===y)H=d(b),y=a;else if(!e(b,H))return void o.revertToStartState();var c=a-y,f=c<z?c/z:1,g=C.clone().lerp(D,f),h=s.getEyeVector();h.multiplyScalar(s.getPivotPoint().sub(s.getPosition()).length()/h.length()),s.setView(g,h.add(g)),H=d(b),t.activatePivot(!1),c<z?requestAnimationFrame(o.step):o.revertToStartState()}},this.handleGesture=function(a){switch(Autodesk.Viewing.Private.HudMessage.dismiss(),a.type){case"dragstart":return I="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===I&&this.handleMouseMove(a);case"dragend":return"drag"===I&&(this.handleButtonUp(a,0),I=null,!0)}return!1},this.handleButtonDown=function(a,b){return Autodesk.Viewing.Private.HudMessage.dismiss(),x+=1<<b,0===b&&(G.x=F.x=a.canvasX,G.y=F.y=a.canvasY,!0)},this.handleButtonUp=function(a,b){return x-=1<<b,0===b},this.handleSingleClick=function(a,b){if(Autodesk.Viewing.Private.HudMessage.dismiss(),0!==b)return this.revertToStartState(),!1;var c={x:a.normalizedX,y:a.normalizedY};switch(v){case m:o.attemptFlight(c,h.GO_TO);break;case n:o.revertToStartState()}return!0},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!(!a.pointers||1!==a.pointers.length)&&(o.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0)},this.handleDoubleClick=function(a,b){return 0===b&&(o.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0)},this.handleMouseMove=function(a){return F.x=a.canvasX,F.y=a.canvasY,1===x&&(g(),!0)},this.handleBlur=function(a){return this.revertToStartState(),!1},this.showOrthoWarningMessage=function(){var a={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."},b=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(q,a,b)},this.showFocalWarningMessage=function(){var a={msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."},b=function(){};Autodesk.Viewing.Private.HudMessage.displayMessage(q,a,b)},this.watchCamera=function(a){if(p.toolController.getActiveToolName()===u[0]||p.toolController.getActiveToolName()===u[1]){var b=s.getCamera(),c=b&&!b.isPerspective,d=s.getFocalLength()>k;c?o.showOrthoWarningMessage():d?o.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}},this.showHUDMessage=function(a){var b=s.getCamera(),c=b&&!b.isPerspective,d=s.getFocalLength()>k;a&&c?o.showOrthoWarningMessage():a&&d?o.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss(),a?p.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o.watchCamera):p.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o.watchCamera)}},function(){"use strict";function a(a,b,c){return function(){var e=b.getState();e===d.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(d.Button.State.ACTIVE)):e===d.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(d.Button.State.INACTIVE))}}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),c=Autodesk.Viewing,d=c.UI,e=function(a,b){c.Extension.call(this,a,b)};e.prototype=Object.create(c.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){var a=this.viewer,b=new c.FovTool(a),d=new c.WorldUpTool(a.impl,a);return a.toolController.registerTool(b),a.toolController.registerTool(d),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},e.prototype.createUI=function(){var b=this.viewer,e=b.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID),g=function(a){return b.navigation.isActionEnabled(a)?"block":"none"};if(f.returnToDefault=function(){},"3d"===this.options.mode){var h=new d.ComboButton("toolbar-orbitTools");h.setToolTip("Orbit"),h.setIcon("adsk-icon-orbit-constrained"),h.setDisplay(g("orbit")),this.createOrbitSubmenu(h),f.addControl(h),f.orbittoolsbutton=h,h.setState(d.Button.State.ACTIVE),f.returnToDefault=function(){h.setState(d.Button.State.ACTIVE)}}var i=new d.Button("toolbar-panTool");i.setToolTip("Pan"),i.setIcon("adsk-icon-pan"),i.onClick=a(b,i,"pan"),i.setDisplay(g("pan")),f.addControl(i),f.panbutton=i;var j=new d.Button("toolbar-zoomTool");j.setToolTip("Zoom"),j.setIcon("adsk-icon-zoom"),j.onClick=a(b,j,"dolly"),j.setDisplay(g("zoom")),f.addControl(j),f.dollybutton=j;var k=new d.ComboButton("toolbar-cameraSubmenuTool");k.setToolTip("Camera interactions"),k.setIcon("adsk-icon-camera"),k.saveAsDefault(),this.createCameraSubmenu(k),f.addControl(k),f.camerabutton=k},e.prototype.createOrbitSubmenu=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=new d.Button("toolbar-freeOrbitTool");h.setToolTip("Free orbit"),h.setIcon("adsk-icon-orbit-free"),h.onClick=a(e,h,"freeorbit"),b.addControl(h),g.freeorbitbutton=h;var i=new d.Button("toolbar-orbitTool");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.onClick=a(e,i,"orbit"),b.addControl(i),g.orbitbutton=i,b.onClick=i.onClick},e.prototype.createCameraSubmenu=function(b){var e=this,f=this.viewer,g=f.getToolbar(!0),h=g.getControl(c.TOOLBAR.NAVTOOLSID),i=function(a){return f.navigation.isActionEnabled(a)?"block":"none"};if(c.isTouchDevice()){var j=new d.Button("toolbar-homeTool");j.setToolTip("Home"),j.setIcon("adsk-icon-home"),j.onClick=function(){f.navigation.setRequestHomeView(!0);var a=f.getDefaultNavigationToolName();f.setActiveNavigationTool(a),b.restoreDefault()},j.setDisplay(i("gotoview")),b.addControl(j),h.homebutton=j}var k=new d.Button("toolbar-fitToViewTool");if(k.setToolTip("Fit to view"),k.setIcon("adsk-icon-fit-to-view"),k.onClick=function(a){f.fitToView("3d"===e.options.mode?f.getSelection():void 0);var c=f.getDefaultNavigationToolName();f.setActiveNavigationTool(c),b.restoreDefault()},k.setDisplay(i("gotoview")),b.addControl(k),h.fovbutton=k,"3d"===this.options.mode){var l=new d.Button("toolbar-focalLengthTool");l.setToolTip("Focal length"),l.setIcon("adsk-icon-fov"),l.onClick=a(f,l,"fov"),l.setDisplay(i("fov")),b.addControl(l),h.fovbutton=l}var m=new d.Button("toolbar-rollTool");m.setToolTip("Roll"),m.setIcon("adsk-icon-roll"),m.onClick=a(f,m,"worldup"),m.setDisplay(i("roll")),b.addControl(m),h.rollbutton=m},e.prototype.initCameraStateMachine=function(a){var b=this,d=this.viewer,e=d.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(a){"fov"===a.toolName&&b.showFocalLengthOverlay(a.active)},d.addEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(a){d.getDefaultNavigationToolName()===a.id&&f.returnToDefault()},d.addEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},e.prototype.initFocalLengthOverlay=function(){var a=this.focallength=document.createElement("div");a.className="focallength";var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c),a.appendChild(b),this.viewer.container.appendChild(a);var d=c.insertRow(-1),e=d.insertCell(0);e.setAttribute("data-i18n","Focal Length"),e.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),e=d.insertCell(1),e.textContent="",e.style.width="4em",e.style.textAlign="right",this.fovCell=e,a.style.visibility="hidden"},e.prototype.showFocalLengthOverlay=function(a){function b(a){if(a){var b={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};c.Private.HudMessage.displayMessage(h.container,b)}else c.Private.HudMessage.dismiss()}function d(a){a&&e(),g.focallength&&(g.focallength.style.visibility=a?"visible":"hidden")}function e(){var a=h.getFocalLength();i!==a&&(i=a,g.fovCell.textContent=a.toString()+" mm")}function f(a){if(e(),"fov"===h.toolController.getActiveToolName()){var c=h.navigation.getCamera(),f=c&&!c.isPerspective;d(!f),b(f)}}var g=this,h=this.viewer,i=0,j=h.navigation.getCamera(),k=j&&!j.isPerspective;d(a&&!k),b(a&&k),a?h.addEventListener(c.CAMERA_CHANGE_EVENT,f):h.removeEventListener(c.CAMERA_CHANGE_EVENT,f)},e.prototype.unload=function(){return this.destroyUI(),!0},e.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(!b)return!0;var e=b.getControl(c.TOOLBAR.NAVTOOLSID);return!e||("3d"===this.options.mode&&(e.orbittoolsbutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.orbittoolsbutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.orbittoolsbutton.getId()),e.orbittoolsbutton=null,e.orbitbutton.onClick=null,e.orbitbutton=null,e.freeorbitbutton.onClick=null,e.freeorbitbutton=null),e.removeControl(e.panbutton.getId()),e.panbutton.onClick=null,e.panbutton=null,e.removeControl(e.dollybutton.getId()),e.dollybutton.onClick=null,e.dollybutton=null,e.camerabutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.camerabutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.camerabutton.getId()),e.camerabutton.onClick=null,e.camerabutton=null,e.rollbutton.onClick=null,e.rollbutton=null,e.fovbutton.onClick=null,e.fovbutton=null,this.focallength=null,a.removeEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,a.removeEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0)},b.NavToolsExtension=e,c.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",e)}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(a,b,c,d){function e(a){var b=0<=a?Math.floor(a):Math.ceil(a),c=a-b;return{intPart:b,fracPart:c}}function f(a,b,c){var d="";return c&&0===a&&(d+="-"),d+=0<b?a.toFixed(b):a.toFixed(0)}function g(a,b,c){for(var d="",g=12,h=1,i=a<0,j=0;j<b;++j)h*=2;a>0?a+=.5/h:a-=.5/h;var k,l;c?l=a:(k=e(a/g).intPart,d+=f(k,0,i)+"' ",l=a-k*g,l<0&&(l=-l));var m=e(l).intPart,n=e((l-m)*h).intPart;if(0!==n&&0===m||(d+=f(m,0)),0!==n){for(m<0&&n<0&&(n=-n);n%2===0;)n/=2,h/=2;0!==m&&(d+="-"),d+=f(n,0)+"/"+f(h,0)}return d+='"'}function h(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=100*d.fracPart;return c+f(g,0)+" m "+f(h,b)+" cm"}function i(a,b){var c="";a<0&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=12*d.fracPart;return c+f(g,0)+"' "+f(h,b)+'"'}var j;void 0===d&&(d=3);try{if(1===c)j=Autodesk.Viewing.i18n.translate(a?"Yes":"No");else if(24===c){var k=a.split(" ");j=[];for(var l=0;l<k.length;++l)j.push(Autodesk.Viewing.Private.formatValueWithUnits(parseFloat(k[l]),b,3,d));j=j.join(", ")}else 2!==c&&3!==c||!isNaN(a)?"ft-and-fractional-in"===b?j=g(12*a,d):"ft-and-fractional-in^2"===b?j=g(12*a,d)+" "+String.fromCharCode(178):"ft-and-decimal-in"===b?j=i(a,d):"ft-and-decimal-in^2"===b?j=i(a,d)+" "+String.fromCharCode(178):"decimal-in"===b||"in"===b||"inch"===b?j=f(a,d)+'"':"decimal-in^2"===b||"in^2"===b||"inch^2"===b?j=f(a,d)+'" '+String.fromCharCode(178):"decimal-ft"===b||"ft"===b||"feet"===b||"foot"===b?j=f(a,d)+"'":"decimal-ft^2"===b||"ft^2"===b||"feet^2"===b||"foot^2"===b?j=f(a,d)+"' "+String.fromCharCode(178):"fractional-in"===b?j=g(a,d,!0):"fractional-in^2"===b?j=g(a,d,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?j=h(a,d):"m-and-cm^2"===b?j=h(a,d)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),j=f(a,d)+" "+b):j=b?a+" "+b:3===c?f(a,d):a:j="NaN"}catch(c){j=b?a+" "+b:a}return j},Autodesk.Viewing.Private.convertUnits=function(a,b,c,d){if(a===b)return c;var e=1;switch(b){case"mm":e=1e3;break;case"cm":e=100;break;case"m":e=1;break;case"in":e=39.37007874;break;case"ft":e=3.280839895;break;case"ft-and-fractional-in":e=3.280839895;break;case"ft-and-decimal-in":e=3.280839895;break;case"decimal-in":e=39.37007874;break;case"decimal-ft":e=3.280839895;break;case"fractional-in":e=39.37007874;break;case"m-and-cm":e=1}var f=1;switch(a){case"mm":f=.001;break;case"cm":f=.01;break;case"m":f=1;break;case"in":f=.0254;break;case"ft":f=.3048;break;case"ft-and-fractional-in":f=.3048;break;case"ft-and-decimal-in":f=.3048;break;case"decimal-in":f=.0254;break;case"decimal-ft":f=.3048;break;case"fractional-in":f=.0254;break;case"m-and-cm":f=1}return"square"===d?c*Math.pow(e*f,2):c*e*f},function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=b.UI,d=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};d.prototype=Object.create(Autodesk.Viewing.Extension.prototype),d.prototype.constructor=d,d.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},d.prototype.load=function(){var c=this,d=this.viewer;return this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",!!d.toolController&&(this.tool=new a.MeasureTool(d,{onCloseCallback:function(a){c.enableMeasureTool(!1)}}),d.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0)},d.prototype.unload=function(){var a=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},d.prototype.isActive=function(){return this.tool.isActive()},d.prototype.setActive=function(a){return this.enableMeasureTool(a)},d.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},d.prototype.getMeasurement=function(a,b){var c=null;return this.isActive()&&(c=this.tool.getMeasurement(a,b)),c},d.prototype.getUnitOptions=function(){var a=[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}];return a},d.prototype.getPrecisionOptions=function(a){if(a)var b=["1","1/2","1/4","1/8","1/16","1/32","1/64"];else var b=["0","0.1","0.01","0.001","0.0001","0.00001"];return b},d.prototype.getDefaultUnit=function(){var a=this.viewer.model.getDisplayUnit();return a},d.prototype.enableMeasureTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return this.viewer.impl.disableRollover(a),a&&!c?(b.activateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},d.prototype.createUI=function(){var a=this,d=this.viewer;this.measureToolButton=null;var e=d.getToolbar(!0);this.measureToolButton=new c.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(b){a.enableMeasureTool(!a.tool.isActive())},this.onMeasureButtonStateChange=function(b){b.state===c.Button.State.ACTIVE?a.enableMeasureTool(!0):b.state===c.Button.State.INACTIVE&&a.enableMeasureTool(!1)},this.measureToolButton.addEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);var f=e.getControl(b.TOOLBAR.MODELTOOLSID);f&&f.addControl(this.measureToolButton,{index:0});var g=[{keycodes:[b.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableMeasureTool(!1)}}];b.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,g)},d.prototype.destroyUI=function(){var a=this.viewer;this.measureToolButton&&this.measureToolButton.removeEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);var d=a.getToolbar(!1);if(d){var e=d.getControl(b.TOOLBAR.MODELTOOLSID);if(e){if(this.measureToolButton){var f=e.getControl("toolbar-inspectSubMenu");f?f.removeControl(this.measureToolButton.getId()):e.removeControl(this.measureToolButton.getId())}this.measureToolButton=null}}b.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},a.MeasureExtension=d,b.theExtensionManager.registerExtension("Autodesk.Measure",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b){function c(){y.updateLabelPositions()}function d(){h.clearMeasurement()}function e(){y||(y=new g(i)),y.hide(),z&&(z.setVisible(!0),z.updatePanel(),i.model&&i.model.is2d()&&z.isolate.setVisibility(!1),t?z.disableUnitOption(0):z.disableUnitOption())}function f(){y&&(y.hide(),y.destroy()),v={},z&&(z.setVisible(!1),z.updatePanel())}function g(a){var b=this,c=!1,d=2002943,e=.7,f="MeasureTool-endPoint",g="MeasureTool-edge",j="MeasureTool-face",k="MeasureTool-angle",n="MeasureTool-angle-outline",o="MeasureTool-extensionLine",p="MeasureTool-extensionFace",v="MeasureTool-greyOutPlane",w=null,y=null,z=null,A=null,C=null,D=null,E=null,F=null,G={first:{},second:{}},H={first:{},second:{}},I={first:{},second:{}},J={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},L={},M=[];this.showFirstVertex=function(a){var b=this.setScale(a);this.showEndPoint("first",a,b)},this.showSecondVertex=function(a){var b=this.setScale(a);this.showEndPoint("second",a,b)},this.showEndPoint=function(a,b,c){w||(w=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(f));var g=G[a],h=g.mesh;if(h||(g.geometry=new THREE.SphereGeometry(1),h=g.mesh=new THREE.Mesh(g.geometry,w),i.impl.addOverlay(f,h)),h.scale.x=c,h.scale.y=c,h.scale.z=c,h.position.set(b.x,b.y,b.z),h.visible=!0,i.impl.invalidate(!1,!1,!0),q||x){var j=g.label;if(!j){j=g.label=document.createElement("div"),j.className="measure-label",i.container.appendChild(j),j.style.pointerEvents="none";var k=document.createElement("div");k.className="adsk-icon-"+a+" measure-label-icon",j.appendChild(k)}j.classList.toggle("visible",!0),g.position=b.clone(),this.updateLabelPositions()}},this.setScale=function(a){var b=5,c=i.navigation,d=c.getCamera(),e=c.getEyeVector(),f=c.getPosition(),g=a.clone(),h=d.isPerspective?g.sub(f).dot(e.normalize()):c.getEyeVector().length(),j=c.getVerticalFov(),k=2*h*Math.tan(THREE.Math.degToRad(.5*j)),l=c.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.updateScale=function(){var a=i.impl.overlayScenes[f];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var d=b.children[c];if(d){var e=this.setScale(d.position);d.scale.x=e,d.scale.y=e,d.scale.z=e}}if(a=i.impl.overlayScenes[o])for(var b=a.scene,c=0;c<b.children.length;c++){var h=b.children[c];if(h){var j=this.setScale(h.geometry.vertices[0]);h.material.dashSize=4*j,h.material.gapSize=2*j}}if(a=i.impl.overlayScenes[g])for(var b=a.scene,c=0;c<b.children.length;c++){var k=b.children[c];k&&this.setCylinderScale(k)}if(a=i.impl.overlayScenes[n])for(var b=a.scene,c=0;c<b.children.length;c++){var k=b.children[c];k&&this.setCylinderScale(k)}for(var l in J)if(J.hasOwnProperty(l)){var m=J[l];m.line&&this.setCylinderScale(m.line)}},this.showFirstEdge=function(a,b){this.showEdge("first",a,b)},this.showSecondEdge=function(a,b){this.showEdge("second",a,b)},this.showEdge=function(a,b,c){y||(y=new THREE.MeshPhongMaterial({
color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(g));var f=H[a];if(f.line&&i.impl.removeMultipleOverlays(g,f.line),f.line=this.drawEdgeAsCylinder(b,y,5,1),i.impl.addMultipleOverlays(g,f.line),q||x){var h=f.label;if(!h){h=f.label=document.createElement("div"),h.className="measure-label",i.container.appendChild(h),h.style.pointerEvents="none";var j=document.createElement("div");j.className="adsk-icon-"+a+" measure-label-icon",h.appendChild(j)}h.classList.toggle("visible",!0),f.intersectPoint=c.clone(),this.updateLabelPositions()}},this.drawEdgeAsCylinder=function(a,b,c,d){var e=[];if(1==d)for(var f=0;f<a.vertices.length;f+=2){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}else for(var f=0;f<a.vertices.length-1;f++){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}return e},this.drawLineAsCylinder=function(a,b,c){var d;return 2==a.vertices.length&&(d=this.cylinderMesh(a.vertices[0],a.vertices[1],b,c),this.setCylinderScale(d)),d},this.cylinderMesh=function(a,b,c,d){var e=(new THREE.Vector3).subVectors(b,a),f=new THREE.Matrix4;f.lookAt(a,b,(new THREE.Object3D).up),f.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var g=new THREE.CylinderGeometry(.1*d,.1*d,e.length(),8,1,!0),h=new THREE.Mesh(g,c);return h.applyMatrix(f),h.position.x=(b.x+a.x)/2,h.position.y=(b.y+a.y)/2,h.position.z=(b.z+a.z)/2,h},this.setCylinderScale=function(a){var b=this.setScale(a.position);a.scale.x=b,a.scale.z=b},this.showFirstFace=function(a,b){this.showFace("first",a,b)},this.showSecondFace=function(a,b){this.showFace("second",a,b)},this.showFace=function(a,b,c){z||(z=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(j));var f=I[a];if(f.mesh&&i.impl.removeOverlay(j,f.mesh),f.mesh=new THREE.Mesh(b,z),i.impl.addOverlay(j,f.mesh),q||x){var g=f.label;if(!g){g=f.label=document.createElement("div"),g.className="measure-label",i.container.appendChild(g),g.style.pointerEvents="none";var h=document.createElement("div");h.className="adsk-icon-"+a+" measure-label-icon",g.appendChild(h)}g.classList.toggle("visible",!0),f.intersectPoint=c.clone(),this.updateLabelPositions()}},this.drawExtensionFace=function(a,b,c){E||(E=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(p));var d=new THREE.Mesh(a,E);d.position.set(b.x,b.y,b.z);var e=d.position.clone();e.add(c),d.lookAt(e),d.updateMatrixWorld(),i.impl.addOverlay(p,d)},this.drawGreyOutPlane=function(a){F||(F=new THREE.MeshPhongMaterial({color:0,ambient:0,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(v));var b=i.model.getMetadata("page_dimensions","page_width"),c=i.model.getMetadata("page_dimensions","page_height"),d=new THREE.Shape;d.moveTo(0,0),d.lineTo(b,0),d.lineTo(b,c),d.lineTo(0,c),d.lineTo(0,0);var e=N=i.model.getClip(a),f=e.contours[0],g=new THREE.Path;g.moveTo(e.points[f[0]].x,e.points[f[0]].y);for(var h=1;h<f.length;h++)g.lineTo(e.points[f[h]].x,e.points[f[h]].y);g.lineTo(e.points[f[0]].x,e.points[f[0]].y),d.holes.push(g);var j=new THREE.ShapeGeometry(d),k=new THREE.Mesh(j,F);i.impl.addOverlay(v,k)},this.getEdgeLength=function(a){for(var b=0,c=a.clone(),d=c.vertices,e=0;e<d.length;e+=2)i.model.is2d()&&i.model.pageToModel(d[e],d[e+1],K),b+=d[e].distanceTo(d[e+1]);return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b),Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)},this.getCircularArcRadius=function(a){var b=a.radius;if(b){if(i.model.is2d()){var c=a.center.clone(),d=a.vertices[0].clone();i.model.pageToModel(c,d,K),b=c.distanceTo(d)}return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b),Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)}},this.getFaceArea=function(a){for(var b=0,c=a.vertices,d=new THREE.Vector3,e=new THREE.Vector3,f=0;f<c.length;f+=3)d.subVectors(c[f+1],c[f]),e.subVectors(c[f+2],c[f]),b+=d.length()*e.length()*Math.sin(d.angleTo(e))/2;return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b,"square"),t?Autodesk.Viewing.Private.formatValueWithUnits(b,t+"^2",3,u):Autodesk.Viewing.Private.formatValueWithUnits(b,null,3,u)},this.updateLabels=function(){r===SNAP_EDGE?H.first.label.children[0].textContent=this.getEdgeLength(l):r===SNAP_FACE&&(I.first.label.children[0].textContent=this.getFaceArea(l)),s===SNAP_EDGE?H.second.label.children[0].textContent=this.getEdgeLength(m):s===SNAP_FACE&&(I.second.label.children[0].textContent=this.getFaceArea(m))},this.updateLabelPositions=function(){function a(a,b,c){var d=i.navigation.getCamera(),e=i.navigation.getScreenViewport(),f=new THREE.Vector3(a,b,c);return f=f.project(d),{x:Math.round((f.x+1)/2*e.width)+5,y:Math.round((-f.y+1)/2*e.height)+5}}for(var b in J)if(J.hasOwnProperty(b)){var c=J[b],d=c.label;if(d){var e=a((c.p1.x+c.p2.x)/2,(c.p1.y+c.p2.y)/2,(c.p1.z+c.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",M.push(d)}}if(L&&(d=L.label)){var e=a((L.p1.x+L.p2.x)/2,(L.p1.y+L.p2.y)/2,(L.p1.z+L.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",M.push(d)}for(var b in I)if(I.hasOwnProperty(b)){var f=I[b],d=f.label,g=f.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",M.push(d)}}for(var b in H)if(H.hasOwnProperty(b)){var h=H[b],d=h.label,g=h.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",M.push(d)}}for(var b in G)if(G.hasOwnProperty(b)){var j=G[b],d=j.label,g=j.position;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",M.push(d)}}for(var k=0;k<M.length;k++)for(var l=0;l<k;l++)this.labelsOverlapDetection(M[l],M[k]);M=[]},this.labelsOverlapDetection=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();d.top<=c.bottom&&d.bottom>=c.top&&(d.right>=c.left&&d.right<=c.right?b.style.left=parseInt(b.style.left,10)-(d.right-c.left)+"px":d.left>=c.left&&d.left<=c.right?b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px":d.left<=c.left&&d.right>=c.right&&(b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px"))},this.drawLine=function(a,d,f){function g(a,d,f,g,h,j,k,l){var m=J[a],n=m.line,o=m.label,p=new THREE.Vector3(d,f,g),r=new THREE.Vector3(h,j,k);if(n&&(i.impl.removeOverlay("MeasureTool-"+a,n),m.line=null),o&&o.classList.remove("visible"),p.distanceTo(r)>=Math.pow(.1,u)&&l){var s="xyz"===a||!c&&q;n||(m.material=new THREE.MeshBasicMaterial({color:parseInt(m.color,16),depthTest:!1,depthWrite:!1}),m.overlayName="MeasureTool-"+a,i.impl.createOverlayScene(m.overlayName)),q?m.material.opacity=1:m.material.opacity=e,i.impl.clearOverlay(m.overlayName);var t=m.geometry=new THREE.Geometry;t.vertices.push(p),t.vertices.push(r);var v="xyz"===a?5:"z"===a?1:2;if(n=m.line=b.drawLineAsCylinder(t,m.material,v),i.impl.addOverlay(m.overlayName,n),n.visible=s,m.p1=p,m.p2=r,"xyz"!=a||q){if(!o){if(o=m.label=document.createElement("div"),o.className="measure-length","xyz"===a){var w=document.createElement("div");w.className="measure-length-text",o.appendChild(w)}o.style.pointerEvents="none",m.axis&&(o.className="adsk-icon-axis-"+a+" measure-label-axis measure-label-axis-"+a),i.container.appendChild(o)}m.axis||b.updateDistance(),o.classList.toggle("visible",s)}}}function h(a,b){var c=Math.pow(.1,u);return!(Math.abs(a.x-b.x)>=c&&Math.abs(a.y-b.y)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.y-b.y)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.z-b.z)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.y-b.y)<c)}g("xyz",a.x,a.y,a.z,d.x,d.y,d.z,!0);var j=i.navigation.getAlignedUpVector(),k=Math.abs(j.x),l=Math.abs(j.y),m=Math.abs(j.z),n=!f&&h(a,d);m>k&&m>l?(g("x",a.x,a.y,a.z,d.x,a.y,a.z,n),g("y",d.x,a.y,a.z,d.x,d.y,a.z,n),g("z",d.x,d.y,a.z,d.x,d.y,d.z,n)):l>k&&l>m?(g("x",a.x,a.y,a.z,d.x,a.y,a.z,n),g("z",d.x,a.y,a.z,d.x,a.y,d.z,n),g("y",d.x,a.y,d.z,d.x,d.y,d.z,n)):(g("y",a.x,a.y,a.z,a.x,d.y,a.z,n),g("z",a.x,d.y,a.z,a.x,d.y,d.z,n),g("x",a.x,d.y,d.z,d.x,d.y,d.z,n)),this.updateLabelPositions()},this.updateDistance=function(){var a=J.xyz.label;a&&(a.children[0].textContent="~ "+h.getDistance("xyz"))},this.updateAngle=function(){var a=L.label;a&&(a.children[0].textContent="~ "+h.getAngle())},this.drawExtensionLine=function(a,b,c){var d,f,g,h,j=new THREE.Vector3,k=new THREE.Vector3;if(j.subVectors(b,a),k.subVectors(c,b),h=j.dot(k),j.subVectors(c,b),h=-h/j.dot(j),j.subVectors(c,b),j.multiplyScalar(h),g=j.add(b),h<0)d=b,f=g;else{if(!(h>1))return;d=c,f=g}D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(o)),q?D.opacity=1:D.opacity=e;var l=this.setScale(d);D.dashSize=4*l,D.gapSize=2*l;var m=new THREE.Geometry;m.vertices.push(d),m.vertices.push(f),m.computeLineDistances();var n=new THREE.Line(m,D);i.impl.addOverlay(o,n)},this.drawExtensionLinePointToPoint=function(a,b){var c=a,d=b;D||(D=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(o)),q?D.opacity=1:D.opacity=e;var f=this.setScale(c);D.dashSize=4*f,D.gapSize=2*f;var g=new THREE.Geometry;g.vertices.push(c),g.vertices.push(d),g.computeLineDistances();var h=new THREE.Line(g,D);i.impl.addOverlay(o,h)},this.nearestPointsInSegmentToSegment=function(a,b,c,d){var e=.001,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;f.subVectors(b,a),g.subVectors(d,c),h.subVectors(a,c);var i,j,k,l,m=f.dot(f),n=f.dot(g),o=g.dot(g),p=f.dot(h),q=g.dot(h),r=m*o-n*n,s=r,t=r;return r<e?(j=0,s=1,l=q,t=o):(j=n*q-o*p,l=m*q-n*p,j<0?(j=0,l=q,t=o):j>s&&(j=s,l=q+n,t=o)),l<0?(l=0,-p<0?j=0:-p>m?j=s:(j=-p,s=m)):l>t&&(l=t,-p+n<0?j=0:-p+n>m?j=s:(j=-p+n,s=m)),i=Math.abs(j)<e?0:j/s,k=Math.abs(l)<e?0:l/t,f.multiplyScalar(i),g.multiplyScalar(k),h.add(f),h.sub(g),f.add(a),g.add(c),[f,g]},this.edgeToEdgeMeasure=function(a,b,c){var d=.01,e=B.getEndPointsInEdge(a),f=e[0].clone(),g=e[1].clone();e=B.getEndPointsInEdge(b);var h=e[0].clone(),i=e[1].clone(),j=this.nearestPointInPointToLine(f,h,i),k=this.nearestPointInPointToLine(g,h,i),l=new THREE.Vector3,m=new THREE.Vector3;if(l.subVectors(f,g),m.subVectors(h,i),l.normalize(),m.normalize(),this.isEqualVectors(l,m,d)||this.isInverseVectors(l,m,d))return f.distanceTo(c)<=g.distanceTo(c)?(this.drawLine(f,j),this.drawExtensionLine(f,h,i),[f,j]):(this.drawLine(g,k),this.drawExtensionLine(g,h,i),[g,k]);var n=this.nearestPointInPointToLine(c,f,g),o=this.angleVectorToVector(l,m);return f.distanceTo(h)<f.distanceTo(i)&&f.distanceTo(h)<g.distanceTo(h)&&f.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,h,i,o):f.distanceTo(i)<f.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,i,h,o):g.distanceTo(h)<f.distanceTo(h)&&g.distanceTo(h)<f.distanceTo(i)&&g.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(g,n,h,i,o):this.drawAngleLineToLine(g,n,i,h,o),o},this.curvedEdgeToEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=B.getEndPointsInEdge(b),h=0;h<f.length;h+=2){var i=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[0],g[1]),j=i[0].distanceTo(i[1]);j<c&&(c=j,d=i[0],e=i[1])}return this.drawLine(d,e),[d,e]},this.curvedEdgeToCurvedEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=b.vertices,h=0;h<f.length;h+=2)for(var i=0;i<g.length;i+=2){var j=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[i],g[i+1]),k=j[0].distanceTo(j[1]);k<c&&(c=k,d=j[0],e=j[1])}return this.drawLine(d,e),[d,e]},this.nearestPointInPointToSegment=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=b:e>1?d=c:(f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)),d},this.nearestPointInPointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)},this.pointToEdgeMeasure=function(a,b,c){var d=B.getEndPointsInEdge(b),e=d[0],f=d[1],g=this.nearestPointInPointToLine(a,e,f),h=this.nearestPointInPointToLine(c,e,f),i=new THREE.Vector3;return i.subVectors(h,g),i.add(a),this.drawLine(i,h),this.drawExtensionLinePointToPoint(a,i),[a,g]},this.edgeToPointMeasure=function(a,b){var c=B.getEndPointsInEdge(a),d=c[0],e=c[1],f=this.nearestPointInPointToLine(b,d,e);return this.drawLine(b,f),this.drawExtensionLine(b,d,e),[b,f]},this.curvedEdgeToVertexMeasure=function(a,b){for(var c=a.vertices,d=Number.MAX_VALUE,e=null,f=0;f<c.length;f+=2){var g=this.nearestPointInPointToSegment(b,c[f],c[f+1]),h=b.distanceTo(g);h<d&&(d=h,e=g)}return this.drawLine(b,e),[b,e]},this.faceToFaceMeasure=function(a,b,c,d){var e=.01,f=b.clone(),g=d.clone(),h=this.angleVectorToVector(b,d);if(f.x<=g.x+e&&f.x>=g.x-e&&f.y<=g.y+e&&f.y>=g.y-e&&f.z<=g.z+e&&f.z>=g.z-e||f.x<=-g.x+e&&f.x>=-g.x-e&&f.y<=-g.y+e&&f.y>=-g.y-e&&f.z<=-g.z+e&&f.z>=-g.z-e){var i=new THREE.Vector3;i.subVectors(a,c);var j=f.dot(i)/f.dot(g);i.addVectors(c,g.multiplyScalar(j));var k=2*i.distanceTo(a),l=new THREE.PlaneBufferGeometry(k,k);return this.drawExtensionFace(l,a,b),this.drawLine(c,i,!0),[c,i,h]}return h=this.drawAngleFaceToFace(a,b,c,d)},this.angleVectorToVector=function(a,b){var c=180*a.angleTo(b)/Math.PI;return c},this.intersectPlaneToPlane=function(a,b,c,d){var e=new THREE.Vector3;e.crossVectors(b,d);var f,g=e.x>=0?e.x:-e.x,h=e.y>=0?e.y:-e.y,i=e.z>=0?e.z:-e.z;f=g>h?g>i?1:3:h>i?2:3;var j,k,l=new THREE.Vector3;switch(j=-b.dot(a),k=-d.dot(c),f){case 1:l.x=0,0!==e.x?(l.y=(k*b.z-j*d.z)/e.x,l.z=(j*d.y-k*b.y)/e.x):(l.y=-(k*b.z)/(b.z*d.y),l.z=-(j*d.y)/(b.z*d.y));break;case 2:l.y=0,0!==e.y?(l.x=(j*d.z-k*b.z)/e.y,l.z=(k*b.x-j*d.x)/e.y):(l.x=-(j*d.z)/(b.x*d.z),l.z=-(k*b.x)/(b.x*d.z));break;case 3:l.z=0,0!==e.z?(l.x=(k*b.y-j*d.y)/e.z,l.y=(j*d.x-k*b.x)/e.z):(l.x=-(k*b.y)/(b.y*d.x),l.y=-(j*d.x)/(b.y*d.x))}var m=new THREE.Vector3;m.addVectors(l,e.multiplyScalar(100));var n=this.nearestPointInPointToLine(a,l,m),o=this.nearestPointInPointToLine(c,l,m);return[n,o]},this.drawAngle=function(a,b,c,d,e,f){var g=.001;A||(A=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),C=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(k,A),i.impl.createOverlayScene(n,C)),i.impl.clearOverlay(k),i.impl.clearOverlay(n);var h=a.distanceTo(b),j=100,l=new THREE.CircleGeometry(h,j,0,e*Math.PI/180),m=new THREE.Mesh(l,A),o=m.geometry.vertices[0].clone();m.geometry.vertices.push(o),m.position.set(a.x,a.y,a.z);var p=m.position.clone();p.add(d),m.lookAt(p),m.updateMatrixWorld();var q=m.geometry.vertices[1].clone(),r=m.geometry.vertices[m.geometry.vertices.length-2].clone();q.applyMatrix4(m.matrixWorld),r.applyMatrix4(m.matrixWorld);var s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3;s.subVectors(q,a),t.subVectors(r,a),u.subVectors(b,a),v.subVectors(c,a);var w,x=s.angleTo(u),y=s.angleTo(v),z=t.angleTo(u),B=t.angleTo(v);w=(x<=g&&x>=-g||y<=g&&y>=-g)&&(z<=g&&z>=-g||B<=g&&B>=-g)?0:(x<=Math.PI+g&&x>=Math.PI-g||y<=Math.PI+g&&y>=Math.PI-g)&&(z<=Math.PI+g&&z>=Math.PI-g||B<=Math.PI+g&&B>=Math.PI-g)?Math.PI:x<=z+g&&x>=z-g||x<=B+g&&x>=B-g?x:y;var D=new THREE.Matrix4;if(D.makeRotationAxis(d,w),D.multiply(m.matrix),m.matrix=D,m.rotation.setFromRotationMatrix(m.matrix),m.updateMatrixWorld(),q=m.geometry.vertices[1].clone(),r=m.geometry.vertices[m.geometry.vertices.length-2].clone(),q.applyMatrix4(m.matrixWorld),r.applyMatrix4(m.matrixWorld),s.subVectors(q,a),t.subVectors(r,a),x=s.angleTo(u),y=s.angleTo(v),z=t.angleTo(u),B=t.angleTo(v),x>=g&&y>=g){var D=new THREE.Matrix4;D.makeRotationAxis(d,2*-w),D.multiply(m.matrix),m.matrix=D,m.rotation.setFromRotationMatrix(m.matrix)}var E=new THREE.CircleGeometry(.9*h,j,0,e*Math.PI/180);E.vertices.splice(0,1),m.updateMatrixWorld(),E.applyMatrix(m.matrixWorld);var F=this.drawEdgeAsCylinder(E,C,2.5,0),G=new THREE.Geometry,H=new THREE.Geometry;G.vertices.push(m.geometry.vertices[0].clone(),m.geometry.vertices[1].clone()),H.vertices.push(m.geometry.vertices[0].clone(),m.geometry.vertices[m.geometry.vertices.length-2].clone()),G.applyMatrix(m.matrixWorld),H.applyMatrix(m.matrixWorld);var I=this.drawLineAsCylinder(G,C,2.5),J=this.drawLineAsCylinder(H,C,2.5);i.impl.addOverlay(k,m),i.impl.addMultipleOverlays(n,F),i.impl.addOverlay(n,I),i.impl.addOverlay(n,J),f.copy(m.geometry.vertices[Math.round(m.geometry.vertices.length/2)-1]),f.applyMatrix4(m.matrixWorld)},this.drawAngleFaceToFace=function(a,b,c,d){var e=this.intersectPlaneToPlane(a,b,c,d),f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(a,e[0]),g.subVectors(c,e[1]);var j=this.angleVectorToVector(f,g),k=e[0].clone(),l=new THREE.Vector3;l.crossVectors(b,d),l.normalize(),e=this.intersectPlaneToPlane(a,b,k,l);var m=e[0].clone();e=this.intersectPlaneToPlane(c,d,k,l);var n=e[0].clone(),o=new THREE.Vector3;if(this.drawAngle(k,m,n,l,j,o),q){var p=L.label;if(!p){p=L.label=document.createElement("div"),p.className="measure-length",i.container.appendChild(p);var r=document.createElement("div");r.className="measure-length-text",p.appendChild(r),p.style.pointerEvents="none"}p.children[0].textContent=h.getAngle(),p.classList.toggle("visible",!0),L.p1=o.clone(),L.p2=o.clone(),this.updateLabelPositions()}return j},this.drawAngleLineToLine=function(a,b,c,d,e){var f=a,g=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;j.subVectors(a,b),k.subVectors(c,d),g.crossVectors(j,k),g.normalize();var l=b,m=new THREE.Vector3;m.subVectors(f,c),m.add(d);var n=new THREE.Vector3;if(this.drawAngle(f,l,m,g,e,n),q){var o=L.label;if(!o){o=L.label=document.createElement("div"),o.className="measure-length",i.container.appendChild(o);var p=document.createElement("div");p.className="measure-length-text",o.appendChild(p),o.style.pointerEvents="none"}o.children[0].textContent=h.getAngle(),o.classList.toggle("visible",!0),L.p1=n.clone(),L.p2=n.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3;e.subVectors(c,a),e.cross(d),f.crossVectors(b,d);var g=e.divide(f);return f=b.clone(),f.multiplyScalar(g),e.addVectors(a,f),e},this.nearestPointInPointToPlane=function(a,b,c){var d=new THREE.Vector3,e=c.clone(),f=new THREE.Vector3;f.subVectors(a,b);var g=-e.dot(f),h=e.dot(e),i=g/h;return d.addVectors(a,e.multiplyScalar(i)),d},this.faceToPointMeasure=function(a,b,c,d){var e=a.vertices[0],f=this.nearestPointInPointToPlane(d,e,b),g=c.clone(),h=new THREE.Vector3;h.subVectors(g,f),h.add(d);var i=2*f.distanceTo(c),j=new THREE.PlaneBufferGeometry(i,i);return this.drawExtensionFace(j,c,b),this.drawLine(d,f),[d,f]},this.nearestPointInPointToTriangle=function(a,b,c,d){var e,f=Number.MAX_VALUE;if(e=this.pointProjectsInTriangle(a,b,c,d))return e;var g=this.nearestPointInPointToSegment(a,b,c);return a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,b,d),a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,c,d),a.distanceTo(g)<f&&(e=g.clone()),e},this.pointToFaceMeasure=function(a,b,c,d){var e=b.vertices[0],f=this.nearestPointInPointToPlane(a,e,c),g=d.clone(),h=new THREE.Vector3;return h.subVectors(g,f),h.add(a),this.drawLine(g,h),this.drawExtensionLinePointToPoint(a,h),[a,f]},this.curvedFaceToVertexMeasure=function(a,b){for(var c,d=Number.MAX_VALUE,e=a.vertices,f=0;f<e.length;f+=3){var g=this.nearestPointInPointToTriangle(b,e[f],e[f+1],e[f+2]);b.distanceTo(g)<d&&(d=b.distanceTo(g),c=g)}return this.drawLine(c,b),[c,b]},this.pointProjectsInTriangle=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;e.subVectors(c,b),f.subVectors(d,b),h.crossVectors(e,f),g.subVectors(a,b),e.cross(g);var i=e.dot(h)/h.dot(h);g.cross(f);var c=g.dot(h)/h.dot(h),b=1-i-c;if(b>=0&&b<=1&&c>=0&&c<=1&&i>=0&&i<=1){var j=THREE.Triangle.normal(b,c,d),k=this.nearestPointInPointToPlane(a,b,j);return k}},this.nearestPointsInLineSegmentToTriangle=function(a,b,c,d,e){var f,g,h=[],i=Number.MAX_VALUE,j=this.pointProjectsInTriangle(a,c,d,e);j&&a.distanceTo(j)<i&&(i=a.distanceTo(j),h[0]=a,h[1]=j);var k=this.pointProjectsInTriangle(b,c,d,e);k&&b.distanceTo(k)<i&&(i=b.distanceTo(k),h[0]=b,h[1]=k),f=c,g=d;var l=this.nearestPointsInSegmentToSegment(a,b,f,g);return l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=c,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=d,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(h[0]=l[0].clone(),h[1]=l[1].clone()),h},this.nearestPointsInEdgeToFace=function(a,b,c){for(var d=[],e=Number.MAX_VALUE,f=0;f<c.vertices.length;f+=3){var g=this.nearestPointsInLineSegmentToTriangle(a,b,c.vertices[f],c.vertices[f+1],c.vertices[f+2]);g[0].distanceTo(g[1])<e&&(e=g[0].distanceTo(g[1]),d=g)}return d},this.nearestPointsInTriangleToTriangle=function(a,b,c,d,e,f){function g(a,b,c,d){var e=i.pointProjectsInTriangle(a,b,c,d);e&&a.distanceTo(e)<k&&(k=a.distanceTo(e),j[0]=a,j[1]=e)}function h(a,b,c,d){var e=i.nearestPointsInSegmentToSegment(a,b,c,d);e[0].distanceTo(e[1])<k&&(k=e[0].distanceTo(e[1]),j=e)}var i=this,j=[],k=Number.MAX_VALUE;return g(a,d,e,f),g(b,d,e,f),g(c,d,e,f),g(d,a,b,c),g(e,a,b,c),g(f,a,b,c),h(a,b,d,e),h(a,b,d,f),h(a,b,e,f),h(a,c,d,e),h(a,c,d,f),h(a,c,e,f),h(b,c,d,e),h(b,c,d,f),h(b,c,e,f),j},this.curvedEdgeToFaceMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=[],e=a.vertices,f=0;f<e.length;f+=2){var g=this.nearestPointsInEdgeToFace(e[f],e[f+1],b);g[0].distanceTo(g[1])<c&&(c=g[0].distanceTo(g[1]),d=g)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.curvedFaceToFaceMeasure=function(a,b){var c=Number.MAX_VALUE,d=[],e=a.vertices,f=b.vertices;a.computeBoundingSphere(),b.computeBoundingSphere();var g=new THREE.Sphere,h=new THREE.Sphere,i=[],j=Number.MAX_VALUE,k=[],l=[];a.bSpheres=[],b.bSpheres=[];for(var m=0;m<e.length;m+=3){g.setFromPoints([e[m],e[m+1],e[m+2]]),a.bSpheres.push(g.clone());var n=g.center.distanceTo(b.boundingSphere.center)+g.radius+b.boundingSphere.radius;n<j&&(j=n)}for(var m=0;m<e.length;m+=3){g=a.bSpheres[m/3];var o=g.center.distanceTo(b.boundingSphere.center)-g.radius-b.boundingSphere.radius;o<=j&&k.push(m)}j=Number.MAX_VALUE;for(var p=0;p<f.length;p+=3){h.setFromPoints(f[p],f[p+1],f[p+2]),b.bSpheres.push(h.clone());var n=h.center.distanceTo(a.boundingSphere.center)+h.radius+a.boundingSphere.radius;n<j&&(j=n)}for(var p=0;p<f.length;p+=3){h=b.bSpheres[p/3];var o=h.center.distanceTo(a.boundingSphere.center)-h.radius-a.boundingSphere.radius;o<=j&&l.push(p)}j=Number.MAX_VALUE;for(var m=0;m<k.length;m++){g=a.bSpheres[k[m]/3];for(var p=0;p<l.length;p++){h=b.bSpheres[l[p]/3];var o=g.center.distanceTo(h.center)-g.radius-h.radius,n=g.center.distanceTo(h.center)+g.radius+h.radius;n<j&&(j=n,i.push({i:k[m],j:l[p],value:o}))}}for(var q=0;q<i.length;q++)if(i[q].value<=j&&i[q].value<c){var r=this.nearestPointsInTriangleToTriangle(e[i[q].i],e[i[q].i+1],e[i[q].i+2],f[i[q].j],f[i[q].j+1],f[i[q].j+2]);r[0].distanceTo(r[1])<c&&(c=r[0].distanceTo(r[1]),d=r)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.faceToEdgeMeasure=function(a,b,c,d,e){var f,g,h=.01,i=B.getEndPointsInEdge(d);i[0].distanceTo(c)<i[1].distanceTo(c)?(f=i[0],g=i[1]):(f=i[1],g=i[0]);var j=new THREE.Vector3;j.subVectors(g,f);var k=this.angleLineToPlane(j,b);if(j.dot(b)<=h&&j.dot(b)>=-h){var l=a.vertices[0],m=this.nearestPointInPointToPlane(f,l,b),n=this.nearestPointInPointToLine(e,f,g);return this.faceToPointMeasure(a,b,c,n),[f,m,k]}var o=this.nearestPointInPointToLine(e,f,g);return this.drawAngleEdgeToFace(a.vertices[0],b,c,f,o,k),k},this.edgeToFaceMeasure=function(a,b,c,d,e){var f,g,h=.01,i=B.getEndPointsInEdge(a);i[0].distanceTo(e)<i[1].distanceTo(e)?(f=i[0],g=i[1]):(f=i[1],g=i[0]);var j=new THREE.Vector3;j.subVectors(g,f);var k=this.angleLineToPlane(j,d);if(j.dot(d)<=h&&j.dot(d)>=-h){var l=c.vertices[0],m=this.nearestPointInPointToPlane(f,l,d),n=new THREE.Vector3;n.subVectors(e,m),n.add(f);var o=new THREE.Vector3;return o.subVectors(e,m),o.add(g),this.drawLine(n,e),this.drawExtensionLinePointToPoint(n,o),[f,m,k]}var p=this.nearestPointInPointToLine(b,f,g);return this.drawAngleEdgeToFace(c.vertices[0],d,e,f,p,k),k},this.angleLineToPlane=function(a,b){var c=this.angleVectorToVector(a,b);return c>90?c-=90:c=90-c,c},this.drawAngleEdgeToFace=function(a,b,c,d,e,f){var g=this.intersectPointLineToPlane(a,b,d,e);if(g){var j=e;if(90===f)var k=c.clone();else var k=this.nearestPointInPointToPlane(e,a,b);var l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3;m.subVectors(e,d),n.subVectors(k,g),l.crossVectors(m,n),l.normalize();var o=new THREE.Vector3;if(this.drawAngle(g,j,k,l,f,o),q){var p=L.label;if(!p){p=L.label=document.createElement("div"),p.className="measure-length",i.container.appendChild(p);var r=document.createElement("div");r.className="measure-length-text",p.appendChild(r),p.style.pointerEvents="none"}p.children[0].textContent=h.getAngle(),p.classList.toggle("visible",!0),L.p1=o.clone(),L.p2=o.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(a,b,c,d){var e=.001,f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(d,c),g.subVectors(c,a);var h=b.dot(f),i=-b.dot(g);return Math.abs(h)<e?null:(f.multiplyScalar(i/h),f.add(c),f)},this.nearestVertexInVertexToEdge=function(a,b){for(var c,d=Number.MAX_VALUE,e=0;e<b.vertices.length;e++){var f=a.distanceTo(b.vertices[e]);d>f&&(c=b.vertices[e],d=f)}return c},this.isEqualVectors=function(a,b,c){return Math.abs(a.x-b.x)<=c&&Math.abs(a.y-b.y)<=c&&Math.abs(a.z-b.z)<=c},this.isInverseVectors=function(a,b,c){return Math.abs(a.x+b.x)<=c&&Math.abs(a.y+b.y)<=c&&Math.abs(a.z+b.z)<=c},this.setSimple=function(a){if(c!=a){c=a;for(var b in J)if("xyz"!==b&&J.hasOwnProperty(b)){var d=J[b];d.line&&(d.line.visible=!a,d.label&&d.label.classList.toggle("visible",!a))}i.impl.invalidate(!1,!1,!0)}},this.hide=function(){var a;for(a in G)if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}for(a in H)if(H.hasOwnProperty(a)){var c=H[a];if(c.line)for(var d in c.line)c.line[d].visible=!1;c.label&&c.label.classList.remove("visible")}for(a in I)if(I.hasOwnProperty(a)){var e=I[a];e.mesh&&(e.mesh.visible=!1),e.label&&e.label.classList.remove("visible")}for(a in J)if(J.hasOwnProperty(a)){var f=J[a];f.line&&(f.line.visible=!1),f.label&&f.label.classList.remove("visible")}L.label&&L.label.classList.remove("visible"),A&&(i.impl.clearOverlay(k),i.impl.clearOverlay(n)),D&&i.impl.clearOverlay(o),E&&i.impl.clearOverlay(p),F&&i.impl.clearOverlay(v),i.impl.invalidate(!1,!1,!0)},this.hideClick=function(a){if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}if(H.hasOwnProperty(a)){var c=H[a];if(c.line)for(var d in c.line)c.line[d].visible=!1;c.label&&c.label.classList.remove("visible")}if(I.hasOwnProperty(a)){var e=I[a];e.mesh&&(e.mesh.visible=!1),e.label&&e.label.classList.remove("visible")}for(var f in J)if(J.hasOwnProperty(f)){var g=J[f];g.line&&(g.line.visible=!1),g.label&&g.label.classList.remove("visible")}L.label&&L.label.classList.remove("visible"),A&&(i.impl.clearOverlay(k),i.impl.clearOverlay(n)),D&&i.impl.clearOverlay(o),E&&i.impl.clearOverlay(p),i.impl.invalidate(!1,!1,!0)},this.destroy=function(){var a;for(a in G)if(G.hasOwnProperty(a)){var b=G[a];b.mesh&&(i.impl.removeOverlay(f,b.mesh),b.mesh=b.geometry=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null)}for(a in H)if(H.hasOwnProperty(a)){var c=H[a];c.line&&(i.impl.removeMultipleOverlays(g,c.line),c.line=c.intersectPoint=null),c.label&&(c.label.parentNode.removeChild(c.label),c.label=null)}for(a in I)if(I.hasOwnProperty(a)){var d=I[a];d.mesh&&(i.impl.removeOverlay(j,d.mesh),d.mesh=d.intersectPoint=null),d.label&&(d.label.parentNode.removeChild(d.label),d.label=null)}w&&(w=null,i.impl.removeOverlayScene(f)),z&&(z=null,i.impl.removeOverlayScene(j)),y&&(y=null,i.impl.removeOverlayScene(g)),D&&(D=null,i.impl.removeOverlayScene(o)),E&&(E=null,i.impl.removeOverlayScene(p)),F&&(F=null,i.impl.clearOverlay(v));for(a in J)if(J.hasOwnProperty(a)){var e=J[a];e.line&&(i.impl.removeOverlay(e.overlayName,e.line),i.impl.removeOverlayScene(e.overlayName),e.material=e.line=e.geometry=null),e.label&&(e.label.parentNode.removeChild(e.label),e.label=null),e.material=e.line=e.geometry=e.label=e.p1=e.p2=null}L.label&&(L.label.parentNode.removeChild(L.label),L.label=null),L.label=L.p1=L.p2=null}}var h=this,i=a,j=["measure"],k=!1,l=null,m=null,n=!1,o=!1,p=0,q=!1,r=null,s=null,t="",u=3,v={},w=0,x=!1,y=null,z=null,A="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), auto",B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D,N=null;
this.register=function(){M&&!z&&(z=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(h,i,"measure-panel","Measure",b),i.addPanel(z)),B||(B=new Autodesk.Viewing.Extensions.Measure.Snapper(a),i.toolController.registerTool(B))},this.deregister=function(){this.deactivate(),z&&(i.removePanel(z),z.uninitialize()),i.toolController.deregisterTool(B),B=null},this.isActive=function(){return k},this.getNames=function(){return j},this.getName=function(){return j[0]},this.getCursor=function(){return n&&!o?null:A},this.activate=function(){k=!0,p=0,n=!1,t||(t=i.model.getDisplayUnit()),u=i.model&&i.model.is2d()?3:1,e(),i.clearSelection(),i.toolController.activateTool("snapper"),i.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),i.addEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.deactivate=function(){k=!1,l=m=null,v={},this.clearMeasurement(),f(),B&&B.isActive()&&i.toolController.deactivateTool("snapper"),i.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),i.removeEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.update=function(){return!1},this.getUnits=function(){return t},this.setUnits=function(a){t!==a&&(t=a,y&&y.updateDistance())},this.getPrecision=function(){return u},this.setPrecision=function(a){u!==a&&(u=a,y&&y.updateDistance())},this.getDistance=function(a){if(i.model&&i.model.isLoadDone()){var b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,v[a]||0);return Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)}},this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(w,String.fromCharCode(176),3,u)},this.getMeasurement=function(a,b){t=a||t,u=b||u;var c=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"],d={from:c[this.getFirstGeometry().type],to:c[this.getSecondGeometry().type],distance:this.getDistance("xyz"),deltaX:this.getDistance("x"),deltaY:this.getDistance("y"),deltaZ:this.getDistance("z"),angle:this.getAngle(),unitType:t,precision:u};return d},this.clearMeasurement=function(){l=m=null,r=s=null,I=J=null,K=L=null,p=1,v={},w=0,N=null,y&&y.hide(),z&&(z.updatePanel(),z.hideMeasureResult(),z.isolateMeasure&&this.clearIsolate()),i.model.is2d()&&(a.impl.updateViewportId(0),B&&B.setFirstClickVpId(null))},this.clearRubberBand=function(){m=null,s=null,y.hideClick("second")},this.clearFirstPick=function(){m?(y.hide(),l=m.clone(),r=s,C=D,E=F,I=J,K=L,G=H,i.model.is2d()&&(a.impl.updateViewportId(K),B&&B.setFirstClickVpId(K)),x=!0,r===SNAP_VERTEX?y.showFirstVertex(l):r===SNAP_EDGE?y.showFirstEdge(l,C):r===SNAP_FACE?y.showFirstFace(l,C):r===SNAP_CIRCULARARC?(l.center=m.center,l.radius=m.radius,y.showFirstEdge(l,C)):r===SNAP_CURVEDFACE&&y.showFirstFace(l,C),x=!1,m=null,s=null,J=null,L=null,H=null,p=2,v={},w=0,z&&z.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),z&&z.showSelection1()},this.clearSecondPick=function(){m=null,s=null,J=null,L=null,p=2,v={},w=0,y.hideClick("second"),z&&z.isolateMeasure&&this.clearIsolate(),i.model.is2d()&&(a.impl.updateViewportId(K),B&&B.setFirstClickVpId(K))},this.getIndicator=function(){return y},this.getFirstGeometry=function(){return{type:r,geometry:l}},this.getSecondGeometry=function(){return{type:s,geometry:m}},this.getEdgeLength=function(a){return y.getEdgeLength(a)},this.getFaceArea=function(a){return y.getFaceArea(a)},this.getCircularArcRadius=function(a){return y.getCircularArcRadius(a)},this.isolateMeasurement=function(){if(I&&J){var a=[I,J];i.isolate(a)}},this.clearIsolate=function(){i.showAll()},this.isIdenticalEdges=function(){if(l.vertices.length===m.vertices.length){for(var a=0;a<l.vertices.length;a++)if(!l.vertices[a].equals(m.vertices[a]))return!1;return!0}return!1},this.isIdenticalFaces=function(){if(l.faceId&&m.faceId){if(l.fragId===m.fragId&&l.faceId===m.faceId)return!0}else if(l.vertices.length===m.vertices.length){for(var a=0;a<l.vertices.length;a++)if(!l.vertices[a].equals(m.vertices[a]))return!1;return!0}return!1},this.isIdenticalGeometries=function(){if(r===s)switch(r){case SNAP_VERTEX:if(l.equals(m))return!0;break;case SNAP_EDGE:return this.isIdenticalEdges();case SNAP_FACE:return this.isIdenticalFaces();case SNAP_CIRCULARARC:return this.isIdenticalEdges();case SNAP_CURVEDEDGE:return this.isIdenticalEdges();case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},this._handleMouseEvent=function(b){if(B.isSnapped()){if(0===p&&(this.clearMeasurement(),p=1),1===p)K=B.getViewportIndex(),r=B.getHighlightGeometry(),C=B.getIntersectPoint(),i.model.is2d()&&(a.impl.updateViewportId(K),B&&B.setFirstClickVpId(K)),l=B.getGeometry(),r===SNAP_VERTEX?y.showFirstVertex(l):r===SNAP_EDGE||r===SNAP_CURVEDEDGE?y.showFirstEdge(l,C):r===SNAP_FACE?(E=B.getFaceNormal(),y.showFirstFace(l,C)):r===SNAP_CIRCULARARC?(G=B.getCircularArcCenter(),l.center=B.getCircularArcCenter(),l.radius=B.getCircularArcRadius(),y.showFirstEdge(l,C)):r===SNAP_CURVEDFACE&&y.showFirstFace(l,C),I=B.getSnapNode(),z&&z.showSelection1();else if(2===p){var c=null;if(s=B.getHighlightGeometry(),D=B.getIntersectPoint(),m=B.getGeometry(),s===SNAP_CIRCULARARC&&(m.center=B.getCircularArcCenter(),m.radius=B.getCircularArcRadius()),this.isIdenticalGeometries())return!1;if(r===SNAP_VERTEX&&s===SNAP_VERTEX?(y.showSecondVertex(m),y.drawLine(l,m),c=[l,m]):r===SNAP_EDGE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.edgeToEdgeMeasure(m,l,D)):r===SNAP_FACE&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),c=y.faceToFaceMeasure(C,E,D,F)):r===SNAP_VERTEX&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.pointToEdgeMeasure(l,m,D)):r===SNAP_EDGE&&s===SNAP_VERTEX?(y.showSecondVertex(m),c=y.edgeToPointMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),c=y.pointToFaceMeasure(l,m,F,D)):r===SNAP_FACE&&s===SNAP_VERTEX?(y.showSecondVertex(m),c=y.faceToPointMeasure(l,E,C,m)):r===SNAP_EDGE&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),c=y.edgeToFaceMeasure(l,C,m,F,D)):r===SNAP_FACE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.faceToEdgeMeasure(l,E,C,m,D)):r===SNAP_CIRCULARARC&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),G.equals(H)?(m=y.nearestVertexInVertexToEdge(D,m),s=SNAP_VERTEX,y.showSecondVertex(m),y.drawLine(G,m),c=[G,m]):(y.showSecondEdge(m,D),y.drawLine(G,H),c=[G,H])):r===SNAP_CIRCULARARC&&s===SNAP_VERTEX?(y.showSecondVertex(m),y.drawLine(G,m),c=[G,m]):r===SNAP_VERTEX&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),y.drawLine(l,H),c=[l,H]):r===SNAP_CIRCULARARC&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.pointToEdgeMeasure(G,m,D)):r===SNAP_EDGE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),c=y.edgeToPointMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),c=y.pointToFaceMeasure(G,m,F,D)):r===SNAP_FACE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),c=y.faceToPointMeasure(l,E,C,H)):r===SNAP_CURVEDEDGE&&s===SNAP_VERTEX?(y.showSecondVertex(m),c=y.curvedEdgeToVertexMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToVertexMeasure(m,l)):r===SNAP_CURVEDEDGE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),c=y.curvedEdgeToVertexMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToVertexMeasure(m,G)):r===SNAP_CURVEDEDGE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToEdgeMeasure(l,m)):r===SNAP_EDGE&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToEdgeMeasure(m,l)):r===SNAP_CURVEDEDGE&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToCurvedEdgeMeasure(l,m)):r!==SNAP_CURVEDEDGE||s!==SNAP_FACE&&s!==SNAP_CURVEDFACE?r!==SNAP_FACE&&r!==SNAP_CURVEDFACE||s!==SNAP_CURVEDEDGE?r===SNAP_CURVEDFACE&&s===SNAP_VERTEX?(y.showSecondVertex(m),c=y.curvedFaceToVertexMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),c=y.curvedFaceToVertexMeasure(m,l)):r===SNAP_CURVEDFACE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),c=y.curvedFaceToVertexMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),c=y.curvedFaceToVertexMeasure(m,G)):r===SNAP_CURVEDFACE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),c=y.curvedEdgeToFaceMeasure(m,l)):r===SNAP_EDGE&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),c=y.curvedEdgeToFaceMeasure(l,m)):r!==SNAP_CURVEDFACE||s!==SNAP_FACE&&s!==SNAP_CURVEDFACE?r===SNAP_FACE&&s===SNAP_CURVEDFACE&&(y.showSecondFace(m,D),c=y.curvedFaceToFaceMeasure(l,m)):(y.showSecondFace(m,D),c=y.curvedFaceToFaceMeasure(l,m)):(y.showSecondEdge(m,D),c=y.curvedEdgeToFaceMeasure(m,l)):(y.showSecondFace(m,D),c=y.curvedEdgeToFaceMeasure(l,m)),q){if(void 0===c.length)w=c,z&&z.showAngleResult();else{var d=c[0].clone(),e=c[1].clone();i.model.is2d()&&i.model.pageToModel(d,e,K),v.xyz=d.distanceTo(e),v.x=Math.abs(d.x-e.x),v.y=Math.abs(d.y-e.y),v.z=Math.abs(d.z-e.z),z&&(r===SNAP_FACE&&s===SNAP_FACE?z.showDistanceResult(!0):z.showDistanceResult())}z&&(z.showSelection2(),z.updatePanel()),y.updateDistance(),y.updateAngle(),J=B.getSnapNode(),L=B.getViewportIndex(),z&&z.isolateMeasure&&this.isolateMeasurement(),i.model.is2d()&&(a.impl.updateViewportId(0),B&&B.setFirstClickVpId(null))}y.updateLabelPositions()}return!0}if(2===p){var f=this.inverseProject(b.canvasX,b.canvasY);r===SNAP_VERTEX?y.drawLine(l,f):r===SNAP_EDGE?y.edgeToPointMeasure(l,f):r===SNAP_FACE?y.faceToPointMeasure(l,E,C,f):r===SNAP_CIRCULARARC?y.drawLine(G,f):r===SNAP_CURVEDEDGE?y.curvedEdgeToVertexMeasure(l,f):r===SNAP_CURVEDFACE&&y.curvedFaceToVertexMeasure(l,f)}return!1},this.inverseProject=function(a,b){var c=i.navigation.getCamera(),d=i.navigation.getScreenViewport(),e=new THREE.Vector3;return e.x=a/d.width*2-1,e.y=-(b/d.height*2-1),e.z=0,e=e.unproject(c)},this.handleButtonDown=function(a,b){return n=!0,0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(q=!0),!1},this.handleMouseMove=function(a){return q=!1,2===p&&(this.clearRubberBand(),this._handleMouseEvent(a)),!1},this.handleButtonUp=function(a,b){return n=!1,!1},this.handleSingleClick=function(a,b){return q&&(this._handleMouseEvent(a)||(this.clearMeasurement(),p=0),1!==p&&2!==p||(p=1===p?2:0),q=!1),!0},this.handleDoubleClick=function(a,b){return!0},this.handleWheelInput=function(a){return y.updateScale(),!1},this.handleSingleTap=function(a){return!0},this.handleDoubleTap=function(a){return!0},this.handleResize=function(){y&&y.updateLabelPositions()}},AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5,SNAP_PRECISION=.001;Autodesk.Viewing.Extensions.Measure.Snapper=function(a,b){function c(a,b){this.viewer=a,this.snapper=b,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=this.snapper.getDetectRadius()}var d=a,e=b?["snapper-markup"]:["snapper"],f=!1,g="MeasureTool-snapper-face",h="MeasureTool-snapper-vertex",i="MeasureTool-snapper-edge",j=null,k=Number.MAX_VALUE,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=!1,u=!1,v=null,w=null,x=null,y=null,z=null;this.markupMode=b,this.isActive=function(){return f},this.getNames=function(){return e},this.getName=function(){return e[0]},this.activate=function(){f=!0},this.deactivate=function(){f=!1,this.destroy()},this.getFace=function(){return m},this.getEdge=function(){return n},this.getVertex=function(){return o},this.getGeometry=function(){switch(q){case SNAP_VERTEX:return this.getVertex();case SNAP_EDGE:return this.getEdge();case SNAP_FACE:return this.getFace();case SNAP_CIRCULARARC:return this.getEdge();case SNAP_CURVEDEDGE:return this.getEdge();case SNAP_CURVEDFACE:return this.getFace()}},this.getSnapNode=function(){return p},this.getHighlightGeometry=function(){return q},this.getIntersectPoint=function(){return r},this.getFaceNormal=function(){return s},this.getEndPointsInEdge=function(a){for(var b=a.vertices,c=[],d=0;d<b.length;++d){for(var e=!1,f=0;f<b.length;++f)if(f!==d&&b[f].equals(b[d])){e=!0;break}e||c.push(b[d])}return c},this.getViewportIndex=function(){return v},this.getCircularArcCenter=function(){return w},this.getCircularArcRadius=function(){return x},this.getDetectRadius=function(){return j},this.isSnapped=function(){return u},this.setClip=function(a){y=a},this.setFirstClickVpId=function(a){z=a},this.isEqualWithPrecision=function(a,b){return Math.abs(a-b)<=SNAP_PRECISION},this.isEqualVectorsWithPrecision=function(a,b){return Math.abs(a.x-b.x)<=SNAP_PRECISION&&Math.abs(a.y-b.y)<=SNAP_PRECISION&&Math.abs(a.z-b.z)<=SNAP_PRECISION},this.isInverseVectorsWithPrecision=function(a,b){return Math.abs(a.x+b.x)<=SNAP_PRECISION&&Math.abs(a.y+b.y)<=SNAP_PRECISION&&Math.abs(a.z+b.z)<=SNAP_PRECISION},this.snapping3D=function(a){p=a.dbId;var b=a.face;r=a.intersectPoint;var c;if(c=void 0===a.fragId.length?[a.fragId]:a.fragId,d.model.hasTopology()){p&&(c=[],d.model.getData().instanceTree.enumNodeFragments(p,function(a){c.push(a)},!0)),m=n=o=null,k=Number.MAX_VALUE;for(var e=0;e<c.length;++e){var f=c[e],g=d.impl.getRenderProxy(d.model,f),h=g.geometry,i=d.model.getTopoIndex(f),t=d.model.getTopology(i),v=t.faces,y=t.edges;t.vertices;if(!m){m=this.faceSnappingWithTopology(b,h,v,g),m&&(m.fragId=f);var z=(new THREE.Matrix3).getNormalMatrix(g.matrixWorld);s=b.normal.applyMatrix3(z).normalize()}this.edgeSnappingWithTopology(r,h,y,g)}if(o=this.vertexSnappingWithTopology(n,r),m){if(j=this.setDetectRadius(r),l<j)this.drawPoint(o),q=SNAP_VERTEX;else if(k<j){this.drawLine(n);var A=this.edgeIsCircle(n);A?(w=A,x=A.distanceTo(n.vertices[0]),q=SNAP_CIRCULARARC):q=this.edgeIsCurved(n)?SNAP_CURVEDEDGE:SNAP_EDGE}else this.drawFace(m),q=this.faceIsCurved(m)?SNAP_CURVEDFACE:SNAP_FACE;u=!0}}else for(var e=0;e<c.length;++e){var f=c[e],g=d.impl.getRenderProxy(d.model,f),h=g.geometry;if(m=this.faceSnapping(b,h)){m.applyMatrix(g.matrixWorld),n=this.edgeSnapping(m,r),o=this.vertexSnapping(n,r);var z=(new THREE.Matrix3).getNormalMatrix(g.matrixWorld);s=b.normal.applyMatrix3(z).normalize(),j=this.setDetectRadius(r),l<j?(this.drawPoint(o),q=SNAP_VERTEX):k<j?(this.drawLine(n),q=SNAP_EDGE):(this.drawFace(m),q=SNAP_FACE),u=!0;break}}},this.faceSnappingWithTopology=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Geometry,i=b.attributes;if(void 0!==i.index){for(var j=b.vb?b.vb:i.position.array,k=b.vb?b.vbstride:3,l=0;l<c.length;l++){for(var m=c[l].indexList,n=c[l].id,o=0;o<m.length;o+=3)if(a.a===m[o]){if(a.b===m[o+1]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o+1])break}else if(a.a===m[o+1]){if(a.b===m[o]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o])break}else if(a.a===m[o+2]&&(a.b===m[o]&&a.c===m[o+1]||a.b===m[o+1]&&a.c===m[o]))break;if(o<m.length)break}if(l<c.length)for(var o=0;o<m.length;o+=3){e.set(j[m[o]*k],j[m[o]*k+1],j[m[o]*k+2]),f.set(j[m[o+1]*k],j[m[o+1]*k+1],j[m[o+1]*k+2]),g.set(j[m[o+2]*k],j[m[o+2]*k+1],j[m[o+2]*k+2]);var p=h.vertices.length;h.vertices.push(e.clone()),h.vertices.push(f.clone()),h.vertices.push(g.clone()),h.faces.push(new THREE.Face3(p,p+1,p+2))}}return h.vertices.length>0?(h.faceId=n,h.applyMatrix(d.matrixWorld),h):null},this.faceSnapping=function(a,b){var c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Geometry,g=b.attributes;if(void 0!==g.index){var h=g.index.array||b.ib,i=b.vb?b.vb:g.position.array,j=b.vb?b.vbstride:3,k=b.offsets;k&&0!==k.length||(k=[{start:0,count:h.length,index:0}]);for(var l=0;l<k.length;++l)for(var m=k[l].start,n=k[l].count,o=k[l].index,p=m;p<m+n;p+=3){var q=o+h[p],r=o+h[p+1],s=o+h[p+2];c.set(i[q*j],i[q*j+1],i[q*j+2]),d.set(i[r*j],i[r*j+1],i[r*j+2]),e.set(i[s*j],i[s*j+1],i[s*j+2]);var t=THREE.Triangle.normal(c,d,e),u=new THREE.Vector3;if(u.set(i[a.a*j],i[a.a*j+1],i[a.a*j+2]),this.isEqualVectorsWithPrecision(t,a.normal)&&this.isEqualWithPrecision(t.dot(c),a.normal.dot(u))){var v=f.vertices.length;f.vertices.push(c.clone()),f.vertices.push(d.clone()),f.vertices.push(e.clone()),f.faces.push(new THREE.Face3(v,v+1,v+2))}}}return f.vertices.length>0?this.getTrianglesOnSameFace(f,a,i,j):null},this.getTrianglesOnSameFace=function(a,b,c,d){var e=!1,f=a.vertices.slice(),g=new THREE.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new THREE.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var i=new THREE.Vector3;i.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);var j=new THREE.Geometry;j.vertices.push(g),j.vertices.push(h),j.vertices.push(i),j.faces.push(new THREE.Face3(0,1,2));var k=[];do{k=[];for(var l=0;l<f.length;l+=3)if(f[l].equals(g)&&f[l+1].equals(h)&&f[l+2].equals(i))e=!0,k.push(l);else for(var m=0;m<j.vertices.length;m+=3)if(this.trianglesSharedEdge(f[l],f[l+1],f[l+2],j.vertices[m],j.vertices[m+1],j.vertices[m+2])){var n=j.vertices.length;j.vertices.push(f[l].clone()),j.vertices.push(f[l+1].clone()),j.vertices.push(f[l+2].clone()),j.faces.push(new THREE.Face3(n,n+1,n+2)),k.push(l);break}for(var o=k.length-1;o>=0;--o)f.splice(k[o],3)}while(k.length>0);return e?j:null},this.trianglesSharedEdge=function(a,b,c,d,e,f){var g=!1,h=!1,i=!1;return(a.equals(d)||a.equals(e)||a.equals(f))&&(g=!0),(b.equals(d)||b.equals(e)||b.equals(f))&&(h=!0),(c.equals(d)||c.equals(e)||c.equals(f))&&(i=!0),!!(g&h||g&i||h&i)},this.edgeSnappingWithTopology=function(a,b,c,d){var e,f=new THREE.Geometry,g=Number.MAX_VALUE,h=new THREE.Vector3,i=new THREE.Vector3,j=b.attributes;if(void 0!==j.index&&void 0!=c){for(var l=b.vb?b.vb:j.position.array,m=b.vb?b.vbstride:3,o=0;o<c.length;o++)for(var p=c[o].indexList,q=0;q<p.length-1;q++){h.set(l[p[q]*m],l[p[q]*m+1],l[p[q]*m+2]),i.set(l[p[q+1]*m],l[p[q+1]*m+1],l[p[q+1]*m+2]),h.applyMatrix4(d.matrixWorld),i.applyMatrix4(d.matrixWorld);var r=this.distancePointToLine(a,h,i);r<g&&(g=r,e=o)}if(e){p=c[e].indexList;for(var s=0;s<p.length-1;s++)f.vertices.push(new THREE.Vector3(l[p[s]*m],l[p[s]*m+1],l[p[s]*m+2])),f.vertices.push(new THREE.Vector3(l[p[s+1]*m],l[p[s+1]*m+1],l[p[s+1]*m+2]))}}k>=g&&f.vertices.length>0&&(k=g,f.applyMatrix(d.matrixWorld),n=f)},this.edgeSnapping=function(a,b){for(var c=new THREE.Geometry,d=!0,e=!0,f=!0,g=0;g<a.vertices.length;g+=3){for(var h=0;h<a.vertices.length;h+=3)g!==h&&((a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(d=!1),(a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(e=!1),(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(f=!1));d&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+1].clone())),e&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+2].clone())),f&&(c.vertices.push(a.vertices[g+1].clone()),c.vertices.push(a.vertices[g+2].clone())),d=!0,e=!0,f=!0}for(var i,j=new THREE.Geometry,l=Number.MAX_VALUE,m=0;m<c.vertices.length;m+=2){var n=this.distancePointToLine(b,c.vertices[m],c.vertices[m+1]);n<l&&(l=n,i=m)}return j.vertices.push(c.vertices[i].clone()),j.vertices.push(c.vertices[i+1].clone()),j.vertices=this.getConnectedLineSegmentsOnSameLine(c,j.vertices),k=l,j},this.distancePointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=a.distanceTo(b):e>1?d=a.distanceTo(c):(f.subVectors(a,b),g.subVectors(a,c),f.cross(g),g.subVectors(c,b),d=Math.sqrt(f.dot(f))/Math.sqrt(g.dot(g))),d},this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=a.vertices.slice(),d=b[0],e=b[1],f=[];do{f=[];for(var g=0;g<c.length;g+=2)if(!c[g].equals(d)||!c[g+1].equals(e))for(var h=0;h<b.length;h+=2)if(c[g].equals(b[h])||c[g+1].equals(b[h])||c[g].equals(b[h+1])||c[g+1].equals(b[h+1])){var i=new THREE.Vector3,j=new THREE.Vector3;if(i.subVectors(b[h],b[h+1]),i.normalize(),j.subVectors(c[g],c[g+1]),j.normalize(),this.isEqualVectorsWithPrecision(i,j)||this.isInverseVectorsWithPrecision(i,j)){f.push(g);break}}for(var k=f.length-1;k>=0;--k)b.push(c[f[k]]),b.push(c[f[k]+1]),c.splice(f[k],2)}while(f.length>0);return b},this.vertexSnappingWithTopology=function(a,b){var c=Number.MAX_VALUE,d=new THREE.Vector3;if(a&&a.vertices.length>1){var e=b.distanceTo(a.vertices[0]),f=b.distanceTo(a.vertices[a.vertices.length-1]);e<=f?(c=e,d=a.vertices[0].clone()):(c=f,d=a.vertices[a.vertices.length-1].clone())}return l=c,d},this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d=new THREE.Vector3,e=0;e<a.vertices.length;++e){var f=b.distanceTo(a.vertices[e]);f<c-SNAP_PRECISION&&(c=f,d=a.vertices[e].clone())}return l=c,d},this.edgeIsCircle=function(a){var b=a.vertices;if(b.length<8)return!1;if(b[0].equals(b[b.length-1])){for(var c=new THREE.Vector3(0,0,0),d=0;d<b.length;d+=2)c.add(b[d]);c.divideScalar(b.length/2);for(var e=c.distanceTo(b[0]),d=0;d<b.length;d+=2)if(!(Math.abs(c.distanceTo(b[d])-e)<=SNAP_PRECISION))return!1;return c}return!1},this.edgeIsCurved=function(a){var b=a.vertices;if(b.length<=2)return!1;if(b[0].equals(b[b.length-1]))return!0;var c=new THREE.Vector3;c.subVectors(b[0],b[1]);for(var d=new THREE.Vector3,e=2;e<b.length;e+=2)if(d.subVectors(b[e],b[e+1]),!this.isEqualVectorsWithPrecision(c,d))return!0;return!1},this.faceIsCurved=function(a){var b=a.vertices,c=a.faces;if(c.length<=1)return!1;for(var d=THREE.Triangle.normal(b[c[0].a],b[c[0].b],b[c[0].c]),e=b[c[0].a],f=1;f<c.length;f++){var g=THREE.Triangle.normal(b[c[f].a],b[c[f].b],b[c[f].c]),h=b[c[f].a];if(!this.isEqualVectorsWithPrecision(d,g)||!this.isEqualWithPrecision(d.dot(e),g.dot(h)))return!0}return!1},this.angleVector2=function(a){return a.x>0&&a.y>=0?Math.atan(a.y/a.x):a.x>=0&&a.y<0?Math.atan(a.y/a.x)+2*Math.PI:a.x<0&&a.y<=0?Math.atan(a.y/a.x)+Math.PI:a.x<=0&&a.y>0?Math.atan(a.y/a.x)+Math.PI:null},c.prototype.onLineSegment=function(a,b,c,d,e){var f=this.snapper.getIntersectPoint(),g=this.lineGeom.vertices,h=new THREE.Vector3(a,b,f.z),i=new THREE.Vector3(c,d,f.z),j=this.snapper.distancePointToLine(f,h,i);j<=this.detectRadius&&j<this.minDist&&(g.splice(0,2,h,i),this.minDist=j,this.vpIdLine=e)},c.prototype.onCircularArc=function(a,b,c,d,e,f){var g=this.snapper.getIntersectPoint(),h=new THREE.Vector2(g.x,g.y),i=new THREE.Vector2(a,b),j=h.distanceTo(i);h.sub(i);var k=this.snapper.angleVector2(h);if(Math.abs(j-e)<=this.detectRadius){if(d>c&&k>=c&&k<=d)var l=new THREE.CircleGeometry(e,100,c,d-c);else{if(!(d<c&&(k>=c||k<=d)))return;var l=new THREE.CircleGeometry(e,100,c,2*Math.PI-c+d)}l.vertices.splice(0,1),l.applyMatrix((new THREE.Matrix4).makeTranslation(a,b,g.z)),this.circularArc=l,this.circularArcCenter=new THREE.Vector3(a,b,g.z),this.circularArcRadius=e,this.vpIdCircular=f}},c.prototype.onEllipticalArc=function(a,b,c,d,e,f,g,h){var i=this.snapper.getIntersectPoint(),j=new THREE.Vector2(i.x,i.y),k=e-this.detectRadius,l=f-this.detectRadius,m=e+this.detectRadius,n=f+this.detectRadius,o=(j.x-a)*(j.x-a)/(k*k)+(j.y-b)*(j.y-b)/(l*l),p=(j.x-a)*(j.x-a)/(m*m)+(j.y-b)*(j.y-b)/(n*n),q=new THREE.Vector2(a,b);j.sub(q),j.x*=f,j.y*=e;var r=this.snapper.angleVector2(j);if(d>2*Math.PI&&(d=2*Math.PI),o>=1&&p<=1&&(d>c&&r>=c&&r<=d||d<c&&(r>=c||r<=d))){var s=new THREE.EllipseCurve(a,b,e,f,c,d,!1),t=new THREE.Path(s.getPoints(50)),u=t.createPointsGeometry(50);this.snapper.isEqualWithPrecision(d-c,2*Math.PI)||u.vertices.pop(),u.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,i.z)),this.ellipticalArc=u,this.ellipticalArcCenter=new THREE.Vector3(a,b,i.z),this.vpIdElliptical=h}},this.snapping2D=function(a){if(a){var b=a.intersectPoint,e=a.fragId;if("undefined"!=typeof e){Array.isArray(e)||(e=[e]),r=b,j=this.setDetectRadius(b);var f=null!=d.model.getFragmentList();if(!f)return u=!0,q=SNAP_VERTEX,o=b,void this.drawPoint(o);for(var g=new c(d,this),h=0;h<e.length;++h){var i=d.impl.getRenderProxy(d.model,e[h]),k=new Autodesk.Viewing.Private.VertexBufferReader(i.geometry);k.enumGeomsForObject(a.dbId,g)}if(g.circularArc){if(v=g.vpIdCircular,null!==z&&z!==v)return;b.distanceTo(g.circularArc.vertices[0])<j?(o=g.circularArc.vertices[0],this.drawPoint(o),q=SNAP_VERTEX):b.distanceTo(g.circularArc.vertices[g.circularArc.vertices.length-1])<j?(o=g.circularArc.vertices[g.circularArc.vertices.length-1],this.drawPoint(o),q=SNAP_VERTEX):(this.lineStripToPieces(g.circularArc),n=g.circularArc,this.drawLine(n),w=g.circularArcCenter,x=g.circularArcRadius,q=SNAP_CIRCULARARC),u=!0}else if(g.ellipticalArc){if(v=g.vpIdElliptical,null!==z&&z!==v)return;b.distanceTo(g.ellipticalArc.vertices[0])<j?(o=g.ellipticalArc.vertices[0],this.drawPoint(o),q=SNAP_VERTEX):b.distanceTo(g.ellipticalArc.vertices[g.ellipticalArc.vertices.length-1])<j?(o=g.ellipticalArc.vertices[g.ellipticalArc.vertices.length-1],this.drawPoint(o),q=SNAP_VERTEX):(this.lineStripToPieces(g.ellipticalArc),n=g.ellipticalArc,this.drawLine(n),w=g.ellipticalArcCenter,x=null,q=SNAP_CIRCULARARC),u=!0}else if(g.lineGeom.vertices.length){if(v=g.vpIdLine,null!==z&&z!==v)return;if(this.markupMode){var l=g.lineGeom.vertices[0],m=g.lineGeom.vertices[1],p=new THREE.Vector3;p.addVectors(l,m),p.divideScalar(2);var s=b.distanceTo(p),t=b.distanceTo(l),y=b.distanceTo(m);n=g.lineGeom,s<j?(o=p,this.drawPoint(o),q=SNAP_VERTEX):t<j?(o=l,this.drawPoint(o),q=SNAP_VERTEX):y<j?(o=m,this.drawPoint(o),q=SNAP_VERTEX):(this.drawLine(n),q=SNAP_EDGE)}else b.distanceTo(g.lineGeom.vertices[0])<j?(o=g.lineGeom.vertices[0],this.drawPoint(o),q=SNAP_VERTEX):b.distanceTo(g.lineGeom.vertices[1])<j?(o=g.lineGeom.vertices[1],this.drawPoint(o),q=SNAP_VERTEX):(n=g.lineGeom,this.drawLine(n),q=SNAP_EDGE);u=!0}}}},this.lineStripToPieces=function(a){for(var b=a.vertices,c=b.length-2;c>0;c--)b.splice(c,0,b[c])},this.createOverlay=function(a){d.impl.createOverlayScene(a)},this.addOverlay=function(a,b){d.impl.addOverlay(a,b)},this.clearOverlay=function(){d.impl.overlayScenes[g]&&d.impl.clearOverlay(g),d.impl.overlayScenes[h]&&d.impl.clearOverlay(h),d.impl.overlayScenes[i]&&d.impl.clearOverlay(i)},this.drawFace=function(a){this.createOverlay(g);var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=new THREE.Mesh(a,d,!0);this.addOverlay(g,e)},this.cylinderMesh=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=new THREE.Matrix4;e.lookAt(a,b,(new THREE.Object3D).up),e.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var f=new THREE.CylinderGeometry(.5,.5,d.length(),8,1,!0),g=new THREE.Mesh(f,c);return g.applyMatrix(e),g.position.x=(b.x+a.x)/2,g.position.y=(b.y+a.y)/2,g.position.z=(b.z+a.z)/2,g},this.drawLine=function(a){this.createOverlay(i);for(var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=0;e<a.vertices.length;e+=2){var f=this.cylinderMesh(a.vertices[e],a.vertices[e+1],d);this.setEdgeScale(f),this.addOverlay(i,f)}},this.drawArc=function(a){this.createOverlay(i);for(var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=0;e<a.vertices.length-1;e++){var f=this.cylinderMesh(a.vertices[e],a.vertices[e+1],d);this.setEdgeScale(f),this.addOverlay(i,f)}},this.drawPoint=function(a){this.createOverlay(h);var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1}),e=new THREE.Mesh(new THREE.SphereGeometry(1),d);e.position.set(a.x,a.y,a.z),this.setPointScale(e),this.addOverlay(h,e)},this.setScale=function(a){var b=5,c=d.navigation,e=c.getCamera(),f=c.getEyeVector(),g=c.getPosition(),h=a.position.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):c.getEyeVector().length(),j=c.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=c.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.setPointScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.y=b,a.scale.z=b},this.setEdgeScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.z=b},this.updatePointScale=function(){var a=d.impl.overlayScenes[h];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var e=b.children[c];e&&this.setPointScale(e)}},this.updateEdgeScale=function(){var a=d.impl.overlayScenes[i];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var e=b.children[c];e&&this.setEdgeScale(e)}},this.setDetectRadius=function(a){var b=av.isMobileDevice()?25:10,c=d.navigation,e=c.getCamera(),f=c.getEyeVector(),g=c.getPosition(),h=a.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):c.getEyeVector().length(),j=c.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=c.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.drawIntersectFace=function(a,b,c,d){this.createOverlay();var e=new THREE.Vector3;e.set(b[a.a*c],b[a.a*c+1],b[a.a*c+2]);var f=new THREE.Vector3;f.set(b[a.b*c],b[a.b*c+1],b[a.b*c+2]);var g=new THREE.Vector3;g.set(b[a.c*c],b[a.c*c+1],b[a.c*c+2]);var h=new THREE.Geometry;h.vertices.push(e),h.vertices.push(f),h.vertices.push(g),h.faces.push(new THREE.Face3(0,1,2));var i=new THREE.Mesh(h,d.material,!0);i.matrixWorld=d.matrixWorld,this.addOverlay(i)},this.handleWheelInput=function(a){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(a,b){return t=!0,!1},this.handleButtonUp=function(a,b){return t=!1,!1},this.handleMouseMove=function(a){if(!t){this.clearOverlay(),m=null,n=null,o=null,u=!1;var b=d.impl.snappingHitTest(a.canvasX,a.canvasY,!1);b&&b.intersectPoint&&(b.face?this.snapping3D(b):this.snapping2D(b))}return!1},this.handleSingleTap=function(a){return this.handleMouseMove(a)},this.destroy=function(){this.clearOverlay(),d.impl.removeOverlayScene(g),d.impl.removeOverlayScene(h),d.impl.removeOverlayScene(i)},this.onMouseMove=function(a){this.clearOverlay(),m=null,n=null,o=null,q=null,u=!1;var b=d.impl.snappingHitTest(a.x,a.y,!1);b&&b.intersectPoint&&(b.face?this.snapping3D(b):this.snapping2D(b))},this.nearestPointInPointToEdge=function(a,b){for(var c=a.vertices,d=Number.MAX_VALUE,e=null,f=0;f<c.length;f+=2){var g=this.nearestPointInPointToSegment(b,c[f],c[f+1]),h=b.distanceTo(g);h<d&&(d=h,e=g)}return e},this.nearestPointInPointToSegment=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),e<0?d=b:e>1?d=c:(f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)),d},this.nearestPointInPointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)}},function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){function b(a){if(q)return!1;var b=a.ctrlKey||e&&a.metaKey,c=a.metaKey&&!e;return b||c||a.shiftKey||a.altKey}var c,d=Autodesk.Viewing.Private,e=navigator.userAgent.search("Mac OS")!=-1,f=a.navigation,g=a.container,h=f.getCamera(),i=["firstperson"],j={SHIFT:0,ALT:0,CONTROL:0},k=Autodesk.Viewing.theHotkeyManager.KEYCODES,l=!1,m=!1,n=!0,o=!1,p=0,q=null,r=new THREE.Clock(!0),s=-1,t=5e3,u=1,v=1,w=2,x=2,y=1,z=.5,A=.0035,B=0,C=0,D=0,E=-1e20,F=0,G=0,H=-1e20,I=0,J=0,K=!1,L=!1,M=!1,N=!1,O=!1,P=!1,Q=h.fov,R=!1,S=h.isPerspective,T=!1,U=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(c=new Autodesk.Viewing.Extensions.GamepadModule(a)),this.isActive=function(){return l},this.getNames=function(){return i},this.getName=function(){return i[0]},this.activate=function(b){r.start(),S=h.isPerspective,f.toPerspective(),Q=h.fov,f.setVerticalFov(75,!0),u=a.model.getUnitScale();
var d=a.model.getBoundingBox().size();v=Math.max(Math.min(Math.min(d.x,d.y),d.z)/10,1e-4),a.canvas.focus(),l=!0,a.getFirstPersonToolPopup()&&!U&&Y(),addCrosshair(),c&&c.activate(this.getName())},this.deactivate=function(a){l=!1,r.stop(),W(),removeCrosshair(),R&&f.setVerticalFov(Q,!0),T&&(S||f.toOrthographic()),c&&c.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(a){0===a?x=w:(x*=a>0?1.1:.9,x<.01&&(x=.01))},this.handleGesture=function(a){switch(a.pointers&&a.pointers.length>0&&(a.pageX=a.pointers[0].pageX,a.pageY=a.pointers[0].pageY),a.type){case"dragstart":return q="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===q&&this.handleMouseMove(a);case"dragend":return"drag"===q&&(this.handleButtonUp(a,0),q=null,!0)}return!1},this.handleSingleClick=function(a,b){return!1},this.handleButtonDown=function(a,c){W(),p+=1<<c;var d=b(a);return!(0===c&&!d)||(C=a.pageX-window.innerWidth/2,F=a.pageY-window.innerHeight/2,E=a.pageX,H=a.pageY,I=J=0,D=G=0,o=!0,!0)},this.handleMouseMove=function(a){var b=E<-1e10?0:a.pageX-E,c=H<-1e10?0:a.pageY-H;return E=a.pageX,H=a.pageY,o!==n||m||(I+=b*A,J+=c*A),!0},this.handleButtonUp=function(a,b){return p-=1<<b,0!==b||!o||(I=J=0,D=G=0,o=!1,!0)},this.handleKeyDown=function(a,b){if(m)return!1;W();var c=!1,d=!1;switch(b){case k.ESCAPE:break;case k.TAB:d=!1;break;case k.SHIFT:j.SHIFT=1,c=d=!0;break;case k.CONTROL:j.CONTROL=1,c=d=!0;break;case k.ALT:j.ALT=1,c=d=!0;break;case k.SPACE:j.SPACE=1,c=d=!0;break;case k.EQUALS:this.adjustSpeed(1),d=!0;break;case k.DASH:this.adjustSpeed(-1),d=!0;break;case k.ZERO:this.adjustSpeed(0),d=!0;break;case k.UP:case k.w:K=!0,d=!0;break;case k.LEFT:case k.a:M=!0,d=!0;break;case k.DOWN:case k.s:L=!0,d=!0;break;case k.RIGHT:case k.d:N=!0,d=!0;break;case k.q:O=!0,d=!0;break;case k.e:P=!0,d=!0;break;case k.g:d=!0;break;case k.F1:d=!0}return d},this.handleKeyUp=function(a,b){if(m)return!1;var c=!1,d=!1;switch(b){case k.TAB:d=!1;break;case k.SHIFT:j.SHIFT=0,c=d=!0;break;case k.CONTROL:j.CONTROL=0,c=d=!0;break;case k.ALT:j.ALT=0,c=d=!0;break;case k.SPACE:j.SPACE=0,c=d=!0;break;case k.UP:case k.w:K=!1,d=!0;break;case k.LEFT:case k.a:M=!1,d=!0;break;case k.DOWN:case k.s:L=!1,d=!0;break;case k.RIGHT:case k.d:N=!1,d=!0;break;case k.q:O=!1,d=!0;break;case k.e:P=!1,d=!0;break;case k.g:D=G=0,n=!n,X(n),d=!0;break;case k.F1:Y(),d=!0}return d},this.handleWheelInput=function(a){return!m&&(f.getReverseZoomDirection()&&(a*=-1),B+=a,!0)},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return K=L=!1,M=N=!1,O=P=!1,!1},this.update=function(){if(!l||!f.isActionEnabled("walk"))return!1;var a=r.getDelta();if(s>-1){var b=(new Date).getTime();b-s>t&&W()}h.isPerspective||(console.log("Lost perspective mode: resetting view."),f.toPerspective());var d=h.clone(),e=a*x*v*(1===j.SHIFT?4:1),g=a*z*v*(1===j.SHIFT?4:1);if(0!=B){var i=B*y*v*(1===j.SHIFT?4:1);d.translateZ(-i),B=0}K&&d.translateZ(-e),L&&d.translateZ(e),M&&d.translateX(-e),N&&d.translateX(e),O&&d.translateY(g),P&&d.translateY(-g);var k=d.position,m=0!==k.distanceToSquared(h.position),n=d.target,o=h.target.clone().sub(h.position),p=o.clone().cross(h.up).normalize();if(0!=J){var q=new THREE.Quaternion;q.setFromAxisAngle(p,-J);var u=o.clone();u.applyQuaternion(q);var w=h.worldup.clone(),A=u.angleTo(w),C=THREE.Math.degToRad(5);A>=C&&A<=Math.PI-C&&(o.applyQuaternion(q),d.up.applyQuaternion(q)),J=0}if(0!=I){var D=new THREE.Quaternion;D.setFromAxisAngle(h.worldup,-I),o.applyQuaternion(D),d.up.applyQuaternion(D),I=0}n=k.clone().add(o);var E=0!==n.distanceToSquared(h.target);return(m||E)&&(f.setView(k,n),f.orientCameraUp()),c&&(h=c.update(h)),h.dirty};var V=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(g,a,c,d,e),b>0?(s=(new Date).getTime(),t=b):(s=-1,t=0))},W=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),s=-1},X=function(a){W();var b={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:a?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation"},c=function(){};V(b,0,c)},Y=function(){W();var b={msgTitleKey:"First Person Tool",messageKey:"Use the WASD and QE keys to move",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:U},c=function(){};V(b,0,c,null,function(b){U=b.target.checked,a.setFirstPersonToolPopup(!b.target.checked)})};addCrosshair=function(){d.stringToDOM&&(this.crosshair=d.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),a.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b),b.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(b){if(b.toolName.indexOf("firstperson")!==-1&&a.firstPersonToolButton){var d=b.active?c.Button.State.ACTIVE:c.Button.State.INACTIVE;a.firstPersonToolButton.setState(d)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar){var b=this,c=Autodesk.Viewing.UI,d=a.getToolbar(!0),e=d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new c.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(d){var e=b.firstPersonToolButton.getState();e===c.Button.State.INACTIVE?a.setActiveNavigationTool("firstperson"):e===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.firstPersonToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRTool=function(a,b){var c=Autodesk.Viewing,d=a.navigation,e=a.container,f=d.getCamera(),g=["vr"],h=!1,i=null,j=!1,k=!0,l=!1,m={SHIFT:0,ALT:0,CONTROL:0},n=Autodesk.Viewing.theHotkeyManager.KEYCODES,o=0,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v=!1,w=new THREE.Clock(!0),x=-1,y=5e3,z=1,A=16,B=15,C=3,D=!1,E=1.75,F=16,G=15,H=(f.fov,f.isPerspective),I=null,J=null,K=null,L=!1,M=-1,N=!0,O=null,P=null,Q=.15,R=!1,S=new THREE.Vector3(0,0,0),T=new THREE.Vector3(0,0,0),U=!1;Math.PI/2;this.isActive=function(){return h},this.getNames=function(){return g},this.getName=function(){return g[0]},this.activate=function(b){if(!h){j=f.worldup&&1===f.worldup.x,k=f.worldup&&1===f.worldup.y,l=f.worldup&&1===f.worldup.z,console.log("VRTool : camera world up = "+f.worldup.x+","+f.worldup.y+","+f.worldup.z),w.start(),Y()?(ga(),V(!1),console.log("VR Supported (Web API): Oculus, etc.")):(fa(),window.addEventListener("deviceorientation",aa,!0));var c=a.config&&a.config.useVR?a.config.useVR:"";U="wearality"===c.toLowerCase(),W(!0);var d=a.utilities.getBoundingBox(!0).size();z=Math.max(Math.min(Math.min(d.x,d.y),d.z)/100,1),this.resetPointerTracking(),a.canvas.focus(),da(),h=!0}},this.deactivate=function(a){h&&(h=!1,ca(),I&&(K&&(K.stop(),K=null),I.disconnect(),I=null,J&&J.disable()),W(!1),c.exitFullscreen(),w.stop(),V(!0))},this.getCursor=function(){return"url(data:image/gif;base64,R0lGODlhGAAYAMIDAAQEBH19feDg4P///////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAYABgAAAMqSLrc/jDKSau9OOvN8fjDNghBIITZEABAgHpr+15jeYpgp+987//AICEBADs=), auto"};var V=function(a){var b=document.getElementsByClassName("toolbar-menu");b.length>0&&""!==b[0]&&(b[0].style.display=a?"block":"none")},W=function(b){if(b!==!!i)if(console.log("Enable Render Context: "+b),b){a.displayViewCube(!1,!1),H=a.navigation.isPerspective,H||a.navigation.toPerspective();var d=!!O,e=null;if(U){var f=.075;e={useWarp:d,HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:f,lensSeparationDistance:f,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]}}}else e={useWarp:d};i=new Autodesk.Viewing.Extensions.Oculus.StereoRenderContext(e),a.impl.setUserRenderContext(i),a.resize(a.canvas.clientWidth,a.canvas.clientHeight),O?c.launchFullscreen(a.impl.canvas,{vrDisplay:O}):c.launchFullscreen(a.impl.canvas)}else i=null,a.impl.setUserRenderContext(null),a.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),a.displayViewCube(a.prefs.get("viewCube"),!1)};this.handleSingleTap=function(b){if(I&&b.pointers){if(1===b.pointers.length)return setTimeout(function(){a.setActiveNavigationTool(a.defaultNavigationToolName)},10),!0;if(2===b.pointers.length)return X(),!0}return!1},this.handleDoubleTap=function(a){return!1},this.handlePressHold=function(a){return!1},this.handleGesture=function(a){if(I)switch(a.type){case"dragstart":v=!0;break;case"dragmove":break;case"dragend":v=!1}return!1},this.handleKeyDown=function(a,b){var c=!1,d=!1;switch(b){case n.TAB:d=!0;break;case n.SHIFT:m.SHIFT=1,c=!0,d=!0;break;case n.CONTROL:m.CONTROL=1,c=!0,d=!0;break;case n.ALT:m.ALT=1,c=!0,d=!0;break;case n.SPACE:d=!0;break;case n.EQUALS:this.adjustSpeed(1),d=!0;break;case n.DASH:this.adjustSpeed(-1),d=!0;break;case n.ZERO:this.adjustSpeed(0),d=!0;break;case n.w:if(1===m.CONTROL&&1===m.SHIFT){d=!0;break}case n.UP:p=!0,d=!0;break;case n.LEFT:case n.a:r=!0,d=!0;break;case n.DOWN:case n.s:q=!0,d=!0;break;case n.RIGHT:case n.d:s=!0,d=!0;break;case n.q:u=!0,d=!0;break;case n.e:t=!0,d=!0;break;case n.h:d=!0}return d},this.handleKeyUp=function(a,b){var c=!1,d=!1;switch(b){case n.SHIFT:m.SHIFT=0,c=!0;break;case n.CONTROL:m.CONTROL=0,c=!0;break;case n.ALT:m.ALT=0,c=!0;break;case n.SPACE:O&&$(),d=!0;break;case n.w:if(!p&&1===m.CONTROL&&1===m.SHIFT){setTimeout(function(){W(!1),U=!U,W(!0)},10),d=!0;break}case n.UP:p=!1,d=!0;break;case n.LEFT:case n.a:r=!1,d=!0;break;case n.DOWN:case n.s:q=!1,d=!0;break;case n.RIGHT:case n.d:s=!1,d=!0;break;case n.q:u=!1,d=!0;break;case n.e:t=!1,d=!0;break;case n.h:da(),d=!0}return d},this.handleBlur=function(a){return p=!1,q=!1,r=!1,s=!1,!1},this.update=function(a){if(h){var b=w.getDelta();if(x>-1){var c=(new Date).getTime();c-x>y&&ca()}var e=!1;O&&Z(b)?e=!0:I&&_(b)&&(e=!0);var g=f.clone(),i=b*A*z*(1===m.SHIFT?4:1),j=b*B*z*(1===m.SHIFT?4:1);if(0!=o){var k=o*C*z*(1===m.SHIFT?4:1);g.translateZ(-k),o=0}var l=!1,n=!1,v=!1,E=!1;D&&(l=!0),(p||l)&&g.translateZ(-i),(q||n)&&g.translateZ(i),(r||v)&&g.translateX(-i),(s||E)&&g.translateX(i),t&&g.translateY(j),u&&g.translateY(-j);var F=g.position,G=0!==F.distanceToSquared(f.position);if(G){var H=g.target,J=F.clone().sub(f.position);H.add(J),d.setView(F,H)}return f.dirty}},this.resetPointerTracking=function(){p=q=!1,r=s=!1,t=u=!1,_mouseDraggingLookMode=!1};var X=function(){return D=!D,D?(F=A,A=E,M=(new Date).getTime()):A=F,ea(D),D},Y=function(){function a(a){for(var c=0;c<a.length;++c)a[c]instanceof HMDVRDevice&&(O=a[c]);for(var c=0;c<a.length;++c)a[c]instanceof PositionSensorVRDevice&&(!O||a[c].hardwareUnitId==O.hardwareUnitId)&&(P=a[c],b=!0)}var b=!1;return navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices?navigator.mozGetVRDevices(a):b=!1,b},Z=function(a){if(!P)return!1;var b=P.getState();if(f){if(l?(T.x=b.position.x,T.y=-b.position.z,T.z=b.position.y):(T.x=b.position.x,T.y=b.position.y,T.z=b.position.z),R){var c=S.distanceTo(T);if(c>=Q){var d=(c-Q)/.0762,e=a*A*z*d,g=T.clone().sub(S).normalize().multiplyScalar(e);f.position.add(g)}}l?(f.quaternion.x=b.orientation.x,f.quaternion.y=-b.orientation.z,f.quaternion.z=b.orientation.y,f.quaternion.w=b.orientation.w):(f.quaternion.x=b.orientation.x,f.quaternion.y=b.orientation.y,f.quaternion.z=b.orientation.z,f.quaternion.w=b.orientation.w);var h=new THREE.Vector3(0,0,-1);l&&(h=new THREE.Vector3(h.x,-h.z,h.y)),h.applyQuaternion(f.quaternion),f.target=f.position.clone().add(h.clone().multiplyScalar(10)),f.dirty=!0}return!0},$=function(){O&&(R=!R,R&&S.copy(T),ea(R))},_=function(a){if(!I)return!1;var b=I.update();if(!b)return!1;if(l){var c=b.z;b.z=b.y,b.y=-c}var e=l?new THREE.Vector3(0,1,0):new THREE.Vector3(0,0,-1),g=e.clone().applyQuaternion(b),h=f.target.clone().sub(f.position).length();if(d.setTarget(f.position.clone().add(g.multiplyScalar(h))),K){if(K.isStarted())if(M<=0)K.checkVideoThreshold(G)&&X();else{var i=K.checkVideoThreshold(G);if(i){if(D){var j=(new Date).getTime(),k=j-M;k>250&&(M=j,A+=F,ea(!0))}}else M=-1}}else{var m=l?new THREE.Vector3(0,0,-1):new THREE.Vector3(0,-1,0),n=THREE.Math.radToDeg(g.angleTo(m));if(n<30)if(L){if(D){var j=(new Date).getTime(),k=j-M,o=N?1500:1e3;k>=o&&(N=!1,M=j,A+=F,ea(!0))}}else X(),L=!0,D&&(N=!0);else n>=30&&(L=!1,M=-1)}return f.dirty=!0,!0},aa=function(a){return!!a.alpha&&(window.removeEventListener("deviceorientation",aa,!0),I=new THREE.DeviceOrientationControls,I.connect(),J||(J=new window.NoSleep,J.enable()),K=new VideoHelper("videoVR","videoVR-canvas",1),K.start()||(K=null,console.log("VideoHelper : Failed to start.")),V(!1),console.log("VR Supported (DeviceOrientation): Google Goggles, etc."),!0)},ba=function(a,b){Autodesk.Viewing.Private.HudMessage.dismiss(),Autodesk.Viewing.Private.HudMessage.displayMessage(e,a),x=(new Date).getTime(),(!b||b<=0)&&(b=5e3),y=b},ca=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),x=-1},da=function(){var a={msgTitleKey:"Virtual Reality Tool",messageKey:"Virtual Reality Tool",messageDefaultValue:"This is the Virtual Reality tool"};ba(a,3e3)},ea=function(a,b){(!b||b<=0)&&(b=250);var c=Autodesk.Viewing.i18n.translate("START Auto Move"),d=Autodesk.Viewing.i18n.translate("STOP Auto Move"),e=a?c+" ("+Math.floor(A)+")":d,f={msgTitleKey:"VR Toggle Move",messageKey:"VR Toggle Move",messageDefaultValue:e};ba(f,b)},fa=function(){var a={msgTitleKey:"VR Device Orientation",messageKey:"VR Device Orientation",messageDefaultValue:"VR Mode Enabled Device Orientation"};ba(a,2e3)},ga=function(){var a={msgTitleKey:"VR Head Mounted Display",messageKey:"VR Head Mounted Display",messageDefaultValue:"VR Mode Enabled Head Mounted Display"};ba(a,2e3)}},AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.VR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.VR.VRExtension,Autodesk.Viewing.Extensions.VR.VRExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),d=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.VR.VRTool(b,this),b.toolController.registerTool(this.tool),this.createUI(c),this.onToolChanged=function(b){if(b.toolName.indexOf("vr")!==-1){var c=b.active?d.Button.State.ACTIVE:d.Button.State.INACTIVE;a.vrToolButton.setState(c)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.createUI=function(a){var b=this,c=this.viewer,d=Autodesk.Viewing.UI,e=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new d.Button("toolbar-vrTool"),this.vrToolButton.setToolTip("Virtual Reality Tool"),this.vrToolButton.setIcon("toolbar-vrToolButton"),this.vrToolButton.onClick=function(a){var e=b.vrToolButton.getState();e===d.Button.State.INACTIVE?c.setActiveNavigationTool("vr"):e===d.Button.State.ACTIVE&&c.setActiveNavigationTool()};var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.vrToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.vrToolButton)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);return b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId()),this.vrToolButton=null,a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.VR",Autodesk.Viewing.Extensions.VR.VRExtension),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}function b(a){function b(){return 100*a.model.getUnitScale()}function c(a){var b=a[1];return a[1]=-a[2],a[2]=b,a}function g(a,b){var c=b.model.getData().globalOffset;return c&&(a[0]+=c.x,a[1]+=c.y,a[2]+=c.z),a}function i(a){return a.isOrthographic?a.orthographicHeight*a.aspectRatio:f(Math.tan(h(a.fieldOfView)*a.aspectRatio))}function j(a){var c=b(a.Units);a.View.Eye[0]*=c,a.View.Eye[1]*=c,a.View.Eye[2]*=c,a.Projection.IsOrthographic&&(a.Projection.Extent*=c)}var k=new Autodesk.Viewing.Private.ViewerState(a).getState(),l=k.viewport,m=l.eye,n=l.target,o=l.up;m=g(m,a),n=g(n,a),m=c(m),n=c(n),o=c(o),n=e([n[0]-m[0],n[1]-m[1],n[2]-m[2]]),o=e(o);var p=i(l),q=d(a),r={Projection:{Extent:p,IsOrthographic:l.isOrthographic,NativeAspect:l.aspectRatio},Units:q,View:{Eye:m,At:n,Up:o}};return j(r),r.Units="CENTIMETER",r}function c(a,b){function c(a,b){var c=1/(100*b.model.getUnitScale()),d=1;switch(a.toUpperCase()){case"FOOT":d=1/30.48;break;case"INCH":d=1/2.54;break;case"KILOMETER":d=1e-5;break;case"METER":d=.01;break;case"CENTIMETER":d=1;break;case"MILLIMETER":d=10}return c}function d(a){var b=a[1];return a[1]=a[2],a[2]=-b,a}function h(a,b,d){var e=c(b.Units,d);a.viewport.eye[0]*=e,a.viewport.eye[1]*=e,a.viewport.eye[2]*=e,a.viewport.isOrthographic&&(a.viewport.orthographicHeight*=e)}function i(a,b){var c=b.model.getData().globalOffset;return c&&(a[0]-=c.x,a[1]-=c.y,a[2]-=c.z),a}function j(a,b){var c=b.Projection,d=c.NativeAspect;c.IsOrthographic?a.viewport.orthographicHeight=c.Extent/d:a.viewport.fieldOfView=g(f(Math.tan(c.Extent))/d)}b=JSON.parse(JSON.stringify(b)),b.Projection.IsOrthographic=b.Projection.IsOrthographic||b.Projection.isOrthographic;var k=d(b.View.Eye),l=e(d(b.View.At)),m=e(d(b.View.Up)),n=b.Projection.NativeAspect,o=b.Projection.IsOrthographic,p=o?"orthographic":"perspective",q={viewport:{eye:k,target:[k[0]+l[0],k[1]+l[1],k[2]+l[2]],up:m,aspectRatio:n,projection:p,isOrthographic:o}};j(q,b),h(q,b,a),i(q.viewport.eye,a),q.viewport.target=[q.viewport.eye[0]+10*l[0],q.viewport.eye[1]+10*l[1],q.viewport.eye[2]+10*l[2]],new Autodesk.Viewing.Private.ViewerState(a).restoreState(q)}function d(a){var b=a.model.getUnitScale();switch(b){case 1:return"METER";case.3048:return"FOOT";case.0254:return"INCH";case.01:return"CENTIMETER";case.001:return"MILLIMETER";case 1e3:return"KILOMETER";default:return"METER"}}function e(a){var b=a[0],c=a[1],d=a[2],e=Math.sqrt(b*b+c*c+d*d);if(0===e)return a;var f=1/e;return[b*f,c*f,d*f]}function f(a){var b=Math.atan(a);return b<0?b+Math.PI:b}function g(a){return a*(180/Math.PI)}function h(a){return a*(Math.PI/180)}var i=AutodeskNamespace("Autodesk.Viewing.Extensions.RaaS");j=Object.create(Autodesk.Viewing.Extension.prototype),j.constructor=a,i.RaaS=a;var j=a.prototype;j.load=function(){return!0},j.unload=function(){return!0},j.setShot=function(a){},j.getShot=function(){},j.getCameraAsRenderDescriptor=function(){return b(this.viewer)},j.setCameraFromViewName=function(a){var b=this.viewer.model.getDocumentNode();b.search({type:"3d",role:"view"}),this.viewer.setViewCube(a)},j.setCameraFromRenderDescriptor=function(a){return c(this.viewer,a)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.RaaS",a)}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a;var c=a.prototype;c.load=function(){var a=this.viewer,c=a.getToolbar(!0);return this.tool=new b.ZoomWindowTool(a),a.toolController.registerTool(this.tool),this.createUI(c),!0},c.createUI=function(a){var b=this,c=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c.dollybutton&&(c.removeControl(c.dollybutton.getId()),this.defaultDollyButton=c.dollybutton),this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("adsk-icon-zoom"),this.createZoomSubmenu(this.zoomWindowToolButton),c.addControl(this.zoomWindowToolButton);var d=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){b.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(b.viewer.setActiveNavigationTool(),b.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}];Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,d)},c.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(c)),c.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,c.panbutton&&this.defaultDollyButton?c.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},c.createNavToggler=function(a,b,c){return function(){var d=b.getState();d===Autodesk.Viewing.UI.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):d===Autodesk.Viewing.UI.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},c.createZoomSubmenu=function(a){var b=this.viewer,c=b.getToolbar(!0),d=(c.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"));d.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),d.setIcon("toolbar-zoomWindowTool"),d.onClick=this.createNavToggler(b,d,"zoomwindow"),a.addControl(d);var e=new Autodesk.Viewing.UI.Button("toolbar-zoomTool");e.setToolTip("Zoom"),e.setIcon("adsk-icon-zoom"),e.onClick=this.createNavToggler(b,e,"dolly"),a.addControl(e),a.onClick=e.onClick},c.unload=function(){var a=this.viewer;return"dolly"!==a.getActiveNavigationTool()&&"zoomwindow"!==a.getActiveNavigationTool()||a.setActiveNavigationTool(),this.destroyUI(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",a)}(),function(){"use strict";function a(a){var d=["zoomwindow"],e=!1,f=!1,g=new THREE.Vector3(0,0,-10),h=new THREE.Vector3(0,0,-10),i=null,j=null,k=null,l=null,m=null,n=a.navigation.getCamera();this.isActive=function(){return e},this.getNames=function(){return d},this.getName=function(){return d[0]},this.onResize=function(){m=null;var b=a.canvas,c=b.clientWidth,d=b.clientHeight,e=new THREE.OrthographicCamera(0,c,0,d,1,1e3);a.impl.overlayScenes.ZoomWindowRect.camera=e},this.activate=function(b){if(e=!0,null===i){var c=null;c=a.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),i=new THREE.LineBasicMaterial({color:c,opacity:.6,linewidth:1})}var d=a.canvas,f=d.clientWidth,g=d.clientHeight,h=new THREE.OrthographicCamera(0,f,0,g,1,1e3);a.impl.createOverlayScene("ZoomWindowRect",i,i,h),a.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);var j=a.toolController.getTool("dolly");j.activate("orbit")},this.deactivate=function(b){m=null,a.impl.removeOverlayScene("ZoomWindowRect"),e=!1,f=!1,a.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);var c=a.toolController.getTool("dolly");c.deactivate("orbit")},this.getCursor=function(){var b=a.toolController.getTool("dolly"),c=b.getTriggeredMode();switch(c){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"},this.handleGesture=function(a){return!0},this.handleSingleClick=function(a,b){return!0},this.startDrag=function(b){if(f===!1){if(f=!0,g.x=b.canvasX,g.y=b.canvasY,h.x=b.canvasX,h.y=b.canvasY,null===m){j=new THREE.Geometry,j.vertices.push(g.clone(),g.clone(),g.clone(),g.clone(),g.clone()),k=new THREE.Geometry,k.vertices.push(g.clone(),g.clone()),l=new THREE.Geometry,l.vertices.push(g.clone(),g.clone());var c=new THREE.Line(j,i,THREE.LineStrip),d=new THREE.Line(k,i,THREE.LineStrip),e=new THREE.Line(l,i,THREE.LineStrip);m=new THREE.Group,m.add(c),m.add(d),m.add(e)}else j.vertices[0]=g.clone(),j.vertices[1]=g.clone(),j.vertices[2]=g.clone(),j.vertices[3]=g.clone(),j.vertices[4]=g.clone(),k.vertices[0]=g.clone(),k.vertices[1]=g.clone(),l.vertices[0]=g.clone(),l.vertices[1]=g.clone(),k.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0,j.verticesNeedUpdate=!0;a.impl.addOverlay("ZoomWindowRect",m)}},this.handleButtonDown=function(a,b){return 0===b&&(this.startDrag(a),!0)},this.handleMouseMove=function(a){return!(!j||!f)&&(h.x=a.canvasX,h.y=a.canvasY,!0)},this.endDrag=function(b){f===!0&&(a.impl.removeOverlay("ZoomWindowRect",m),f=!1)},this.handleButtonUp=function(a,b){return 0===b&&(this.endDrag(),!0)},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return!1},this.update=function(){if(this.isActive()){if(!j||!f)return this.zoomWindow();j.vertices[1].x=g.x,j.vertices[1].y=h.y,j.vertices[2]=h.clone(),j.vertices[3].x=h.x,j.vertices[3].y=g.y,j.vertices[4]=j.vertices[0];var b=Math.abs(h.x-g.x),d=Math.abs(h.y-g.y),e=b>d?d:b;e>c&&(e=c);var i=.5*e,m=[.5*(h.x+g.x),.5*(h.y+g.y)];return k.vertices[0].x=m[0]-i,k.vertices[0].y=m[1],k.vertices[1].x=m[0]+i,k.vertices[1].y=m[1],l.vertices[0].x=m[0],l.vertices[0].y=m[1]-i,l.vertices[1].x=m[0],l.vertices[1].y=m[1]+i,k.verticesNeedUpdate=!0,l.verticesNeedUpdate=!0,j.verticesNeedUpdate=!0,a.impl.invalidate(!1,!1,!0),!1}},this.getScreenRay=function(a,c,d,e,f){var g=f.position.clone(),h=f.target.clone(),i=h.clone().sub(g),j=f.up.clone(),k=i.clone().cross(j),l=i.length(),m=l*Math.tan(f.fov*b),n=m*f.aspect,o=2*a*n/d,p=o-n,q=2*c*m/e,r=q-m;j=j.normalize().multiplyScalar(r),k=k.normalize().multiplyScalar(p);var s=new THREE.Vector3,t=new THREE.Vector3;return f.isPerspective?(s=g.clone(),t=i.clone(),t.add(j),t.add(k)):(s=g.clone(),s.add(k),s.add(j),t.add(i)),{rayOrigin:s,rayDirection:t}},this.queryMouseRaySceneIntersection=function(b,c){if(null==a)return null;if(null==a.model)return null;if(a.model.is2d())return null;var d=a.impl.hitTest(b,c,!1);return d?d.intersectPoint:null};this.zoomWindow=function(){var b=n,c=a.canvas.clientWidth,d=a.canvas.clientHeight,e=g.x,f=g.y,i=h.x,j=h.y,k=Math.abs(i-e),l=Math.abs(j-f);if(0===k||0===l)return!1;if(h.copy(g),a.navigation.getIs2D()){var m={x:.5*(e+i),y:.5*(f+j)},o=a.navigation.getEyeVector().length(),p=a.impl.clientToViewport(m.x,m.y),q=a.impl.clientToViewport(c/2,d/2);
p.subVectors(p,q),a.navigation.panRelative(p.x/2,p.y/2,o);var r=k/c,s=l/d,t=r>s?r:s;o=a.navigation.getEyeVector().length();var u=a.navigation.getWorldPoint(.5,.5);return a.navigation.dollyFromPoint(o*(t-1),u),!0}var v=!1,w=null;if(!v){var x=.5*(e+i),y=.5*(f+j),z=this.getScreenRay(x,y,c,d,n);w=this.queryMouseRaySceneIntersection(x,y),null===w&&(w=z.rayOrigin.add(z.rayDirection))}var A=b.position.clone(),B=b.target.clone(),C=B.clone().sub(A);C.normalize();var D=b.up.clone();D.normalize();var E=k/l>c/d?c/k:d/l,F=w.distanceTo(A),G=1*F/E,H=C.clone().negate().multiplyScalar(G);A=w.clone().add(H),b.position.set(A.x,A.y,A.z),B=w.clone();var I=B.clone().sub(A);return I.normalize(),b.target.set(B.x,B.y,B.z),b.dirty=!0,!0}}AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow");var b=.017453292519943295,c=20;Autodesk.Viewing.Extensions.ZoomWindow.ZoomWindowTool=a}(),AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function a(a,b,c){function e(b){var c=b.data.msg;if(h.x=c.x1,h.y=c.y1,i.x=c.x2,i.y=c.y2,j=c.explode,c.command)if("gohome"==c.command)h.x=h.y=0,i.x=i.y=0,a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0),k=null;else if("select"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d?a.impl.selector.toggleSelection(d.dbId,d.model):a.impl.selector.clearSelection()}else if("hide"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d&&a.hide(d.dbId)}else if("fly"==c.command)k=k?null:f.target.clone().sub(f.position).normalize();else if("savepoint"==c.command){var c=g.getState(t);r.push(c),alertify.success("Savepoint created.")}else"nextsavepoint"==c.command&&r.length&&(s>=r.length&&(s=0),g.restoreState(r[s++]))}var f,g,h=new THREE.Vector2,i=new THREE.Vector2,j=0,k=null,l=a,m=.02,n=.002,o=.05,p=.01,q=1,r=[],s=0,t={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},u=function(){if(!a.impl.model.is2d()){var b=a.impl.model.getData().bbox.size(),c=b.length();m*=c,n*=c,a.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,u)}};a.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,u),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(a){if(b.addEventListener("joystick",e),c.addEventListener("joystick",e),f=l.navigation.getCamera(),l.model){var h=l.model.getBoundingBox();q=.001*h.size().length(),g=new d.ViewerState(l)}},this.deactivate=function(a){b.removeEventListener("joystick",e),c.removeEventListener("joystick",e),f=null,g=null,r.length=0},this.update=function(b){if(f.isPerspective||a.navigation.toPerspective(),k){var c=k.clone().multiplyScalar(n);f.position.add(c),f.target.add(c)}if(0!=j){var d=a.getExplodeScale()+j*p;d>1&&(d=1),d<0&&(d=0),a.explode(d)}if(0==h.x&&0==h.y&&0==i.x&&0==i.y)return!(!k&&!j);var e=f.target.clone().sub(f.position),g=e.length();e.multiplyScalar(1/g);var l=e.clone().cross(f.up).normalize(),q=e.clone().multiplyScalar(h.y*m);f.position.add(q),f.target.add(q);var r=l.clone().multiplyScalar(h.x*m);f.position.add(r),f.target.add(r);var s=new THREE.Quaternion;s.setFromAxisAngle(l,i.y*o);var t=e.clone().applyQuaternion(s);f.up.applyQuaternion(s);var u=new THREE.Quaternion;return u.setFromAxisAngle(f.worldup,-i.x*o),t.applyQuaternion(u),f.up.applyQuaternion(u),t.multiplyScalar(g),f.target.copy(f.position).add(t),k&&k.copy(f.target).sub(f.position).normalize(),!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a,b){return!1},this.handleTouchChange=function(a,b){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=b.UI;d.Collaboration;c.RemoteControl=function(c,e){b.Extension.call(this,c,e),this.viewer=c,this.client=d.MessageClient.GetInstance(),this.p2p=new d.P2PClient(this.client),this.controllerTool=new a(c,this.client,this.p2p),c.toolController.registerTool(this.controllerTool)},c.RemoteControl.prototype=Object.create(b.Extension.prototype),c.RemoteControl.prototype.constructor=c.RemoteControl,c.RemoteControl.prototype.createUI=function(){var a=this,b=this.viewer;this.controlButton=new e.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===e.Button.State.INACTIVE?(a.connect(),this.setState(e.Button.State.ACTIVE)):(a.disconnect(),this.setState(e.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),b.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(b.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body);var c=Autodesk.Viewing.i18n.translate("Go to this link"),d=Autodesk.Viewing.i18n.translate("Scan the QR code with your device"),f=Autodesk.Viewing.i18n.translate("or");this.panel.body.innerHTML=['<p data-i18n="'+c+'">'+c+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>','<p data-i18n="'+f+'">'+f+"</p>",'<p data-i18n="'+d+'">'+d+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},c.RemoteControl.prototype.load=function(){function a(d){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),c.createUI()}var b=this.viewer,c=this;return b.modelTools&&b.modelTools.getNumberOfControls()>0?c.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),!0},c.RemoteControl.prototype.unload=function(){var a=this.viewer;if(this.p2p.hangup(),this.client.disconnect(),a.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{a.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(a){d.logger.error("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},c.RemoteControl.prototype.addCrosshair=function(){this.crosshair=d.stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},c.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},c.RemoteControl.prototype.connect=function(a){if(this.client.isConnected())return void console.log("RemoteControl already connected");var b=this;d.loadDependency("lmv_io","socket.io-1.3.5.js",function(){b.connectAux(a)})},c.RemoteControl.prototype.connectAux=function(a){var b=this,c=this.viewer;b.client.addEventListener("connectSucceeded",function(c){function e(){i&&i.setVisible(!1),b.p2p.removeEventListener("dataChannelAdded",e),b.addCrosshair()}d.logger.log("connect succeeded");var f=c.data.id+"rc";b.client.join(f);var g=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+f+"&env="+d.env,h="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(g),i=b.panel;i&&(i.link.href=g,i.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",i.qrImg.src=h,i.setVisible(!0)),b.p2p.addEventListener("dataChannelAdded",e),a&&a instanceof Function&&a(g)}),c.navigation.toPerspective(),b.client.connect(),c.toolController.activateTool(b.controllerTool.getName())},c.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},b.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",c.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(a){function b(){for(var a in H)if(H.hasOwnProperty(a)&&e.buttons[a].pressed&&.5!=e.buttons[a].value)return y[a]=!0,!0;for(var a in y)if(y.hasOwnProperty(a)&&y[a])return!0;return!(Math.abs(e.axes[F.LEFT_STICK_X])<u&&Math.abs(e.axes[F.LEFT_STICK_Y])<u&&Math.abs(e.axes[F.RIGHT_STICK_X])<u&&Math.abs(e.axes[F.RIGHT_STICK_Y])<u)}function c(){for(var a in E)E.hasOwnProperty(a)&&d(E[a])}function d(a){if(e.buttons[a].value>u)switch(y[a]=!0,a){case E.LEFT_SHOULDER:H[a]();break;case E.RIGHT_SHOULDER:H[a]();break;case E.LEFT_TRIGGER:H[a](e.buttons[E.LEFT_TRIGGER].value);break;case E.RIGHT_TRIGGER:H[a](e.buttons[E.RIGHT_TRIGGER].value)}else if(y[a])switch(y[a]=!1,a){case E.SOUTH_BTN:H[a]();break;case E.EAST_BTN:H[a]();break;case E.WEST_BTN:H[a]();break;case E.NORTH_BTN:H[a]();break;case E.NORTH_DPAD:H[a]();break;case E.SOUTH_DPAD:H[a]();break;case E.WEST_DPAD:H[a]();break;case E.EAST_DPAD:H[a]();break;case E.RIGHT_STICK_BUTTON:H[a]();break;case E.LEFT_STICK_BUTTON:H[a]();break;case E.LEFT_TRIGGER:H[a](e.buttons[E.LEFT_TRIGGER].value);break;case E.RIGHT_TRIGGER:H[a](e.buttons[E.RIGHT_TRIGGER].value)}}var e,f,g,h,i,j,k,l,m,n,o=Autodesk.Viewing.Private,p=a.navigation,q=a.container,r=p.getCamera(),s=1,t=0,u=.1,v=5.5,w=6,x=w,y={},z=new THREE.Clock(!0),A={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},B=2,C=75,D=-45,E={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},F={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},G=function(){},H={};for(var I in E)E.hasOwnProperty(I)&&(H[E[I]]=G);var J=function(){};this.activate=function(b){var c=a.model.getBoundingBox().size();s=Math.max(Math.min(Math.min(c.x,c.y),c.z)/10,1e-4),e=navigator.getGamepads()[0],h=new Autodesk.Viewing.Private.ViewerState(a),i=[],j=0,n=b,N(b)},this.deactivate=function(){n=null,h=null},this.update=function(a,d){if(d&&(r=d),a=z.getDelta(),e=navigator.getGamepads()[0],f>-1){var h=(new Date).getTime();h-f>g&&L()}if(e&&(l=a*B*s*x,r.isPerspective||p.toPerspective(),e&&b())){r.dirty=!0,k&&(m=r.position.z);var i=r.target.clone().sub(r.position),j=i.length();i.multiplyScalar(1/j);var n=i.clone().cross(r.up).normalize();if(Math.abs(e.axes[F.LEFT_STICK_Y])>u){var o=i.clone().multiplyScalar(-e.axes[F.LEFT_STICK_Y]*l);r.position.add(o),r.target.add(o)}if(Math.abs(e.axes[F.LEFT_STICK_X])>u){var q=n.clone().multiplyScalar(e.axes[F.LEFT_STICK_X]*l);r.position.add(q),r.target.add(q)}var t=new THREE.Quaternion,v=i;if(Math.abs(e.axes[F.RIGHT_STICK_Y])>u){var w=r.clone(),y=i.clone();t.setFromAxisAngle(n,-e.axes[F.RIGHT_STICK_Y]*l/2),y.applyQuaternion(t),w.up.applyQuaternion(t);var A=w.worldup.clone(),C=y.angleTo(A),D=THREE.Math.degToRad(5);C>=D&&C<=Math.PI-D&&(v=i.clone().applyQuaternion(t),r.up.applyQuaternion(t))}var E=new THREE.Quaternion;Math.abs(e.axes[F.RIGHT_STICK_X])>u&&(E.setFromAxisAngle(r.worldup,-e.axes[F.RIGHT_STICK_X]*l/2),v.applyQuaternion(E),r.up.applyQuaternion(E)),c(),k&&(r.position.z=m),v.multiplyScalar(j),r.target.copy(r.position).add(v)}return r};var K=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage.displayMessage(q,a,c,d,e),b>0?(f=(new Date).getTime(),g=b):(f=-1,g=0)},L=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),f=-1},M=function(a){L();var b;switch(a){case"up":b=k?"Vertical Lock Mode":"Fly mode";break;case"left":break;case"right":break;case"down":}var c={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:b};K(c,2e3)},N=function(a){switch(a){case"headtracker":H[E.SOUTH_BTN]=X,H[E.SOUTH_DPAD]=O,H[E.NORTH_DPAD]=aa,H[E.WEST_BTN]=$,H[E.LEFT_SHOULDER]=P,H[E.RIGHT_SHOULDER]=Q,H[E.LEFT_TRIGGER]=R,H[E.RIGHT_TRIGGER]=T,H[E.RIGHT_STICK_BUTTON]=Y,H[E.LEFT_STICK_BUTTON]=Z;break;default:H[E.SOUTH_BTN]=X,H[E.EAST_BTN]=U,H[E.WEST_BTN]=$,H[E.NORTH_BTN]=_,H[E.SOUTH_DPAD]=O,H[E.WEST_DPAD]=V,H[E.EAST_DPAD]=W,H[E.NORTH_DPAD]=aa,H[E.LEFT_SHOULDER]=P,H[E.RIGHT_SHOULDER]=Q,H[E.LEFT_TRIGGER]=S,H[E.RIGHT_TRIGGER]=T,H[E.RIGHT_STICK_BUTTON]=Y,H[E.LEFT_STICK_BUTTON]=Z}},O=function(){a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},P=function(){k?m+=-e.buttons[E.LEFT_SHOULDER].pressed*l:r.translateY(-e.buttons[E.LEFT_SHOULDER].pressed*l)},Q=function(){k?m+=e.buttons[E.RIGHT_SHOULDER].pressed*l:r.translateY(e.buttons[E.RIGHT_SHOULDER].pressed*l)},R=function(b){if(b>u){if(.5==b)return void a.explode(0);t=b;var c=t;c>1&&(c=1),c<0&&(c=0),a.explode(c)}else a.explode(0)},S=function(a){if(a>u){if(.5==a)return r.fov=C,void(y[E.LEFT_TRIGGER]=!1);r.fov=D*a+C}else r.fov=C},T=function(a){if(a>u){if(.5==a)return void(y[E.RIGHT_TRIGGER]=!1);x=-(v*a)+w}else x=w},U=function(){var a=h.getState(A);i.push(a),o.logger.log("Savepoint created.")},V=function(){i.length&&(j--,j<0&&(j=i.length-1),h.restoreState(i[j]))},W=function(){i.length&&(j++,j>=i.length&&(j=0),h.restoreState(i[j]))},X=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==n&&r.updateMatrixWorld(),b?a.impl.selector.toggleSelection(b.dbId,b.model):a.impl.selector.clearSelection()},Y=function(){a.impl.selector.clearSelection()},Z=function(){a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},$=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);b&&(b.dbId in a.getHiddenNodes()?a.show(b.dbId):a.hide(b.dbId))},_=function(){a.getPropertyPanel(!0).setVisible(!a.getPropertyPanel(!0).isVisible())},aa=function(){k=!k,k&&(m=r.position.z),M("up")};J()}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var a=this,b=this.viewer;if(this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(b),b.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],b.getToolbar){var c=b.getToolbar(!0);c?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),b.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var d=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,d),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var a=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var a=this.sectionStyle||"X";this.setSectionStyle(a,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(a,b){if(this.supportedStyles.indexOf(a)===-1)return!1;var c=this.isActive(),d=this.sectionStyle!==a||!b;return this.sectionStyle=a,c&&d?this.tool.setSection(a):c||(this.enableSectionTool(!0),d?this.tool.setSection(a):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var a=this.viewer,b=Autodesk.Viewing.UI;this.sectionToolButton=new b.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var c=a.getToolbar(!1),d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(d){var e=d.getControl("toolbar-resetTool");e?d.addControl(this.sectionToolButton,{index:d.indexOf(e.getId())}):d.addControl(this.sectionToolButton,{index:0})}},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState(),e=function(){d.enableSectionTool(!0),a instanceof f.ComboButton==!1?d.tool.setSection(b):d.tool.attachControl(!0)};c===f.Button.State.INACTIVE?(a.setState(f.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(e,1):e()):c===f.Button.State.ACTIVE&&(a.setState(f.Button.State.INACTIVE),d.enableSectionTool(!1)),d.sectionStyle=b}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){return a.subVectors(b,c),a.lengthSq()<d}}(),b=new THREE.Vector3(1,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),h=e.autocam.getWorldRightVector(),i=e.autocam.getWorldUpVector(),j=e.autocam.getWorldFrontVector(),k=1e-4;a(i,b,k)?d.sectionYButton.setIcon("adsk-icon-plane-x"):a(i,g,k)?d.sectionYButton.setIcon("adsk-icon-plane-z"):d.sectionYButton.setIcon("adsk-icon-plane-y"),a(h,f,k)?d.sectionXButton.setIcon("adsk-icon-plane-y"):a(h,g,k)?d.sectionXButton.setIcon("adsk-icon-plane-z"):d.sectionXButton.setIcon("adsk-icon-plane-x"),a(j,b,k)?d.sectionZButton.setIcon("adsk-icon-plane-x"):a(j,f,k)?d.sectionZButton.setIcon("adsk-icon-plane-y"):d.sectionZButton.setIcon("adsk-icon-plane-z"),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var d=this,e=this.viewer,f=Autodesk.Viewing.UI,g=this.sectionXButton=new f.Button("toolbar-sectionTool-x");g.setToolTip("Add X plane"),g.setIcon("adsk-icon-plane-x"),g.onClick=b(g,"X"),a.addControl(g);var h=this.sectionYButton=new f.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane"),h.setIcon("adsk-icon-plane-y"),h.onClick=b(h,"Y"),a.addControl(h);var i=this.sectionZButton=new f.Button("toolbar-sectionTool-z");i.setToolTip("Add Z plane"),i.setIcon("adsk-icon-plane-z"),i.onClick=b(i,"Z"),a.addControl(i);var j=this.sectionBoxButton=new f.Button("toolbar-sectionTool-box");j.setToolTip("Add box"),j.setIcon("adsk-icon-box"),j.onClick=b(j,"BOX"),a.addControl(j),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(c&&this.sectionToolButton){var d=c.getControl("toolbar-inspectSubMenu");d?d.removeControl(this.sectionToolButton.getId()):c.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(a,b){function c(){F||(s=new THREE.TransformControls(u.camera,u.canvas,"transrotate"),s.addEventListener("change",e),s.setSnap(Math.PI/2,Math.PI/36),t=new THREE.TransformControls(u.camera,u.canvas,"translate"),t.addEventListener("change",e),void 0===u.overlayScenes[D]&&u.createOverlayScene(D),u.addOverlay(D,s),u.addOverlay(D,t),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.addEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.addEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!0)}function d(){F&&(u.removeOverlay(D,s),s.removeEventListener("change",e),s=null,u.removeOverlay(D,t),t.removeEventListener("change",e),t=null,u.removeOverlayScene(D),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.removeEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.removeEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!1)}function e(){u.invalidate(!1,!1,!0)}function f(){s&&s.update(),t&&t.update()}function g(){1===A.length&&(k(!0),f(),i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)))}function h(a){return a.color||new THREE.Color(16777215)}function i(a){init_three_triangulator(),init_three_intersector();var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b);var c=new THREE.Object3D;c.name="section",u.sceneAfter.add(c);var d=new THREE.Object3D;c.add(d);var e=new THREE.Object3D;c.add(e);var f=Autodesk.Viewing.Private,g=f.Intersector.makePlaneBasis(a),i=(new THREE.Matrix4).getInverse(g),j=u.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),k=u.matman().findMaterial(null,j);k.transparent=!0,k.depthTest=!0,k.polygonOffset=!0,k.polygonOffsetFactor=-1,k.polygonOffsetUnits=.1;var l=new THREE.Box3,m=u.getVisibleBounds(!0),n=(25e-6*m.size().length(),u.modelQueue().getModels());n.forEach(function(b){var c=b.getData().instanceTree;if(c){var j=b.getFragmentList();c.enumNodeChildren(b.getRootId(),function(b){if(!c.isNodeHidden(b)&&!c.isNodeOff(b)){var m,n=[];if(c.enumNodeFragments(b,function(b){j.getWorldBounds(b,l),f.Intersector.intersectBoxPlane(a,l)&&(m=j.getVizmesh(b),m.geometry&&(m.geometry.is2d||m.geometry.isLines||m.material.cutplanes&&f.Intersector.intersectMeshPlane(a,m,n)))},!1),n.length){var o=new THREE.Box3;f.Intersector.convertToPlaneCoords(g,n,o);var p=new f.VertexBufferBuilder(!1,8*n.length),q=h(m.material),r=0|.25*q.r*255.5,s=0|.25*q.g*255.5,t=0|.25*q.b*255.5,v=4278190080|t<<16|s<<8|r,w=new f.Triangulator.ContourSet(n,o);w.snapEdges(),w.sanitizeEdges(),w.stitchContours();for(var x=0;x<w.contours.length;x++)for(var y=w.contours[x],r=0|255.5*Math.random(),s=0|255.5*Math.random(),t=0|255.5*Math.random(),z=(y[0]===y[y.length-1],1);z<y.length;z++){var A=w.pts[y[z-1]],B=w.pts[y[z]];p.addSegment(A.x,A.y,B.x,B.y,0,.02,v,b,0)}var C={mesh:p.toMesh()};f.BufferGeometryUtils.meshToGeometry(C);var D=C.geometry;D.streamingDraw=!0,D.streamingIndex=!0;var E=new THREE.Mesh(D,k);E.matrix.copy(i),E.matrixAutoUpdate=!1,E.frustumCulled=!1,e.add(E);var F=new f.Triangulator.TriangulatedSurface(w);if(F.indices.length){for(var G=new THREE.BufferGeometry,H=new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)H[3*x]=F.pts[x].x,H[3*x+1]=F.pts[x].y,H[3*x+2]=0;G.addAttribute("position",new THREE.BufferAttribute(H,3));for(var I=m.material.packedNormals,J=I?new Uint16Array(2*F.pts.length):new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)if(I){var K=.5*(0/Math.PI+1),L=1;J[2*x]=65535*K|0,J[2*x+1]=65535*L|0}else J[3*x]=0,J[3*x+1]=0,J[3*x+2]=1;G.addAttribute("normal",new THREE.BufferAttribute(J,I?2:3)),I&&(G.attributes.normal.bytesPerItem=2,G.attributes.normal.normalize=!0);var M=new Uint16Array(F.indices.length);M.set(F.indices),G.addAttribute("index",new THREE.BufferAttribute(M,1)),G.streamingDraw=!0,G.streamingIndex=!0;var N=u.matman().cloneMaterial(m.material);N.packedNormals=I,N.cutplanes=null,N.side=THREE.FrontSide,N.depthTest=!0,N.map=null,N.bumpMap=null,N.normalMap=null,N.alphaMap=null,N.specularMap=null,N.transparent=!1,N.depthWrite=!0,N.hatchPattern=!0,N.needsUpdate=!0;var O=(m.material.id+2)*Math.PI*.125,P=Math.tan(O);N.hatchParams=new THREE.Vector2(P,10),N.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,N.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=N.prismType&&(N.defines={},N.defines[N.prismType.toUpperCase()]="","PrismWood"==N.prismType&&(N.defines.NO_UVW=""));var Q=new THREE.Mesh(G,N);Q.matrix.copy(i),Q.matrixAutoUpdate=!1,Q.dbId=b,Q.fragId=n.fragId,d.add(Q)}}}},!0)}})}function j(a,b){var c,d=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal);if(b){var e=a.projectPoint(b.max),f=a.projectPoint(b.min),g=d.clone().inverse();e.applyQuaternion(g),f.applyQuaternion(g);var h=(new THREE.Vector3).subVectors(e,f);c=new THREE.PlaneBufferGeometry(h.x,h.y)}else{b=u.getVisibleBounds();var h=2*b.getBoundingSphere().radius;c=new THREE.PlaneBufferGeometry(h,h)}var i=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),j=new I.SectionMesh(c,i,a),k=a.projectPoint(b.center());j.position.copy(k),j.quaternion.multiply(d);for(var l=Autodesk.Viewing.Private.LightPresets[u.currentLightPreset()].bgColorGradient,m="rgb("+(255-l[0])+","+(255-l[1])+","+(255-l[2])+")",n=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),o=j.geometry.getAttribute("position"),p=0;p<H.length;p++){var c=new THREE.Geometry;c.vertices.push((new THREE.Vector3).fromArray(o.array,H[p][0]*o.itemSize),(new THREE.Vector3).fromArray(o.array,H[p][1]*o.itemSize));var q=new THREE.Line(c,n);j.add(q),j.outlines.push(q)}return j}function k(a){l(function(b){if(b instanceof I.SectionMesh)if(b.connectivity.length>0){for(var c=(new THREE.Matrix4).getInverse(b.matrixWorld),d=new THREE.Vector3,e=b.geometry.getAttribute("position"),f=0;f<e.length/e.itemSize;f++){var g=b.connectivity[f];null!==J(b.plane,g[0],g[1],d)&&(d.applyMatrix4(c),e.setXYZ(f,d.x,d.y,d.z))}e.needsUpdate=!0,b.geometry.computeBoundingBox(),b.geometry.computeBoundingSphere();for(var f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}else if(a){var i=u.getVisibleBounds(),j=2*i.getBoundingSphere().radius,d=b.plane.projectPoint(i.center());b.geometry=new THREE.PlaneBufferGeometry(j,j),b.position.copy(d);for(var e=b.geometry.getAttribute("position"),f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}})}function l(a){for(var b=0;b<z.length;b++)z[b].traverse(a)}function m(){l(function(a){a instanceof I.SectionMesh&&a.update()}),1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),u.setCutPlanes(A)}function n(a){for(var b=0;b<z.length;b++)z[b].visible=a;y!==a&&e(),y=a}function o(b){b&&A.length>0&&(1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),a.setCutPlanes(A)),n(b)}function p(a,b){a.attach(b),a.setPosition(b.position),a.visible=!0}function q(a){var b=u.api.navigation.getEyeVector();b.dot(a)>0&&a.negate();var c=new THREE.Group,d=new THREE.Plane(a,0),e=j(d,null);c.add(e),A.push(e.planeVec),z.push(c),u.addOverlay(D,c),p(s,e),s.showRotationGizmos(!0),B=s.getPicker(),m()}function r(){for(var a=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],b=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],c=new THREE.Group,d=u.getVisibleBounds(),e=d.center(),f=new THREE.Box3(d.min,e),g=[],h=[],i=0;i<a.length;i++){var k=new THREE.Plane(a[i],-1*e.dot(a[i]));if(g.push(k),i>2){var l=k.orthoPoint(f.max),n=k.orthoPoint(f.min),o=(new THREE.Vector3).subVectors(l,n);k.constant-=o.length()}var q=j(k,f);c.add(q),h.push(q),A.push(q.planeVec)}for(var i=0;i<h.length;i++)for(var q=h[i],r=b[i],v=0;v<r.length;v++){for(var w=[],x=r[v],y=0;y<x.length;y++)w.push(g[x[y]]);q.connectivity.push(w)}z.push(c),u.addOverlay(D,c),p(s,z[0].children[0]),p(t,z[0]),s.showRotationGizmos(!1),B=s.getPicker().concat(t.getPicker()),m()}var s,t,u=a.impl,v=["section"],w=!1,x=!1,y=!0,z=[],A=[],B=[],C="",D="gizmo",E=null,F=!1,G=!0,H=[[0,1],[1,3],[3,2],[2,0]],I=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var J=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h){a.set(e.normal.x,e.normal.y,e.normal.z,f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z);var i=a.determinant();if(0===i)return null;b.crossVectors(f.normal,g.normal).multiplyScalar(-e.constant),c.crossVectors(g.normal,e.normal).multiplyScalar(-f.constant),d.crossVectors(e.normal,f.normal).multiplyScalar(-g.constant);var j=h||new THREE.Vector3;return j.copy(b).add(c).add(d).divideScalar(i)}}(),K=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=u.camera;return function(e,f,g){var h=u.canvas.getBoundingClientRect(),i=(e.clientX-h.left)/h.width*2-1,j=2*-((e.clientY-h.top)/h.height)+1;d.isPerspective?(a.set(i,j,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(i,j,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));var k=c.intersectObjects(f,g);return k[0]?k[0]:null}}();this.isActive=function(){return w},this.setSection=function(a){switch(this.clearSection(),a){case"X":var b=new THREE.Vector3(1,0,0);q(b);break;case"Y":var b=new THREE.Vector3(0,1,0);q(b);break;case"Z":var b=new THREE.Vector3(0,0,1);q(b);break;case"BOX":r()}C=a},this.clearSection=function(){for(s&&s.detach(),t&&t.detach();A.length>0;)A.pop();for(;z.length>0;){var a=z.pop();u.removeOverlay(D,a)}var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),u.setCutPlanes()},this.isPlaneOn=function(){return y},this.showPlane=function(a){n(a)},this.attachControl=function(a){a?(p(s,z[0].children[0]),s.highlight(),"BOX"===C&&p(t,z[0])):(s.detach(),t.detach())},this.resetSection=function(){this.setSection(C)},this.getNames=function(){return v},this.getName=function(){return v[0]},this.register=function(){},this.deregister=function(){this.clearSection(),d()},this.activate=function(a){c(),w=!0,x=!1,G=!0,A=A||[],o(!0)},this.deactivate=function(a){w=!1,x=!1;var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),o(!1),u.setCutPlanes(),s.detach(),t.detach()},this.update=function(a){return!1},this.handleSingleClick=function(a,b){var c=a.pointers?a.pointers[0]:a,d=K(c,z[0].children);return d&&(p(s,d.object),s.highlight(),e()),!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},
this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return x=!0,!!t.onPointerDown(a)||s.onPointerDown(a)},this.handleButtonUp=function(a,b){return x=!1,!!t.onPointerUp(a)||s.onPointerUp(a)},this.handleMouseMove=function(a){if(x){if(t.onPointerMove(a))return m(),s.update(),!0;if(s.onPointerMove(a))return m(),k(),!0}if("touch"!==a.pointerType){var b=a.pointers?a.pointers[0]:a,c=K(b,z[0].children);c&&(G=!1);var d=!!(G||c||K(b,B,!0));s.visible=d,t.visible=void 0!==t.object&&d,n(d)}return!!t.onPointerHover(a)||s.onPointerHover(a)},this.handleGesture=function(a){switch(a.type){case"dragstart":return E="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===E&&this.handleMouseMove(a);case"dragend":return"drag"===E&&(E=null,this.handleButtonUp(a,0))}return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){},this.handlePressHold=function(a){return!0}},function(){"use strict";function a(a){this.viewer=a,this.mappingPromise=null,this.filter={seedURN:!0,objectSet:!0,viewport:!0,tags:!0,renderOptions:!1,cutplanes:!0}}function b(a){for(var b={},c=[],d=a.length,e=0,f=0;f<d;f++){var g=a[f];1!==b[g]&&(b[g]=1,c[e++]=g)}return c}var c=AutodeskNamespace("Autodesk.Viewing.Comments"),d=Autodesk.Viewing.Private,e=a.prototype;e.destroy=function(){this.viewer=null},e.createCommentObj=function(a){var b=this.viewer.getState(this.filter);return this.injectInfo(b,a),b},e.injectInfo=function(a,b){a.body=b.message||"",a.status="open",a.jsonVersion="2.0",a.inputSource="Web",a.type="geometry";var c=this.viewer.model.getDocumentNode();if(c&&(c=c.findParentGeom2Dor3D(),a.layoutName=c.data.guid,a.layoutIndex=c.data.order),b.point3d){var d=b.point3d;d instanceof THREE.Vector3&&(d=d.toArray()),this.pushTag(a,{name:"nodeOffset",value:d})}},e.isCommentForCurrentSheet=function(a){var b=this.viewer.model.getDocumentNode();return!b||(b=b.findParentGeom2Dor3D(),b.data.guid===a.layoutName)},e.getManifestNode=function(a){var b=this.viewer.model.getDocumentNode();if(b){var c=b.getRootNode();return c.findByGuid(a.layoutName)}return null},e.pushTag=function(a,b){Array.isArray(a.tags)||(a.tags=[]),a.tags.push(b)},e.getTag=function(a,b){var c=a.tags;if(c&&Array.isArray(c))for(var d=0,e=c.length;d<e;++d)if(c[d].name===b)return c[d];return null},e.getTagValue=function(a,b,c){var d=this.getTag(a,b);return d?d.value:c||null},e.exportCommentObj=function(a){var b=this;return new Promise(function(c){b.applyGlobalOffset(a),b.getMappingPromise().then(function(d){b.mapObjectSetLmvToExternal(a,d,function(a){c(a)})})})},e.importCommentObj=function(a){var b={};for(var c in this.filter)this.filter.hasOwnProperty(c)&&a.hasOwnProperty(c)&&(b[c]=a[c]);var d=JSON.parse(JSON.stringify(b)),e=this;return new Promise(function(a){e.getMappingPromise().then(function(b){e.mapObjectSetExternalToLmv(d,b),e.removeGlobalOffset(d),a(d)})})},e.applyGlobalOffset=function(a){var b=this.viewer.model.getData().globalOffset;if(b){this.applyOffsetToCamera(a.viewport,b);var c=this.getTag(a,"nodeOffset");return c&&this.applyOffset(c.value,b),!0}return!1},e.removeGlobalOffset=function(a){var b=this.viewer.model.getData().globalOffset;if(b){var c={x:-b.x,y:-b.y,z:-b.z};this.applyOffsetToCamera(a.viewport,c);var d=this.getTag(a,"nodeOffset");return d&&this.applyOffset(d.value,c),!0}return!1},e.applyOffsetToCamera=function(a,b){a&&b&&(this.applyOffset(a.eye,b),this.applyOffset(a.target,b),this.applyOffset(a.pivotPoint,b))},e.applyOffset=function(a,b){if(a){var c=Number(a[0])+b.x,d=Number(a[1])+b.y,e=Number(a[2])+b.z;a[0]="string"==typeof a[0]?c.toString():c,a[1]="string"==typeof a[1]?d.toString():d,a[2]="string"==typeof a[2]?e.toString():e}},e.mapObjectSetLmvToExternal=function(a,c,d){c||d(a),this.viewer.model.is2d()&&d(a);var e=this.getObjectSetElementWithIdType(a.objectSet,"lmv"),f=[].concat(e.id).concat(e.hidden).concat(e.isolated);b(f),this.viewer.model.getBulkProperties(f,["externalId"],function(b){var c={};b.forEach(function(a){c[a.dbId]=a.externalId});var f=JSON.parse(JSON.stringify(e));f.idType="external";var g=function(a){return c[a]};f.id=f.id.map(g),f.hidden=f.hidden.map(g),f.isolated=f.isolated.map(g),a.objectSet.push(f),d(a)},function(){d(a)})},e.mapObjectSetExternalToLmv=function(a,b){if(b){var c=a.objectSet,d=this.getObjectSetElementWithIdType(c,"lmv");if(!d){var e=this.getObjectSetElementWithIdType(c,"external");if(e){var f=function(a){return b[a]},g=JSON.parse(JSON.stringify(e));g.id=g.id.map(f),g.isolated=g.isolated.map(f),g.hidden=g.hidden.map(f),g.idType="lmv",c.unshift(g)}}}},e.getObjectSetElementWithIdType=function(a,b){if(!a||!Array.isArray(a))return null;for(var c=0,d=a.length;c<d;++c)if(a[c].idType===b)return a[c];return null},e.getMappingPromise=function(){if(!this.mappingPromise){var a=this;this.mappingPromise=new Promise(function(b){a.viewer.model.getExternalIdMapping(function(a){d.logger.log("[Autodesk.Comment]Successfully fetched external id mapping."),b(a)},function(){d.logger.error("[Autodesk.Comment]Failed to fetch the external id mapping."),b(null)})})}return this.mappingPromise},c.CommentFactory=a}(),function(){"use strict";function a(a,b,c){this.viewer=a,this.cache=c,this.PATH_STORAGE=null,this.fakeRequest=null,this.init(b)}function b(a,b,c,d,e,f){if(a.fakeRequest)return a.fakeRequest.createRequest(b,c,e,f);var g=a.getToken(),h=new XMLHttpRequest;return h.open(b,c,!0),d&&h.setRequestHeader("Content-Type",d),h.setRequestHeader("Access-Control-Allow-Origin","*"),h.setRequestHeader("Authorization","Bearer "+g),h.onload=e.onLoad,h.onerror=e.onError,h.ontimeout=e.onTimeout,h}function c(a,b,c){return{onLoad:function(d){200==d.currentTarget.status?a(c?d.currentTarget.response:d.currentTarget.responseText):b(d.currentTarget)},onError:function(a){b(a.currentTarget)},onTimeout:function(a){b(a.currentTarget)}}}function d(a,b){b&&b.forEach(function(b){a.setRequestHeader(b.name,b.value)})}function e(a){return window.btoa?window.btoa(a):window.Base64.encode(a)}var f=AutodeskNamespace("Autodesk.Viewing.Comments"),g=(Autodesk.Viewing.Private,a.prototype);f.ENV_TABLE={Local:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Development:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},Staging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},Production:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"},AutodeskDevelopment:{COMMENT:"https://developer-dev.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v1/"},AutodeskStaging:{COMMENT:"https://developer-stg.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v1/"},AutodeskProduction:{COMMENT:"https://developer.api.autodesk.com/comments/v2/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v1/"}},g.init=function(a){a=a||{},this.env=Autodesk.Viewing.Private.env,a.fakeServer&&(this.fakeRequest=new f.FakeRequest(a)),this.token=a.token3leg;var b=f.ENV_TABLE[this.env];this.COMMENT_SERVICE_URL=b.COMMENT,this.OBJECT_STORAGE_SERVICE_URL=b.OBJECT_STORAGE;var c=a.urn;if(c)this.setPathStorage(c);else{var d=this.viewer,e=this,g=function(){var a=d.model.getDocumentNode();if(a){var b=a.urn(!0);e.setPathStorage(b)}};d.model?g():d.addEventListener(av.GEOMETRY_LOADED_EVENT,function a(){d.removeEventListener(av.GEOMETRY_LOADED_EVENT,a),g()})}},g.destroy=function(){this.viewer=null,this.fakeRequest=null},g.setPathStorage=function(a){if(a){var b=a.length%4;b>0&&(a+="=".repeat(4-b)),this.PATH_STORAGE=a}},g.listComments=function(){var a=this;return new Promise(function(d,e){var f=[a.COMMENT_SERVICE_URL,"resources/",a.PATH_STORAGE].join(""),g=c(function(b){var c=JSON.parse(b);a.cache.comments=c,d(c)},e),h=b(a,"GET",f,"text/plain",g);h.send()})},g.postComment=function(a){var d=this;return new Promise(function(e,f){var g=[d.COMMENT_SERVICE_URL,"resources/",d.PATH_STORAGE].join(""),h=c(e,f),i=b(d,"POST",g,"text/plain",h);i.send(JSON.stringify(a))})},g.postCommentReply=function(a,d){var f=this;return new Promise(function(g,h){var i=window.encodeURIComponent(e(d)),j=[f.COMMENT_SERVICE_URL,"resources/",i].join(""),k=c(g,h),l=b(f,"POST",j,"text/plain",k);l.send(JSON.stringify(a))})},g.deleteComment=function(a){var d=this;return new Promise(function(f,g){var h=e(a),i=window.encodeURIComponent(h),j=[d.COMMENT_SERVICE_URL,"resources/",i].join(""),k=c(f,g),l=b(d,"DELETE",j,"text/plain",k);l.send()})},g.fetchLocationForNewOssAttachment=function(a,c){var e=[this.COMMENT_SERVICE_URL,"resources/",this.PATH_STORAGE,"/attachment"].join(""),f=b(this,"POST",e,"application/json",c,"fetchLocationForNewOssAttachment");d(f,a),f.send()},g.getAttachment=function(a,e,f){var g=this;return new Promise(function(h,i){var j=g.extractOssBucketAndId(a),k=[g.OBJECT_STORAGE_SERVICE_URL,"buckets/",j[0],"/objects/",j[1]].join(""),l=c(h,i,e),m=b(g,"GET",k,null,l);d(m,f),e&&(m.responseType="arraybuffer"),m.send()})},g.postAttachment=function(a,c,e,f,g){var h=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",e,"/objects/",a].join(""),i=b(this,"PUT",h,"text/plain",g);d(i,f),i.send(c)},g.deleteAttachment=function(a,c,d){var e=[this.OBJECT_STORAGE_SERVICE_URL,"buckets/",c,"/objects/",a].join(""),f=b(this,"DELETE",e,"text/plain",d);f.send()},g.extractOssBucketAndId=function(a){var b=a.split("/"),c=b[0],d=c.split(":");return b[0]=d[d.length-1],b},g.getToken=function(){return this.token||Autodesk.Viewing.Private.token.accessToken},f.CommentService=a}(),function(){"use strict";function a(a,d){Autodesk.Viewing.Extension.call(this,a,d||{});var e,f;this.load=function(){var a=this.getCache();if(e=new c.CommentFactory(this.viewer),f=new c.CommentService(this.viewer,this.options,a),a.restoreComment){var b=a.restoreComment;delete a.restoreComment;var d=this,g=function(){var a=function(){d.isCommentForCurrentSheet(b)&&d.restoreComment(b)};d.viewer.getObjectTree(a,a)};this.viewer.model?g():this.viewer.addEventListener(av.GEOMETRY_LOADED_EVENT,function a(){d.viewer.removeEventListener(av.GEOMETRY_LOADED_EVENT,a),g()})}return!0},this.unload=function(){return f&&(f.destroy(),f=null),e&&(e.destroy(),e=null),!0},this.createComment=function(a){var b=a||{};"string"==typeof a&&(b={message:a});var c=e.createCommentObj(b);return e.exportCommentObj(c)},this.isCommentForCurrentSheet=function(a){return e.isCommentForCurrentSheet(a)},this.restoreComment=function(a,b,c){if(!this.isCommentForCurrentSheet(a)){var d=e.getManifestNode(a);if(d){var f=this.getCache();return f.restoreComment=a,void this.viewer.fireEvent({type:Autodesk.Viewing.LOAD_GEOMETRY_EVENT,data:{item:d.data}})}}var g=this,h=e.importCommentObj(a);h.then(function(a){g.viewer.restoreState(a,b,c)})},this.setPathStorage=function(a){if(!a)throw new Error(b+": Invalid path storage");f.setPathStorage(a)},this.comments=function(){var a=this.getCache();return a.comments||[]},this.getComments=function(){return f.listComments()},this.postComment=function(a){return f.postComment(a)},this.postCommentReply=function(a,b){return f.postCommentReply(a,b)},this.deleteComment=function(a){return f.deleteComment(a)}}var b="Autodesk.Comments",c=AutodeskNamespace("Autodesk.Viewing.Comments");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,Autodesk.Viewing.theExtensionManager.registerExtension(b,a),c.CommentsExtension=a}(),function(){"use strict";function a(a){this.options=a||{},this.FAKE_SERVER_DELAY=this.options.fakeSeverDelay||200,this.FAKE_NEXT_ID=11}var b=AutodeskNamespace("Autodesk.Viewing.Comments"),c=a.prototype;c.createRequest=function(a,b,c,d){var e=this,f={notifyCallback:function(a){e.FAKE_SERVER_DELAY?setTimeout(function(){c.onLoad(a)},e.FAKE_SERVER_DELAY):c.onLoad(a)},replyPostComment:function(a){var b=JSON.parse(a);b.id=e.FAKE_NEXT_ID++,b.index=b.id,b.layoutName=b.layoutName||"Another Sheet",b.actor||(b.actor={name:e.options.displayName||"John Doe",id:e.options.oxygenId||"ABCDEFGHIJK"}),b.published=(new Date).toUTCString(),this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(b)}})},replyFetchLocationForNewOssAttachment:function(){var a={attachment:[{url:"urn:adsk.objects:os.object:comments/filename"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(a)}})},send:function(b){switch(a){case"GET":this.notifyCallback({currentTarget:{status:200,responseText:"[]"}});break;case"POST":switch(d){case"fetchLocationForNewOssAttachment":this.replyFetchLocationForNewOssAttachment();break;default:this.replyPostComment(b)}break;case"DELETE":this.notifyCallback({currentTarget:{status:200,responseText:"{}"}});break;case"PUT":try{JSON.parse(b),this.notifyCallback({currentTarget:{status:200,responseText:b}})}catch(a){var c={objects:[{id:"test",key:"test","content-type":"image/png",location:"http://www.autodesk.com"}]};this.notifyCallback({currentTarget:{status:200,responseText:JSON.stringify(c)}})}}},setRequestHeader:function(){}};return f},b.FakeRequest=a}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),b=Autodesk.Viewing;a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS=5,a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS=12,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS=15,a.isTouchDevice=function(){return!(!b.isTouchDevice||"function"!=typeof Hammer)&&b.isTouchDevice()},a.createSvgElement=function(a){var b="http://www.w3.org/2000/svg";return document.createElementNS(b,a)},a.setSvgParentAttributes=function(a){return a.setAttribute("version","1.1"),a.setAttribute("baseProfile","full"),a},a.createMarkupPathSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","inherit"),b.setAttribute("pointer-events","none");var c=a.createSvgElement("path");c.setAttribute("id","markup");var d=a.createSvgElement("path");return d.setAttribute("id","hitarea"),d.setAttribute("fill","transparent"),d.setAttribute("stroke","transparent"),b.markup=c,b.hitarea=d,b.appendChild(c),b.appendChild(d),b},a.setAttributeToMarkupSvg=function(a,b,c){a.markup.setAttribute(b,c)},a.updateMarkupPathSvgHitarea=function(b,c){var d=b.markup,e=b.hitarea,f=c.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f+=parseFloat(d.getAttribute("stroke-width"))+f;var g=d.getAttribute("fill"),h=d.getAttribute("stroke"),i=""!==h&&"none"!==h,j=""!==g&&"none"!==g;if(e.setAttribute("d",d.getAttribute("d")),e.setAttribute("stroke-width",f),e.setAttribute("transform",d.getAttribute("transform")),!c.navigating){if(i&&j)return void b.setAttribute("pointer-events","painted");if(i)return void b.setAttribute("pointer-events","stroke");if(!j)return void b.setAttribute("pointer-events","fill")}b.setAttribute("pointer-events","none")},a.createMarkupTextSvg=function(){var b=a.createSvgElement("g");b.setAttribute("cursor","default");var c="markup-clipper-"+a.getClipPathId(),d="url(#"+c+")",e=a.createSvgElement("clipPath");e.setAttribute("id",c),e.removeAttribute("pointer-events"),e.rect=a.createSvgElement("rect"),e.appendChild(e.rect);var f=a.createSvgElement("rect");f.setAttribute("id","markup-background");var g=a.createSvgElement("text");g.setAttribute("id","markup"),f.removeAttribute("pointer-events");var h=a.createSvgElement("rect");h.setAttribute("id","hitarea"),h.setAttribute("fill","transparent"),h.setAttribute("stroke","none"),h.setAttribute("stroke-width","0");var i=a.createSvgElement("g");return i.setAttribute("clip-path",d),i.appendChild(e),i.appendChild(f),i.appendChild(g),b.appendChild(i),b.appendChild(h),b.clipper=e,b.background=f,b.markup=g,b.hitarea=h,b},a.setMarkupTextSvgTransform=function(a,b,c){a.clipper.rect.setAttribute("transform",b),a.background.setAttribute("transform",b),a.markup.setAttribute("transform",c),a.hitarea.setAttribute("transform",b)},a.updateMarkupTextSvgHitarea=function(b,c,d,e){var f=b.hitarea,g=e.sizeFromClientToMarkups(0,a.MARKUP_DEFAULT_HITAREAS_MARGIN_IN_PIXELS).y;f.setAttribute("x",-g),f.setAttribute("y",-g),f.setAttribute("width",c+2*g),f.setAttribute("height",d+2*g),b.setAttribute("pointer-events",e.navigating?"none":"painted")},a.updateMarkupTextSvgBackground=function(a,b,c,d){var e=a.background;e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("width",b),e.setAttribute("height",c),e.setAttribute("fill",d)},a.updateMarkupTextSvgClipper=function(a,b,c){var d=a.clipper;d.rect.setAttribute("x",0),d.rect.setAttribute("y",0),d.rect.setAttribute("width",b),d.rect.setAttribute("height",c)},a.addSvgMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_document");return c.appendChild(d),d.setAttribute("data-model-version",b["data-model-version"]),a.insertBefore(c,a.firstChild),c},a.addMarkupMetadata=function(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","metadata"),d=document.createElement("markup_element");c.appendChild(d);for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return a.insertBefore(c,a.firstChild),c},a.removeAllMetadata=function(a){if(a.getElementsByTagName)for(var b=a.getElementsByTagName("metadata"),c=0;c<b.length;++c){var d=b[c];d.parentNode&&d.parentNode.removeChild(d)}var e=a.children||a.childNodes;if(e)for(c=0;c<e.length;++c)this.removeAllMetadata(e[c])},a.transferChildNodes=function(a,b){for(var c=a.children||a.childNodes,d=[],e=0;e<c.length;++e)d.push(c[e]);d.forEach(function(a){b.appendChild(a)})},a.getClipPathId=function(){for(var a=document.getElementsByTagName("clipPath"),b=a.length,c=0,d=0;d<b;++d){var e=a[d].id;e.indexOf("markup-clipper-")!==-1&&(e=e.replace("markup-clipper-",""),c=Math.max(c,e))}return c+1},a.svgNodeToString=function(a){function b(a,c){var d=a.hitarea,e=d&&d.parentNode;e&&(c.push({hitarea:d,parent:e}),e.removeChild(d));for(var f=a.childNodes,g=f.length,h=0;h<g;++h)b(f.item(h),c)}function c(a){for(var b=a.length,c=0;c<b;++c){var d=a[c];d.parent.appendChild(d.hitarea)}}var d;try{var e=[];b(a,e);var f=new XMLSerializer;d=f.serializeToString(a),c(e)}catch(a){d="",console.warn("svgNodeToString failed to generate string representation of domNode.")}return d},a.stringToSvgNode=function(a){var b=null;try{var c=new DOMParser,d=c.parseFromString(a,"text/xml");b=d.firstChild}catch(a){b=null,console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return b},a.addTraitEventDispatcher=function(a){a.listeners={},a.addEventListener=function(a,b){"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},a.hasEventListener=function(a,b){if(void 0===this.listeners)return!1;var c=this.listeners;return void 0!==c[a]&&c[a].indexOf(b)!==-1},a.removeEventListener=function(a,b){if(this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;d<e;d++)if(c[d]===b){c.splice(d,1);break}},a.fireEvent=function(a){if("string"==typeof a&&(a={type:a}),a.target||(a.target=this),!a.type)throw new Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var b=this.listeners[a.type].slice(),c=0;c<b.length;c++)b[c].call(this,a)}},a.removeTraitEventDispatcher=function(a){try{delete a.listeners,delete a.addEventListener,delete a.hasEventListener,delete a.removeEventListener,delete a.fireEvent}catch(a){}},a.worldToClient=function(b,c,d){var e=a.worldToViewport(b,c),f=a.viewportToClient(e.x,e.y,c);return f.z=0,d&&(f.x=Math.floor(f.x)+.5,f.y=Math.floor(f.y)+.5),f},a.clientToWorld=function(b,c,d,e){var f=a.clientToViewport(b,c,e);return f.z=d,f.unproject(e.impl.camera),f},a.clientToViewport=function(a,b,c){return c.impl.clientToViewport(a,b)},a.viewportToClient=function(a,b,c){return c.impl.viewportToClient(a,b)},a.worldToViewport=function(a,b){var c=new THREE.Vector3;return c.x=a.x,c.y=a.y,c.z=a.z,c.project(b.impl.camera),c},a.metersToModel=function(a,b){var c=b.model.getUnitScale(),d=1/c;return d*a},a.radiansToDegrees=function(a){return a*(180/Math.PI)},a.degreesToRadians=function(a){return a*(Math.PI/180)},a.sign=function(a){return a>=0?1:-1},a.areMarkupsPointsInClientRange=function(a,b,c,d){c=d.sizeFromClientToMarkups(0,c).y;var e=a.x-b.x,f=a.y-b.y;return c*c>=e*e+f*f},a.hideLmvUi=function(b){b.toolbar&&(b.setActiveNavigationTool(),a.dismissLmvHudMessage(),a.hideLmvPanels(!0,b),a.hideLmvToolsAndPanels(b))},a.restoreLmvUi=function(b){b.toolbar&&(a.dismissLmvHudMessage(),a.hideLmvPanels(!1,b),a.showLmvToolsAndPanels(b))},a.hideLmvPanels=function(a,b){var c=b.dockingPanels;if(c)for(var d=0;d<c.length;++d){var e=c[d],f=e.container;f.classList.contains("dockingPanelVisible")&&(f.style.display=a?"none":"block",e.visibilityChanged())}},a.showLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!0,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display=""),c.length>0&&(c[0].style.display=""),d.length>0&&(d[0].style.display=""),a.toolbar){for(var e=a.toolbar.container,f=e.children.length,g=0;g<f;++g)e.children[g].style.display="";a.centerToolBar()}},a.hideLmvToolsAndPanels=function(a){a&&a.model&&!a.model.is2d()&&a.displayViewCube(!1,!1);var b=document.getElementsByClassName("homeViewWrapper"),c=document.getElementsByClassName("infoButton"),d=document.getElementsByClassName("toolbar-animationSubtoolbar");if(b.length>0&&(b[0].style.display="none"),c.length>0&&(c[0].style.display="none"),d.length>0){d[0].style.display="none";var e=a.impl.keyFrameAnimator;if(e&&!e.isPaused){e.pauseCameraAnimations(),e.pause();var f=a.modelTools.getControl("toolbar-animationPlay");f&&(f.setIcon("toolbar-animationPauseIcon"),f.setToolTip("Pause"))}}if(a.toolbar)for(var g=a.toolbar.container,h=g.children.length,i=0;i<h;++i)g.children[i].style.display="none"},a.dismissLmvHudMessage=function(){try{for(var a=!0;a;)a=Autodesk.Viewing.Private.HudMessage.dismiss()}catch(a){console.warn("[CO2]Failed to dismiss LMV HudMessage")}},a.createStyle=function(b,c){for(var d={},e=0;e<b.length;++e)d[b[e]]=null;for(var f=a.getStyleDefaultValues(d,c),e=0;e<b.length;++e){var g=b[e];d[g]=f[g].values[f[g].default].value}return d},a.copyStyle=function(a,b){for(var c in b)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},a.cloneStyle=function(a){var b={};for(var c in a)b[c]=a[c];return b},a.getStyleDefaultValues=function(b,c){function d(a,b){var c=b.sizeFromClientToMarkups(0,a);return c.y}function e(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a}],default:1}}function f(){return{values:[{name:"Miter",value:"miter"},{name:"Round",value:"round"},{name:"Bevel",value:"bevel"}],default:0}}function g(a){return{values:[{name:"Thin",value:a/2},{name:"Normal",value:a},{name:"Thick",value:2*a}],default:1}}function h(){return{values:[{name:"red",value:"#ff0000"},{name:"green",value:"#00ff00"},{name:"blue",value:"#0000ff"},{name:"white",value:"#ffffff"},{name:"black",value:"#000000"}],default:0}}function i(a){return{values:[{name:"100%",value:1},{name:"75%",value:.75},{name:"50%",value:.5},{name:"25%",value:.25},{name:"0%",value:0}],default:a?4:0}}function j(){return{values:[{name:"Arial",value:"Arial"},{name:"Arial Black",value:"Arial Black"},{name:"Arial Narrow",value:"Arial Narrow"},{name:"Century Gothic",value:"Century Gothic"},{name:"Courier New",value:"Courier New"},{name:"Georgia",value:"Georgia"},{name:"Impact",value:"Impact"},{name:"Lucida Console",value:"Lucida Console"},{name:"Tahoma",value:"Tahoma"},{name:"Verdana",value:"Verdana"}],default:0}}function k(){return{values:[{name:"Normal",value:"normal"},{name:"Italic",value:"italic"}],default:0}}function l(){return{values:[{name:"Normal",value:"normal"},{name:"Bold",value:"bold"}],default:0}}var m=a.cloneStyle(b),n=d(a.MARKUP_DEFAULT_STROKE_WIDTH_IN_PIXELS,c),o=d(a.MARKUP_DEFAULT_FONT_WIDTH_IN_PIXELS,c);for(var p in m)switch(p){case"stroke-width":m[p]=e(n);break;case"stroke-linejoin":m[p]=f();break;case"font-size":m[p]=g(o);break;case"font-family":m[p]=j();break;case"font-style":m[p]=k();break;case"font-weight":m[p]=l();break;case"stroke-color":case"fill-color":m[p]=h();break;case"stroke-opacity":var q=!1;m[p]=i(q);break;case"fill-opacity":var q=!0;m[p]=i(q)}return m},a.composeRGBAString=function(a,b){return!a||!b||b<=0?"none":["rgba("+parseInt("0x"+a.substr(1,2)),",",parseInt("0x"+a.substr(3,2)),",",parseInt("0x"+a.substr(5,2)),",",b,")"].join("")},a.checkLineSegment=function(a,b,c,d,e){function f(a,b){a=Math.round(a),b=Math.round(b);for(var c=0,d=0,e=-h;e<=h;e+=2*h)d+=g(a,b+e)?e:0;for(var f=-h;f<=h;f+=2*h)c+=g(a+f,b)?f:0;return{x:Math.round(a/h+c),y:Math.round((j-b)/h-d)}}function g(a,b){if(a<0||a>=i||b<0||b>=j)return!1;var c=4*(b*i+a);return 255!==k[c]||255!==k[c+1]||255!==k[c+2]}var h=window.devicePixelRatio||1;a*=h,b*=h,c*=h,d*=h;var i=e.width,j=e.height,k=e.buffer;a=Math.round(a),c=Math.round(c),b=Math.round(j-b),d=Math.round(j-d);var l=c-a,m=d-b,n=0!==l?m/l:1,o=a,p=b;if(0!==l&&Math.abs(n)<=1){if(a<=c){for(;o<=c;++o,p+=n)if(g(o,Math.round(p)))return f(o,p)}else for(;o>=c;--o,p-=n)if(g(o,Math.round(p)))return f(o,p)}else if(n=0!==l?1/n:0,b<=d){for(;p<=d;++p,o+=n)if(g(Math.round(o),p))return f(o,p)}else for(;p>=d;--p,o-=n)if(g(Math.round(o),p))return f(o,p)},a.checkPolygon=function(a,b){function c(a,b){for(var c=0,e=0,g=-f;g<=f;g+=2*f)e+=d(a,b+g)?g:0;for(var i=-f;i<=f;i+=2*f)c+=d(a+i,b)?i:0;return{x:Math.round(a/f)+c,y:Math.round((h-b)/f-e)}}function d(a,b){if(a<0||a>=g||b<0||b>=h)return!1;var c=4*(b*g+a);return(255!==i[c]||255!==i[c+1]||255!==i[c+2])&&e(a,b)}function e(b,c){for(var d=!1,e=a.vertexCount,f=0,g=e-1;f<e;g=f++)l[f]>c!=l[g]>c&&b<(k[g]-k[f])*(c-l[f])/(l[g]-l[f])+k[f]&&(d=!d);return d}if(!a||a.verxtexCount<3||!b)return null;for(var f=window.devicePixelRatio||1,g=b.width,h=b.height,i=b.buffer,j=a.vertexCount,k=Float32Array.from(a.xVertices),l=Float32Array.from(a.yVertices),m=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY,q=0;q<j;++q){var r=k[q]=k[q]*f,s=l[q]=h-l[q]*f;m=Math.min(m,r),n=Math.min(n,s),o=Math.max(o,r),p=Math.max(p,s)}if(o<0||m>g||p<0||n>h)return null;var t=Math.round(o-m),u=Math.round(p-n),v=Math.round(.5*(m+o)),w=Math.round(.5*(n+p)),x=v,y=w,z=1,A=1;do{for(var B=x+z,C=y+A;x<B;++x)if(d(x,y))return c(x,y);for(;y<C;++y)if(d(x,y))return c(x,y);for(z<t?(B=x-++z,++z):B=x-z,A<u?(C=y-++A,++A):C=y-A;x>B;--x)if(d(x,y))return c(x,y);for(;y>C;--y)if(d(x,y))return c(x,y)}while(z<t||A<u)},a.createStyleSheet=function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet},a.addRuleToStyleSheet=function(a,b,c,d){"insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d)},a.measureTextLines=function(b,c,d){var e=d.sizeFromMarkupsToClient(0,c["font-size"]).y,f=(new a.DomElementStyle).setAttribute("font-family",c["font-family"]).setAttribute("font-size",e+"px").setAttribute("font-weight",c["font-weight"]?"bold":"").setAttribute("font-style",c["font-style"]?"italic":"").removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString(),g=document.createElement("div");g.setAttribute("style",f),d.viewer.container.appendChild(g);for(var h=[],i=b.length,j=0;j<i;++j)g.innerHTML=b[j],h.push({line:b[j],width:g.clientWidth,height:g.clientHeight});return d.viewer.container.removeChild(g),h},a.createArcTo=function(a,b,c,d,e,f){return f.push(e?"a":"A"),f.push(c),f.push(d),f.push(0),f.push(1),f.push(1),f.push(a),f.push(b),f},a.createEllipsePath=function(b,c,d,e,f,g){var h=.5*d,i=.5*e;g.push(f?"m":"M"),g.push(b),g.push(c),a.createArcTo(d,0,h,i,!0,g),a.createArcTo(-d,0,h,i,!0,g),g.push("z")},a.createRectanglePath=function(a,b,c,d,e,f){f.push(e?"m":"M"),f.push(a),f.push(b),f.push("l"),f.push(c),f.push(0),f.push("l"),f.push(0),f.push(d),f.push("l"),f.push(-c),f.push(0),f.push("z")},a.renderToCanvas=function(b,c,d,e,f){for(var g=e["stroke-width"],h=e["stroke-linejoin"],i=e["stroke-color"],j=e["stroke-opacity"],k=e["fill-color"],l=e["fill-opacity"],m=new THREE.Vector3(0,0,0),n=(new THREE.Matrix4).extractRotation(f),o=180*Math.atan2(n.elements[4],n.elements[0])/Math.PI,p=b.positionFromMarkupsToClient.bind(b),q=b.vectorFromMarkupsToClient.bind(b),r=b.sizeFromMarkupsToClient.bind(b),s=d.length,t=!1,u=0;u<s;)switch(d[u++]){case"M":case"L":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(f);var v=p(m.x,m.y);d[u++]=v.x,d[u++]=v.y;break;case"m":case"l":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var v=q(m.x,m.y);d[u++]=v.x,d[u++]=v.y;break;case"c":m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var w=q(m.x,m.y);d[u++]=w.x,d[u++]=w.y,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var x=q(m.x,m.y);d[u++]=x.x,d[u++]=x.y,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var y=q(m.x,m.y);d[u++]=y.x,d[u++]=y.y;break;case"a":var z=r(d[u],d[u+1]);d[u++]=z.x,d[u++]=z.y,d[u++]=o,u++,d[u]=1==d[u++]?0:1,m.x=d[u],m.y=d[u+1],m=m.applyMatrix4(n);var y=q(m.x,m.y);d[u++]=y.x,d[u++]=y.y;break;case"Z":case"z":t=!0}c.strokeStyle=a.composeRGBAString(i,j),c.fillStyle=a.composeRGBAString(k,l),c.lineJoin=h,c.lineWidth=b.sizeFromMarkupsToClient(g,0).x,d=new Path2D(d.join(" ")),t&&0!==l&&c.fill(d),c.stroke(d)}}(),function(){"use strict";function a(a,b,c){this.type=b,this.editor=a,this.targetId=c,this.addToHistory=!0,this.selectOnExecution=!0}AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),Autodesk.Viewing.Extensions.Markups.Core.EditAction=a,Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.execute=function(){this.editor.actionManager.execute(this)},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.redo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.undo=function(){},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.merge=function(a){return!1},Autodesk.Viewing.Extensions.Markups.Core.EditAction.prototype.isIdentity=function(){return!1}}(),function(){"use strict";function a(a){this.historySize=a,this.undoStack=new Array(a),this.redoStack=new Array(a),c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_HISTORY_CHANGED="EVENT_HISTORY_CHANGED";var d=a.prototype;d.execute=function(a){var c=this.redoStack,d=this.undoStack;c.splice(0,c.length),a.redo();var e=this.getEditActionGroup();e.isOpen()?e.addAction(a):(e.open(),e.addAction(a),e.close()),d.length>this.historySize&&d.splice(0,1);var f=a.selectOnExecution?a.targetId:-1;this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"execute",targetId:f}})},d.beginActionGroup=function(){var a=this.undoStack,b=a.length,c=null;0===b||a[b-1].isClosed()?(c=this.getEditActionGroup(),c.open()):console.warn("Markups - Undo/Redo - Action edit group already open.")},d.closeActionGroup=function(){var a=this.undoStack,b=a.length;if(0===b)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var c=a[b-1];c.close()||console.warn("Markups - Undo/Redo - Action edit group already closed."),c.isEmpty()&&a.pop()},d.cancelActionGroup=function(){var a=this.undoStack,c=a.length;if(0===c)return void console.warn("Markups - Undo/Redo - There is no action edit group to close.");var d=a[c-1];return d.close()?(d.undo(),a.pop(),void this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"cancel",targetId:-1}})):void console.warn("Markups - Undo/Redo - Action edit group already closed.")},d.undo=function(){var a=this.undoStack,c=this.redoStack;if(0!==a.length){var d=a.pop(),e=d.undo();c.push(d),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"undo",targetId:e}})}},d.redo=function(){var a=this.undoStack,c=this.redoStack;if(0!==c.length){var d=c.pop(),e=d.redo();
a.push(d),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"redo",targetId:e}})}},d.clear=function(){this.undoStack.splice(0,this.undoStack.length),this.redoStack.splice(0,this.redoStack.length),this.fireEvent({type:b.EVENT_HISTORY_CHANGED,data:{action:"clear",targetId:-1}})},d.isUndoStackEmpty=function(){return 0===this.undoStack.length},d.isRedoStackEmpty=function(){return 0===this.redoStack.length},d.getEditActionGroup=function(){var a=this.undoStack,c=this.undoStack.length,d=null;return 0===c||a[c-1].isClosed()?(d=new b.EditActionGroup,a.push(d)):d=a[c-1],d},b.EditActionManager=a}(),function(){"use strict";function a(){this.reset()}function b(a){var b=[];for(var c in a){var d=a[c];b.push(c),b.push(":"),b.push(d),b.push("; ")}return b.join("")}var c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=["-ms-","-webkit-","-moz-","-o-"],e=a.prototype;e.reset=function(){return this.attributes={},this.dirty=!1,this.styleString="",this},e.setAttribute=function(a,b,c){if(this.attributes[a]=b,c&&c.allBrowsers){var e=this;d.forEach(function(c){e.attributes[c+a]=b})}return this.dirty=!0,this},e.removeAttribute=function(a){Array.isArray(a)||(a=[a]);var b=this;return a.forEach(function(a){a in b.attributes&&(delete b.attributes[a],b.dirty=!0)}),this},e.getStyleString=function(){return this.dirty&&(this.styleString=b(this.attributes),this.dirty=!1),this.styleString},e.clone=function(){var a=new c.DomElementStyle,b=this.attributes;for(var d in b)a.setAttribute(d,b[d]);return a},c.DomElementStyle=a}(),function(){"use strict";function a(a,b){this.containingDiv=a,this.editor=b,this.selectionLayer=c(),this.frameMargin=10,this.selection={x:0,y:0,width:0,height:0,rotation:0,element:null,active:!1,dragging:!1,resizing:!1,handle:{}},j.bind(this)(),w.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.selectionLayer,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}]],inputClass:Hammer.TouchInput}),this.onHammerDragBinded=this.onHammerDrag.bind(this),this.onHammerDoubleTapBinded=this.onHammerDoubleTap.bind(this),this.hammer.on("dragstart dragmove dragend",this.onHammerDragBinded),this.hammer.on("doubletap",this.onHammerDoubleTapBinded),this.hammer.on("doubletap2",this.onHammerDoubleTapBinded)),o.bind(this)(),p.bind(this)(),r.bind(this)(),q.bind(this)(),this.containingDiv.appendChild(this.selectionLayer),w.addTraitEventDispatcher(this)}function b(a){a.pageX=a.pointers[0].clientX,a.pageY=a.pointers[0].clientY}function c(){var a=document.createElement("div");return a.style.position="absolute",a.style.top=0,a.style.bottom=0,a.style.left=0,a.style.right=0,a.style.overflow="hidden",a.style.visibility="hidden",s(a,!1),a}function d(a,b){var c=document.createElement("div");c.style.position="absolute",c.style.height=a+"px",c.style.width=a+"px",c.style.background=y,c.style.borderColor=x,c.style.borderWidth="1px",c.style.borderStyle="solid",f(c,b),c.className="selector-drag-point autodesk-markups-extension-core-make-me-bigger sdp-handle-"+b,c.setAttribute("data-sdp-handle",b);var d=-a-2;switch(b){case"n":c.style.top=d+"px",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"s":c.style.top="calc(100% - "+(a+2)+"px)",c.style.left="calc(50% - "+a/2+"px)",c.style.position="relative",c.style.margin=0;break;case"w":c.style.left=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"e":c.style.right=d+"px",c.style.top="50%",c.style.transform="translate3d(0, -50%, 0)";break;case"nw":c.style.top=d+"px",c.style.left=d+"px";break;case"ne":c.style.top=d+"px",c.style.right=d+"px";break;case"sw":c.style.bottom=d+"px",c.style.left=d+"px";break;case"se":c.style.bottom=d+"px",c.style.right=d+"px"}return c}function e(){var a=18,b=1,c=document.createElement("div");return c.style.position="absolute",c.style.background=y,c.style.border=b+"px solid rgba(30, 30, 255, 0.25)",c.style.height=a+"px",c.style.width=a+"px",c.style.borderRadius=a/2+b+"px",c.style.boxSizing="border-box",c.classList.add("selector-rotate-point"),c.style.left="50%",c.style.transform="translate3d(-50%, 0px, 0px)",c.style.top="-70px",c.classList.add("autodesk-markups-extension-core-make-me-bigger"),c}function f(a,b){var c;switch(b){case"n":case"s":c="ns-resize";break;case"w":case"e":c="ew-resize";break;case"ne":case"sw":c="nesw-resize";break;case"nw":case"se":c="nwse-resize"}a.style.cursor=c}function g(a){var b=16;["n","s","w","e","nw","ne","sw","se"].forEach(function(c){this.selection.handle[c]=d(b,c),a.appendChild(this.selection.handle[c])}.bind(this))}function h(a){return u(a,".selector-drag-point")}function i(a){return u(a,".selector-rotate-point")}function j(){var a=1,b=document.createElement("div");return b.style.position="absolute",b.style.border=a+"px solid "+x,b.style.zIndex=1,b.style.cursor="move",b.style.boxSizing="border-box",s(b,!0),b.classList.add("selector-box"),g.bind(this)(b),this.selection.rotationHandle=e(),b.appendChild(this.selection.rotationHandle),this.selection.element=b,this.selectionLayer.appendChild(this.selection.element),l.bind(this)(!1),b}function k(a,b){return"translate3d("+a+"px,"+b+"px,0)"}function l(a){this.selection.active=a,this.selection.element.style.display=a?"block":"none"}function m(a,b,c){this.selection.x=a,this.selection.y=b,this.selection.rotation=c;var d=this.markup.getClientSize();d.x+=2*this.frameMargin,d.y+=2*this.frameMargin,this.selection.element.style.msTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.msTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.webkitTransform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.webkitTransformOrigin=d.x/2+"px "+d.y/2+"px",this.selection.element.style.transform=k(a,b)+" rotate("+c+"rad)",this.selection.element.style.transformOrigin=d.x/2+"px "+d.y/2+"px"}function n(a,b){this.selection.width=a,this.selection.height=b,this.selection.element.style.width=a+"px",this.selection.element.style.height=b+"px"}function o(){this.selection.element.addEventListener("mousedown",this._onRepositionMouseDown.bind(this))}function p(){this.selectionLayer.addEventListener("mousedown",this._onResizeMouseDown.bind(this))}function q(){this.selection.element.addEventListener("mousedown",this._onRotationMouseDown.bind(this))}function r(){var a=function(a){this.selection.dragging=!1;var b=this.editor.editMode;b&&b.onMouseDoubleClick(this.markup)}.bind(this),b=this.selectionLayer;b.addEventListener("dblclick",a)}function s(a,b){a.style.pointerEvents=b?"auto":"none"}function t(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}function u(a,b){return a.matches?a.matches(b):a.msMatchesSelector?a.msMatchesSelector(b):a.mozMatchesSelector?a.mozMatchesSelector(b):!!a.webkitMatchesSelector&&a.webkitMatchesSelector(b)}var v=Autodesk.Viewing.Extensions.Markups.Core,w=Autodesk.Viewing.Extensions.Markups.Core.Utils;v.EVENT_EDITFRAME_EDITION_START="EVENT_EDITFRAME_EDITION_START",v.EVENT_EDITFRAME_EDITION_END="EVENT_EDITFRAME_EDITION_END";var x="rgba(30, 30, 255, 0.30)",y="gainsboro",z=a.prototype;z.setSelection=function(a,b,c,d,e){var f=this.frameMargin,g=2*f;n.bind(this)(c+g,d+g),m.bind(this)(a-f,b-f,e),l.bind(this)(!0),this.selectionLayer.style.visibility="visible"},z.setMarkup=function(a){if(this.hammer&&this.hammer.set({enable:null!==a}),this.markup=a,l.bind(this)(!1),a){var b=a.getClientSize(),c=a.getClientPosition(),d=b.x,e=b.y,f=a.getRotation();this.setSelection(c.x-d/2,c.y-e/2,d,e,f),this.enableResizeHandles(),this.enableRotationHandle()}},z.startDrag=function(a){this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),this._onRepositionMouseDown(a,this.editor.getMousePosition())},z.isActive=function(){return this.isDragging()||this.isResizing()||this.isRotating()},z.isDragging=function(){return this.selection.dragging},z.isResizing=function(){return this.selection.resizing},z.isRotating=function(){return this.selection.rotating},z.onMouseMove=function(a){},z.onMouseUp=function(a){},z.onHammerDrag=function(a){function c(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}switch(b(a),a.type){case"dragstart":c(this.editor.input,this.editor.svg,a),i(a.target)?this._onRotationMouseDown(a):h(a.target)?this._onResizeMouseDown(a):this.startDrag(a),a.preventDefault();break;case"dragmove":c(this.editor.input,this.editor.svg,a),this.onMouseMove(a),a.preventDefault();break;case"dragend":c(this.editor.input,this.editor.svg,a),this.onMouseUp(a),a.preventDefault()}},z.onHammerDoubleTap=function(a){function c(a,b,c){var d=b.getBoundingClientRect();a.mousePosition.x=c.pageX-d.left,a.mousePosition.y=c.pageY-d.top}b(a),c(this.editor.input,this.editor.svg,a),this.selection.dragging=!1,this.editor.editMode&&this.editor.editMode.onMouseDoubleClick(this.markup)},z.enableResizeHandles=function(){var a,b=this.markup;if(b.isHeightConstrained()||b.isWidthConstrained()){for(var c in this.selection.handle)a=this.selection.handle[c],a&&(a.style.display="none");b.isHeightConstrained()&&(this.selection.handle.w.style.display="block",this.selection.handle.e.style.display="block"),b.isWidthConstrained()&&(this.selection.handle.n.style.display="block",this.selection.handle.s.style.display="block")}else for(var c in this.selection.handle)a=this.selection.handle[c],a&&(a.style.display="block")},z.enableRotationHandle=function(){var a=this.markup,b=this.selection.rotationHandle,c=a.isRotationConstrained()?"none":"block";b.style.display=c};var A=!1;z._onRepositionMouseDown=function(a,b){A=!0;var c=!(a instanceof MouseEvent);if((c||!h(a.target)&&!i(a.target))&&(b=c?b:this.editor.getMousePosition(),this.initialCursor=b,this.initialPosition=this.markup.getClientPosition(),this.areAxisConstrained=!1,this.axisConstrains=new THREE.Vector2(1,1),this.onMouseMove=this._onRepositionMouseMove.bind(this),this.onMouseUp=this._onRepositionMouseUp.bind(this),!this.selection.dragging)){if(this.selection.dragging=!0,this.editor.beginActionGroup(),a&&a.altKey){var d=this.editor,e=new v.CloneMarkup(d,d.getId(),this.markup,this.markup.position);e.execute()}this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START})}},z._onRepositionMouseMove=function(a){if(A)return void(A=!1);if(this.selection.dragging){var b=this.editor.getMousePosition(),c=this.editor.input.constrainAxis;this.areAxisConstrained!==c&&(this.areAxisConstrained=c,this.axisConstrains=c?new THREE.Vector2(0,0):new THREE.Vector2(1,1),this.initialPosition.x+=b.x-this.initialCursor.x,this.initialPosition.y+=b.y-this.initialCursor.y,this.initialCursor.x=b.x,this.initialCursor.y=b.y);var d={x:b.x-this.initialCursor.x,y:b.y-this.initialCursor.y},e=15;0===this.axisConstrains.x&&0===this.axisConstrains.y&&(Math.abs(d.x)>e?(this.axisConstrains.x=1,d.x+=d.x<0?e:-e):Math.abs(d.y)>e&&(this.axisConstrains.y=1,d.y+=d.y<0?e:-e));var f=this.initialPosition.x+d.x*this.axisConstrains.x,g=this.initialPosition.y+d.y*this.axisConstrains.y;m.bind(this)(f,g,this.selection.rotation);var h=this.editor.positionFromClientToMarkups(f,g),i=new v.SetPosition(this.editor,this.markup,h);i.execute()}},z._onRepositionMouseUp=function(){this.last=null,this.onMouseMove=function(){},this.onMouseUp=function(){},this.selection.dragging&&(this.editor.closeActionGroup(),this.selection.dragging=!1,this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END}))},z._onResizeMouseDown=function(a){var b=a.target;if(h(b)){this.selection.handle.resizing=b;var c=this.selection.handle.resizing.getAttribute("data-sdp-handle");this.containingDiv.style.cursor=c+"-resize";var d=this.editor.getMousePosition(),e=this.markup.getClientPosition(),f=this.markup.getClientSize();this.initial={x:e.x,y:e.y,width:f.x,height:f.y,mouseX:d.x,mouseY:d.y},this.onMouseMove=this._onResizeMouseMove.bind(this),this.onMouseUp=this._onResizeMouseUp.bind(this),this.selection.resizing||(this.selection.resizing=!0,this.editor.beginActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START}))}},z._onResizeMouseMove=function(a){if(this.selection.resizing){var b=this.editor.getMousePosition(),c=this.initial,d={x:b.x-c.mouseX,y:b.y-c.mouseY},e=new THREE.Vector3(d.x,d.y,0),f=(new THREE.Matrix4).makeRotationZ(-this.selection.rotation);d=e.applyMatrix4(f);var g=c.x,h=c.y,i=c.width,j=c.height,k=new THREE.Vector3,l=this.selection.handle.resizing.getAttribute("data-sdp-handle");if(this.editor.input.keepAspectRatio&&["nw","ne","sw","se"].indexOf(l)!==-1){var m=new THREE.Vector3(d.x,d.y,0);switch(l){case"nw":d.set(-c.width,-c.height,0);break;case"ne":d.set(c.width,-c.height,0);break;case"sw":d.set(c.width,-c.height,0);break;case"se":d.set(c.width,c.height,0)}d.normalize(),d=m.projectOnVector(d)}var n={n:function(){j-=d.y,k.y=d.y},s:function(){j+=d.y,k.y=d.y},w:function(){i-=d.x,k.x=d.x},e:function(){i+=d.x,k.x=d.x},nw:function(){this.n(),this.w()},ne:function(){this.n(),this.e()},sw:function(){this.s(),this.w()},se:function(){this.s(),this.e()}};n[l]();var o=(new THREE.Matrix4).makeRotationZ(this.selection.rotation),p=k.applyMatrix4(o),q=this.editor.positionFromClientToMarkups(g+.5*p.x,h+.5*p.y),r=this.editor.sizeFromClientToMarkups(i,j),s=new v.SetSize(this.editor,this.markup,q,r.x,r.y);s.execute()}},z._onResizeMouseUp=function(a){this.selection.resizing=!1,this.selection.handle.resizing=null,this.containingDiv.style.cursor="",this.editor.closeActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END}),this.onMouseMove=function(){},this.onMouseUp=function(){}};var B,C;z._onRotationMouseDown=function(a){i(a.target)&&(this.editor.beginActionGroup(),this.selection.rotating=!0,C=this.editor.getMousePosition(),B=this.selection.rotation||0,this.onMouseMove=this._onRotationMouseMove.bind(this),this.onMouseUp=this._onRotationMouseUp.bind(this),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_START}))},z._onRotationMouseMove=function(a){if(this.selection.rotating){var b=this.editor.getMousePosition(),c=this.markup.getClientPosition(),d=t(c,b),e=t(c,C),f=d-e+B;if(this.editor.input.snapRotations){var g=w.degreesToRadians(22.5);f=Math.ceil(f/g)*g}m.bind(this)(this.selection.x,this.selection.y,f);var h=new v.SetRotation(this.editor,this.markup,f);h.execute()}},z._onRotationMouseUp=function(a){this.selection.rotating=!1,B=null,C=null,this.editor.closeActionGroup(),this.fireEvent({type:v.EVENT_EDITFRAME_EDITION_END})},v.EditFrame=a}(),function(){"use strict";function a(a,b,d){this.id=a,this.type="",this.editor=b,this.viewer=b.viewer,this.position={x:0,y:0},this.size={x:0,y:0},this.rotation=0,this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(b.getDefaultStyle(),this.style),this.highlightColor="#FAFF3C",this.constraintWidth=!1,this.constraintHeight=!1,this.constraintRotation=!1,this.highlighted=!1,this.selected=!1,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.MARKUP_TYPE_ARROW="arrow",b.MARKUP_TYPE_TEXT="label",b.MARKUP_TYPE_RECTANGLE="rectangle",b.MARKUP_TYPE_CIRCLE="ellipse",b.MARKUP_TYPE_CLOUD="cloud",b.MARKUP_TYPE_FREEHAND="freehand",b.MARKUP_TYPE_POLYLINE="polyline",b.MARKUP_TYPE_POLYCLOUD="polycloud",b.EVENT_EDITMODE_CHANGED="EVENT_EDITMODE_CHANGED",b.EVENT_EDITMODE_ENTER="EVENT_EDITMODE_ENTER",b.EVENT_EDITMODE_LEAVE="EVENT_EDITMODE_LEAVE",b.EVENT_MARKUP_SELECTED="EVENT_MARKUP_SELECTED",b.EVENT_MARKUP_DRAGGING="EVENT_MARKUP_DRAGGING",b.EVENT_MARKUP_ENTER_EDITION="EVENT_MARKUP_ENTER_EDITION",b.EVENT_MARKUP_CANCEL_EDITION="EVENT_MARKUP_CANCEL_EDITION",b.EVENT_MARKUP_DELETE_EDITION="EVENT_MARKUP_DELETE_EDITION";var d=a.prototype;b.Markup=a,d.destroy=function(){this.unselect(),this.setParent(null)},d.setParent=function(a){var b=this.shape;b.parentNode&&b.parentNode.removeChild(b),a&&a.appendChild(b)},d.clone=function(){var a=Object.create(this.__proto__),b=this.getCloneOverrides();for(var c in this)if(this.hasOwnProperty(c)){var d=this[c];b.hasOwnProperty(c)?a[c]=b[c]:d.clone instanceof Function?a[c]=d.clone():d instanceof Function?a[c]=d.bind(a):d.nodeType?a[c]=d.cloneNode(!0):d instanceof Object?a[c]=JSON.parse(JSON.stringify(d)):a[c]=d}return this.cloneShape(a),a},d.cloneShape=function(a){a.shape.markup=a.shape.childNodes.item(0),a.shape.hitarea=a.shape.childNodes.item(1),a.bindDomEvents()},d.getCloneOverrides=function(){return{viewer:this.viewer,editor:this.editor,hammer:null,listeners:{}}},d.select=function(){this.selected||(this.selected=!0,this.highlighted=!1,this.updateStyle(),this.fireEvent({type:b.EVENT_MARKUP_SELECTED,markup:this}))},d.unselect=function(){this.selected=!1},d.highlight=function(a){this.interactionsDisabled||(this.highlighted=a,this.updateStyle())},d.getStyle=function(){return c.cloneStyle(this.style)},d.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},d.updateStyle=function(){},d.edit=function(){this.fireEvent({type:b.EVENT_MARKUP_ENTER_EDITION,markup:this})},d.cancel=function(){this.fireEvent({type:b.EVENT_MARKUP_CANCEL_EDITION,markup:this})},d.deleteMarkup=function(){this.fireEvent({type:b.EVENT_MARKUP_DELETE_EDITION,markup:this})},d.getEditMode=function(){return console.warn("EditMode of markup type"+this.type+" not defined."),null},d.getClientPosition=function(){var a=this.position;return this.editor.positionFromMarkupsToClient(a.x,a.y)},d.getClientSize=function(){var a=this.size;return this.editor.sizeFromMarkupsToClient(a.x,a.y)},d.setRotation=function(a){this.rotation=a,this.updateStyle()},d.getRotation=function(){return this.rotation},d.setPosition=function(a,b){this.position.x=a,this.position.y=b,this.updateStyle()},d.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.isWidthConstrained=function(){return this.constraintWidth},d.isHeightConstrained=function(){return this.constraintHeight},d.isRotationConstrained=function(){return this.constraintRotation},d.disableInteractions=function(a){this.interactionsDisabled=a},d.setStrokeWidth=function(a){},d.constrainsToBounds=function(a){},d.onMouseDown=function(a){this.interactionsDisabled||(this.select(),this.editor.editFrame.startDrag(a))},d.generatePoint3d=function(a){function b(b,d){var f=c.checkLineSegment(b.x,b.y,d.x,d.y,a),g=f&&e.clientToWorld(f.x,f.y);return g&&g.point}function d(b){var d=c.checkPolygon(b,a),f=d&&e.clientToWorld(d.x,d.y);return f&&f.point}var e=this.viewer,f=this.generateBoundingPolygon(),g=f.xVertices,h=f.yVertices,i=new THREE.Vector2(g[0]+g[1],h[0]+h[1]).multiplyScalar(.5),j=new THREE.Vector2(g[0]+g[3],h[0]+h[3]).multiplyScalar(.5),k=new THREE.Vector2(g[2]+g[1],h[2]+h[1]).multiplyScalar(.5),l=new THREE.Vector2(g[2]+g[3],h[2]+h[3]).multiplyScalar(.5),m=j.clone().add(k).multiplyScalar(.5),n=b(m,k)||b(m,j)||b(m,i)||b(m,l);return n||d(f)},d.generateBoundingBox=function(){for(var a={min:{x:0,y:0},max:{x:0,y:0}},b=this.generateBoundingPolygon(),c=b.vertexCount,d=b.xVertices,e=b.yVertices,f=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,j=0;j<c;++j){var k=d[j],l=e[j];f=Math.min(f,k),g=Math.min(g,l),h=Math.max(h,k),i=Math.max(i,l)}return a.min.x=f,a.min.y=g,a.max.x=h,a.max.y=i,a},d.generateBoundingPolygon=function(){var a=this.getClientPosition(),b=this.getClientSize();b.x*=.5,b.y*=.5;var c=new THREE.Vector3(-b.x,-b.y).add(a),d=new THREE.Vector3(b.x,-b.y).add(a),e=new THREE.Vector3(b.x,b.y).add(a),f=new THREE.Vector3(-b.x,b.y).add(a);if(0!==this.rotation){var g=(new THREE.Matrix4).makeTranslation(-a.x,-a.y,0),h=(new THREE.Matrix4).makeRotationZ(this.rotation),i=(new THREE.Matrix4).makeTranslation(a.x,a.y,0),j=i.multiply(h).multiply(g);c.applyMatrix4(j),d.applyMatrix4(j),e.applyMatrix4(j),f.applyMatrix4(j)}return{vertexCount:4,xVertices:new Float32Array([c.x,d.x,e.x,f.x]),yVertices:new Float32Array([c.y,d.y,e.y,f.y])}},d.setMetadata=function(){return null},d.bindDomEvents=function(){c.isTouchDevice()&&(this.hammer=new Hammer.Manager(this.shape,{recognizers:[[Hammer.Tap,{event:"singletap",pointers:1,threshold:2}]],inputClass:Hammer.TouchInput}),this.onSingleTapBinded=function(a){this.onMouseDown(a)}.bind(this),this.hammer.on("singletap",this.onSingleTapBinded)),this.shape.addEventListener("mousedown",this.onMouseDown.bind(this),!0),this.shape.addEventListener("mouseout",function(){this.highlight(!1)}.bind(this)),this.shape.addEventListener("mouseover",function(){this.highlight(!0)}.bind(this))},d.renderToCanvas=function(a){var b=(new THREE.Matrix4).makeRotationZ(-this.rotation),d=(new THREE.Matrix4).makeTranslation(this.position.x,this.position.y,0),e=d.multiply(b);c.renderToCanvas(this.editor,a,this.getPath(),this.style,e)},d.getPath=function(){},d.getTransform=function(){return["translate(",this.position.x,",",this.position.y,")","rotate(",c.radiansToDegrees(-this.rotation),")"].join(" ")}}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_ARROW,this.constraintHeight=!0,this.head=new THREE.Vector3,this.tail=new THREE.Vector3,this.size.y=3*this.style["stroke-width"],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeArrow(this.editor)},d.set=function(a,b,c,d){var e=new THREE.Vector2(a,b),f=new THREE.Vector2(c,d),g=f.clone().sub(e).normalize();this.size.x=e.distanceTo(f),this.rotation=Math.acos(g.dot(new THREE.Vector2(1,0))),this.rotation=d>b?2*Math.PI-this.rotation:this.rotation;var h=this.head,i=this.tail;h.set(c,d,0),i.set(a,b,0),this.position.x=i.x+.5*(h.x-i.x),this.position.y=i.y+.5*(h.y-i.y),this.updateStyle()},d.setRotation=function(a){this.rotation=a;var b=Math.cos(-a),c=Math.sin(-a),d=new THREE.Vector2(b,c);d.multiplyScalar(.5*this.size.x);var e=new THREE.Vector2(this.position.x,this.position.y),f=e.clone().sub(d),g=e.clone().add(d);this.head.set(g.x,g.y,0),this.tail.set(f.x,f.y,0),this.updateStyle()},d.setSize=function(a,b,c){var d=Math.cos(-this.rotation),e=Math.sin(-this.rotation),f=new THREE.Vector2(d,e);f.multiplyScalar(.5*b);var g=new THREE.Vector2(a.x,a.y),h=g.clone().sub(f),i=g.clone().add(f);this.head.set(i.x,i.y,0),this.tail.set(h.x,h.y,0),this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=a["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.getTransform();this.size.y=3*d,this.style["fill-color"]=a["stroke-color"],this.style["fill-opacity"]=a["stroke-opacity"],c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",e),c.setAttributeToMarkupSvg(b,"transform",f),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setPosition=function(a,b){var c=this.head,d=this.tail,e=c.x-d.x,f=c.y-d.y,g=a+.5*e,h=b+.5*f;c.x=g,c.y=h,d.x=g-e,d.y=h-f,this.position.x=d.x+.5*(c.x-d.x),this.position.y=d.y+.5*(c.y-d.y),this.updateStyle()},d.generatePoint3d=function(a){var b=this.editor.positionFromMarkupsToClient(this.head.x,this.head.y),d=this.editor.positionFromMarkupsToClient(this.tail.x,this.tail.y),e=b.clone().sub(d).normalize(),f=c.checkLineSegment(b.x,b.y,b.x+200*e.x,b.y+200*e.y,a),g=f&&this.viewer.clientToWorld(f.x,f.y);return g&&g.point},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.head=[this.head.x,this.head.y].join(" "),a.tail=[this.tail.x,this.tail.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size.x,b=this.size.y,c=b/3,d=this.style["stroke-width"],e=a-3*d,f=a-e,g=.3*d;return["M",.5*-a,.5*-b+c,"l",e,0,"l",-g,-c,"l",f+g,1.5*c,"l",-f-g,1.5*c,"l",g,-c,"l",-e,0,"z"]},b.MarkupArrow=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CIRCLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCircle(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.size;if(1===a.x||1===a.y)return[""];var b=this.style["stroke-width"],d=a.x,e=a.y,f=d-b,g=e-b,h=.5*b,i=h-.5*d,j=0,k=[];return c.createEllipsePath(i,j,f,g,!1,k),k},b.MarkupCircle=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-linejoin","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_CLOUD,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeCloud(this.editor)},d.set=function(a,b){this.setSize(a,b.x,b.y)},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){function a(a,b,c,d,e){return e.push("a"),e.push(c),e.push(d),e.push(0),e.push(1),e.push(1),e.push(a),e.push(b),e}function b(b,c,d,e,f){switch(b){case"LT":return a(c,-d,c,d,f);case"RT":return a(c,d,c,d,f);case"RB":return a(-c,d,c,d,f);case"LB":return a(-c,-d,c,d,f)}}function d(a,b,c,d){var e=2*c,f=Math.abs(b-a-d),g=Math.round(f/e);e+=(f-e*g)/g,c=.5*e;var h=.05*e,i=3.5*c/3;return{count:g,radius:c,diameter:e,p1:{x:h,y:-i},p2:{x:e-h,y:-i},p3:{x:e,y:0}}}function e(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.x),b.push(c.p1.y),b.push(c.p2.x),b.push(c.p2.y),b.push(c.p3.x),b.push(c.p3.y);return b}function f(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.y),b.push(c.p1.x),b.push(-c.p2.y),b.push(c.p2.x),b.push(-c.p3.y),b.push(c.p3.x);return b}function g(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(-c.p1.x),b.push(-c.p1.y),b.push(-c.p2.x),b.push(-c.p2.y),b.push(-c.p3.x),b.push(-c.p3.y);return b}function h(a,b){for(var c=a,d=0;d<c.count;++d)b.push("c"),b.push(c.p1.y),b.push(-c.p1.x),b.push(c.p2.y),b.push(-c.p2.x),b.push(c.p3.y),b.push(-c.p3.x);return b}var i=this.position,j=this.size,k=this.style["stroke-width"],l=2*k,m=i.x,n=i.y,o=i.x+j.x,p=i.y+j.y,q=5*l,r=[];if(j.x<q||j.y<q){var s=j.x-k,t=j.y-k,u=.5*-j.x,v=0;c.createEllipsePath(u,v,s,t,!1,r)}else{var w=d(m,o,l,k),x=d(n,p,l,k),y=w.diameter,z=x.diameter,A=w.radius,B=x.radius;w=d(m+y,o-y,l,k),x=d(n+z,p-z,l,k);var C=.5*k,u=.5*-j.x+C+A,v=.5*-j.y+C+2*B;r.push("M"),r.push(u),r.push(v),b("LT",A,B,k,r),e(w,r),b("RT",A,B,k,r),f(x,r),b("RB",A,B,k,r),g(w,r),b("LB",A,B,k,r),h(x,r)}return r.push("z"),r},b.MarkupCloud=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_FREEHAND,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeFreehand(this.editor)},d.set=function(a,b,c){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g="none",h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(c>1){a.push("M"),a.push(b[0].x),a.push(b[0].y);for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(f.x-e.x),a.push(f.y-e.y)}}return a},b.MarkupFreehand=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYLINE,this.shape=c.createMarkupPathSvg("path"),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolyline(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.style["stroke-width"],e=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),f=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",g=this.getTransform();c.setAttributeToMarkupSvg(b,"d",this.getPath().join(" ")),c.setAttributeToMarkupSvg(b,"stroke-width",d),c.setAttributeToMarkupSvg(b,"stroke",e),c.setAttributeToMarkupSvg(b,"fill",f),c.setAttributeToMarkupSvg(b,"transform",g),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),
a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=[],b=this.locations,c=b.length;if(0===c)return" ";a.push("M"),a.push(b[0].x),a.push(b[0].y);for(var d=1;d<c;++d){var e=b[d-1],f=b[d];a.push("l"),a.push(f.x-e.x),a.push(f.y-e.y)}return this.closed&&a.push("z"),a},b.MarkupPolyline=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_POLYCLOUD,this.locations=[],this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModePolycloud(this.editor)},d.set=function(a,b,c,d){this.rotation=0,this.locations=c.concat(),this.size.x=0===b.x?1:b.x,this.size.y=0===b.y?1:b.y,this.closed=d,this.setSize(a,b.x,b.y),this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=this.closed?c.composeRGBAString(a["fill-color"],a["fill-opacity"]):"none",h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setSize=function(a,b,c){b=0===b?1:b,c=0===c?1:c;for(var d=this.locations,e=d.length,f=b/this.size.x,g=c/this.size.y,h=0;h<e;++h){var i=d[h];i.x*=f,i.y*=g}this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),a.locations=this.locations.map(function(a){return[a.x,a.y].join(" ")}).join(" "),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){function a(a){switch(a.length){case 0:case 1:return 1;case 2:var b=a[0],c=a[1];return b.y>c.y?1:-1;default:var d=a[0],e=a[1],f=a[2],g=(e.x-d.x)*(e.y+d.y)+(f.x-e.x)*(f.y+e.y);return g<0?1:-1}}function b(a,b){for(var c=a.length,d=[],e=c-(b?0:1),f=0;f<e;++f){var g=a[f],h=a[(f+1)%c],i=h.x-g.x,j=h.y-g.y,k=Math.sqrt(i*i+j*j);d.push({index:f,pointA:new THREE.Vector3(g.x,g.y,0),pointB:new THREE.Vector3(h.x,h.y,0),vecAB:new THREE.Vector3(i/k,j/k,0),vecBA:new THREE.Vector3(-i/k,-j/k,0),length:k})}return d}function c(a,b,c){for(var d=2*c,e=a.length,f=0;f<e;++f){var g=a[f],h=b[f],i=b[(f+1)%e];g.bodyA=g.vecAB.clone().multiplyScalar(h.radius).add(g.pointA),g.bodyB=g.vecBA.clone().multiplyScalar(i.radius).add(g.pointB),g.body=g.bodyB.clone().sub(g.bodyA).length(),g.bodyCount=Math.round(g.body/d),g.bodyDiameter=d+(g.body-d*g.bodyCount)/g.bodyCount,g.bodyRadius=.5*g.bodyDiameter}}function d(a,b,c){for(var d=[],e=a.length,f=0;f<e;++f){var g=a[0!==f?f-1:e-1],h=a[f],i=g.vecBA.clone().cross(h.vecAB).z<0,j=g.length<b||h.length<b;j||0===f&&!c?d.push({pointA:h.pointA.clone(),pointB:h.pointA.clone(),radius:0,large:!1}):d.push({pointA:h.pointA.clone().add(g.vecBA.clone().multiplyScalar(b)),pointB:h.pointA.clone().add(h.vecAB.clone().multiplyScalar(b)),radius:b,large:i})}return d}function e(a,b,c){var d=a.bodyRadius,e=a.bodyDiameter,f=.05*e,g=3.5*d/3,h=new THREE.Vector3(f,b*-g),i=new THREE.Vector3(e-f,b*-g),j=new THREE.Vector3(e,0),k=Math.acos(a.vecAB.x)*(a.vecAB.y<0?-1:1),l=(new THREE.Matrix4).makeRotationZ(k);h.applyMatrix4(l),i.applyMatrix4(l),j.applyMatrix4(l);for(var m=a.bodyCount,n=0;n<m;++n)c.push("c"),c.push(h.x),c.push(h.y),c.push(i.x),c.push(i.y),c.push(j.x),c.push(j.y)}function f(a,b,c,d){b&&(d.push("M"),d.push(a.pointA.x),d.push(a.pointA.y));var e=1===c?a.large:!a.large;return 0!==a.radius&&(d.push("a"),d.push(a.radius),d.push(a.radius),d.push(0),d.push(e?1:0),d.push(1===c?1:0),d.push(a.pointB.x-a.pointA.x),d.push(a.pointB.y-a.pointA.y)),d}var g=this.style["stroke-width"],h=2*g,i=a(this.locations),j=this.closed,k=[],l=b(this.locations,j),m=d(l,h,j),n=m.length;c(l,m,h);for(var o=0;o<n;++o)f(m[o],0===o,i,k),e(l[o],i,k);return j&&k.push("z"),k},b.MarkupPolycloud=a}(),function(){"use strict";function a(a,d){var e=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.Markup.call(this,a,d,e),this.type=b.MARKUP_TYPE_RECTANGLE,this.shape=c.createMarkupPathSvg(),this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeRectangle(this.editor)},d.set=function(a,b){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.updateStyle()},d.updateStyle=function(){var a=this.style,b=this.shape,d=this.getPath().join(" "),e=this.style["stroke-width"],f=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),g=c.composeRGBAString(a["fill-color"],a["fill-opacity"]),h=this.getTransform();c.setAttributeToMarkupSvg(b,"d",d),c.setAttributeToMarkupSvg(b,"stroke-width",e),c.setAttributeToMarkupSvg(b,"stroke",f),c.setAttributeToMarkupSvg(b,"fill",g),c.setAttributeToMarkupSvg(b,"transform",h),c.updateMarkupPathSvgHitarea(b,this.editor)},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.rotation=String(this.rotation),c.addMarkupMetadata(this.shape,a)},d.getPath=function(){var a=this.style["stroke-width"],b=this.size.x-a,d=this.size.y-a,e=.5*-b,f=.5*-d,g=[];return c.createRectanglePath(e,f,b,d,!1,g),g},b.MarkupRectangle=a}(),function(){"use strict";function a(a,d,e){var f=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.Markup.call(this,a,d,f),this.type=b.MARKUP_TYPE_TEXT,this.shape=c.createMarkupTextSvg(),this.constraintRotation=!0,this.size.x=e.x,this.size.y=e.y,this.currentText="",this.currentTextLines=[""],this.textDirty=!0,this.textSize={x:0,y:0},this.lineHeight=130,this.bindDomEvents()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.Markup.prototype),a.prototype.constructor=a;var d=a.prototype;d.getEditMode=function(){return new b.EditModeText(this.editor)},d.set=function(a,b,c,d){this.position.x=a.x,this.position.y=a.y,this.size.x=b.x,this.size.y=b.y,this.setText(c,d)},d.setSize=function(a,b,c){this.position.x=a.x,this.position.y=a.y,this.size.x=b,this.size.y=c,this.updateStyle()},d.setStyle=function(a){c.copyStyle(a,this.style),this.updateStyle()},d.setText=function(a){this.currentText=a,this.updateStyle()},d.getText=function(){return this.currentText},d.getTextLines=function(){return this.currentTextLines.concat()},d.updateStyle=function(){function a(){var a=this.style,b=this.shape,d=this.style["font-size"],e=this.style["font-family"],f=this.style["font-weight"],g=this.style["font-style"],h=this.highlighted?this.highlightColor:c.composeRGBAString(a["stroke-color"],a["stroke-opacity"]),i=c.composeRGBAString(a["fill-color"],a["fill-opacity"]);this.rebuildTextSvg(),c.setAttributeToMarkupSvg(b,"font-family",e),c.setAttributeToMarkupSvg(b,"font-size",d),c.setAttributeToMarkupSvg(b,"fill",h),c.setAttributeToMarkupSvg(b,"font-weight",f),c.setAttributeToMarkupSvg(b,"font-style",g);var j=this.editor,k=this.getTransform(),l=this.getTextTransform(),m=this.textSize;c.setMarkupTextSvgTransform(b,k,l),c.updateMarkupTextSvgBackground(b,m.x,m.y,i),c.updateMarkupTextSvgClipper(b,m.x,m.y),c.updateMarkupTextSvgHitarea(b,m.x,m.y,j),this.applyingStyle=!1}this.applyingStyle=this.applyingStyle||!1,this.applyingStyle||(this.applyingStyle=!0,requestAnimationFrame(a.bind(this)))},d.rebuildTextSvg=function(){var a=this.editor.editMode;if(a&&a.type===this.type){var b=c.cloneStyle(a.textInputHelper.style),d=a.textInputHelper.textArea.value;this.currentTextLines=a.textInputHelper.getTextValuesForMarkup(this).lines,a.selectedMarkup!==this&&(a.textInputHelper.textArea.value=d,a.textInputHelper.setStyle(b))}var e=c.createSvgElement("text");e.setAttribute("id","markup"),e.setAttribute("alignment-baseline","middle"),this.shape.childNodes[0].removeChild(this.shape.markup),this.shape.childNodes[0].appendChild(e),this.shape.markup=e;var f=0,g=0,h=this.getLineHeight();this.currentTextLines.forEach(function(a){var b=c.createSvgElement("tspan");b.setAttribute("x",f),b.setAttribute("y",g),b.textContent=a,e.appendChild(b),g+=h}.bind(this));var i=this.generateBoundingPolygon(),j=this.editor.sizeFromClientToMarkups(i.xVertices[1]-i.xVertices[0],i.yVertices[2]-i.yVertices[0]);this.textSize.x=Math.min(j.x,this.size.x),this.textSize.y=Math.min(j.y,this.size.y)},d.generateBoundingPolygon=function(){function a(a,b,d){for(var e={w:0,h:0},a=c.measureTextLines(a,b,d),f=a.length,g=0;g<f;++g){var h=a[g];e.w=Math.max(e.w,h.width),e.h=e.h+h.height}return 0!==e.h&&(e.h+=d.sizeFromMarkupsToClient(0,.25*b["font-size"]).y),e}var b=this.getClientPosition(),d=this.getClientSize(),e=a(this.currentTextLines,this.style,this.editor),f=Math.min(d.x,e.w),g=Math.min(d.y,e.h),h=new THREE.Vector2(.5*-d.x,.5*-d.y).add(b),i=new THREE.Vector2(h.x+f,h.y),j=new THREE.Vector2(i.x,i.y+g),k=new THREE.Vector2(h.x,j.y);return{vertexCount:4,xVertices:new Float32Array([h.x,i.x,j.x,k.x]),yVertices:new Float32Array([h.y,i.y,j.y,k.y])}},d.setMetadata=function(){var a=c.cloneStyle(this.style);return a.type=this.type,a.position=[this.position.x,this.position.y].join(" "),a.size=[this.size.x,this.size.y].join(" "),a.text=String(this.currentText),c.addMarkupMetadata(this.shape,a)},d.getClientFontSize=function(){return this.editor.sizeFromMarkupsToClient(0,this.style["font-size"]).y},d.getLineHeight=function(){return this.style["font-size"]},d.renderToCanvas=function(a){function b(a,b,c,d){var e=0;b.forEach(function(b){e+c>d||(a.fillText(b,0,e),e+=c)})}var d=this.style["font-family"],e=this.style["font-style"],f=this.style["font-weight"],g=this.style["stroke-color"],h=this.style["stroke-opacity"],i=this.getClientFontSize(),j=this.editor.positionFromMarkupsToClient(this.position.x,this.position.y),k=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y),l=this.editor.sizeFromMarkupsToClient(this.textSize.x,this.textSize.y),m=this.editor.sizeFromMarkupsToClient(0,this.getLineHeight()).y;a.save();var n=this.style["fill-color"],o=this.style["fill-opacity"];a.fillStyle=c.composeRGBAString(n,o),a.translate(j.x,j.y),0!==o&&a.fillRect(k.x*-.5,k.y*-.5,l.x,l.y),a.restore(),a.fillStyle=g,a.strokeStyle=g,a.textBaseline="Alphabetic",a.translate(j.x-.5*k.x,j.y-.5*k.y+m),a.font=e+" "+f+" "+i+"px "+d,a.globalAlpha=h,b(a,this.currentTextLines,m,k.y)},d.getTransform=function(){var a=this.position.x-.5*this.size.x,b=this.position.y+.5*this.size.y;return["translate(",a,",",b,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},d.getTextTransform=function(){var a=this.getLineHeight(),b=this.position.x-.5*this.size.x,d=this.position.y+.5*this.size.y-a;return["translate(",b,",",d,")","rotate(",c.radiansToDegrees(-this.rotation),")","scale(1,-1)"].join(" ")},d.cloneShape=function(a){a.shape=c.createMarkupTextSvg(),a.bindDomEvents()},b.MarkupText=a}(),function(){"use strict";function a(){Autodesk.Viewing.ToolInterface.call(this),this.names=["markups.core"],this.panTool=null,this.allowNav=!1,this.coreExt=null,this.hotkeysEnabled=!0;var a=!1,b=!1;this.allowNavigation=function(a){this.allowNav=a},this.setCoreExtension=function(a){this.coreExt=a},this.setHotkeysEnabled=function(a){this.hotkeysEnabled=a},this.activate=function(a,b){this.panTool=b.toolController.getTool("pan"),this.panTool&&this.panTool.activate("pan")},this.deactivate=function(a){this.panTool&&this.panTool.deactivate("pan"),this.panTool=null},this.handleKeyDown=function(c,d){if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!0;break;case Autodesk.Viewing.KeyCode.x:a&&!this.allowNav&&this.coreExt.cut();break;case Autodesk.Viewing.KeyCode.c:a&&!this.allowNav&&this.coreExt.copy();break;case Autodesk.Viewing.KeyCode.v:a&&!this.allowNav&&this.coreExt.paste();break;case Autodesk.Viewing.KeyCode.d:a&&!this.allowNav&&(this.coreExt.copy(),this.coreExt.paste());break;case Autodesk.Viewing.KeyCode.z:!a||b||this.allowNav?a&&b&&!this.allowNav&&this.coreExt.redo():this.coreExt.undo();break;case Autodesk.Viewing.KeyCode.y:a&&!this.allowNav&&this.coreExt.redo();break;case Autodesk.Viewing.KeyCode.ESCAPE:this.coreExt.onUserCancel();break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var e=this.coreExt.getSelection();e&&this.coreExt.deleteMarkup(e);break;case Autodesk.Viewing.KeyCode.F12:return!1}return!0},this.handleKeyUp=function(c,d){if(!this.hotkeysEnabled)return!0;switch(d){case Autodesk.Viewing.KeyCode.CONTROL:a=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:b=!1}return!0},this.update=function(){return!!(this.allowNav&&this.panTool&&this.panTool.update)&&this.panTool.update()},this.handleSingleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleClick)&&this.panTool.handleSingleClick(a,b)},this.handleDoubleClick=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleClick)&&this.panTool.handleDoubleClick(a,b)},this.handleSingleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleSingleTap)&&this.panTool.handleSingleTap(a)},this.handleDoubleTap=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleDoubleTap)&&this.panTool.handleDoubleTap(a)},this.handleWheelInput=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleWheelInput)&&this.panTool.handleWheelInput(a)},this.handleButtonDown=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonDown)&&this.panTool.handleButtonDown(a,b)},this.handleButtonUp=function(a,b){return!this.allowNav||!(!this.panTool||!this.panTool.handleButtonUp)&&this.panTool.handleButtonUp(a,b)},this.handleMouseMove=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleMouseMove)&&this.panTool.handleMouseMove(a)},this.handleGesture=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleGesture)&&this.panTool.handleGesture(a)},this.handleBlur=function(a){return!this.allowNav||!(!this.panTool||!this.panTool.handleBlur)&&this.panTool.handleBlur(a)}}var b=Autodesk.Viewing.Extensions.Markups.Core;b.MarkupTool=a}(),function(){"use strict";function a(a,d){Autodesk.Viewing.Extension.call(this,a,d),this.options=this.options||{},this.markups=[],this.styles={},this.duringViewMode=!1,this.duringEditMode=!1,this.actionManager=new b.EditActionManager(50),this.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onEditActionHistoryChanged.bind(this)),this.nextId=0,this.clipboard=new b.Clipboard(this),this.input=new b.InputHandler,c.addTraitEventDispatcher(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onViewerResizeBinded=function(a){var b=this;b.onViewerResize(a),requestAnimationFrame(function(){b.duringViewMode&&b.onViewerResize(a)})}.bind(this),this.onMarkupSelectedBinded=this.onMarkupSelected.bind(this),this.onMarkupEnterEditionBinded=this.onMarkupEnterEdition.bind(this),this.onMarkupCancelEditionBinded=this.onMarkupCancelEdition.bind(this),this.onMarkupDeleteEditionBinded=this.onMarkupDeleteEdition.bind(this),this.onToolChangeBinded=this.onToolChange.bind(this);var e=c.createStyleSheet();c.addRuleToStyleSheet(e,".autodesk-markups-extension-core-make-me-bigger:after",'content:""; position:absolute; top:-10px; bottom:-10px; left:-10px; right:-10px;',0)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core"),c=AutodeskNamespace("Autodesk.Viewing.Extensions.Markups.Core.Utils"),d=1e3;a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,b.MarkupsCore=a,b.EVENT_ENTER_EDIT_MODE="EVENT_MARKUP_CORE_ENTER_EDIT_MODE",b.EVENT_LEAVE_EDIT_MODE="EVENT_MARKUP_CORE_LEAVE_EDIT_MODE",b.EVENT_SELECTION_CHANGED="EVENT_MARKUP_SELECTION_CHANGED";var e=a.prototype;e.load=function(){var a=this.svg=c.createSvgElement("svg");c.setSvgParentAttributes(a);var d=new c.DomElementStyle;d.setAttribute("position","absolute"),d.setAttribute("left","0"),d.setAttribute("top","0"),d.setAttribute("transform","scale(1,-1)",{allBrowsers:!0}),d.setAttribute("transformOrigin","0, 0",{allBrowsers:!0}),a.setAttribute("style",d.getStyleString()),this.bounds={x:0,y:0,width:0,height:0},this.input.attachTo(this),this.editFrame=new b.EditFrame(this.viewer.container,this),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_START,function(){this.disableMarkupInteractions(!0)}.bind(this)),this.editFrame.addEventListener(b.EVENT_EDITFRAME_EDITION_END,function(){this.disableMarkupInteractions(!1)}.bind(this));var e=this.options.markupToolClass||b.MarkupTool;return this.markupTool=new e,this.markupTool.setCoreExtension(this),this.markupTool.setHotkeysEnabled(!this.options.markupDisableHotkeys),this.viewer.toolController.registerTool(this.markupTool),this.snapper=new Autodesk.Viewing.Extensions.Measure.Snapper(this.viewer,!0),this.viewer.toolController.registerTool(this.snapper),!0},e.unload=function(){this.hide(),this.input.detachFrom(this),this.markupTool&&(this.viewer.toolController.deregisterTool(this.markupTool),this.markupTool=null),this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null);var a=this.svg;return a&&this.onMouseDownBinded&&(a.removeEventListener("mousedown",this.onMouseDownBinded),this.onMouseDownBinded=null),a.parentNode&&a.parentNode.removeChild(a),this.editModeSvgLayerNode=null,this.svg=null,!0},e.toggleEditMode=function(){this.duringEditMode?this.leaveEditMode():this.enterEditMode()},e.enterEditMode=function(){return!!this.duringEditMode||!(!this.duringViewMode&&!this.show())&&(this.editModeSvgLayerNode||(this.editModeSvgLayerNode=c.createSvgElement("g"),this.editModeSvgLayerNode.setAttribute("cursor","default")),this.svg.insertBefore(this.editModeSvgLayerNode,this.svg.firstChild),this.svg.setAttribute("cursor","crosshair"),this.input.enterEditMode(),this.activateTool(!0),this.allowNavigation(!1),this.styles={},this.defaultStyle=null,this.duringEditMode=!0,this.changeEditMode(new b.EditModeArrow(this)),this.actionManager.clear(),this.fireEvent({type:b.EVENT_EDITMODE_ENTER}),!0)},e.leaveEditMode=function(){var a=!0,c=!1;if(!this.duringEditMode||!this.duringViewMode)return a;var d=this.viewer;return d?(this.editMode.destroy(),this.editMode=null,this.duringEditMode=!1,this.svg.removeChild(this.editModeSvgLayerNode),this.svg.setAttribute("cursor","default"),this.input.leaveEditMode(),this.editFrame.setMarkup(null),this.activateTool(!0),this.allowNavigation(!0),this.fireEvent({type:b.EVENT_EDITMODE_LEAVE}),a):c},e.toggle=function(){this.duringViewMode?this.hide():this.show()},e.show=function(){var a=this.viewer;if(!a||!a.model)return!1;if(this.duringViewMode||this.duringEditMode)return!0;a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded),a.container.appendChild(this.svg),this.input.enterViewMode(),c.hideLmvUi(a),this.onViewerRolloverObject=a.impl.rolloverObject,a.impl.rolloverObject=function(){},this.activateTool(!0);var b=a.impl.camera;return this.onViewerResize({width:b.clientWidth,height:b.clientHeight}),this.clear(),this.svgLayersMap={},this.duringViewMode=!0,this.allowNavigation(!0),!0},e.hide=function(){var a=!0,b=!1,d=this.viewer;if(!d||!this.duringViewMode)return a;if(this.duringEditMode&&!this.leaveEditMode())return b;d.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),d.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onViewerResizeBinded);var e=this.svg;return e.parentNode&&e.parentNode.removeChild(e),this.unloadMarkupsAllLayers(),c.removeAllMetadata(e),this.input.leaveViewMode(),c.restoreLmvUi(d),this.viewer.impl.rolloverObject=this.onViewerRolloverObject,this.activateTool(!1),this.duringViewMode=!1,a},e.clear=function(){for(var a=this.markups;a.length>0;){var b=a[0];this.removeMarkup(b),b.destroy()}var c=this.editModeSvgLayerNode;if(c&&c.childNodes.length>0)for(;c.childNodes.length;)c.removeChild(c.childNodes[0])},e.generateData=function(){this.editMode&&this.editMode.onSave(),c.removeAllMetadata(this.svg);var a=c.createSvgElement("svg");c.transferChildNodes(this.svg,a),c.transferChildNodes(this.editModeSvgLayerNode,this.svg);var b={"data-model-version":"4"},d=c.addSvgMetadata(this.svg,b),e=[d];this.markups.forEach(function(a){var b=a.setMetadata();b&&e.push(b)});var f=c.svgNodeToString(this.svg);return e.forEach(function(a){a.parentNode.removeChild(a)}),c.transferChildNodes(this.svg,this.editModeSvgLayerNode),c.transferChildNodes(a,this.svg),a=null,f},e.generatePoints3d=function(){var a={markups:[],main:null},d=this.markups,e=d.length;if(0===e)return a;for(var f=this.viewer.impl.renderer().readbackTargetId(),g=0;g<e;++g){var h=d[g],i=h.generatePoint3d(f)||null;a.markups.push({id:h.id,type:h.type,point:i||null})}if(1===e){var j=a.markups[0].point;return a.main=j&&j.clone(),a}for(var g=0;g<e;++g){var k=a.markups[g];if(k.type===b.MARKUP_TYPE_ARROW&&null!==k.point)return a.main=k.point.clone(),a}for(var l=Number.POSITIVE_INFINITY,m=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,g=0;g<e;++g){var p=d[g].generateBoundingBox();l=Math.min(l,p.min.x),m=Math.min(m,p.min.y),n=Math.max(n,p.max.x),o=Math.max(o,p.max.y)}var q={};q.vertexCount=4,q.xVertices=new Float32Array([l,n,n,l]),q.yVertices=new Float32Array([m,m,o,o]);var r=c.checkPolygon(q,f),s=r&&this.viewer.clientToWorld(r.x,r.y);return a.main=s&&s.point,a},e.renderToCanvas=function(a){this.markups.forEach(function(b){a.save(),b.renderToCanvas(a),a.restore()})},e.changeEditMode=function(a){var d=this.editMode;d&&d.destroy(),a.addEventListener(b.EVENT_EDITMODE_CREATION_BEGIN,function(){this.disableMarkupInteractions(!0)}.bind(this)),a.addEventListener(b.EVENT_EDITMODE_CREATION_END,function(){this.disableMarkupInteractions(!1)}.bind(this)),a.addEventListener(b.EVENT_MARKUP_DESELECT,function(a){this.fireEvent(a)}.bind(this)),this.editMode=a,this.styles[a.type]=c.cloneStyle(a.getStyle()),this.fireEvent({type:b.EVENT_EDITMODE_CHANGED,target:a})},e.isNavigationAllowed=function(){return!this.viewer.impl.camera.isPerspective},e.allowNavigation=function(a){if(a&&(this.duringEditMode||this.duringViewMode)&&!this.isNavigationAllowed())return!1;var b=this.editMode;this.navigating=a,a?(this.svg.setAttribute("pointer-events","none"),b&&this.selectMarkup(null)):this.svg.setAttribute("pointer-events","painted");for(var c=this.markups,d=c.length,e=0;e<d;++e)c[e].updateStyle();this.markupTool.allowNavigation(a),b&&b.notifyAllowNavigation(a)},e.disableMarkupInteractions=function(a){this.markups.forEach(function(b){b.disableInteractions(a)})},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.activateTool=function(a){if(a)this.cachedNavigationTool||(this.cachedNavigationTool=this.viewer.getActiveNavigationTool(),this.viewer.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)),this.viewer.setActiveNavigationTool(this.markupTool.getName());else{if(this.cachedNavigationTool)this.viewer.setActiveNavigationTool(this.cachedNavigationTool),this.cachedNavigationTool=null;else{var b=this.viewer.getDefaultNavigationToolName();this.viewer.setActiveNavigationTool(b)}this.viewer.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChangeBinded)}},Autodesk.Viewing.Extensions.Markups.Core.MarkupsCore.prototype.onToolChange=function(a){if(a.toolName===this.markupTool.getName()){if(a.active){var b=this.isNavigationAllowed();this.viewer.setNavigationLockSettings({pan:b,zoom:b,orbit:!1,roll:!1,fov:!1,walk:!1,gotoview:!1})}this.viewer.setNavigationLock(a.active)}},e.changeInputHandler=function(a){this.input.detachFrom(this),a.attachTo(this),this.input=a,this.duringEditMode&&a.enterEditMode(),this.duringViewMode&&a.enterViewMode()},e.copy=function(){this.clipboard.copy()},e.cut=function(){this.clipboard.cut()},e.paste=function(){this.clipboard.paste()},e.undo=function(){this.actionManager.undo()},e.redo=function(){this.actionManager.redo()},e.isUndoStackEmpty=function(){return this.actionManager.isUndoStackEmpty()},e.isRedoStackEmpty=function(){return this.actionManager.isRedoStackEmpty()},e.beginActionGroup=function(){this.actionManager.beginActionGroup()},e.closeActionGroup=function(){this.actionManager.closeActionGroup()},e.cancelActionGroup=function(){this.actionManager.cancelActionGroup()},e.getId=function(){return++this.nextId},e.onEditActionHistoryChanged=function(a){var b=a.data,c=this.editMode,d=c&&c.selectedMarkup&&c.selectedMarkup.id===b.targetId;if("undo"!==b.action&&b.targetId!==-1||"undo"===b.action&&d){var e=this.getMarkup(b.targetId);this.selectMarkup(e)}this.fireEvent(a)},e.getMarkup=function(a){for(var b=this.markups,c=b.length,d=0;d<c;++d)if(b[d].id==a)return b[d];return null},e.selectMarkup=function(a){if(a)if(this.editMode.type===a.type)this.editMode.setSelection(a);else{var b=a.getEditMode();b.setSelection(null),this.changeEditMode(b),this.setStyle(a.getStyle()),this.editMode.setSelection(a)}else this.editMode.setSelection(null)},e.getSelection=function(){return this.editMode.getSelection()},e.deleteMarkup=function(a,b){var c=a.getEditMode();c.deleteMarkup(a,b)},e.addMarkup=function(a){a.setParent(this.editModeSvgLayerNode),a.addEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.addEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.addEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.addEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded),this.markups.push(a)},e.removeMarkup=function(a){a.setParent(null),a.removeEventListener(b.EVENT_MARKUP_SELECTED,this.onMarkupSelectedBinded),a.removeEventListener(b.EVENT_MARKUP_ENTER_EDITION,this.onMarkupEnterEditionBinded),a.removeEventListener(b.EVENT_MARKUP_CANCEL_EDITION,this.onMarkupCancelEditionBinded),a.removeEventListener(b.EVENT_MARKUP_DELETE_EDITION,this.onMarkupDeleteEditionBinded);var c=this.markups,d=c.indexOf(a);d!==-1&&c.splice(d,1);var e=this.editMode;if(e){var f=e.getSelection();f===a&&this.selectMarkup(null)}},e.setStyle=function(a){var b=this.styles,d=this.editMode;c.copyStyle(a,b[d.type]),d.setStyle(b[d.type])},e.getStyle=function(){return c.cloneStyle(this.styles[this.editMode.type])},e.getDefaultStyle=function(){var a=["stroke-width","font-size","font-family","font-style","font-weight","stroke-color","stroke-opacity","fill-color","fill-opacity"];return this.defaultStyle=this.defaultStyle||c.createStyle(a,this),this.defaultStyle},e.bringToFront=function(a){this.sendMarkupTo(a,this.markups.length-1)},e.sendToBack=function(a){this.sendMarkupTo(a,0)},e.bringForward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b+1)},e.bringBackward=function(a){var b=this.markups.indexOf(a);this.sendMarkupTo(a,b-1)},e.sendMarkupTo=function(a,b){var c=this.markups,d=c.indexOf(a);d===-1||b<0||b>=c.length||(c.splice(d,1),b=d>b?b-1:b,c.splice(b,0,a),a.setParent(null),a.setParent(this.editModeSvgLayerNode))},e.loadMarkups=function(a,b){var e=this,f=e.viewer,g=f.impl.camera,h=function(a,b){var d=c.clientToWorld(a,b,0,f);return d.add(g.position).applyMatrix4(g.matrixWorldInverse),d.z=0,d},i=function(a,b){var d=e.viewer.impl.camera,f=c.clientToWorld(a,b,0,e.viewer),g=e.viewer.model.getData().globalOffset;return g&&f.sub(g),f.add(d.position),f.applyMatrix4(d.matrixWorldInverse),f.z=0,f},j=c.getClipPathId(),k=function(a){if("markup_element"==a.tagName&&"label"===a.getAttribute("type")){var b=a.parentNode.parentNode.childNodes[1].childNodes[0],c="markup-clipper-"+j++,d="url(#"+c+")";b.setAttribute("id",c),b.parentNode.setAttribute("clip-path",d)}else for(var e=a.childNodes,f=e.length,g=0;g<f;++g)k(e[g])};if(!this.duringViewMode)return!1;if(!b)return console.warn("loadMarkups failed; missing 2nd argument 'layerId'"),!1;var l=c.stringToSvgNode(a);if(!l)return!1;var m=l.childNodes[0].childNodes[0],n=parseFloat(m.getAttribute("data-model-version")),o={x:0,y:0},p=this.viewer.model.getData().globalOffset;if(n<2&&p){var q=i(0,0).sub(h(0,0));o.x+=q.x,o.y+=q.y}if(n<4&&p&&!g.isPerspective){var r=this.clientToMarkups(0,0).sub(i(0,0));o.x+=r.x,o.y+=r.y}var s=null;n<4&&g.isPerspective&&(s=d),n>=3&&k(l),c.removeAllMetadata(l);var t=this.svgLayersMap[b];t||(t=c.createSvgElement("g"),this.svg.appendChild(t),this.svgLayersMap[b]=t);for(var u=l.childNodes;u.length;){var v=u[0],w=v.getAttribute("transform")||"";0===o.x&&0===o.y||(w="translate("+o.x+", "+o.y+") "+w),s&&(w="scale("+s+", "+s+") "+w),(o||s)&&v.setAttribute("transform",w),t.appendChild(v),v.setAttribute("pointer-events","none")}return!0},e.unloadMarkups=function(a){if(!a)return console.warn("unloadMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];return!!b&&(this.svg.removeChild(b),delete this.svgLayersMap[a],!0)},e.unloadMarkupsAllLayers=function(){for(var a in this.svgLayersMap)this.svgLayersMap.hasOwnProperty(a)&&this.svg.removeChild(this.svgLayersMap[a]);this.svgLayersMap={}},e.hideMarkups=function(a){if(!a)return console.warn("hideMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];return!!b&&void b.setAttribute("visibility","hidden")},e.showMarkups=function(a){if(!a)return console.warn("showMarkups failed; No layerId provided."),!1;var b=this.svgLayersMap[a];return!!b&&void b.setAttribute("visibility","visible")},e.positionFromClientToMarkups=function(a,b){return this.clientToMarkups(a,b)},e.positionFromMarkupsToClient=function(a,b){return this.markupsToClient(a,b)},e.vectorFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:d.x-c.x,y:d.y-c.y}},e.vectorFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:d.x-c.x,y:d.y-c.y}},e.sizeFromClientToMarkups=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},e.sizeFromMarkupsToClient=function(a,b){var c=this.markupsToClient(0,0),d=this.markupsToClient(a,b);return{x:Math.abs(d.x-c.x),y:Math.abs(d.y-c.y)}},e.markupsToClient=function(a,b){var e=this.viewer.impl.camera,f=new THREE.Vector3(a,b,0);if(e.isPerspective){var g=this.viewer.impl.canvas.getBoundingClientRect();f.x=f.x/d*(.5*g.height)+.5*g.width,f.y=-f.y/d*(.5*g.height)+.5*g.height}else{f.applyMatrix4(e.matrixWorld),f.sub(e.position);var h=this.viewer.model.getData().globalOffset;h&&f.sub(h),f=c.worldToClient(f,this.viewer,!1),f.z=0}return f},e.clientToMarkups=function(a,b){var e=this.viewer.impl.camera,f=new THREE.Vector3(a,b,0);if(e.isPerspective){var g=this.viewer.impl.canvas.getBoundingClientRect();f.x=(f.x-.5*g.width)/(.5*g.height)*d,f.y=-(f.y-.5*g.height)/(.5*g.height)*d}else{f=c.clientToWorld(f.x,f.y,0,this.viewer);var h=this.viewer.model.getData().globalOffset;h&&f.add(h),f.add(e.position),f.applyMatrix4(e.matrixWorldInverse),f.z=0}return f},e.getSvgViewBox=function(a,b){var c=this.clientToMarkups(0,0),d=this.clientToMarkups(a,b),e=Math.min(c.x,d.x),f=Math.min(c.y,d.y),g=Math.max(c.x,d.x),h=Math.max(c.y,d.y);return[e,f,g-e,h-f].join(" ")},e.getBounds=function(){return this.bounds},e.getMousePosition=function(){return this.viewer.model.is2d()&&this.snapper&&this.snapper.isSnapped()?this.getSnapPosition():this.input.getMousePosition();
},e.getSnapPosition=function(){var a,b=this.snapper.getHighlightGeometry(),c=this.snapper.getGeometry();a=b===SNAP_VERTEX?c:this.snapper.nearestPointInPointToEdge(c,this.snapper.getIntersectPoint());var d=this.project(a);return{x:d.x,y:d.y}},e.project=function(a){var b=this.viewer.navigation.getCamera(),c=this.viewer.navigation.getScreenViewport(),d=(new THREE.Vector3).copy(a);return d.project(b),new THREE.Vector3(Math.round((d.x+1)/2*c.width),Math.round((-d.y+1)/2*c.height),d.z)},e.onCameraChange=function(a){var b=this.getSvgViewBox(this.bounds.width,this.bounds.height);if("NaN NaN NaN NaN"!==b){this.svg.setAttribute("viewBox",b);var c=this.editMode;if(c){var d=c.getSelection();this.editFrame.setMarkup(d)}}},e.onViewerResize=function(a){this.bounds.x=0,this.bounds.y=0,this.bounds.width=a.width,this.bounds.height=a.height,this.svg.setAttribute("width",this.bounds.width),this.svg.setAttribute("height",this.bounds.height),this.onCameraChange()},e.onMouseMove=function(a){if(!this.navigating){if(this.editFrame.isActive()&&"mousemove"===a.type&&this.editFrame.onMouseMove(a),this.viewer.model.is2d()&&"freehand"!==this.editMode.type){var b=this.input.getMousePosition();this.snapper&&this.snapper.onMouseMove(b)}this.editMode&&this.editMode.onMouseMove(a)}};var f=0,g="";e.onMouseDown=function(a){var b=performance.now();if(!(b-f<400&&g!==a.type)){f=b,g=a.type,c.dismissLmvHudMessage();var d=this.getBounds(),e=this.getMousePosition();e.x>=d.x&&e.x<=d.x+d.width&&e.y>=d.y&&e.y<=d.y+d.height&&this.editMode.onMouseDown(a),this.editMode.creating||a.target!==this.svg||this.selectMarkup(null),this.ignoreNextMouseUp=!1}};var h=0,i="";e.onMouseUp=function(a){var b=performance.now();if(!(b-h<400&&i!==a.type||(h=b,i=a.type,this.navigating)))return this.editFrame.isActive()?void this.editFrame.onMouseUp(a):void(this.ignoreNextMouseUp||this.editMode.onMouseUp(a))},e.onMouseDoubleClick=function(a){this.navigating||this.editFrame.isActive()||this.editMode.onMouseDoubleClick(a)},e.onUserCancel=function(){this.editMode.creating?this.editMode.creationCancel():this.editMode.unselect()},e.onMarkupSelected=function(a){this.selectMarkup(a.markup),this.fireEvent(a)},e.onMarkupEnterEdition=function(a){},e.onMarkupCancelEdition=function(a){this.onUserCancel()},e.onMarkupDeleteEdition=function(a){this.removeMarkup(a.markup),this.editMode.deleteMarkup()},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.MarkupsCore",a)}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"CLONE-MARKUP",c),this.clone=d.clone(),this.clone.id=c,this.position={x:e.x,y:e.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor,b=this.clone,c=this.position;if(!a.getMarkup(this.targetId)){var d=b.clone();d.setPosition(c.x,c.y),a.addMarkup(d)}},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CloneMarkup=a}(),function(){"use strict";function a(a,d,e,f,g){b.EditAction.call(this,a,"CREATE-ARROW",d),this.selectOnExecution=!1,this.tail=f,this.head=e,this.style=c.cloneStyle(g)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupArrow(this.targetId,a);a.addMarkup(c),c.set(this.head.x,this.head.y,this.tail.x,this.tail.y),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateArrow=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CIRCLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCircle(this.targetId,a);a.addMarkup(c),c.setSize(this.position,this.size.x,this.size.y),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCircle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-CLOUD",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupCloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateCloud=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-FREEHAND",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupFreehand(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateFreehand=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-POLYCLOUD",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolycloud(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolycloud=a}(),function(){"use strict";function a(a,d,e,f,g,h,i){b.EditAction.call(this,a,"CREATE-POLYLINE",d),this.selectOnExecution=!1,this.position=e,this.size=f,this.rotation=g,this.movements=h.concat(),this.style=c.cloneStyle(i)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupPolyline(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size,this.movements),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreatePolyline=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-RECTANGLE",d),this.selectOnExecution=!1,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.rotation=g,this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=new b.MarkupRectangle(this.targetId,a);a.addMarkup(c),c.set(this.position,this.size),c.setRotation(this.rotation),c.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&this.editor.removeMarkup(a)},b.CreateRectangle=a}(),function(){"use strict";function a(a,d,e,f,g,h){b.EditAction.call(this,a,"CREATE-TEXT",d),this.text=g,this.position={x:e.x,y:e.y},this.size={x:f.x,y:f.y},this.style=c.cloneStyle(h)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor,c=this.position,d=this.size,e=new b.MarkupText(this.targetId,a,d);a.addMarkup(e),e.setSize(c,d.x,d.y),e.setText(this.text),e.setStyle(this.style)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&(this.editor.removeMarkup(a),a.destroy())},b.CreateText=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-ARROW",c.id),this.createArrow=new b.CreateArrow(a,c.id,c.head,c.tail,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createArrow.undo()},c.undo=function(){this.createArrow.redo()},b.DeleteArrow=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CIRCLE",c.id),this.createCircle=new b.CreateCircle(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCircle.undo()},c.undo=function(){this.createCircle.redo()},b.DeleteCircle=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-CLOUD",c.id),this.createCloud=new b.CreateCloud(a,c.id,c.position,c.size,c.rotation,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createCloud.undo()},c.undo=function(){this.createCloud.redo()},b.DeleteCloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-FREEHAND",c.id),this.createFreehand=new b.CreateFreehand(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createFreehand.undo()},c.undo=function(){this.createFreehand.redo()},b.DeleteFreehand=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYCLOUD",c.id),this.createPolycloud=new b.CreatePolyline(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolycloud.undo()},c.undo=function(){this.createPolycloud.redo()},b.DeletePolycloud=a}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-POLYLINE",c.id),this.createPolyline=new b.CreatePolyline(a,c.id,c.position,c.size,c.rotation,c.locations,c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createPolyline.undo()},c.undo=function(){this.createPolyline.redo()},b.DeletePolyline=a}(),function(){"use strict";var a=Autodesk.Viewing.Extensions.Markups.Core,b=function(b,c){a.EditAction.call(this,b,"DELETE-RECTANGLE",c.id),this.createRectangle=new a.CreateRectangle(b,c.id,c.position,c.size,c.rotation,c.getStyle())};b.prototype=Object.create(a.EditAction.prototype),b.prototype.constructor=b;var c=b.prototype;c.redo=function(){this.createRectangle.undo()},c.undo=function(){this.createRectangle.redo()},a.DeleteRectangle=b}(),function(){"use strict";function a(a,c){b.EditAction.call(this,a,"DELETE-TEXT",c.id);var d={x:c.position.x,y:c.position.y},e={x:c.size.x,y:c.size.y};this.createText=new b.CreateText(a,c.id,d,e,c.getText(),c.getStyle())}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.createText.undo()},c.undo=function(){this.createText.redo()},b.DeleteText=a}(),function(){"use strict";function a(){this.actions=[],this.closed=!0}var b=Autodesk.Viewing.Extensions.Markups.Core,c=a.prototype;c.open=function(){return!!this.closed&&(this.closed=!1,!0)},c.close=function(){return!this.closed&&(this.closed=!0,!0)},c.undo=function(){for(var a=this.actions,b=a.length-1,c=-1,d=b;d>=0;--d){var e=a[d];e.undo(),e.targetId!==-1&&(c=e.targetId)}return c},c.redo=function(){for(var a=this.actions,b=a.length,c=-1,d=0;d<b;++d){var e=a[d];e.redo(),e.targetId!==-1&&(c=e.targetId)}return c},c.isOpen=function(){return!this.closed},c.isClosed=function(){return this.closed},c.isEmpty=function(){return 0===this.actions.length},c.addAction=function(a){return!this.closed&&(this.actions.push(a),this.compact(),!0)},c.compact=function(){for(var a=this.actions,b=a.length,c=0;c<b;++c){var d=a[c];if(d.isIdentity())a.splice(c,1),--b,--c;else for(var e=c+1;e<b;++e){var f=a[e];if(d.type===f.type&&d.merge(f)){a.splice(e,1),--b,--c;break}}}},b.EditActionGroup=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-ARROW",c.id),this.newHead={x:d.x,y:d.y},this.newTail={x:e.x,y:e.y},this.oldHead={x:c.head.x,y:c.head.y},this.oldTail={x:c.tail.x,y:c.tail.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newHead,this.newTail)},c.undo=function(){this.applyState(this.targetId,this.oldHead,this.oldTail)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newHead=a.newHead,this.newTail=a.newTail,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){var e=1e-4;(Math.abs(d.head.x-b.x)>=e||Math.abs(d.head.y-b.y)>=e||Math.abs(d.tail.x-c.x)>=e||Math.abs(d.tail.y-c.y)>=e)&&d.set(b.x,b.y,c.x,c.y)}},c.isIdentity=function(){return this.newHead.x===this.oldHead.x&&this.newHead.y===this.oldHead.y&&this.newTail.x===this.oldTail.x&&this.newTail.y===this.oldTail.y},b.SetArrow=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CIRCLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){var e=1e-4;(Math.abs(d.position.x-b.x)>e||Math.abs(d.size.y-c.y)>e||Math.abs(d.position.y-b.y)>e||Math.abs(d.size.y-c.y)>e)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCircle=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-CLOUD",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize,this.newStrokeWidth,this.newColor)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize,this.oldStrokeWidth,this.oldColor)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){var e=1e-4;(Math.abs(d.position.x-b.x)>e||Math.abs(d.size.y-c.y)>e||Math.abs(d.position.y-b.y)>e||Math.abs(d.size.y-c.y)>e)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetCloud=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-FREEHAND",c.id),this.position=d,this.size=e,this.locations=f.concat()}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,!0)},c.isIdentity=function(){return!1},b.SetFreehand=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYCLOUD",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolycloud=a}(),function(){"use strict";function a(a,c,d,e,f,g){b.EditAction.call(this,a,"SET-POLYLINE",c.id),this.position=d,this.size=e,this.locations=f.concat(),this.closed=g}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.position,this.size,this.locations,this.closed)},c.undo=function(){},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.locations=a.locations.concat(),this.position=a.position,this.size=a.size,this.closed=a.closed,!0)},c.isIdentity=function(){return!1},b.SetPolyline=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-POSITION",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.newPosition.x,this.newPosition.y)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setPosition(this.oldPosition.x,this.oldPosition.y)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,!0)},c.isIdentity=function(){var a=this.newPosition,b=this.oldPosition;return a.x===b.x&&a.y===b.y},b.SetPosition=a}(),function(){"use strict";function a(a,c,d,e){b.EditAction.call(this,a,"SET-RECTANGLE",c.id),this.newPosition={x:d.x,y:d.y},this.newSize={x:e.x,y:e.y},this.oldPosition={x:c.position.x,y:c.position.y},this.oldSize={x:c.size.x,y:c.size.y}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){this.applyState(this.targetId,this.newPosition,this.newSize)},c.undo=function(){this.applyState(this.targetId,this.oldPosition,this.oldSize)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newSize=a.newSize,!0)},c.applyState=function(a,b,c){var d=this.editor.getMarkup(a);if(d){var e=1e-4;(Math.abs(d.position.x-b.x)>e||Math.abs(d.size.y-c.y)>e||Math.abs(d.position.y-b.y)>e||Math.abs(d.size.y-c.y)>e)&&d.set(b,c)}},c.isIdentity=function(){return this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newSize.x===this.oldSize.x&&this.newSize.y===this.oldSize.y},b.SetRectangle=a}(),function(){"use strict";function a(a,c,d){b.EditAction.call(this,a,"SET-ROTATION",c.id);var e=c.getRotation();this.newRotation={angle:d},this.oldRotation={angle:e}}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.newRotation.angle)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setRotation(this.oldRotation.angle)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newRotation=a.newRotation,!0)},c.isIdentity=function(){return this.newRotation.angle===this.oldRotation.angle},b.SetRotation=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-SIZE",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newWidth=e,this.oldWidth=c.size.x,this.newHeight=f,this.oldHeight=c.size.y}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.newPosition,this.newWidth,this.newHeight)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setSize(this.oldPosition,this.oldWidth,this.oldHeight)},c.merge=function(a){return this.targetId===a.targetId&&this.type===a.type&&(this.newPosition=a.newPosition,this.newWidth=a.newWidth,this.newHeight=a.newHeight,!0)},c.isIdentity=function(){var a=this.newPosition.x===this.oldPosition.x&&this.newPosition.y===this.oldPosition.y&&this.newWidth===this.oldWidth&&this.newHeight===this.oldHeight;return a},b.SetSize=a}(),function(){"use strict";function a(a,d,e){b.EditAction.call(this,a,"SET-STYLE",d.id),this.newStyle=c.cloneStyle(e),this.oldStyle=d.getStyle()}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var d=a.prototype;d.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.newStyle)},d.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.setStyle(this.oldStyle)},b.SetStyle=a}(),function(){"use strict";function a(a,c,d,e,f){b.EditAction.call(this,a,"SET-TEXT",c.id),this.newPosition={x:d.x,y:d.y},this.oldPosition={x:c.position.x,y:c.position.y},this.newSize={x:e.x,y:e.y},this.oldSize={x:c.size.x,y:c.size.y},this.newText=f,this.oldText=c.getText()}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditAction.prototype),a.prototype.constructor=a;var c=a.prototype;c.redo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.newPosition,this.newSize,this.newText)},c.undo=function(){var a=this.editor.getMarkup(this.targetId);a&&a.set(this.oldPosition,this.oldSize,this.oldText)},b.SetText=a}(),function(){"use strict";function a(a){this.editor=a,this.content=null,this.pastePosition={x:0,y:0},c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils,d=a.prototype;d.copy=function(){var a=this.editor.getSelection();a&&(this.content=a.clone(),this.pastePosition.x=a.position.x,this.pastePosition.y=a.position.y)},d.cut=function(){var a=this.editor.getSelection();a&&(this.copy(),this.editor.deleteMarkup(a))},d.paste=function(){var a=this.content;if(a){var c=this.editor,d=this.pastePosition,e=c.sizeFromClientToMarkups(20,20);d.x+=e.x,d.y-=e.y;var f=new b.CloneMarkup(c,c.getId(),a,d);f.execute()}},b.Clipboard=a}(),function(){"use strict";function a(){this.editor=null,this.mousePosition={x:0,y:0},this.makeSameXY=!1,this.snapRotations=!1,this.keepAspectRatio=!1,this.constrainAxis=!1,this.onWheelBinded=this.onWheel.bind(this),this.onTouchDragBinded=this.onTouchDrag.bind(this),this.onSingleTapBinded=this.onSingleTap.bind(this),this.onDoubleTapBinded=this.onDoubleTap.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.isMouseDown=!1}function b(a,b){var c=a.editor.svg.getBoundingClientRect();a.makeSameXY=b.shiftKey,a.snapRotations=b.shiftKey,a.keepAspectRatio=b.shiftKey,a.constrainAxis=b.shiftKey,a.mousePosition.x=b.clientX-c.left,a.mousePosition.y=b.clientY-c.top}function c(a){a.shiftKey=!1,a.clientX=a.pointers[0].clientX,a.clientY=a.pointers[0].clientY}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f=a.prototype;f.attachTo=function(a){this.editor&&this.detachFrom(this.editor),this.editor=a,e.isTouchDevice()&&(this.hammer=new Hammer.Manager(a.svg,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.get("doubletap2").recognizeWith("doubletap"),this.hammer.get("singletap2").recognizeWith("singletap"),this.hammer.get("singletap").requireFailure("doubletap"))},f.detachFrom=function(a){this.hammer&&this.hammer.destroy(),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor&&(this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded)),this.editor=a},f.enterEditMode=function(){this.hammer&&(this.hammer.on("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.on("singletap",this.onSingleTapBinded),this.hammer.on("singletap2",this.onSingleTapBinded),this.hammer.on("doubletap",this.onDoubleTapBinded),this.hammer.on("doubletap2",this.onDoubleTapBinded)),document.addEventListener("mousemove",this.onMouseMoveBinded,!0),document.addEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.addEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.addEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},f.leaveEditMode=function(){this.hammer&&(this.hammer.off("dragstart dragmove dragend",this.onTouchDragBinded),this.hammer.off("singletap",this.onSingleTapBinded),this.hammer.off("singletap2",this.onSingleTapBinded),this.hammer.off("doubletap",this.onDoubleTapBinded),this.hammer.off("doubletap2",this.onDoubleTapBinded)),document.removeEventListener("mousemove",this.onMouseMoveBinded,!0),document.removeEventListener("mouseup",this.onMouseUpBinded,!0),this.editor.svg.removeEventListener("mousedown",this.onMouseDownBinded),this.editor.svg.removeEventListener("dblclick",this.onMouseDoubleClickBinded),this.editor.svg.removeEventListener("wheel",this.onWheelBinded)},f.enterViewMode=function(){},f.leaveViewMode=function(){},f.getMousePosition=function(){return{x:this.mousePosition.x,y:this.mousePosition.y}},f.onWheel=function(a){a.preventDefault()},f.onMouseMove=function(a){b(this,a),this.editor.onMouseMove(a),a.preventDefault()},f.onMouseDown=function(a){b(this,a),this.isMouseDown=!0,this.editor.onMouseDown(a),a.preventDefault()},f.onMouseUp=function(a){b(this,a),this.isMouseDown=!1,this.editor.onMouseUp(a),a.preventDefault()},f.onMouseDoubleClick=function(a){b(this,a),this.editor.onMouseDoubleClick(a),a.preventDefault()},f.onTouchDrag=function(a){switch(c(a),a.type){case"dragstart":this.onMouseDown(a);break;case"dragmove":this.onMouseMove(a);break;case"dragend":this.onMouseUp(a)}a.preventDefault()},f.onSingleTap=function(a){c(a),this.onMouseDown(a),this.onMouseUp(a),a.preventDefault()},f.onDoubleTap=function(a){c(a),this.onMouseDoubleClick(a),a.preventDefault()},d.InputHandler=a}(),function(){"use strict";function a(a,b,d){this.editor=a,this.viewer=a.viewer,this.type=b,this.selectedMarkup=null,this.dragging=!1,this.draggingAnnotationIniPosition=null,this.draggingMouseIniPosition=new THREE.Vector2,this.initialX=0,this.initialY=0,this.minSize=9,this.creating=!1,this.size={x:0,y:0},this.style=c.createStyle(d,this.editor),this.style=c.copyStyle(a.getDefaultStyle(),this.style),this.CREATION_METHOD_DRAG="CREATION_METHOD_DRAG",this.CREATION_METHOD_CLICK="CREATION_METHOD_CLICK",this.CREATION_METHOD_CLICKS="CREATION_METHOD_CLICKS",this.creationMethod=this.CREATION_METHOD_DRAG,c.addTraitEventDispatcher(this)}var b=Autodesk.Viewing.Extensions.Markups.Core,c=Autodesk.Viewing.Extensions.Markups.Core.Utils;b.EVENT_EDITMODE_CREATION_BEGIN="EVENT_EDITMODE_CREATION_BEGIN",b.EVENT_EDITMODE_CREATION_END="EVENT_EDITMODE_CREATION_END",b.EVENT_MARKUP_DESELECT="EVENT_MARKUP_DESELECT";var d=a.prototype;d.destroy=function(){this.unselect(),c.removeTraitEventDispatcher(this)},d.unselect=function(){var a=!1,c=this.selectedMarkup;c&&(c.unselect(),this.selectedMarkup=null,a=!0),this.editor.editFrame.setMarkup(null),a&&this.fireEvent({type:b.EVENT_MARKUP_DESELECT})},d.creationBegin=function(){this.creating||(this.creating=!0,this.fireEvent({type:b.EVENT_EDITMODE_CREATION_BEGIN}))},d.creationEnd=function(){this.creating&&(this.creationMethod!==this.CREATION_METHOD_CLICK&&(this.selectedMarkup&&!this.isMinSizeValid()?this.creationCancel():(this.creationMethod===this.CREATION_METHOD_DRAG&&this.finishDragging(),this.selectedMarkup&&(this.editor.closeActionGroup(),this.unselect()))),this.creating=!1,this.fireEvent({type:b.EVENT_EDITMODE_CREATION_END}))},d.creationCancel=function(){this.editor.cancelActionGroup(),this.creationEnd(),this.selectedMarkup=null},d.setStyle=function(a){this.style=a;var c=this.selectedMarkup;if(c){var d=new b.SetStyle(this.editor,c,a);d.execute()}},d.getStyle=function(){return this.style},d.setSelection=function(a){this.selectedMarkup!==a&&(this.unselect(),a&&a.select()),this.selectedMarkup=a;var b=this.editor;a&&b.bringToFront(a),this.creating||b.editFrame.setMarkup(a)},d.getSelection=function(){return this.selectedMarkup},d.deleteMarkup=function(a,b){return!1},d.isMinSizeValid=function(){if(0!==this.minSize){var a=this.editor.sizeFromMarkupsToClient(this.size.x,this.size.y);return a.x*a.x+a.y*a.y>=this.minSize*this.minSize}return!0},d.startDragging=function(){var a=this.selectedMarkup,b=this.editor.getMousePosition();a&&(this.dragging=!0,this.draggingAnnotationIniPosition=a.getClientPosition(),this.draggingMouseIniPosition.set(b.x,b.y))},d.finishDragging=function(){var a=this.dragging,b=this.selectedMarkup;this.dragging=!1,b&&a&&b.finishDragging()},d.getFinalMouseDraggingPosition=function(){var a=this.editor,b=a.getBounds(),d=a.getMousePosition(),e=this.initialX,f=this.initialY,g=Math.min(Math.max(b.x,d.x),b.x+b.width),h=Math.min(Math.max(b.y,d.y),b.y+b.height);if(g==e&&h==f&&(g++,h++),a.input.makeSameXY){var i=Math.abs(g-e),j=Math.abs(h-f),k=Math.max(i,j);g=e+k*c.sign(g-e),h=f+k*c.sign(h-f)}return{x:g,y:h}},d.notifyAllowNavigation=function(a){},d.onMouseMove=function(a){},d.onMouseDown=function(){},d.onMouseUp=function(a){this.creationMethod===this.CREATION_METHOD_DRAG&&this.creationEnd()},d.onMouseDoubleClick=function(a){this.creationMethod===this.CREATION_METHOD_CLICKS&&this.creationEnd()},d.onSave=function(){this.creating&&this.creationCancel()},d.getDraggingPosition=function(){var a=this.editor.getMousePosition(),b=a.x-this.draggingMouseIniPosition.x,c=a.y-this.draggingMouseIniPosition.y;return{x:this.draggingAnnotationIniPosition.x+b,y:this.draggingAnnotationIniPosition.y+c}},d.isInsideBounds=function(a,b,c){return a>=c.x&&a<=c.x+c.width&&b>=c.y&&b<=c.y+c.height},b.EditMode=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_ARROW,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;
a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteArrow(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();if(this.initialX=c.x,this.initialY=c.y,this.size.x=0,this.size.y=0,this.lineSnapped=null,a.snapper){var d=a.snapper.getHighlightGeometry();d!==SNAP_VERTEX&&d!==SNAP_EDGE||(this.lineSnapped=a.snapper.getEdge())}var e=3.5*this.style["stroke-width"],f=a.sizeFromMarkupsToClient(e,0).x,g={x:this.initialX,y:this.initialY},h={x:Math.round(g.x+Math.cos(.25*Math.PI)*f),y:Math.round(g.y+Math.sin(.25*-Math.PI)*f)},i=function(a,b,c,d){this.isInsideBounds(b.x,b.y,d)||(b.y=Math.round(a.y+Math.sin(.25*Math.PI)*c),this.isInsideBounds(b.x,b.y,d)||(b.x=Math.round(a.x+Math.cos(.25*-Math.PI)*c),this.isInsideBounds(b.x,b.y,d)||(b.y=Math.round(a.y+Math.sin(.25*-Math.PI)*c))))}.bind(this);i(g,h,f,a.getBounds()),a.beginActionGroup(),g=a.positionFromClientToMarkups(g.x,g.y),h=a.positionFromClientToMarkups(h.x,h.y);var j=new THREE.Vector2(h.x-g.x,h.y-g.y);j.lengthSq()<e*e&&(j=j.normalize().multiplyScalar(e),h.x=g.x+j.x,h.y=g.y+j.y);var k=a.getId(),l=new b.CreateArrow(a,k,g,h,this.style);l.execute(),this.selectedMarkup=a.getMarkup(k),this.creationBegin()}},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.getFinalMouseDraggingPosition(),f=this.initialX,g=this.initialY;if(d.snapper&&!d.snapper.isSnapped()&&this.lineSnapped){var h=d.project(this.lineSnapped.vertices[0]),i=d.project(this.lineSnapped.vertices[1]),j=new THREE.Vector3(e.x,e.y,h.z),k=d.snapper.nearestPointInPointToLine(j,h,i),l=-(h.x-i.x)/(h.y-i.y),m=g-l*f,n=f+1,o=l*n+m,p=new THREE.Vector3(n,o,h.z),q=new THREE.Vector3(f,g,h.z),r=d.snapper.nearestPointInPointToLine(j,q,p);k.distanceTo(j)<=20?(e.x=k.x,e.y=k.y):r.distanceTo(j)<=20&&(e.x=r.x,e.y=r.y)}var s=d.positionFromClientToMarkups(f,g),t=d.positionFromClientToMarkups(e.x,e.y),u=new THREE.Vector2(t.x-s.x,t.y-s.y),v=3.5*c.style["stroke-width"];u.lengthSq()<v*v&&(u=u.normalize().multiplyScalar(v),t.x=s.x+u.x,t.y=s.y+u.y),this.size=d.sizeFromClientToMarkups(e.x-f,e.y-g);var w=new b.SetArrow(d,c,s,t);w.execute()}},b.EditModeArrow=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CIRCLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteCircle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.initialX,f=this.initialY,g=this.getFinalMouseDraggingPosition(),h=Math.abs(e-g.x),i=Math.abs(f-g.y),j=d.clientToMarkups(.5*(e+g.x),.5*(f+g.y)),k=this.size=d.sizeFromClientToMarkups(h,i),l=new b.SetCircle(d,c,j,k);l.execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId(),g=new b.CreateCircle(a,f,d,e,0,this.style);g.execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCircle=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_CLOUD,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteCloud(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=this.initialX,f=this.initialY,g=this.getFinalMouseDraggingPosition(),h=d.clientToMarkups((e+g.x)/2,(f+g.y)/2),i=this.size=d.sizeFromClientToMarkups(g.x-e,g.y-f),j=new b.SetCloud(d,c,h,i);j.execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId(),g=new b.CreateCloud(a,f,d,e,0,this.style);g.execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeCloud=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_FREEHAND,c),this.style["stroke-opacity"]=.75}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteFreehand(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d=this.editor,e=d.getMousePosition(),f=this.movements,g=d.clientToMarkups(e.x,e.y);f.push(g);var h=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},i=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},j=h(f,"x"),k=h(f,"y"),l=i(f,"x"),m=i(f,"y"),n=l-j,o=m-k,p={x:j+.5*n,y:k+.5*o},q=this.size={x:n,y:o},r=f.map(function(a){return{x:a.x-p.x,y:a.y-p.y}}),s=new b.SetFreehand(d,c,p,q,r);s.execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY);this.movements=[d];var e=this.size=a.sizeFromClientToMarkups(1,1);a.beginActionGroup();var f=a.getId(),g=new b.CreateFreehand(a,f,d,e,0,[{x:0,y:0}],this.style);g.execute(),this.selectedMarkup=a.getMarkup(f),this.creationBegin()}},b.EditModeFreehand=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYCLOUD,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=b.style["stroke-width"],f=2*e+.5*e,g=c(a,"x")-f,h=c(a,"y")-f,i=d(a,"x")+f,j=d(a,"y")+f,k=i-g,l=j-h;b.size={x:k,y:l},b.position={x:g+.5*k,y:h+.5*l};var m=b.position;return a.map(function(a){return{x:a.x-m.x,y:a.y-m.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils,e=25;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var f=a.prototype;f.deleteMarkup=function(a,b){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new c.DeletePolycloud(this.editor,a);return d.addToHistory=!b,d.execute(),!0}return!1},f.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var f=this.editor,g=this.selectedMarkup;if(g&&this.creating){this.dragging=!0;var h=this.movements;h.splice(h.length-1,1);var i=f.getMousePosition();i=f.clientToMarkups(i.x,i.y),h.length>=2&&d.areMarkupsPointsInClientRange(h[0],i,e,this.editor)&&(i=h[0]),h.push(i);var j=b(h,this),k=new c.SetPolycloud(f,g,this.position,this.size,j);k.execute()}},f.onMouseDown=function(){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var a=this.editor,b=a.getMousePosition();b=a.clientToMarkups(b.x,b.y);var d=this.size=a.sizeFromClientToMarkups(1,1);this.movements=[b,b],a.beginActionGroup();var e=a.getId(),f=new c.CreatePolycloud(a,e,b,d,0,[{x:0,y:0}],this.style);f.execute(),this.selectedMarkup=a.getMarkup(e),this.creationBegin()}},f.onMouseUp=function(a){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var f=this.editor,g=f.getMousePosition(),h=this.movements,i=!1;if(g=f.clientToMarkups(g.x,g.y),!(h.length>1&&d.areMarkupsPointsInClientRange(h[h.length-2],g,e,this.editor))){h.length>2&&d.areMarkupsPointsInClientRange(h[0],g,e,this.editor)&&(g=h[0],i=!0),h.splice(h.length-1,1),i||(h.push(g),h.push(g));var j=this.selectedMarkup,k=b(h,j),l=new c.SetPolycloud(f,j,j.position,j.size,k,i);l.execute(),i&&this.creationEnd()}}},f.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e),g=new c.SetPolycloud(this.editor,e,e.position,e.size,f,!0);g.execute(),this.creationEnd()}}},f.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},f.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},c.EditModePolycloud=a}(),function(){"use strict";function a(a){var b=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];c.EditMode.call(this,a,c.MARKUP_TYPE_POLYLINE,b),this.creationMethod=this.CREATION_METHOD_CLICKS,this.movements=[]}function b(a,b){var c=function(a,b){var c=a.map(function(a){return a[b]});return Math.min.apply(null,c)},d=function(a,b){var c=a.map(function(a){return a[b]});return Math.max.apply(null,c)},e=c(a,"x"),f=c(a,"y"),g=d(a,"x"),h=d(a,"y"),i=g-e,j=h-f;b.size={x:i,y:j},b.position={x:e+.5*i,y:f+.5*j};var k=b.position;return a.map(function(a){return{x:a.x-k.x,y:a.y-k.y}})}var c=Autodesk.Viewing.Extensions.Markups.Core,d=Autodesk.Viewing.Extensions.Markups.Core.Utils,e=25;a.prototype=Object.create(c.EditMode.prototype),a.prototype.constructor=a;var f=a.prototype;f.deleteMarkup=function(a,b){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new c.DeletePolyline(this.editor,a);return d.addToHistory=!b,d.execute(),!0}return!1},f.onMouseMove=function(a){c.EditMode.prototype.onMouseMove.call(this,a);var f=this.editor,g=this.selectedMarkup;if(g&&this.creating){this.dragging=!0;var h=this.movements;h.splice(h.length-1,1);var i=f.getMousePosition();i=f.clientToMarkups(i.x,i.y),h.length>=2&&d.areMarkupsPointsInClientRange(h[0],i,e,this.editor)&&(i=h[0]),h.push(i);var j=b(h,this),k=new c.SetPolyline(f,g,this.position,this.size,j);k.execute()}},f.onMouseDown=function(a){if(c.EditMode.prototype.onMouseDown.call(this),(!this.selectedMarkup||this.creating)&&!this.creating){var b=this.editor,d=b.getMousePosition();d=b.clientToMarkups(d.x,d.y);var e=this.size=b.sizeFromClientToMarkups(1,1);this.movements=[d,d],b.beginActionGroup();var f=b.getId(),g=new c.CreatePolyline(b,f,d,e,0,[{x:0,y:0}],this.style);g.execute(),this.selectedMarkup=b.getMarkup(f),this.creationBegin()}},f.onMouseUp=function(){if(c.EditMode.prototype.onMouseUp.call(this),this.creating){this.dragging=!1;var a=this.editor,f=a.getMousePosition(),g=this.movements,h=!1;if(f=a.clientToMarkups(f.x,f.y),!(g.length>1&&d.areMarkupsPointsInClientRange(g[g.length-2],f,e,this.editor))){g.length>2&&d.areMarkupsPointsInClientRange(g[0],f,e,this.editor)&&(f=g[0],h=!0),g.splice(g.length-1,1),h||(g.push(f),g.push(f));var i=this.selectedMarkup,j=b(g,i),k=new c.SetPolyline(a,i,i.position,i.size,j,h);k.execute(),h&&this.creationEnd()}}},f.creationEnd=function(){this.selectedMarkup&&(this.size.x=this.selectedMarkup.size.x,this.size.y=this.selectedMarkup.size.y),c.EditMode.prototype.creationEnd.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},f.creationCancel=function(){c.EditMode.prototype.creationCancel.call(this),this.closed=!1,this.movements=[],this.dragging=!1,this.creating=!1},f.onMouseDoubleClick=function(a){if(this.creating){var d=this.movements;if(d.splice(Math.max(0,d.length-1)),d.length<2)this.creationCancel();else{var e=this.selectedMarkup,f=b(d,e),g=new c.SetPolyline(this.editor,e,e.position,e.size,f,this.closed);g.execute(),this.creationEnd()}}},c.EditModePolyline=a}(),function(){"use strict";function a(a){var c=["stroke-width","stroke-color","stroke-opacity","fill-color","fill-opacity"];b.EditMode.call(this,a,b.MARKUP_TYPE_RECTANGLE,c)}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteRectangle(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){b.EditMode.prototype.setStyle.call(this,a);var c=this.selectedMarkup;if(c){var d=new b.SetRectangle(this.editor,c,c.position,c.size);d.execute()}},c.onMouseMove=function(a){b.EditMode.prototype.onMouseMove.call(this,a);var c=this.selectedMarkup;if(c&&this.creating){var d,e,f=this.editor,g=this.initialX,h=this.initialY,i=this.getFinalMouseDraggingPosition(),j=f.clientToMarkups((g+i.x)/2,(h+i.y)/2);if(f.snapper&&this.lineSnapped){var k=f.project(this.lineSnapped.vertices[0]),l=f.project(this.lineSnapped.vertices[1]),m=new THREE.Vector3(i.x,i.y,k.z),n=f.snapper.nearestPointInPointToLine(m,k,l);e=m.distanceTo(n);var o=-(k.x-l.x)/(k.y-l.y),p=h-o*g,q=g+1,r=o*q+p,s=new THREE.Vector3(q,r,k.z),t=new THREE.Vector3(g,h,k.z),u=f.snapper.nearestPointInPointToLine(m,t,s);d=m.distanceTo(u)}else d=i.x-g,e=i.y-h;var v=this.size=f.sizeFromClientToMarkups(d,e),w=new b.SetRectangle(f,c,j,v);w.execute()}},c.onMouseDown=function(){if(b.EditMode.prototype.onMouseDown.call(this),!this.selectedMarkup){var a=this.editor,c=a.getMousePosition();this.initialX=c.x,this.initialY=c.y;var d=a.clientToMarkups(this.initialX,this.initialY),e=this.size=a.sizeFromClientToMarkups(1,1),f=0;if(this.lineSnapped=null,a.snapper){var g=a.snapper.getHighlightGeometry();if(g===SNAP_VERTEX||g===SNAP_EDGE){this.lineSnapped=a.snapper.getEdge();var h=a.project(this.lineSnapped.vertices[0]),i=a.project(this.lineSnapped.vertices[1]),j=(i.y-h.y)/(i.x-h.x);f=this.rotation=Math.atan(j)}}a.beginActionGroup();var k=a.getId(),l=new b.CreateRectangle(a,k,d,e,f,this.style);l.execute(),this.selectedMarkup=a.getMarkup(k),this.creationBegin()}},b.EditModeRectangle=a}(),function(){"use strict";function a(a){var c=["font-size","stroke-color","stroke-opacity","fill-color","fill-opacity","font-family","font-style","font-weight"];b.EditMode.call(this,a,b.MARKUP_TYPE_TEXT,c);var d=new b.EditorTextInput(this.viewer.container,this.editor);d.addEventListener(d.EVENT_TEXT_CHANGE,this.onHelperTextChange.bind(this),!1),this.textInputHelper=d,this.onHistoryChangeBinded=this.onHistoryChange.bind(this),this.minSize=0,this.creationMethod=this.CREATION_METHOD_CLICK}var b=Autodesk.Viewing.Extensions.Markups.Core;a.prototype=Object.create(b.EditMode.prototype),a.prototype.constructor=a;var c=a.prototype;c.deleteMarkup=function(a,c){if(a=a||this.selectedMarkup,a&&a.type==this.type){var d=new b.DeleteText(this.editor,a);return d.addToHistory=!c,d.execute(),!0}return!1},c.setStyle=function(a){this.textInputHelper.isActive()?this.textInputHelper.setStyle(a):b.EditMode.prototype.setStyle.call(this,a)},c.notifyAllowNavigation=function(a){a&&this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit()},c.destroy=function(){this.textInputHelper&&(this.textInputHelper.isActive()&&this.textInputHelper.acceptAndExit(),this.textInputHelper.destroy(),this.textInputHelper=null),b.EditMode.prototype.destroy.call(this)},c.onMouseDown=function(){if(this.textInputHelper.isActive())return void this.textInputHelper.acceptAndExit();if(!this.selectedMarkup){var a=this.editor,c=a.getMousePosition(),d=a.sizeFromMarkupsToClient(0,this.style["font-size"]).y,e=15*d,f=3*d,g=this.size=a.sizeFromClientToMarkups(e,f),h=a.positionFromClientToMarkups(c.x+.5*e,c.y+.5*f);this.creationBegin(),a.beginActionGroup();var i=new b.CreateText(a,a.getId(),h,g,"",this.style);i.execute(),this.creationEnd(),this.selectedMarkup=a.getMarkup(i.targetId),this.textInputHelper.setActive(this.selectedMarkup,!0),this.editor.actionManager.addEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded)}},c.onMouseUp=function(a){},c.onMouseDoubleClick=function(a){a===this.selectedMarkup&&(this.editor.selectMarkup(null),this.textInputHelper.setActive(a,!1))},c.onHelperTextChange=function(a){var c=a.data,d=c.markup,e=c.style;if(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),""===c.newText){if(c.firstEdit)return this.editor.cancelActionGroup(),void this.editor.selectMarkup(null);var f=new b.DeleteText(this.editor,d);return f.execute(),void this.editor.selectMarkup(null)}c.firstEdit||this.editor.beginActionGroup();var g=this.editor.positionFromClientToMarkups(c.newPos.x,c.newPos.y),h=this.editor.sizeFromClientToMarkups(c.width,c.height),i=new b.SetSize(this.editor,d,g,h.x,h.y);i.execute();var j=new b.SetText(this.editor,d,d.position,d.size,c.newText);j.execute();var k=new b.SetStyle(this.editor,d,e);k.execute(),this.editor.closeActionGroup(),this.editor.selectMarkup(null)},c.onHistoryChange=function(a){this.textInputHelper.isActive()&&(this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive())},c.onSave=function(){if(b.EditMode.prototype.onSave.call(this),this.textInputHelper.isActive()){var a=this.textInputHelper.firstEdit;this.editor.actionManager.removeEventListener(b.EVENT_HISTORY_CHANGED,this.onHistoryChangeBinded),this.textInputHelper.setInactive(),a&&this.editor.cancelActionGroup(),this.editor.selectMarkup(null),this.selectedMarkup=null}},b.EditModeText=a}(),function(){"use strict";function a(a,b){this.parentDiv=a,this.editor=b,this.EVENT_TEXT_CHANGE="EVENT_CO2_TEXT_CHANGE",this.textArea=document.createElement("textarea"),this.textArea.setAttribute("maxlength","260"),this.textArea.setAttribute("data-i18n",f),this.onKeyHandlerBinded=this.onKeyHandler.bind(this),this.textArea.addEventListener("keydown",this.onKeyHandlerBinded),this.styleTextArea=new e.DomElementStyle,this.styleTextArea.setAttribute("position","absolute").setAttribute("overflow-y","hidden"),this.measureDiv=document.createElement("div"),e.addTraitEventDispatcher(this),this.onResizeBinded=this.onWindowResize.bind(this)}function b(a){if(0===a.length)return"";for(var b=a.length-1,c=b;c>=0;--c)if(" "!==a.charAt(c)){b=c;break}return a.substr(0,b+1)}function c(a){if(0===a.length)return"";for(var b=0,c=0;c<a.length;++c)if(" "!==a.charAt(c)){b=c;break}return a.substr(b)}var d=Autodesk.Viewing.Extensions.Markups.Core,e=Autodesk.Viewing.Extensions.Markups.Core.Utils,f="Write Something",g=a.prototype;g.destroy=function(){this.textArea.removeEventListener("keydown",this.onKeyHandlerBinded),this.setInactive()},g.setActive=function(a,b){if(this.textMarkup!==a){var c=Autodesk.Viewing.i18n.translate(f);this.textArea.setAttribute("placeholder",c),this.setInactive(),this.parentDiv.appendChild(this.textArea),this.textMarkup=a,this.firstEdit=b||!1,this.initFromMarkup(),window.addEventListener("resize",this.onResizeBinded);var d=this.textArea;window.requestAnimationFrame(function(){d.focus()})}},g.setInactive=function(){window.removeEventListener("resize",this.onResizeBinded),this.textMarkup&&(this.textMarkup=null,this.parentDiv.removeChild(this.textArea)),this.style=null},g.isActive=function(){return!!this.textMarkup},g.initFromMarkup=function(){var a=this.textMarkup,b=a.getClientPosition(),c=a.getClientSize(),d=b.x-.5*c.x,e=b.y-.5*c.y,f=a.lineHeight+"%";this.styleTextArea.setAttribute("line-height",f),this.setPosAndSize(d,e,c.x,c.y),this.setStyle(a.getStyle()),this.textArea.value=a.getText()},g.setPosAndSize=function(a,b,c,d){a+c>=this.editor.viewer.container.clientWidth&&(a=this.editor.viewer.container.clientWidth-(c+10)),b+d>=this.editor.viewer.container.clientHeight&&(b=this.editor.viewer.container.clientHeight-(d+10)),this.styleTextArea.setAttribute("left",a+"px").setAttribute("top",b+"px").setAttribute("width",c+"px").setAttribute("height",d+"px")},g.setStyle=function(a){if(this.style){var b={};this.injectSizeValues(b),this.setPosAndSize(b.newPos.x-.5*b.width,b.newPos.y-.5*b.height,b.width,b.height)}var c=this.editor.sizeFromMarkupsToClient(0,a["font-size"]).y,d=this.styleTextArea.setAttribute("color",a["stroke-color"]).setAttribute("font-family",a["font-family"]).setAttribute("font-size",c+"px").setAttribute("font-weight",a["font-weight"]).setAttribute("font-style",a["font-style"]).getStyleString();this.textArea.setAttribute("style",d),this.style=e.cloneStyle(a)},g.getTextValuesForMarkup=function(a){var b=this.isActive(),c=this.textMarkup,d=this.firstEdit;this.setActive(a,!1);var e=this.getTextValues();return b?this.setActive(c,d):this.setInactive(),e},g.getTextValues=function(){var a=this.textArea.value;return a===f&&(a=""),{text:a,lines:this.generateLines()}},g.acceptAndExit=function(){var a=this.getTextValues(),b={markup:this.textMarkup,style:this.style,firstEdit:this.firstEdit,newText:a.text,newLines:a.lines};this.injectSizeValues(b),this.fireEvent({type:this.EVENT_TEXT_CHANGE,data:b}),this.setInactive()},g.injectSizeValues=function(a){var b=parseFloat(this.textArea.style.width),c=parseFloat(this.textArea.style.height),d=parseFloat(this.textArea.style.left),e=parseFloat(this.textArea.style.top);a.width=b,a.height=c,a.newPos={x:d+.5*b,y:e+.5*c}},g.onWindowResize=function(a){window.requestAnimationFrame(function(){var a=this.textArea.value;this.style=null,this.initFromMarkup(),this.textArea.value=a}.bind(this))},g.onKeyHandler=function(a){var b=a.keyCode,c=a.shiftKey;c||13!==b||(a.preventDefault(),this.acceptAndExit())},g.generateLines=function(){var a=this.textArea.value,c=a.split(/\r*\n/),d=this.styleTextArea.clone().removeAttribute(["top","left","width","height","overflow-y"]).setAttribute("position","absolute").setAttribute("white-space","nowrap").setAttribute("float","left").setAttribute("visibility","hidden").getStyleString();this.measureDiv.setAttribute("style",d),this.parentDiv.appendChild(this.measureDiv);for(var e=parseFloat(this.textArea.style.width),f=[],g=0,h=c.length;g<h;++g){var i=b(c[g]);this.splitLine(i,e,f)}return this.parentDiv.removeChild(this.measureDiv),f},g.splitLine=function(a,b,d){if(""!==a)for(var e="",f=!1;!f;){this.measureDiv.innerHTML=a;var g=this.measureDiv.clientWidth;if(g<=b)d.push(a),this.splitLine(c(e),b,d),f=!0;else{var h=this.getShorterLine(a);1===h.length?(this.splitWord(a,e,b,d),f=!0):(a=h[0],e=h[1]+e)}}},g.getShorterLine=function(a){var b=a.lastIndexOf(" ");if(b===-1)return[a];for(;" "===a.charAt(b-1);)b--;var c=a.substr(b),d=a.substr(0,b);return[d,c]},g.splitWord=function(a,b,c,d){for(var e=1,f=!0;f;){var g=a.substr(0,e);this.measureDiv.innerHTML=g;var h=this.measureDiv.clientWidth;if(h>c){if(1===e)return d.push(g),void this.splitWord(a.substr(1),b,c,d);var i=a.substr(0,e-1);d.push(i);var j=a.substr(e-1);return void this.splitLine(j+b,c,d)}if(e++,e>a.length)return void d.push(a)}},d.EditorTextInput=a}();var AutodeskNamespace=AutodeskNamespace||function(a){"use strict";var b="undefined"!=typeof window&&null!==window?window:self,c=a.split(".");return c.forEach(function(a){b[a]=b[a]||{},b=b[a]}),b};!function(){"use strict";function a(a){return a&&0!==a.length?a.replace(/^#?\?/,"").split("&").map(function(a){return a.split("=").map(function(a){return decodeURIComponent(a)})}):null}function b(a){return"object"!=typeof a||null===a?a:(Object.getOwnPropertyNames&&Object.getOwnPropertyNames(a).forEach(function(c){var d=a[c];"object"!=typeof d||Object.isFrozen(d)||b(d)}),Object.freeze(a))}function c(a,b,c,d){function e(a,b){return function(){var b,d=null,e=null;if(4===f.readyState&&(b=f.status||a||-1,e=!f.response||"application/json"!==f.getResponseHeader("Content-Type")&&"json"!==f.responseType?f.response:JSON.parse(f.response),!g[b]))return g[b]=!0,200!==b&&(d=f.status||a||"unknown error"),d?void c(d,null):void c(null,e)}}if(c=c||function(){},!a||!b)return console.error("Invalid URL or Request Headers for the Query Service REST API"),void setTimeout(function(){c("Invalid URL or Request Headers for the Query Service REST API",null)},0);var f=new XMLHttpRequest;f.open("GET",a),Object.keys(b).forEach(function(a){"undefined"!=typeof b[a]&&null!==b[a]&&f.setRequestHeader(a,b[a])});var g=[];f.onreadystatechange=e(),f.onload=e(),f.onerror=e(null,"Error"),f.ontimeout=e(null,"TimeOut"),f.onabort=e(null,"Abort"),f.timeout=d||Q,f.send()}function d(){var a,b,c=+new Date;C&&D&&(b=c-U,U=c,document.hidden?(V+=b,a={documentVisibleDuration:b,totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},u(C,D,"documentNotVisible",a)):(W+=b,a={documentNotVisibleDuration:b,totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},u(C,D,"documentVisible",a)))}function e(){var a,b={},c=+new Date;C&&D&&(a=c-U,U=c,document.hidden?W+=a:V+=a,b={totalDocumentVisibleDuration:V,totalDocumentNotVisibleDuration:W},u(C,D,"documentUnloaded",b))}function f(a,b){C=a,D=b}function g(a){var b={};return b[X.TOKEN_HEADER_NAME]=a.token,b[X.AUTHORIZATION_HEADER_NAME]=a.oauth2Token?"Bearer "+a.oauth2Token:void 0,b[X.ANON_SESSION_HEADER_NAME]=a.token||a.oauth2Token?"false":"true",b[X.CLIENT_ID_HEADER_NAME]=a.clientId,b[X.CLIENT_FEATURE_ID_HEADER_NAME]=a.clientFeatureId,b[X.SESSION_ID_HEADER_NAME]=a.sessionId,b[X.EXTRA_USER_ID_HEADER_NAME]=a.userId,b[X.DEBUG_HEADER_NAME]=F,b[X.CONTENT_TYPE_HEADER_NAME]="application/json",b[X.ACCEPT_HEADER_NAME]="application/json",b}function h(a){var b=null;return a[X.AUTHORIZATION_HEADER_NAME]&&"apidev"!==O&&"apistg"!==O&&"apiprod"!==O&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' header for OAUTH2 not valid for "+O+" endpoint. Use one of apidev/apistg/apiprod endpoints."),!a[X.TOKEN_HEADER_NAME]||"apidev"!==O&&"apistg"!==O&&"apiprod"!==O||(b="'"+X.AUTHORIZATION_HEADER_NAME+"' header for OAUTH1 not valid for "+O+" endpoint."),a[X.TOKEN_HEADER_NAME]&&a[X.AUTHORIZATION_HEADER_NAME]&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' and '"+X.AUTHORIZATION_HEADER_NAME+"' headers can not coexist."),a[X.EXTRA_USER_ID_HEADER_NAME]&&!a[X.AUTHORIZATION_HEADER_NAME]&&(b="'"+X.AUTHORIZATION_HEADER_NAME+"' OAUTH2 header must be used w/ '"+X.EXTRA_USER_ID_HEADER_NAME+"' header."),a[X.CLIENT_ID_HEADER_NAME]||(b="'"+X.CLIENT_ID_HEADER_NAME+"' header is required for all requests."),a[X.CLIENT_FEATURE_ID_HEADER_NAME]||(b="'"+X.CLIENT_FEATURE_ID_HEADER_NAME+"'header is required for all requests."),"application/json"!==a[X.CONTENT_TYPE_HEADER_NAME]&&(b="'"+X.CONTENT_TYPE_HEADER_NAME+"' header must be application/json for all requests."),a[X.TOKEN_HEADER_NAME]||a[X.AUTHORIZATION_HEADER_NAME]||a[X.SESSION_ID_HEADER_NAME]&&a[X.ANON_SESSION_HEADER_NAME]||(b="'"+X.TOKEN_HEADER_NAME+"' or '"+X.AUTHORIZATION_HEADER_NAME+"' header needs to be a valid value or both '"+X.SESSION_ID_HEADER_NAME+"' and '"+X.ANON_SESSION_HEADER_NAME+"' header need to be specified."),b}function i(a){var b=null;return a||(b="queryParams: needs to be specified."),a.pid||0===a.pid||(b="queryParams.pid: needs to be a valid Profile Id."),a.pid<0&&(b="queryParams.pid: Profile Id needs to be an integer greater than zero."),a.query||(b="queryParams.query empty."),a.page||(b="queryParams.page empty."),(a.page<0||a.page>100)&&(b="queryParams.page should be a positive integer between 1 and 100"),void 0!==a.language&&""!==a.language&&"string"!=typeof a.language&&console.warn("queryParams.language should be a language identifier"),b}function j(a,b){var c=a;return b.pid&&(c+="?pid="+b.pid),b.query&&(c+="&query="+encodeURIComponent(b.query)),b.language&&(c+="&language="+encodeURIComponent(b.language)),b.modifier&&(c+="&modifier="+encodeURIComponent(b.modifier)),b.filters&&(c+="&filters="+encodeURIComponent(b.filters)),b.sort&&"relevance"!==b.sort&&(c+="&sort="+encodeURIComponent(b.sort)),b.page&&1!==b.page&&(c+="&page="+encodeURIComponent(""+b.page)),O!==M&&(c+="&env="+encodeURIComponent(O)),c=c.replace(/^\?&/,"?")}function k(a,b,c){return a.indexOf(Y.escapeCharacter)===-1?a:a.split(b).join(c)}function l(a){return a=a||"",a=k(a,Y.escapeCharacter,Z.escapeCharacterEscSeq),a=k(a,Y.listItemDelimiter,Z.listItemDelimiterEscSeq),a=k(a,Y.nameValueDelimiter,Z.nameValueDelimiterEscSeq),a=k(a,Y.arrayListItemDelimiter,Z.arrayListItemDelimiterEscSeq),a=k(a,Y.arrayListValueDelimiter,Z.arrayListValueDelimiterEscSeq)}function m(a){var b=a.map(function(a){for(var b=a[0],c=1;c<a.length;c++)b+=Y.arrayListValueDelimiter+a[c];return b});return b.join(Y.arrayListItemDelimiter)}function n(a){var b=a.map(function(a){if(Y.reservedArrayListFilterNames.indexOf(a[0])!==-1&&Array.isArray(a[1])){var b=m(a[1]);return l(a[0])+Y.nameValueDelimiter+b}return l(a[0])+Y.nameValueDelimiter+l(a[1])});return b.join(Y.listItemDelimiter)}function o(a,b,c){if(!a||!b||!c)return[];for(var d=[],e="",f="",g=!1,h=0;h<a.length;h++)e=a[h],e===c?(g=!g,f+=e):e!==b||g?(f+=e,g=!1):(d.push(f),f="",g=!1);return f.length&&d.push(f),d}function p(a){var b=o(a,Y.arrayListItemDelimiter,Y.escapeCharacter);return b.map(function(a){return o(a,Y.arrayListValueDelimiter,Y.escapeCharacter)})}function q(a){var b=[];return a.map(function(a){return Y.reservedArrayListFilterNames.indexOf(a[0])!==-1?(b=p(a[1]),[a[0],b]):a})}function r(a){return a.map(function(a){return o(a,Y.nameValueDelimiter,Y.escapeCharacter)})}function s(a){return o(a,Y.listItemDelimiter,Y.escapeCharacter)}function t(a){if(!a||!a.length)return[];var b=s(a),c=r(b);return q(c)}function u(a,b,d,e,f){var g=!1;if(f&&"function"!=typeof f)throw new Error("Callback was not a function");f=f||function(){};var h=P+S.Log+"?queryId="+a+"&type="+encodeURIComponent(d)+"&sessionId="+(b.sessionId||"")+"&userId="+(b.userId||"")+"&clientId="+(b.clientId||"")+"&clientFeatureId="+(b.clientFeatureId||"")+"&body="+encodeURIComponent(JSON.stringify(e))+"&_n="+Math.floor(1e5*Math.random()),i=function(a,b){a&&console.debug("Logged(err:"+(a||"noerr")+" info:"+(b||"-")+"): "+h),f(a)},j={};j[X.CONTENT_TYPE_HEADER_NAME]="text/plain",g||c(h,j,i)}function v(a,b){var c,d;H||(window&&window.performance?(d=w(),d.searchSDKTimings={fetchStartToSearchSDKLoaded:T-d.timing.fetchStart,fetchStartToSearchSDKInstantiated:G-d.timing.fetchStart,fetchStartToNow:+new Date-d.timing.fetchStart},d.timingDelta={},d.timing&&(d.timingDelta.navigationStartToDomInteractive=d.timing.domInteractive-d.timing.navigationStart,d.timingDelta.dns=d.timing.domainLookupEnd-d.timing.domainLookupStart,d.timingDelta.htmlDownloadTime=d.timing.responseEnd-d.timing.responseStart,d.timingDelta.tcpConnectionSetup=d.timing.connectEnd-d.timing.connectStart,d.timing.secureConnectionStart&&(d.timingDelta.secureConnectionSetup=d.timing.connectEnd-d.timing.secureConnectionStart),Object.keys(d.timing).forEach(function(a){0!==d.timing[a]&&(d.timingDelta["fetchStartTo"+a[0].toUpperCase()+a.slice(1)]=d.timing[a]-d.timing.fetchStart)})),delete d.timing,c={url:document&&document.location&&document.location.href,userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,language:navigator.language,performance:d}):c={noPerformance:!0},u(a,b,"performance",c)),H=!0}function w(){if(!window||!window.performance)return{};var a=function(a){return window.performance[a]?Object.keys(Object.getPrototypeOf(window.performance[a])).reduce(function(b,c){return window.performance[a][c]>=0&&(b[c]=window.performance[a][c]),b},{}):null};return Object.keys(Object.getPrototypeOf(window.performance)).reduce(function(b,c){return 0!==c.indexOf("onwebkit")&&window.performance[c]&&"object"==typeof window.performance[c]&&(b[c]=a(c)),
b},{})}function x(a,b,c){var d,e;c&&(e="SERP",d=[].concat(c.queryResults||[],c.federatedResults||[]),d.forEach(function(c,d){A(c,d+1,a,b,e,"")}))}function y(a,b,c){var d;c&&(d="suggestions",(c.suggestionGroups||[]).forEach(function(c){var e=c.name;c.suggestions.forEach(function(c,f){A(c,f+1,a,b,d,e)})}),(c.textSuggestions||[]).forEach(function(c,e){z(c,e,a,b,d,"")}))}function z(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.suggestion&&(g.title=a.suggestion),u(c,d,"click",g)}}function A(a,b,c,d,e,f){a.logClick=function(){var g={position:b,url:"",querySource:e,subQuerySource:f};a.searchResultId&&(g.id=a.searchResultId.id,g.sourceSystem=a.searchResultId.sourceSystem),a.url&&(g.url=a.url),u(c,d,"click",g)}}function B(d){O=d&&N.hasOwnProperty(d)?d:M,P=N[O];var e=this;this.getApiVersion=function(){return I.version},this.getServerMinRestApiVersion=function(){return I.minRestApiVersion},this.getBuildDate=function(){return I.buildDate},this.getBuildNumber=function(){return I.buildNumber},this.getServiceEnvironments=function(){return Object.keys(N)},this.getFilterConfig=function(){return Y},this.filterStringToFilterArray=function(a){return t(a)},this.filterArrayToFilterString=function(a){return n(a)},this.getLanguageFromBcp47Code=function(a){return $[a]||"ENU"},this.sanitizeAndHighlightString=function(a,b,c){var d,e,f=!1;return a?(b=b||"<em class='highlight'>",c=c||"</em>",e=document.createElement("div"),e.textContent=a,d=e.innerHTML,d=d.replace(/[\uE000\uE001]/g,function(d,e,g){return""!==d||f?""===d&&f?(f=!1,c):void console.warn("Warning: Incorrect number of highlight tokens in string: "+a):(f=!0,b)}),f&&(d+=c,console.warn("Warning: Incorrect number of highlight tokens in string: "+a)),d):""},this.removeHighlightTokens=function(a){return a?a=a.replace(/[\uE000\uE001]/g,""):""},this.query=function(a,d,e){var k,l=i(a);if(l)return console.error("Invalid Query Parameters for the Query Service REST API - "+l),void setTimeout(function(){e("Invalid Query Parameters for the Query Service REST API - "+l,null)},0);k=j(P+S.Query,a);var m=g(d),n=h(m);return n?(console.error("Invalid Request Headers for the Query Service REST API - "+n),void setTimeout(function(){e("Invalid Request Headers for the Query Service REST API - "+n,null)},0)):void c(k,m,function(a,c){!a&&c&&(x(c.queryId,d,c),b(c),v(c.queryId,d),f(c.queryId,d)),e(a,c)})},this.findCategories=function(a,b,d){var e,f=i(a);if(f)return console.error("Invalid Query Parameters for the Query Service REST API - "+f),void setTimeout(function(){d("Invalid Query Parameters for the Query Service REST API - "+f,null)},0);e=j(P+S.Categories,a);var k=g(b),l=h(k);return l?(console.error("Invalid Request Headers for the Query Service REST API - "+l),void setTimeout(function(){d("Invalid Query Parameters for the Query Service REST API - "+l,null)},0)):void c(e,k,d)},this.suggestionTimeoutId=null,this.lastSentSuggestionNum=-1,this.lastDisplayedSuggestionNum=-1,this.suggest=function(a,b,d){var k=function(a,b,d){var k,l,m=i(a);if(m)return console.error("Invalid Request Parameters for the Query Service REST API - "+m),void setTimeout(function(){d("Invalid Request Parameters for the Query Service REST API - "+m,null)},0);l=e.lastSentSuggestionNum+1,e.lastSentSuggestionNum=l,k=j(P+S.Suggestions,a);var n=g(b),o=h(n);if(o)return console.error("Invalid Request Headers for the Query Service REST API - "+o),void setTimeout(function(){d("Invalid Request Headers for the Query Service REST API - "+o,null)},0);var p=function(a,c){if(l>e.lastDisplayedSuggestionNum)return e.lastDisplayedSuggestionNum=l,a||(y(c.queryId,b,c),v(c.queryId,b),f(c.queryId,b)),void d(a,c)};c(k,n,p)};clearTimeout(e.suggestionTimeoutId),e.suggestionTimeoutId=setTimeout(function(){k(a,b,d)},R)},this.logEvent=u,this.queryServiceInfo=function(a,b){var d=P+S.Health,e=g(a),f=h(e);if(f)return console.error("Invalid Request Headers for the Query Service REST API - "+f),void setTimeout(function(){b("Invalid Request Headers for the Query Service REST API - "+f,null)},0);var i=function(a,c){var d,e,f=0,g=!1;if(d=I.minRestApiVersion.split(".").map(function(a){return parseFloat(a)}),!a&&c.versionInfo&&c.versionInfo.version){for(e=c.versionInfo.version.split(".").map(function(a){return parseFloat(a)});f<e.length||f<d.length;)g=g||(d[f]||0)>(e[f]||0),f+=1;g&&console.error("Error: Remote API version ("+c.versionInfo.version+") is older than required ("+I.minRestApiVersion+")")}b(a,c)};c(d,e,i)},this.queryParamsToUrl=function(a,b,c,d){var e;if(!b||!c||!c.pushState)return console.error("queryParamsToUrl() requres a History object in the urlLocation parameter such as window.history."),!1;e=new URL(b),e.search=new URL(j(P+S.Query,a)).search;try{c.pushState(null,"",e)}catch(a){document.location.hash=e.search}return!0},this.urlParametersToQueryParams=function(b){var c={pid:void 0,query:null,modifier:null,filters:"",sort:"",page:1,language:"",oauth2Token:null,env:null},d={pid:1},e={access_token:"oauth2Token",expires_in:"oauth2TokenExpiresIn"},f=new URL(b),g=(f.search||"").slice(1)+"&"+(f.hash||"").slice(1),h=a(g);return h.forEach(function(a){void 0===typeof c[a[0]]||d[a[0]]||(c[e[a[0]]||a[0]]=a[1])}),c}}var C,D,E=new AutodeskNamespace("Autodesk.Search"),F=F||!1,G=+new Date,H=!1,I=Object.freeze({version:"1.0.0",buildDate:"[local-dev]",buildNumber:"[local-dev]",minRestApiVersion:"1.35.0"}),J="qs",K="search",L="v2",M="prod",N=Object.freeze({localdev:"http://search-localdev.api.autodesk.com:8080/"+J+"/"+L,dev:"https://search-dev.api.autodesk.com/"+J+"/"+L,"dev-dr":"https://search-dev-dr.api.autodesk.com/"+J+"/"+L,stg:"https://search-staging.api.autodesk.com/"+J+"/"+L,"stg-dr":"https://search-staging-dr.api.autodesk.com/"+J+"/"+L,prod:"https://search.api.autodesk.com/"+J+"/"+L,"prod-dr":"https://search-dr.api.autodesk.com/"+J+"/"+L,apidev:"https://developer-dev.api.autodesk.com/"+K+"/"+L,apistg:"https://developer-stg.api.autodesk.com/"+K+"/"+L,apiprod:"https://developer.api.autodesk.com/"+K+"/"+L}),O=M,P=N[O],Q=null,R=250,S=Object.freeze({Query:"/search",Categories:"/categories",Suggestions:"/suggestions",Log:"/log",Health:"/health"}),T=+new Date,U=+new Date,V=0,W=0;document.addEventListener&&document.addEventListener("visibilitychange",d,!1),window.addEventListener&&window.addEventListener("beforeunload",e,!1);var X={TOKEN_HEADER_NAME:"x-ads-token",ANON_SESSION_HEADER_NAME:"x-ads-anon-session",CLIENT_ID_HEADER_NAME:"x-ads-client-id",CLIENT_FEATURE_ID_HEADER_NAME:"x-ads-client-feature-id",SESSION_ID_HEADER_NAME:"x-ads-session-id",DEBUG_HEADER_NAME:"x-ads-debug",EXTRA_USER_ID_HEADER_NAME:"x-ads-ex-user-id",CONTENT_TYPE_HEADER_NAME:"Content-Type",ACCEPT_HEADER_NAME:"Accept",AUTHORIZATION_HEADER_NAME:"Authorization"},Y=b({listItemDelimiter:"!",nameValueDelimiter:"~",arrayListItemDelimiter:"'",arrayListValueDelimiter:"*",escapeCharacter:"\\",reservedArrayListFilterNames:["resourceIds"]}),Z=b({nameValueDelimiterEscSeq:Y.escapeCharacter+Y.nameValueDelimiter,listItemDelimiterEscSeq:Y.escapeCharacter+Y.listItemDelimiter,arrayListItemDelimiterEscSeq:Y.escapeCharacter+Y.arrayListItemDelimiter,arrayListValueDelimiterEscSeq:Y.escapeCharacter+Y.arrayListValueDelimiter,escapeCharacterEscSeq:Y.escapeCharacter+Y.escapeCharacter}),$=b({"pt-BR":"PTB",cs:"CSY",en:"ENU","en-us":"ENU",fr:"FRA",de:"DEU",hu:"HUN",it:"ITA",ja:"JPN",ko:"KOR",pl:"PLK",ru:"RUS","zh-CN":"CHS",es:"ESP","es-ES":"ESP","zh-TW":"CHT"});B.prototype.constructor=B,E.SearchQueryAPI=B}(),function(){"use strict";function a(a,b,c){var d=a.viewer.model.myData.is2d;a.inViewerSearchThisView&&a.inViewerSearchThisView.initialize(a.qsApiService,a.viewerProperties,b,d,a.thisViewDom||s,c),a.inViewerSearchThisItem&&!a.inViewerSearchThisItem.initialized&&a.inViewerSearchThisItem.initialize(a.qsApiService,a.viewerProperties,b,a.thisItemDom||t,c,function(b){a.changeToThisViewTabAndSelectNode(b)}),a.inViewerSearchThisProject&&a.inViewerSearchThisProject.initialize(a.qsApiService,a.thisProjectDom||u)}function b(a){var b=a.cacheObj().searchInfoThisItem;b&&(i(a,b.str,b.node),a.inViewerSearchPanel&&(a.inViewerSearchPanel.setVisible(!0),g(a)),a.cacheObj.searchInfoThisItem=null)}function c(a){var b=null;return a.children.forEach(function(a){a.hasOwnProperty("sharedPropertyDbPath")&&(b=a.sharedPropertyDbPath)}),b}function d(a){return a.parent?d(a.parent):a}function e(a){var b=null;try{b=JSON.parse(a)}catch(a){console.error("JSON parse error: "+a)}return b}function f(a,b,c){var e=b.model.getDocumentNode(),f=e?b.model.getDocumentNode().parent:null;if(f){var g=d(f);return void setTimeout(function(){c(g)},0)}return a.noBubbleData=!0,a.inViewerSearchThisItem&&(delete a.inViewerSearchThisItem,a.inViewerSearchThisItem=null),q.logger.warn("InViewerSearch Extension: no ViewingApplication is being used so relatedItemsTab will not be visible"),void setTimeout(function(){c(null)},0)}function g(a){var b;a.options.uiEnabled&&a.searchToolButton&&a.inViewerSearchPanel&&(b=a.inViewerSearchPanel.isVisible(),a.searchToolButton.setState(b?p.Button.State.ACTIVE:p.Button.State.INACTIVE),a.searchToolButton.setToolTip(o.i18n.translate("Search")))}function h(d,e){var h=d.viewer,i={},j=q.env,k=q.docItemId,l=o.getViewingUrl(),m=d.cacheObj().searchInfoThisItem;d.showingTabs=!1;var n=function(a,c){var f;i[a]=c,f=Object.keys(i).every(function(a){return!!i[a]}),f?(d.initialized=!0,e(!0),b(d)):i[s]&&(m||g(d))},p=function(b){var e,f={},g="";if(b){var h=function(a){var b=a.children||[],c=this;b.forEach(function(a){if(!f[a.data.guid])switch(a.data.type){case"geometry":f[a.data.guid]=a;break;case"folder":h.call(c,a)}})};h(b),g=c(b)}if(d.flatGUIDS=f,q.logger.debug("InViewerSearchExtension - has sharedPropertyDBPath: "+g),d.qsApiService){var m={count:{}};e=0,Object.keys(f).forEach(function(a){f[a].data&&(e+=f[a].data.size?f[a].data.size:0,f[a].data.role&&(m.count[f[a].data.role]=m.count[f[a].data.role]+1||1))}),m.size=e;var o=av.getGlobal(),p=o.LMV_VIEWER_VERSION+"."+o.LMV_VIEWER_PATCH;d.qsApiService.initialize(p,j,d.options.clientId,d.options.sessionId),d.qsApiService.logInitEvent(d.viewer.model.myData.urn,m,"")}d.viewerProperties&&!d.viewerProperties.initialized&&d.viewerProperties.initialize(d.viewer,d.noBubbleData,l,d.flatGUIDS,k,d.qsApiService,g),i[s]=!1,d.inViewerSearchThisItem&&(i[t]=d.inViewerSearchThisItem.initialized),d.options.uiEnabled&&!d.initialized&&d.createTabs(),a(d,k,n)};f(d,h,p)}function i(a,b,c){var d=a.searchBarElem;b&&(d.value=b,a.uiSearch(c),a.updateRecentSearches(b))}function j(a,b){var c=document.createElement("li");return c.className="recent-item",c.appendChild(document.createTextNode(b)),c.addEventListener("click",function(){i(a,this.innerText)},!1),c}function k(a,b){var c,d,e,f;c=document.createElement("label"),c.className="recent-label",c.appendChild(document.createTextNode(o.i18n.translate("Recent Searches"))),d=document.createElement("ul"),d.className="recent-searches-list dockingPanelScroll",e=a.getRecentSearches(),e.forEach(function(b){d.appendChild(j(a,b))}),e.length<1&&(f=document.createElement("li"),f.className="recent-item empty-list",f.appendChild(document.createTextNode(o.i18n.translate("Recent Searches Empty"))),d.appendChild(f)),b.appendChild(c),b.appendChild(d)}function l(a,b,c,d){var e,f,g=[].slice.call(b.parentElement.children);g.forEach(function(a){a.classList.remove("selected")}),b.classList.add("selected"),a.qsApiService.logTabClickEvent(d),e=b.parentElement.parentElement.children[1],f=[].slice.call(e.children),f.forEach(function(a){a.id===c?a.classList.remove("hidden"):a.classList.add("hidden")})}function m(a,b,c,d,e){var f,g;return f=document.createElement("div"),f.className="tab-item "+c,f.addEventListener("click",function(){l(a,this,b,e)},!1),g=document.createElement("label"),g.appendChild(document.createTextNode(d)),f.appendChild(g),f}function n(a,b){var c,d,e,f,g,h;h=1,c=document.createElement("div"),d=document.createElement("div"),d.className="tab-content",c.appendChild(m(b,s,"this-view selected",b.options.loadedModelTab.displayName,"thisView")),e=document.createElement("div"),e.id=s,b.thisViewDom=e,d.appendChild(e),b.options.relatedItemsTab.enabled&&b.inViewerSearchThisItem&&(h++,c.appendChild(m(b,t,"this-item",b.options.relatedItemsTab.displayName,"thisItem")),f=document.createElement("div"),f.className="hidden",f.id=t,b.thisItemDom=f,d.appendChild(f)),b.options.serverSearchTab.enabled&&(h++,c.appendChild(m(b,u,"this-project",b.options.serverSearchTab.displayName,"thisProject")),g=document.createElement("div"),g.className="hidden",g.id=u,b.thisProjectDom=g,d.appendChild(g)),c.className="tab-items tabs-count-"+h,a.appendChild(c),a.appendChild(d),b.tabContent=d}var o=Autodesk.Viewing,p=Autodesk.Viewing.UI,q=Autodesk.Viewing.Private,r=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),s="in-viewer-search-this-view",t="in-viewer-search-this-item",u="in-viewer-search-this-project",v="recentSearches",w=3,x=200,y=null,z=null,A=Object.freeze({BACKSPACE:8,SPACE:32,ENTER:13});r.InViewerSearchMain=function(a,b,c){this.initialized=!1,this.cacheObj=c,this.viewer=a,this.toolbarTools=null,this.options=b,this.qsApiService=new r.QsApiService,this.viewerProperties=new r.ViewerPropertiesService(a),this.noBubbleData=!1,this.inViewerSearchPanel=null,this.inViewerSearchThisView=null,this.inViewerSearchThisItem=null,this.inViewerSearchThisProject=null,this.geometryLoadedCallback=null,this.tabsElem=null,this.searchBarElem=null,this.recentSearchesElem=null,this.saveLastQuery=null,this.recentSearches=null,this.flatGUIDS={},this.container=null,this.searchToolButton=null,this.tabContent=null,this.showingTabs=!1,this.initCb=null,this.closeCallback=null,this.workersScriptsInitialized=!1,this.initWorkersScripts=null,this.thisProjectDom=null,this.thisItemDom=null,this.thisViewDom=null},r.InViewerSearchMain.prototype.constructor=r.InViewerSearchMain,r.InViewerSearchMain.prototype.load=function(){var a=this,b=this.viewer,c=!!(this.options&&this.options.loadedModelTab&&this.options.relatedItemsTab&&this.options.serverSearchTab),d=c&&(this.options.loadedModelTab.enabled||this.options.relatedItemsTab.enabled||this.options.serverSearchTab.enabled);if(!d)return q.logger.log("InViewerSearch Extension - all search types disabled, nothing to do."),!1;r.WorkerUtils.initInViewerSearchWorkersScripts(function(){a.workersScriptsInitialized=!0,a.initWorkersScripts&&a.initWorkersScripts(),q.logger.info("InViewerSearch Extension: workers fetched.")},function(){q.logger.warn("InViewerSearch Extension: error fetching workers.")}),this.options.loadedModelTab.enabled&&!this.inViewerSearchThisView&&(this.inViewerSearchThisView=new r.InViewerSearchThisView(b,this.options)),this.options.relatedItemsTab.enabled&&!this.inViewerSearchThisItem&&(this.inViewerSearchThisItem=new r.InViewerSearchThisItem(b,this.options,this.cacheObj)),this.options.serverSearchTab.enabled&&!this.inViewerSearchThisProject&&(this.inViewerSearchThisProject=new r.InViewerSearchThisProject(this.options)),this.options.uiEnabled&&!this.inViewerSearchPanel&&(this.inViewerSearchPanel=new r.InViewerSearchPanel(b,"in-viewer-search","Search",this.options,this.qsApiService),this.container=this.inViewerSearchPanel.container,this.closeCallback=function(){a.closeSearch.call(a)},this.inViewerSearchPanel.addEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.options.uiEnabled&&!a.searchToolButton&&this.addToolbarUI(),this.onInitialized=function(b){b&&(a.initialized=!0,g(a),a.initCb&&a.initCb())},this.geometryLoadedCallback=function(){a.workersScriptsInitialized?h(a,a.onInitialized):a.initWorkersScripts=function(){h(a,a.onInitialized)}};var e=function(c){b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,e),b.getObjectTree(function(){a.geometryLoadedCallback()},function(){q.logger.warn("InViewerSearch Extension - failed getObjectTree"),a.geometryLoadedCallback()})};return b.getObjectTree(function(){a.geometryLoadedCallback()},function(){if(b.model&&b.model.getData){var c=b.model.getData();c&&c.hasOwnProperty("hasObjectProperties")&&a.geometryLoadedCallback()}else b.addEventListener(o.GEOMETRY_LOADED_EVENT,e)}),!0},r.InViewerSearchMain.prototype.addToolbarUI=function(){var a,b=this,c=this.viewer;if(c.getToolbar){var d=Autodesk.Viewing.UI,e=c.getToolbar(!0);this.toolbarTools=e.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),a=new d.Button("toolbar-in-viewer-search"),a.setToolTip(o.i18n.translate("Loading Search")),a.setIcon("adsk-button-icon-search"),a.setState(d.Button.State.DISABLED),a.addEventListener("click",function(){if(b.inViewerSearchPanel){var a=b.inViewerSearchPanel.isVisible();b.qsApiService.logGeneralEvent(a?"searchWindowClose":"searchWindowOpen"),b.inViewerSearchPanel.setVisible(!a),b.searchBarElem.focus()}},!1),a.addClass("in-viewer-search-button"),b.inViewerSearchPanel&&b.inViewerSearchPanel.addVisibilityListener(function(b){a.setState(b?d.Button.State.ACTIVE:d.Button.State.INACTIVE)}),b.searchToolButton=a,b.toolbarTools.addControl(a)}},r.InViewerSearchMain.prototype.unload=function(){if(this.initialized=!1,this.options.uiEnabled){this.closeSearch(),this.toolbarTools&&this.toolbarTools.removeControl(this.searchToolButton);var a=this.cacheObj().searchInfoThisItem;a&&this.viewer.getPropertyPanel(!0).setVisible(!1)}return this.options.uiEnabled&&!this.options.saveExtensionStateEnabled&&(this.searchBarElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.searchBarElem),this.recentSearchesElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.recentSearchesElem),this.tabsElem&&this.inViewerSearchPanel.scrollContainer.removeChild(this.tabsElem),this.inViewerSearchPanel.removeEventListener(this.inViewerSearchPanel.closer,"click",this.closeCallback)),this.geometryLoadedCallback&&this.viewer.removeEventListener(o.GEOMETRY_LOADED_EVENT,this.geometryLoadedCallback),this.inViewerSearchThisView&&this.inViewerSearchThisView.initialized&&this.inViewerSearchThisView.uninitialize(),this.options.saveExtensionStateEnabled||(this.inViewerSearchThisItem&&this.inViewerSearchThisItem.initialized&&this.inViewerSearchThisItem.uninitialize(),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.initialized&&this.inViewerSearchThisProject.uninitialize(),this.inViewerSearchPanel&&this.inViewerSearchPanel.uninitialize(),this.viewerProperties.uninitialize()),delete this.searchToolButton,delete this.inViewerSearchThisView,this.options&&!this.options.saveExtensionStateEnabled&&(delete this.inViewerSearchThisItem,delete this.inViewerSearchThisProject,delete this.inViewerSearchPanel,delete this.qsApiService,delete this.viewerProperties),!0},r.InViewerSearchMain.prototype.getRecentSearches=function(){return this.recentSearches||(this.recentSearches=e(window.localStorage[v]||"[]")),this.recentSearches},r.InViewerSearchMain.prototype.updateRecentSearches=function(a){var b,c,d,e;null!==a&&0!==a.length&&(b=this,this.recentSearches||this.getRecentSearches(),c=this.recentSearches.indexOf(a),0!==c&&(e=this.recentSearchesElem.children[1],c>0&&(this.recentSearches.splice(c,1),e.removeChild(e.childNodes[c]),c=-1),c<0&&(this.recentSearches=[a].concat(this.recentSearches.slice(0,20)),window.localStorage[v]=JSON.stringify(this.recentSearches),b.options.uiEnabled&&(d=e.children[0],d.className.indexOf("empty-list")>=0&&d.parentNode.removeChild(d),e.insertBefore(j(b,a),e.childNodes[0])))))},r.InViewerSearchMain.prototype.closeSearch=function(){var a=this;a.inViewerSearchPanel.setVisible(!1),a.hideTabs(),a.inViewerSearchThisView&&a.inViewerSearchThisView.clearSearchResults(),a.inViewerSearchThisItem&&a.inViewerSearchThisItem.clearSearch(),a.inViewerSearchThisProject&&a.inViewerSearchThisProject.clearSearch(),this.searchBarElem&&(this.searchBarElem.value="")},r.InViewerSearchMain.prototype.createTabs=function(){if(this.inViewerSearchPanel&&this.inViewerSearchPanel.scrollContainer){var a,b,c,d=this,e=this.inViewerSearchPanel?this.inViewerSearchPanel.scrollContainer:null,f="onsearch"in document.documentElement;if(!this.searchBarElem){b=document.createElement("input"),b.className="in-viewer-search-bar",b.id="in-viewer-search-bar",b.type="search",this.options.searchPlaceholder&&(b.placeholder=this.options.searchPlaceholder),b.addEventListener("keyup",function(a){var c=a.target.value.trim(),e=a.which||a.keyCode;f||e!==A.ENTER?c&&c.length>=w?(e===A.BACKSPACE||e===A.SPACE||e>40&&e<128||e>185&&e<193||e>218&&e<223)&&(clearTimeout(z),z=setTimeout(function(){d.saveLastQuery=!1,d.uiSearch()},x)):(d.hideTabs(),d.inViewerSearchThisView.clearSearchResults()):b.onsearch(a)});var g=function(a){var b=a.target.value.trim();clearTimeout(z),b?z=setTimeout(function(){d.saveLastQuery=!0,d.uiSearch()},x):(d.hideTabs(),d.inViewerSearchThisView.clearSearchResults())};b.onsearch=g,this.searchBarElem=b,a=document.createElement("div"),a.className="recent-searches",k(d,a),this.recentSearchesElem=a,c=document.createElement("div"),c.className="tabs-wrapper hidden",n(c,d),this.tabsElem=c,e&&(e.appendChild(b),this.searchBarElem.focus(),e.appendChild(a),e.appendChild(c))}}},r.InViewerSearchMain.prototype.search=function(a,b,c,d){var e=a.trim();e&&(this.qsApiService.generateQueryId(),this.inViewerSearchThisView&&this.inViewerSearchThisView.search(e,b,y),this.inViewerSearchThisItem&&this.inViewerSearchThisItem.search(e,c),this.inViewerSearchThisProject&&this.inViewerSearchThisProject.search(e,d),this.saveLastQuery&&this.updateRecentSearches(e))},r.InViewerSearchMain.prototype.uiSearch=function(a){var b=this.searchBarElem,c=b.value.toLocaleLowerCase();y=a,c?(this.showTabs(),this.search(c)):this.hideTabs()},r.InViewerSearchMain.prototype.showTabs=function(){var a,b;!this.showingTabs&&this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(a=this.tabsElem,a.classList.remove("hidden"),l(this,a.firstChild.firstChild,s,"thisView"),b=this.recentSearchesElem,b.classList.add("hidden"),this.showingTabs=!0)},r.InViewerSearchMain.prototype.changeToThisViewTabAndSelectNode=function(a){var b;this.options.loadedModelTab&&this.options.loadedModelTab.enabled&&(b=this.tabsElem,l(this,b.firstChild.firstChild,s,"thisView"),this.inViewerSearchThisView.selectNode(null,a,!0))},r.InViewerSearchMain.prototype.hideTabs=function(){this.showingTabs&&(this.recentSearchesElem.classList.remove("hidden"),this.tabsElem.classList.add("hidden"),this.showingTabs=!1,this.searchBarElem.focus())}}(),function(){"use strict";var a=Autodesk.Viewing,b=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),c={searchPlaceholder:"",uiEnabled:!0,clientId:"adsk.viewer.defaultClientId",sessionId:"adsk.viewer.defaultSessionId",serverSearchTab:{enabled:!1,displayName:"This Project",parameters:{pid:"",filters:"",language:"ENU",baseURL:"",urlCallback:""},pageSize:20},relatedItemsTab:{enabled:!0,displayName:"This Item",pageSize:20},loadedModelTab:{enabled:!0,displayName:"This View",pageSize:50}};b.InViewerSearchExtension=function(d,e){var f;a.Extension.call(this,d,e),this.initialized=!1,this.viewer=d,this.toolbarTools=null,e||(e={}),e.inViewerSearchConfig=e.inViewerSearchConfig||c,this.options=e.inViewerSearchConfig,f=Autodesk.Viewing.Private.GuiViewer3D&&d instanceof Autodesk.Viewing.Private.GuiViewer3D,this.options.uiEnabled=f&&(void 0===this.options.uiEnabled?c.uiEnabled:this.options.uiEnabled),this.options.serverSearchTab=this.options.serverSearchTab||c.serverSearchTab,this.options.relatedItemsTab=this.options.relatedItemsTab||c.relatedItemsTab,this.options.loadedModelTab=this.options.loadedModelTab||c.loadedModelTab,this.options.serverSearchTab.displayName=this.options.serverSearchTab.displayName||c.serverSearchTab.displayName,this.options.relatedItemsTab.displayName=this.options.relatedItemsTab.displayName||c.relatedItemsTab.displayName,this.options.loadedModelTab.displayName=this.options.loadedModelTab.displayName||c.loadedModelTab.displayName,this.options.initialized||(this.inViewerSearchMain=new b.InViewerSearchMain(this.viewer,this.options,this.getCache))},b.InViewerSearchExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),b.InViewerSearchExtension.prototype.constructor=b.InViewerSearchExtension,b.InViewerSearchExtension.prototype.getInViewerSearch=function(){return this.inViewerSearchMain},b.InViewerSearchExtension.prototype.load=function(){return this.options.initialized&&this.options.inViewerSearchMain&&(this.inViewerSearchMain=this.options.inViewerSearchMain),this.inViewerSearchMain.load(),this.options.saveExtensionStateEnabled&&(this.options.inViewerSearchMain=this.inViewerSearchMain,this.options.initialized=!0),!0},b.InViewerSearchExtension.prototype.unload=function(){return this.inViewerSearchMain.unload(),this.options.saveExtensionStateEnabled||(delete this.inViewerSearchMain,this.inViewerSearchMain=null,this.options.initialized=!1,this.options.inViewerSearchMain=null),!0},b.InViewerSearchExtension.prototype.addInitListener=function(a){this.inViewerSearchMain&&this.inViewerSearchMain.initialized?setTimeout(function(){a()},0):this.inViewerSearchMain.initCb=a},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.InViewerSearch",b.InViewerSearchExtension)}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");b.InViewerSearchPanel=function(b,c,d,e,f){var g=this;this.viewer=b,this.qsApiService=f,a.DockingPanel.call(this,b.container,c,d,e),this.container.classList.add("inViewerSearchPanel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.options=e,this.selectedNodes=[],this.uiCreated=!1,this.addVisibilityListener(function(a){a&&(g.uiCreated||g.createUI(),g.resizeToContent())})},b.InViewerSearchPanel.prototype=Object.create(a.DockingPanel.prototype),b.InViewerSearchPanel.prototype.constructor=b.InViewerSearchPanel,b.InViewerSearchPanel.prototype.createUI=function(){},b.InViewerSearchPanel.prototype.addClass=function(a,b){var c=null!==this.tree&&this.tree.addClass(a,b);return c},b.InViewerSearchPanel.prototype.removeClass=function(a,b){var c=null!==this.tree&&this.tree.removeClass(a,b);return c},b.InViewerSearchPanel.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(){b.qsApiService.logGeneralEvent("searchWindowClose")},!1)},Autodesk.Viewing.UI.InViewerSearchPanel=b.InViewerSearchPanel}(),function(){"use strict";function a(a,b,c,d,e){var f,g=document.createElement("li"),h=a.controller;if(c.displayName)f=c.displayName;else{var i=c.nodeName;if(i||(i=h.viewerProperties.defaultNodeName()),i.indexOf(h.searchedString)>=0||c.hasOwnProperty("fieldName")&&"Name"===c.fieldName)f=h.viewerProperties.highlightText(i,h.searchedString);else{var j="[object Number]"===Object.prototype.toString.call(c.fieldValue)?String(c.fieldValue):c.fieldValue;f=h.viewerProperties.highlightText(i)+" ("+h.viewerProperties.highlightText(c.fieldName)+": "+h.viewerProperties.highlightText(j,h.searchedString)+")"}}g.className="item-result",g.innerHTML=f,g.setAttribute("adskSearchGeoGuid",e),g.setAttribute("adskSearchDbId",c.dbId),g.setAttribute("adskSearchIndex",d),b.appendChild(g)}function b(a,b,c){var d,e;b&&b.children.length&&(e=b.lastChild.className.contains("more-items"),e||(d=document.createElement("li"),d.className="item-result more-items",d.textContent=j.i18n.translate("Load More"),d.addEventListener("click",function(b){a.qsApi.logLoadMoreClickEvent(c,"thisItem"),a.loadMoreItems(c,b)},!1),b.appendChild(d)))}function c(b,c,d,e){var f,g,h,i,j=b.controller;f=document.createElement("div"),f.className="geometry-results geometry_"+d.id,f.className=f.className+(j.geometriesCount>3?" collapsed":""),g=document.createElement("label"),g.className="geometry-name",g.setAttribute("adskGeomId",d.id),g.setAttribute("adskGeomIndex",e),g.addEventListener("click",function(a){var c=a.currentTarget.getAttribute("adskGeomId"),d=parseInt(a.currentTarget.getAttribute("adskGeomIndex"),10);b.qsApi.logResultGeomClickEvent(d+1,c,b.currentGeometry===c,"thisItem"),b.toggleGeometry(a)},!1),g.textContent=d.name,f.appendChild(g),h=document.createElement("ul"),h.className="geometry-result-list",i=Math.min(d.results.length,b.limit),b.geoPages[d.id]=i,d.results.slice(0,i).forEach(function(c,e){a(b,h,c,e,d.id)}),f.appendChild(h),j.bruteSearch&&e<j.geometriesCount-1?c.insertBefore(f,c.childNodes[e]):c.appendChild(f),b.geometriesContainer[d.id]=f}function d(a,b){var c,d,e,f;f=b.resultCountDom,f&&(c=f.getAttribute("term"),d=f.getAttribute("ctx"),e=j.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),f.textContent=e)}function e(a,d,e,f,g,h,i){var k,l,m,n,o;l=a.controller,d.textContent="",n=document.createElement("div"),n.id="result-count-this-item-wrapper",n.className="result-count",k=document.createElement("span"),k.id="result-count-this-item",k.setAttribute("term",e),k.setAttribute("ctx",a.options.relatedItemsTab.displayName),m=j.i18n.translate("Results Count").split("{0}").join(g).split("{1}").join(e).split("{2}").join(a.options.relatedItemsTab.displayName),a.resultCountDom=k,k.textContent=m,n.appendChild(k),d.appendChild(n),o=document.createElement("div"),o.className="geometries-results-container dockingPanelScroll",h||(o.className=o.className+" too-many-geometries"),d.appendChild(o);var p,q,r=f.id;c(a,o,f,i),a.geoPages[r]>=a.limit&&(p=a.geometriesContainer[r],q=f.results.length>a.geoPages[r],q&&b(a,p.children[1],r))}function f(e,f,g,h,i){var j,k,l,m,n,o,p=e.controller;if(g.results&&g.results.length&&(e.geometriesContainer.hasOwnProperty(g.id)?e.geoPages[g.id]<e.limit&&(o=e.geometriesContainer[g.id],j=o.children[1],k=g.results.length,l=e.limit-e.geoPages[g.id],m=e.geoPages[g.id],n=0,m>0&&(n=m),k>e.limit?(e.geoPages[g.id]=e.limit,k=e.limit):e.geoPages[g.id]=e.geoPages[g.id]+(k-m),g.results.slice(n,k).forEach(function(b,c){a(e,j,b,c,g.id)})):c(e,f,g,i),e.geoPages[g.id]>=e.limit)){var q=p.totalResults[p.totalResultsIndex[g.id]].results.length>e.geoPages[g.id];q&&(o=e.geometriesContainer[g.id],b(e,o.children[1],g.id))}d(h,e)}function g(a,b,c,d){b.innerHTML="";var e=document.createElement("p");e.className="search-no-results";var f=j.i18n.translate("No Results").split("{0}").join(c).split("{1}").join(d);e.textContent=f,b.appendChild(e)}function h(a,b,c,d){function e(){var a=(new Date).getTime()-i;k.logger.log("Execution time INIT: "+a),c.logTimeEvent("initTime",a,"thisItem"),h.initialized=!0}function f(){return h.viewerProperties.tooManyNodes()}function g(a,b){j=(new Date).getTime(),h.viewerProperties.bruteSearch(a,function(a,d,e,f){if(h.lastSearchedString===a){h.totalResults=d.totalResults,h.searchInItemEnded=e,h.resultsCount=d.resultsCount,h.totalResultsIndex=d.totalResultsIndex,h.searchedString=a,h.geometriesCount++,h.bruteSearch=!0,g&&e&&(c.logTimeEvent("bruteSearchTime",(new Date).getTime()-j,"thisItem"),c.logSearchResults(h.resultsCount,a,"bruteSearch","thisItem"));var i=d.totalResults[d.totalResultsIndex[f]],k=null;return i&&(k={totalResults:[i]}),g&&e&&(c.logTimeEvent("bruteSearchTime",(new Date).getTime()-j,"thisItem"),c.logSearchResults(h.resultsCount,a,"bruteSearch","thisItem")),void b(k,h.viewerProperties.geometriesLoaded(),h.viewerProperties.getTotalCountGeometries(),e,f)}})}var h=this,i=null,j=null;h.initialized=!1,h.totalResults=[],h.searchInItemEnded=!1,h.resultsCount=-1,h.totalResultsIndex={},h.bigModels=!1,h.bigAmountGeometries=!1,h.viewerProperties=b,h.searchedString="",h.lastSearchedString="",h.geometriesCount=0,h.bruteSearch=!1,h.initializeAttributes=function(a,b){return h.initialized=!1,h.totalResults=[],h.searchInItemEnded=!1,h.resultsCount=-1,h.totalResultsIndex={},h.bigModels?(e(),void b()):void h.viewerProperties.getGeometriesAttributes(function(){e(),b()})},h.initialize=function(a){i=(new Date).getTime(),h.viewerProperties.initPropertyDatabases(function(b,c,d){return h.loadingGeom=b,h.bigAmountGeometries=d,h.bigModels=f(b),1===h.viewerProperties.getTotalCountGeometries()?(e(),void a()):(c&&h.initializeAttributes(b,function(){
if(!d)return void a()}),d?void a():void 0)})},h.doSearch=function(a,b){if(h.totalResults=[],h.searchInItemEnded=!1,h.resultsCount=0,h.totalResultsIndex={},h.lastSearchedString=a,h.geometriesCount=0,h.bruteSearch=!1,h.bigModels||!h.initialized)g(a,b);else{var d=+new Date;h.viewerProperties.doSearch(a,function(a,e,f){if(h.lastSearchedString===a)return h.totalResults=e.totalResults,h.searchInItemEnded=f,h.resultsCount=e.resultsCount,h.totalResultsIndex=e.totalResultsIndex,h.searchedString=a,h.geometriesCount=e.totalResults.length,f&&(c.logTimeEvent("searchTime",new Date-d,"thisItem"),c.logSearchResults(h.resultsCount,a,"fullproof-StringSearch","thisItem")),void b(e,h.viewerProperties.geometriesLoaded(),h.viewerProperties.getTotalCountGeometries(),f)})}}}var i,j=Autodesk.Viewing,k=Autodesk.Viewing.Private,l=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");l.InViewerSearchThisItem=function(a,b,c){i=this,this.viewer=a,this.options=b,this.container=null,this.initialized=!1,this.controller=null,this.qsApi=null,this.searchString=null,this.geoPages={},this.currentGeometry=null,this.limit=b.relatedItemsTab.pageSize,this.clicked=null,this.extensionViewer=null,this.cacheObj=c,this.loading=null,this.stillLoadingAlertElemId="this-item-loading-alert",this.stillLoadingAlertElem=null,this.geometriesContainer={},this.resultCountDom=null},l.InViewerSearchThisItem.prototype.constructor=l.InViewerSearchThisItem,l.InViewerSearchThisItem.prototype.initialize=function(a,b,c,d,e,f){var g=this;this.qsApi=a,this.options.uiEnabled&&(this.container=d,this.container.addEventListener("click",this.clickHandler)),this.currentGeometry=c,this.changeTab=f,this.controller=new h(c,b,a,this.viewer.model.myData.urn),this.controller.initialize(function(){g.initialized=!0,g.options.uiEnabled&&g.viewer&&g.viewer.getPropertyPanel&&(g.extensionViewer=g.viewer.getPropertyPanel(!0));var a=d&&d.id?d.id:d;e(a,g.initialized)})},l.InViewerSearchThisItem.prototype.uninitialize=function(){this.options.uiEnabled&&this.container.removeEventListener("click",this.clickHandler),this.controller&&(this.controller=null)};var m=function(a){for(var b,c,d,e=a.target,f=!1;e&&this.container!==e&&!f;)f=e.hasAttribute("adskSearchDbId"),f||(e=e.parentNode);f&&(b=e.getAttribute("adskSearchGeoGuid"),c=parseInt(e.getAttribute("adskSearchDbId"),10),d=parseInt(e.getAttribute("adskSearchIndex"),10),"click"===a.type?i.currentGeometry===b?(i.qsApi.logResultClickEvent(d+1,c,!0,"thisItem"),i.changeTab(c)):i.loadGeometryInViewer(b,c,d):"dblclick"===a.type||"hover"===a.type)};l.InViewerSearchThisItem.prototype.clickHandler=function(a){a&&(i.mouseClickTimeout&&(clearTimeout(i.mouseClickTimeout),i.mouseClickTimeout=null),i.mouseClickTimeout=setTimeout(function(){m.call(i,a)},200))},l.InViewerSearchThisItem.prototype.toggleLoading=function(a){var b,c=this.loading;a&&!c?(c=document.createElement("div"),c.className="loading this-item-loading",b=document.createElement("span"),b.textContent=j.i18n.translate("Loading"),c.appendChild(b),this.container.appendChild(c),this.loading=c):!a&&c&&(c.parentNode&&c.parentNode.removeChild(c),this.loading=null)},l.InViewerSearchThisItem.prototype.search=function(a,b){var c=this,d=c.controller,e=a.trim();this.clearSearch(),e&&(this.searchString=e,this.options.uiEnabled&&this.toggleLoading(!0),this.controller.doSearch(e,function(a,f,g,h,i){var j;if(c.options.uiEnabled)c.showResults(e,a,f,g,i);else if(h){j=d.totalResults.map(function(a){var b={id:a.id,name:a.name,results:a.results.slice(0,c.limit),moreResults:a.results.length>c.limit};return b});var k={page:1,results:j,resultsCount:d.resultsCount};return void b(k)}}))},l.InViewerSearchThisItem.prototype.loadGeometryInViewer=function(a,b,c){var d=this.cacheObj(),e=this.controller,f=e.viewerProperties.getGeometry(a),g=f?f.data:{guid:a};this.qsApi.logResultClickEvent(c+1,b,!1,"thisItem"),d.searchInfoThisItem={node:b,str:this.searchString};var h=function(){k.logger.error("Error loading geometry")},i=function(){k.logger.log("success loading geometry")};this.viewer.fireEvent({type:j.LOAD_GEOMETRY_EVENT,data:{item:g,onSuccessCb:i,onErrorCb:h}})},l.InViewerSearchThisItem.prototype.toggleGeometry=function(a){a.target.parentElement.className.indexOf("collapsed")===-1?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},l.InViewerSearchThisItem.prototype.showResults=function(a,b,c,d,h){var i,k,l=this.controller,m=this,n=m.container,o=n.children.length>1,p=d===c,q=this.stillLoadingAlertElem;if(b&&b.totalResults&&b.totalResults.length>0){k=b.totalResults;var r=null;h||(k=l.viewerProperties.orderGeometriesByName(b)),m.toggleLoading(!1),k.forEach(function(b){i=l.totalResultsIndex[b.id],o?(r=n.children[1],f(m,r,b,l.resultsCount,i,l.bruteSearch)):(e(m,n,a,b,l.resultsCount,p,i,l.bruteSearch),o=!0)})}else l.searchInItemEnded&&(m.toggleLoading(!1),g(m,n,a,m.options.relatedItemsTab.displayName));if(!p&&l.searchInItemEnded&&!q){q=document.createElement("div"),q.id=m.stillLoadingAlertElemId,q.className="alert-geometries-loading";var s=j.i18n.translate("Geometries Loading");q.textContent=s,this.stillLoadingAlertElem=q,n.appendChild(q)}},l.InViewerSearchThisItem.prototype.clearSearch=function(){this.container&&this.options.uiEnabled&&(this.container.innerHTML="",this.geometriesContainer={},this.stillLoadingAlertElem=null,this.resultCountDom=null),this.geoPages={},this.toggleLoading(!1)},l.InViewerSearchThisItem.prototype.getPage=function(a,b,c){var d,e,f,g,h,i=this.controller,j=this,k=j.limit*(b-1);g={id:"",name:"",results:[],moreResults:!1},d=i.totalResults[i.totalResultsIndex[a]],d&&(e=d.results,f=e.slice(k,k+j.limit),g={id:d.id,name:d.name,results:f,moreResults:e.length>k+j.limit}),h={page:b,results:g,resultsCount:i.resultsCount},c(h)},l.InViewerSearchThisItem.prototype.loadMoreItems=function(c,d){var e,f,g,h,i,j,k=this.controller,l=this,m=l.geoPages[c],n=m;e=k.totalResults[k.totalResultsIndex[c]],f=e.results,g=f.slice(m,m+l.limit),l.geoPages[c]=l.geoPages[c]+l.limit,h=this.geometriesContainer[c],i=h.children[1],d.target.parentNode.removeChild(d.target),j=f.length>l.geoPages[c],g.forEach(function(b){a(l,i,b,n,c),n++}),j&&b(l,i,c)}}(),function(){"use strict";function a(a,b,c,d){var e=a,f=/^https?:\/\//i;try{d?e=d(c):c.url&&(0===c.url.search(f)?e=c.url:(e=b+"/"+c.url,e=e.replace(/([^:]\/)\/+/g,"$1")))}catch(a){e=null}return e||a}function b(a,b,c,e){var f,g;b.textContent="",g=document.createElement("p"),g.className="search-no-results",f=d.i18n.translate("No Results"),f=f.split("{0}").join(c),f=f.split("{1}").join(e),g.textContent=f,b.appendChild(g)}function c(a){function b(b,c){var d=[];b&&(b.forEach(function(b){var c;b.suggestionCount>0&&(c={modifier:b.modifier,name:b.displayName,categoryResults:[],moreItems:b.suggestionCount>3},b.suggestions.forEach(function(b){var d={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};c.categoryResults.push(d)}),e.count=e.count+b.suggestionCount,d.push(c),e.categoriesIndex[c.name]=d.length-1)}),e.categories=d),c(e.categories)}function c(c,d,e){c?(a.logErrorEvent("Error getting suggestions: "+c,"in_viewer_search_this_project","handleResult","thisProject"),e([])):d&&d.suggestionGroups&&b(d.suggestionGroups,e)}function d(b,c,d){var f,g,i;if(b)a.logErrorEvent("Error getting more item results: "+b,"in_viewer_search_this_project","loadMoreResults","thisProject");else if(c&&c.queryResults)return f=[],i=e.categories[e.categoriesIndex[h]].categoryResults,c.queryResults.forEach(function(b){var c={name:a.sanitizeAndHighlightString(b.title,"<b>","</b>"),logClick:b.logClick,url:b.url,resultData:b};f.push(c),i.push(c)}),g=c.queryResultCount>i.length,void d(f,g)}var e=this,f=null,g={},h="",i={};e.categories=null,e.categoriesIndex={},e.count=0,e.projectResults=null,e.search=function(b,d,h,j,k,l){1===k&&(e.categories=null,e.count=0,i={}),f=d,g={query:d,sort:h,filters:j};var m=+new Date;a.search(b,d,h,j,k,function(b,d){a.logTimeEvent("searchTime",new Date-m,"thisProject"),c(b,d,l)},"thisProject")},e.uninitialize=function(){},e.getMoreResults=function(b,c,e,f,j){var k=2;h=c,i.hasOwnProperty(c.name)&&(k=i[c.name]),j&&(k=j),a.getMoreResults(b,e,g.query,g.sort,g.filters,k,function(a,b){d(a,b,f)}),j||(i[c.name]=k+1)}}var d=Autodesk.Viewing,e=Autodesk.Viewing.Private,f=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),e=Autodesk.Viewing.Private,g="This feature has not been configured.";f.InViewerSearchThisProject=function(a){this.options=a,this.initialized=!1,this.controller=null,this.qsApi=null,this.container=null,this.contextMenu=null,this.urlCb=null,this.loadingId="this-project-loading",this.searchParams=null,a&&a.serverSearchTab&&a.serverSearchTab.parameters&&(this.searchParams=a.serverSearchTab.parameters),this.loadingElementDom=null,self.categoriesContainerDom=null},f.InViewerSearchThisProject.prototype.constructor=f.InViewerSearchThisProject,f.InViewerSearchThisProject.prototype.initialize=function(a,b){var d=this,f=+new Date;return this.qsApi=a,d.options&&d.options.serverSearchTab&&d.searchParams?(this.urlCb=d.searchParams.urlCallback,this.baseURL=d.searchParams.baseURL?d.searchParams.baseURL.replace(/\/$/g,""):"",this.fallbackURL=d.searchParams.fallbackURL,this.controller=new c(a),this.options.uiEnabled&&(this.container=b,window.addEventListener("click",function(){d.contextMenu&&d.contextMenu.classList.add("hidden")},!1)),a.logTimeEvent("initTime",new Date-f,"thisProject"),void(this.initialized=!0)):void e.logger.warn("Error initializing server search tab: missing options.")},f.InViewerSearchThisProject.prototype.uninitialize=function(){this.controller&&this.controller.uninitialize()},f.InViewerSearchThisProject.prototype.openMenu=function(b,c){var f,g,h,i=this.contextMenu,j=a(this.fallbackURL,this.baseURL,c,this.urlCb),k=this.container,l=k.getBoundingClientRect();c.logClick(),b.stopPropagation(),i.textContent="",j?(f=document.createElement("div"),f.className="menu-item open-another-window",f.innerHTML="<a href='"+j+"' target='_blank'>"+d.i18n.translate("Open Another Window")+"</a>",g=document.createElement("div"),g.className="menu-item open-this-window",g.innerHTML="<a href='"+j+"' target='_self'>"+d.i18n.translate("Open This Window")+"</a>",i.appendChild(f),i.appendChild(g),h=b.pageX-l.left+b.currentTarget.offsetLeft-10,h>195&&(h-=145),i.style.top=b.pageY-7+"px",i.style.left=h+"px",i.className=i.className.replace(" hidden","")):e.logger.warn("The url for "+c.name+" is empty")},f.InViewerSearchThisProject.prototype.toggleCategory=function(a){var b=a.target.parentElement.className.indexOf("collapsed")===-1;b?a.target.parentElement.classList.add("collapsed"):a.target.parentElement.classList.remove("collapsed")},f.InViewerSearchThisProject.prototype.toggleLoading=function(a){var b=this.loadingElementDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.innerHTML="<span>"+d.i18n.translate("Loading")+"</span>",this.loadingElementDom=b,this.container.appendChild(b)):!a&&b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingElementDom=null)},f.InViewerSearchThisProject.prototype.loadMoreItems=function(a,b){var c=this,d=this.controller,e=a.target.parentElement;this.toggleLoading(!0),d.getMoreResults(this.searchParams.pid,b.name,b.modifier,function(b,d){var f;d||a.target.parentNode.removeChild(a.target),c.toggleLoading(!1),b.forEach(function(a){var b=document.createElement("li");b.innerHTML=a.name,b.className="item-result",b.addEventListener("click",function(b){c.openMenu(b,a)},!1),d?e.insertBefore(b,e.childNodes[e.childElementCount-1]):e.appendChild(b)}),f=this.categoriesContainerDom,f.scrollTop=f.scrollTop+70})},f.InViewerSearchThisProject.prototype.getPage=function(a,b,c){var d=this.controller;this.options.uiEnabled&&this.toggleLoading(!0),d.getMoreResults(this.searchParams.pid,a.name,a.modifier,function(a,e){var f={page:b,results:a,resultsCount:d.count};c(f)},b)},f.InViewerSearchThisProject.prototype.showResults=function(a,c){var e,f,g,h,i=this,j=this.container,k=this.controller;this.toggleLoading(!1),j.textContent="",i.qsApi.logSearchResults(k.count,a,"elasticsearch","thisProject"),k.count>0?(e=document.createElement("div"),e.className="result-count",f=d.i18n.translate("Results Count"),f=f.split("{0}").join(k.count),f=f.split("{1}").join(a),f=f.split("{2}").join(i.options.serverSearchTab.displayName),g=document.createElement("span"),g.id="result-count-this-project",g.textContent=f,e.appendChild(g),j.appendChild(e),h=document.createElement("div"),h.className="categories-results-container dockingPanelScroll",j.appendChild(h),i.categoriesContainerDom=h,i.contextMenu=document.createElement("div"),i.contextMenu.className="context-menu hidden",j.appendChild(i.contextMenu),c.forEach(function(a,b){var c,e,f,g;c=document.createElement("div"),c.id="category_"+a.name,c.className="category-results",e=document.createElement("label"),e.className="category-name",e.setAttribute("adskCatId",a.name),e.setAttribute("adskCatIndex",b),e.addEventListener("click",function(a){var b=a.currentTarget.getAttribute("adskCatId"),c=parseInt(a.currentTarget.getAttribute("adskCatIndex"),10);i.qsApi.logResultGeomClickEvent(c+1,b,!1,"thisProject"),i.toggleCategory(a)},!1),e.innerText=a.name,c.appendChild(e),f=document.createElement("ul"),f.className="category-result-list",[].slice.call(a.categoryResults).forEach(function(a,b){var c=document.createElement("li");c.className="item-result",c.innerHTML=a.name,c.setAttribute("adskItemId",a.url),c.setAttribute("adskItemIndex",b),c.addEventListener("click",function(b){var c=b.currentTarget.getAttribute("adskItemId"),d=parseInt(b.currentTarget.getAttribute("adskItemIndex"),10);i.qsApi.logResultClickEvent(d+1,c,!1,"thisProject"),i.openMenu(b,a)},!1),f.appendChild(c)}),a.moreItems&&(g=document.createElement("li"),g.className="more-items item-result",g.textContent=d.i18n.translate("Load More"),g.addEventListener("click",function(b){i.qsApi.logLoadMoreClickEvent(a.name,"thisProject"),i.loadMoreItems(b,a)},!1),f.appendChild(g)),c.appendChild(f),h.appendChild(c)})):b(i,j,a,i.options.serverSearchTab.displayName)},f.InViewerSearchThisProject.prototype.search=function(a,b){var c=this,d=this.controller,e=a.trim();return this.clearSearch(),this.searchParams.pid&&this.searchParams.filters?void(e&&(this.options.uiEnabled&&this.toggleLoading(!0),this.controller.search(this.searchParams.pid,e,"dateModifiedDescending",this.searchParams.filters,1,function(a){c.options.uiEnabled?c.showResults(e,a):b({page:1,results:a,resultsCount:d.count})}))):void c.displayMessage(g)},f.InViewerSearchThisProject.prototype.displayMessage=function(a){var b,c;this.container&&this.options.uiEnabled&&(b=this.container,this.toggleLoading(!1),b.textContent="",c=document.createElement("p"),c.className="display-message",c.textContent=a,b.appendChild(c))},f.InViewerSearchThisProject.prototype.clearSearch=function(){var a;this.container&&this.options.uiEnabled&&(a=this.container,a.textContent="",this.toggleLoading(!1))}}(),function(){"use strict";function a(a,b,c,d){var e=document.createElement("li");e.innerHTML=b.displayNameSanitized,e.setAttribute("adskSearchDbId",b.dbId),e.setAttribute("adskSearchIndex",d),e.className="in-viewer-search-item item-result dbId_"+b.dbId+"_",a.highlightNode===b.dbId&&(a.selectedNode=e,e.className=e.className+" selected",a.selectNode(e,b.dbId,!0)),a.resultsDom=e,c.appendChild(e)}function b(a,b,c,d){var e,f;b.textContent="",f=h.i18n.translate("No Results").split("{0}").join(c).split("{1}").join(d),e=document.createElement("p"),e.className="search-no-results",e.textContent=f,b.appendChild(e)}function c(a,b,c,d){var e,f,g;return f=b.nodeName,!f&&a.viewer.model.myData.instanceTree&&(f=a.viewer.model.myData.instanceTree.getNodeName(b.dbId)),f||(f=c.viewerProperties.defaultNodeName()),f.indexOf(d)>=0||b.hasOwnProperty("fieldName")&&"Name"===b.fieldName?g=c.viewerProperties.highlightText(f,d):b.hasOwnProperty("fieldName")&&b.hasOwnProperty("fieldValue")?(e="[object Number]"===Object.prototype.toString.call(b.fieldValue)?String(b.fieldValue):b.fieldValue,g=c.viewerProperties.highlightText(f)+" ("+c.viewerProperties.highlightText(b.fieldName)+": "+c.viewerProperties.highlightText(e,d)+")"):g=c.viewerProperties.highlightText(f),g}function d(a,b){var c,d,e,f;f=b.resultCountDOM,f&&(c=f.getAttribute("term"),d=f.getAttribute("ctx"),e=h.i18n.translate("Results Count"),e=e.split("{0}").join(a),e=e.split("{1}").join(c),e=e.split("{2}").join(d),f.textContent=e)}function e(b,e,f,g){var i,j,k,l,m,n=b.container,o=b.controller,p=f.length,q=b.limit,r=b.offset,s=r+q;p<q&&(s=r+p),p&&(b.options.uiEnabled&&(b.toggleLoading(!1),b.resultList||(n.textContent="",i=document.createElement("div"),i.className="result-count",j=document.createElement("span"),j.id="result-count-this-view",j.setAttribute("term",e),j.setAttribute("ctx",b.options.loadedModelTab.displayName),k=h.i18n.translate("Results Count"),j.textContent=k.split("{0}").join(p).split("{1}").join(e).split("{2}").join(b.options.loadedModelTab.displayName),b.resultCountDOM=j,i.appendChild(j),n.appendChild(i),b.resultList=document.createElement("ul"),b.resultList.className="search-result-list dockingPanelScroll",b.resultList.addEventListener("scroll",function(){this.scrollTop>b.scrollOffset&&(b.loadMoreResults(),b.scrollOffset=b.scrollOffset+b.limitScroll)}),n.appendChild(b.resultList))),f.slice(r,p).forEach(function(d,f){d.hasOwnProperty("dbId")||(d={fieldName:d.name,fieldValue:d.value,dbId:d.id,nodeName:d.nodeName}),b.isNodeVisible(d.dbId,function(){o.searchedIds.hasOwnProperty(d.dbId)||(l=c(b,d,o,e),m={displayNameSanitized:l,dbId:d.dbId,fieldName:d.fieldName,fieldValue:d.fieldValue},o.totalResults.push(m),o.searchResultIds.push(d.dbId),o.searchedIds[d.dbId]=1,o.resultsCount++,b.options.uiEnabled&&o.resultsCount<=q&&r<s&&(a(b,m,b.resultList,f),r+=1))})}),b.offset=r,b.options.uiEnabled&&d(o.resultsCount,b))}function f(a,b,c,d){function e(){var a=(new Date).getTime()-j;i.logger.log("Execution time INIT: "+a),b.logTimeEvent("initTime",a,"thisView"),h.initialized=!0}function f(a,c){var d=(new Date).getTime(),e=function(e){h.searchEnded=!0,b.logTimeEvent("bruteSearchTime",(new Date).getTime()-d,"thisView"),b.logSearchResults(e.length,a,"bruteSearch","thisView"),c(a,e,!0)},f=function(){b.logErrorEvent("LMV search bruteForceSearch failed","in_viewer_search_this_view","bruteSearch","thisView")};h.viewerProperties.bruteSearchCurrent(a,e,f)}function g(){var a=h.viewerProperties.tooManyNodes(!0);return a}var h=this,j=null;h.initialized=!1,h.searchResultIds=[],h.searchedIds={},h.resultsCount=0,h.totalResults=[],h.searchEnded=null,h.viewerProperties=c,h.bigModel=!1,h.isSharedPropertyDb=!1,h.initializeAllAttributes=function(a){j=(new Date).getTime(),h.bigModel=g(),d||(h.bigModel=!0),h.bigModel?(e(),a()):h.viewerProperties.getCurrentGeometryAttributes(function(){e(),a()})},h.doSearch=function(a,c){var e;h.searchResultIds=[],h.searchedIds={},h.resultsCount=0,h.totalResults=[],h.searchEnded=!1,h.bigModel?f(a,c):(e=(new Date).getTime(),h.viewerProperties.doSearch(a,function(a,f,g){var i=[];f&&f.totalResults.length&&(i=f.totalResults[f.totalResultsIndex[d]].results),g&&(b.logTimeEvent("searchTime",(new Date).getTime()-e,"thisView"),b.logSearchResults(h.resultsCount.length,a,"fullproof-StringSearch","thisView")),c(a,i,g)}))}}var g,h=Autodesk.Viewing,i=Autodesk.Viewing.Private,j=new AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");j.InViewerSearchThisView=function(a,b){g=this,this.options=b,this.viewer=a,this.container=null,this.initialized=!1,this.controller=null,this.resultList=null,this.extensionViewer=null,this.clicked=null,this.is2DMode=null,this.qsApi=null,this.highlightNode=null,this.scrollOffset=500,this.limitScroll=200,this.limit=b.loadedModelTab.pageSize,this.offset=0,this.mouseClickTimeout=null,this.loadingId="this-view-loading",this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null},j.InViewerSearchThisView.prototype.constructor=j.InViewerSearchThisView,j.InViewerSearchThisView.prototype.initialize=function(a,b,c,d,e,g){var h=this,i=this.viewer;this.options.uiEnabled&&(this.container=e,this.container.addEventListener("click",this.clickHandler),this.container.addEventListener("dblclick",this.clickHandler),this.container.addEventListener("hover",this.clickHandler)),this.is2DMode=d,this.qsApi=a,this.controller=new f(i,a,b,c),this.controller.initializeAllAttributes(function(){h.initialized=!0,h.options.uiEnabled&&h.viewer&&h.viewer.getPropertyPanel&&(h.extensionViewer=h.viewer.getPropertyPanel(!0));var a=e&&e.id?e.id:e;g(a,h.initialized)})},j.InViewerSearchThisView.prototype.uninitialize=function(){this.options.uiEnabled&&(this.container.removeEventListener("click",this.clickHandler),this.container.removeEventListener("dblclick",this.clickHandler),this.container.removeEventListener("hover",this.clickHandler)),this.controller&&(this.controller=null)};var k=function(a){for(var b,c,d=a.target,e=!1;d&&this.container!==d&&!e;)e=d.hasAttribute("adskSearchDbId"),e||(d=d.parentNode);e&&(b=parseInt(d.getAttribute("adskSearchDbId"),10),c=parseInt(d.getAttribute("adskSearchIndex"),10),"click"===a.type?g.showNodeProperties(a,b,c):"dblclick"===a.type?(g.showNodeProperties(a,b,c,!0),g.viewer.fitToView()):"hover"===a.type&&g.viewer.impl.rolloverObjectNode(b))};j.InViewerSearchThisView.prototype.clickHandler=function(a){a&&(clearTimeout(g.mouseClickTimeout),g.mouseClickTimeout=setTimeout(function(){k.call(g,a)},200))},j.InViewerSearchThisView.prototype.search=function(a,b,c){var d=this,f=this.controller,g=a.trim();this.clearSearchResults(),g&&(d.resultList=null,this.options.uiEnabled&&(this.toggleLoading(!0),this.highlightNode=c),this.controller.doSearch(g,function(a,c,g){var h;if(d.options.uiEnabled)d.showResults(a,c,g);else if(e(d,a,c,g),g)return h={page:1,results:f.totalResults.slice(0,d.limit),resultsCount:f.resultsCount,moreResults:f.resultsCount>d.limit},void b(h)}))};var l=function(a,b){var c,b;c=a.selectedNode,c&&c.classList.remove("selected"),b&&(a.selectedNode=b,b&&b.classList.add("selected"))};j.InViewerSearchThisView.prototype.showNodeProperties=function(a,b,c,d){var e=this;this.qsApi.logResultClickEvent(c+1,b,!0,"thisView"),this.clicked===b?(this.clicked=null,this.viewer.clearSelection(),this.is2DMode?this.viewer.select(this.controller.searchResultIds):this.viewer.isolate(this.controller.searchResultIds),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!!d),d?l(e,a.target,a):l(e,null)):this.selectNode(a.target,b,!1)},j.InViewerSearchThisView.prototype.isNodeVisible=function(a,b){if(this.is2DMode)return void b();if(this.viewer.model&&this.viewer.model.getData()){var c=this.viewer.model.getData().instanceTree;if(c){c.nodeAccess.enumNodeFragments(a,function(a){b()})}}},j.InViewerSearchThisView.prototype.selectNode=function(a,b,c){var d,e,f=this,g=!1,h=this.controller;if(this.nodeNotVisibleAlert&&(clearTimeout(this.nodeNotVisibleAlertTimer),document.body.removeChild(this.nodeNotVisibleAlert),this.nodeNotVisibleAlert=null),this.clicked=b,!a&&this.container.children.length>1)for(e=this.container.children[1].children,length=e.length,d=0;!g&&d<length;)e[d].className.indexOf("dbId_"+b+"_")>=0&&(g=!0,a=e[d]),d++;this.is2DMode?this.viewer.select(b):this.viewer.isolate(b),this.extensionViewer&&this.extensionViewer.container&&this.extensionViewer.setVisible(!0),l(f,a),c&&a&&a.parentNode&&(a.parentNode.scrollTop=a.offsetTop),!a&&h.searchResultIds.indexOf(b)<0&&(this.clicked=null,this.showAlertNodeNotVisible(f.container))},j.InViewerSearchThisView.prototype.clearSearchResults=function(){if(this.offset=0,this.scrollOffset=500,this.limitScroll=200,this.clicked=null,this.selectedNode=null,this.highlightNode=null,this.options.uiEnabled){if(this.container&&(this.container.textContent=""),this.controller&&this.controller.searchResultIds&&this.controller.searchResultIds.length>0){if(!this.is2DMode)try{this.viewer.showAll()}catch(a){i.logger.error(a)}this.toggleLoading(!1),this.viewer.clearSelection(),this.controller.searchResultIds=[],this.resultList=null}this.loadingDom=null,this.resultsDom=null,this.resultCountDOM=null}},j.InViewerSearchThisView.prototype.toggleLoading=function(a){var b=this.loadingDom;a&&!b?(b=document.createElement("div"),b.id=this.loadingId,b.className="loading",b.textContent=h.i18n.translate("Loading"),this.loadingDom=b,this.container.appendChild(b)):b&&(b.parentNode&&b.parentNode.removeChild(b),this.loadingDom=null)},j.InViewerSearchThisView.prototype.loadMoreResults=function(){var b,c,d=this.controller,e=this,f=this.offset,g=d.resultsCount;if(g>f){for(b=f+e.limit,c=f;c<b;c++)g>c&&a(e,d.totalResults[c],e.resultList,c);e.offset=f+e.limit}},j.InViewerSearchThisView.prototype.getPage=function(a,b){var c,d,e=this.controller,f=this,g=f.limit*(a-1);e.resultsCount>g?(c=e.totalResults.slice(g,g+f.limit),d={page:a,results:c,resultsCount:e.resultsCount,moreResults:e.resultsCount>g+f.limit}):d={page:a,results:[],resultsCount:e.resultsCount,moreResults:!1},setTimeout(function(){b(d)},0)},j.InViewerSearchThisView.prototype.showAlertNodeNotVisible=function(a){var b=this,c=document.createElement("div");c.className="alert-node-not-visible",c.textContent=h.i18n.translate("AlertNodeNotVisible"),document.body.appendChild(c),this.nodeNotVisibleAlertTimer=setTimeout(function(){c&&(document.body.removeChild(b.nodeNotVisibleAlert),b.nodeNotVisibleAlert=null)},7e3),this.nodeNotVisibleAlert=c},j.InViewerSearchThisView.prototype.showResults=function(a,c,d){var f=this,g=this.controller,h=f.container;e(f,a,c,d),g.searchResultIds&&g.searchResultIds.length&&(f.is2DMode?f.highlightNode?f.viewer.select(f.highlightNode):f.viewer.select(g.searchResultIds):f.highlightNode?(f.viewer.isolate(f.highlightNode),f.viewer.select(f.highlightNode)):f.viewer.isolate(g.searchResultIds)),d&&(g.resultsCount<1||!f.resultList.childNodes.length)&&(f.toggleLoading(!1),b(f,h,a,f.options.loadedModelTab.displayName)),d&&f.highlightNode&&(g.searchedIds.hasOwnProperty(f.highlightNode)||this.selectNode(null,f.highlightNode,!1)),d&&(g.searchedIds={}),g.searchEnded=d}}(),function(){"use strict";function a(a){return l?(l.indexOf("autodesk")>=0?(i.token=null,i.oauth2Token=d.token.accessToken):(i.token=d.token.getAccessToken?d.token.getAccessToken():null,i.oauth2Token=null),a&&(i.clientFeatureId=f+(a?"."+a:"")),i):i}function b(a){a&&d.logger.log("InViewerSearch Extension: QsApi not initialized")}function c(){var a=!!window.chrome&&!!window.chrome.webstore;if(a)return"Chrome";var b=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0;if(b)return"Opera";var c="undefined"!=typeof InstallTrigger;if(c)return"Firefox";var d=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;if(d)return"Safari";var e=!!document.documentMode;if(e)return"Internet Explorer";var f=!e&&!!window.StyleMedia;if(f)return"Edge";var g=(a||b)&&!!window.CSS;return g?"Blink":"Unknown"}var d=(Autodesk.Viewing.Extensions,Autodesk.Viewing.Private),e=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch"),f="adsk.viewer";e.QsApiService=function(){this.qsAPI=null};var g=e.QsApiService.prototype,h={pid:"",query:"",sort:"",page:1,filters:"",language:"ENU",modifier:null},i={},j=null,k=null,l=null,m=null,n=Object.freeze({development:"apidev",staging:"apistg",production:"apiprod",autodeskstaging:"apistg",autodeskdevelopment:"apidev",autodeskproduction:"apiprod"});g.initialize=function(a,b,c,d){i={token:null,oauth2Token:null,clientId:c,sessionId:d,clientFeatureId:""},m=a,l=b.toLowerCase(),this.qsAPI=new Autodesk.Search.SearchQueryAPI(n[l])},g.generateQueryId=function(){var a=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(a+=performance.now());var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});k=b},g.search=function(b,c,e,f,g,i,k){this.qsAPI||d.logger.log("InViewerSearch Extension: QsApi not initialized"),j=c,h.pid=b,h.page=g,h.query=c,h.sort=e,h.filters=f;var l=a(k);this.qsAPI.suggest(h,l,i)},g.getMoreResults=function(b,c,e,f,g,i,k){this.qsAPI||d.logger.log("InViewerSearch Extension: QsApi not initialized"),j=e,h.pid=b,h.page=i,h.query=e,h.sort=f,h.filters=g,h.modifier=c;var l=a();this.qsAPI.query(h,l,k)},g.logEvent=function(a,c,d){this.qsAPI&&this.qsAPI.logEvent(k,c,a,d,b)},g.logInitEvent=function(b,d,e){var f="inViewer.initialization",g={viewerVersion:m,id:b,modelInfo:d,url:window.location.href,browser:c(),userAgent:window.navigator.userAgent},h=a(e);this.logEvent(f,h,g)},g.logGeneralEvent=function(b,c){var d="inViewer."+b,e=a(c);this.logEvent(d,e,"")},g.logTimeEvent=function(b,c,d){var e="inViewer."+b,f={};f[b+"DurationMs"]=c;var g=a(d);this.logEvent(e,g,f)},g.logSearchResults=function(b,c,d,e){var f="inViewer.searchResults",g={resultCount:b,queryString:c,algorithm:d},h=a(e);this.logEvent(f,h,g)},g.logTabClickEvent=function(b){var c="inViewer.tabClick",d=null,e=a(b);this.logEvent(c,e,d)},g.logResultClickEvent=function(a,b,c,d){var e="inViewer.resultClick";this.logResultComponentClickEvent(e,a,b,c,d)},g.logResultGeomClickEvent=function(a,b,c,d){var e="inViewer.resultGeomClick";this.logResultComponentClickEvent(e,a,b,c,d)},g.logResultComponentClickEvent=function(b,c,d,e,f){var g={position:c,nodeId:d,clickedCurrentGeometry:e},h=a(f);this.logEvent(b,h,g)},g.logLoadMoreClickEvent=function(b,c){var d="inViewer.loadMoreClick",e={id:b},f=a(c);this.logEvent(d,f,e)},g.logErrorEvent=function(b,c,d,e){var f="inViewer.error",g={file:c,method:d,querySource:"inViewer",message:b},h=a(e);this.logEvent(f,h,g)},g.sanitizeAndHighlightString=function(a,b,c){return this.qsAPI.sanitizeAndHighlightString(a,b,c)}}(),function(){"use strict";function a(a){var b;return a?([].slice.call(a).forEach(function(a){b||(b=a.urn(),b&&(b=b.substr(0,b.lastIndexOf("/")+1),b.indexOf("output/Resource")>0&&(b=b.substr(0,b.lastIndexOf("Resource")+9))))}),b||g.logger.warn("InViewerSearch Extension: No URN found for geometry")):g.logger.warn("InViewerSearch Extension: No URN to retrieve from in getUrnFromChildren()"),b}function b(a){if(y&&y.length)return y;var b=[];return Object.keys(n).forEach(function(a){b.push(n[a].data)}),y=b.sort(c)}function c(a,b){var c=a.name.toUpperCase(),d=b.name.toUpperCase();return c<d?-1:c>d?1:0}function d(a){var b=0,c=a.model.myData;return b=c.instanceTree&&c.instanceTree.objectCount?c.instanceTree.objectCount:c.instanceTree&&c.instanceTree.children?c.instanceTree.children.length:0}function e(a){return String(a).replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var f=Autodesk.Viewing,g=f.Private,h=AutodeskNamespace("Autodesk.Viewing.Extensions.InViewerSearch");h.ViewerPropertiesService=function(){this.worker=void 0,this.viewerpropertiesworker=void 0,this.initialized=!1,this.viewer=null,this.isGeometry=!1,this.isSearching=!1,this.isSearchingTimer=null,this.searchingString="",this.searchingStringCb=null};var i=h.ViewerPropertiesService.prototype,j=300,k=20,l={},m=null,n=null,o=0,p=null,q=131e3,r=0,s=null,t=!1,u={},v=!1,w=null,x=null,y=[],z="_sharedPropertyDatabase_";i.uninitialize=function(){void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,self.viewerpropertiesworker=void 0),this.initialized=!1},i.initialize=function(a,b,c,d,e,i,j){if(this.viewer=a,p=i,b)void 0!==this.worker&&(this.worker.terminate(),this.worker=void 0,this.viewerpropertiesworker=void 0);else{l={};var k=this.viewer.model.myData.acmSessionId;this.viewer.model.myData.basePath;n=d,m=e,r=0,s=j,t=!!s,o=Object.keys(d).length,g.logger.debug("InViewerSearch Extension - Geometries amount: "+o);var q=f.isNodeJS?null:"domain="+encodeURIComponent(window.location.origin);u={url:f.getItemApi(),headers:{},basePath:a.model.myData.basePath,auth:!0,viewing_url:f.getItemApi(),queryParams:q+(k&&q?"&":"")+(k?"acmsession="+k:"")},void 0===this.viewerpropertiesworker?(this.worker=h.WorkerUtils.createPropertyWorker(),
this.viewerpropertiesworker=this.worker):this.worker=this.viewerpropertiesworker,this.worker.postMessage({operation:"SET_DEBUG",enable:avp.ENABLE_DEBUG,level:avp.logger.level})}this.initialized=!0},i.initPropertyDatabases=function(b){var c,d=[],e=this,f=0,g=!1,h=function(a){var c=a.data;switch(c.operation){case"PROP_DB_CREATED":if(c.guid!==m)return r++,l[c.guid].objCount=c.objCount,r===f+1&&e.worker.removeEventListener("message",h),void b(l,r===f+1,g)}};return s?(Object.keys(n).forEach(function(a){var b;r<j&&(b=n[a],l.hasOwnProperty(a)||(l[a]={geometry:b.data,hasSharedProperties:!0,objCount:0}),r++)}),void b(l,o>1,g)):(Object.keys(n).forEach(function(b){var c,e=n[b];b!==m&&f<j&&(l.hasOwnProperty(b)||(l[b]={geometry:e.data},c=a(e.children),d.push({urn:c,geo:e.data}),f++))}),(c=d.length)?(g=c>k,e.worker.addEventListener("message",h),e.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:d,context:u}),void 0):void b(l,!0,!1))},i.initSharedPropertyDatabase=function(a){var b=this,c=z,d=function(e){var f=e.data;switch(f.operation){case"PROP_DB_CREATED":if(f.guid===c)return l[c].objCount=f.objCount,l[c].loading=!1,b.worker.removeEventListener("message",d),l[c].sharedDbInit&&l[c].sharedDbInit(),void a()}};if(l.hasOwnProperty(c)){if(!l[c].loading)return void a();l[c].sharedDbInit=a}else l[c]={isShared:!0,loading:!0},l[m]={isShared:!0,geometry:n[m].data},b.worker.addEventListener("message",d),b.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:s,geo:{guid:c}}],context:u})},i.initCurrentPropertyDatabase=function(b,c){var d,e,f=this;if(s)this.initSharedPropertyDatabase(function(){var a=n[b];l.hasOwnProperty(b)||(l[b]={geometry:a.data,hasSharedProperties:!0,objCount:0}),c()});else{var g=function(a){var b=a.data;switch(b.operation){case"PROP_DB_CREATED":if(l[b.guid].objCount=b.objCount,b.guid===m)return r++,f.worker.removeEventListener("message",g),void c()}};if(l.hasOwnProperty(b))return void c();d=n[m]||{},l[m]={geometry:d.data},e=a(d.children),f.worker.addEventListener("message",g),f.worker.postMessage({operation:"CREATE_PROP_DB",geoPropertyPacks:[{urn:e,geo:d.data}],context:u})}},i.getCurrentGeometryAttributes=function(a){var b=this;this.initCurrentPropertyDatabase(m,function(){b.getGeometryAttributes(m,function(){a()})})},i.getGeometryAttributes=function(a,b){var c=this,d=function(e){var f=e.data;switch(f.operation){case"GEOMETRY_ATTR_OK":c.worker.removeEventListener("message",d),b();break;case"GEOMETRY_ATTR_ERR":c.worker.removeEventListener("message",d),g.logger.info("InViewerSearch Extension: No attributes found for: "+a),b();break;default:g.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(f.operation||"")+" Error: "+(f.error||"")+" Place: "+(f.place||"")+" Method: "+(f.method||""))}};this.worker.addEventListener("message",d),this.worker.postMessage({operation:"GEOMETRY_ATTR",guid:a,sharedPropDbKey:z,isSharedPropertyDb:t})},i.getGeometriesAttributes=function(a){var b=this,c=(this.getGeometry(m),function(d){var e=d.data;switch(e.operation){case"GEOMETRIES_ATTR_OK":a(),b.worker.removeEventListener("message",c);break;case"GEOMETRIES_ATTR_ERR":g.logger.info("InViewerSearch Extension: No attributes found for: "+e.geometry.guid),e.ended&&(a(),b.worker.removeEventListener("message",c));break;default:g.logger.warn("InViewerSearch Extension: Invalid operation found:  Operation: "+(e.operation||"")+" Error: "+(e.error||"")+" Place: "+(e.place||"")+" Method: "+(e.method||""))}});return t?void a({},t,!0):(this.worker.addEventListener("message",c),void this.worker.postMessage({operation:"GEOMETRIES_ATTR",sharedPropDbKey:z,isSharedPropertyDb:t}))},i.getGeometry=function(a){var b;return b=n.hasOwnProperty(a)?n[a]:null},i.orderGeometriesByName=function(a){var c,d=[],e=b(this);return e.forEach(function(b){a.totalResultsIndex.hasOwnProperty(b.guid)&&(c=a.totalResultsIndex[b.guid],d.push(a.totalResults[c]))}),d},i.getTotalCountGeometries=function(){return o>j?j:o},i.areMoreGeometriesToLoad=function(){return n.length>j},i.geometriesLoaded=function(){return r},i.updateCurrent=function(a){m=a},i.tooManyNodes=function(a){var b=0,c=d(this.viewer);if(t)b=c;else{if(!a&&this.getTotalCountGeometries()>100)return!0;a?b=c:Object.keys(l).forEach(function(a){a!==m&&l[a].objCount&&(b+=l[a].objCount)})}return g.logger.log("Object count? "+b),q<b},i.bruteSearchCurrent=function(a,b,c){var d=function(a){v=!1,b(a),w&&(w(a),w=null)},e=function(){c(),x&&x()};if(m&&!l.hasOwnProperty(m)){r++;var f=n[m]||{};l[m]={geometry:f.data}}v?(w=b,x=c):(v=!0,this.viewer.search(a,d,e,[],!0))},i.bruteSearch=function(a,c){var d=this,e=b(this),f=function(a){var b=a.data;switch(b.operation){case"BRUTE_SEARCH_OK":return b.ended&&d.worker.removeEventListener("message",f),void c(b.str,b.result,b.ended,b.geometry)}},g=function(b){var c={geometry:m,results:b};d.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:c,sharedPropDbKey:z,isSharedPropertyDb:t,geometries:e})},h=function(){d.worker.postMessage({operation:"PROCESS_BRUTE_SEARCH",str:a,results:{geometry:m,results:[]},sharedPropDbKey:z,isSharedPropertyDb:t,geometries:e})};this.worker.addEventListener("message",f),this.bruteSearchCurrent(a,g,h),t||this.worker.postMessage({operation:"BRUTE_SEARCH",str:a,currentGeo:m,geometries:e})},i.highlightText=function(a,b){var c,d,f;return"[object String]"!==Object.prototype.toString.call(a)&&g.logger.error("Error: Non-string sent to highlightText(). Check type, and if correct, convert to String() first."),f=new RegExp("("+e(b)+")","gi"),c=b&&String(a).replace(f,"$1")||String(a),d=p.qsAPI.sanitizeAndHighlightString(c,'<span class="bolder">',"</span>")},i.replaceHtmlCh=function(a){return p.qsAPI.sanitizeAndHighlightString(a)},i.doSearch=function(a,b){var c,d=this,e=function(a){var c=a.data;switch(c.operation){case"SEARCH_RESULT":return c.ended&&(d.worker.removeEventListener("message",e),d.isSearching=!1,g.logger.debug("The last SEARCH_RESULT messgage received for query '"+c.str+"' Ready for another search"),d.searchingString=null),d.searchingStringCb&&(d.searchingStringCb(c.str,c.results,c.ended),c.ended&&(d.searchingStringCb=null)),void b(c.str,c.results,c.ended);case"OLD_SEARCH_RESULT":d.worker.removeEventListener("message",e),d.isSearching=!1;break;default:g.logger.warn("Received unexpected event for "+c.str)}};clearTimeout(d.isSearchingTimer),d.isSearching===!0?a===d.searchingString?d.searchingStringCb=b:d.isSearchingTimer=setTimeout(function(){d.doSearch(a,b)},100):(t&&(c={},Object.keys(l).forEach(function(a){a!==z&&(c[a]={guid:l[a].geometry.guid,name:l[a].geometry.name})})),g.logger.debug("Submitting a new search request for query '"+a+"'"),d.isSearching=!0,d.searchingString=a,d.worker.addEventListener("message",e),d.worker.postMessage({operation:"SEARCH",str:a,isSharedPropertyDb:t,geometries:c}))},i.defaultNodeName=function(){return"Untitled Node"}}(),void 0==CanvasRenderingContext2D.prototype.ellipse&&(CanvasRenderingContext2D.prototype.ellipse=function(a,b,c,d,e,f,g,h){this.save(),this.translate(a,b),this.rotate(e),this.scale(c,d),this.arc(0,0,1,f,g,h),this.restore()}),"function"!=typeof Path2D&&!function(){function a(a){if(this.ops_=[],void 0!=a)if("string"==typeof a)try{this.ops_=parser.parse(a)}catch(a){}else{if(!a.hasOwnProperty("ops_"))throw"Error: "+typeof a+"is not a valid argument to Path";this.ops_=a.ops_.slice(0)}}function b(a){return function(){this.ops_.push({type:a,args:Array.prototype.slice.call(arguments,0)})}}parser=function(){function a(a,b){function c(){this.constructor=a}c.prototype=b.prototype,a.prototype=new c}function b(a,b,c,d,e,f){this.message=a,this.expected=b,this.found=c,this.offset=d,this.line=e,this.column=f,this.name="SyntaxError"}function c(a){function c(b){function c(b,c,d){var e,f;for(e=c;e<d;e++)f=a.charAt(e),"\n"===f?(b.seenCR||b.line++,b.column=1,b.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(b.line++,b.column=1,b.seenCR=!0):(b.column++,b.seenCR=!1)}return ub!==b&&(ub>b&&(ub=0,vb={line:1,column:1,seenCR:!1}),c(vb,ub,b),ub=b),vb}function d(a){sb<wb||(sb>wb&&(wb=sb,xb=[]),xb.push(a))}function e(d,e,f){function g(a){var b=1;for(a.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});b<a.length;)a[b-1]===a[b]?a.splice(b,1):b++}function h(a,b){function c(a){function b(a){return a.charCodeAt(0).toString(16).toUpperCase()}return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(a){return"\\x0"+b(a)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(a){return"\\x"+b(a)}).replace(/[\u0180-\u0FFF]/g,function(a){return"\\u0"+b(a)}).replace(/[\u1080-\uFFFF]/g,function(a){return"\\u"+b(a)})}var d,e,f,g=new Array(a.length);for(f=0;f<a.length;f++)g[f]=a[f].description;return d=a.length>1?g.slice(0,-1).join(", ")+" or "+g[a.length-1]:g[0],e=b?'"'+c(b)+'"':"end of input","Expected "+d+" but "+e+" found."}var i=c(f),j=f<a.length?a.charAt(f):null;return null!==e&&g(e),new b(null!==d?d:h(e,j),e,j,f,i.line,i.column)}function f(){var a,b,c,d,e;for(a=sb,b=[],c=S();c!==la;)b.push(c),c=S();if(b!==la)if(c=g(),c===la&&(c=pa),c!==la){for(d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(tb=a,b=qa(c),a=b):(sb=a,a=oa)}else sb=a,a=oa;else sb=a,a=oa;return a}function g(){var a,b,c,d,e;if(a=sb,b=h(),b!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=g(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function h(){var a,b,c,d,e;if(a=sb,b=k(),b!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=i(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function i(){var a,b,c,d,e;if(a=sb,b=j(),b!==la){for(c=sb,d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(e=i(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function j(){var a;return a=m(),a===la&&(a=n(),a===la&&(a=p(),a===la&&(a=r(),a===la&&(a=s(),a===la&&(a=v(),a===la&&(a=y(),a===la&&(a=B(),a===la&&(a=D())))))))),a}function k(){var b,c,e,f;if(b=sb,ra.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(sa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=l(),f!==la?(tb=b,c=ta(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function l(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=o(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function m(){var b,c;return b=sb,va.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(wa)),c!==la&&(tb=b,c=xa()),b=c}function n(){var b,c,e,f;if(b=sb,ya.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(za)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=o(),f!==la?(tb=b,c=Aa(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function o(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=o(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function p(){var b,c,e,f;if(b=sb,Ba.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Ca)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=q(),f!==la?(tb=b,c=Da(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function q(){var a,b,c,d,e;return a=sb,b=H(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=q(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function r(){var b,c,e,f;if(b=sb,Ea.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Fa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=q(),f!==la?(tb=b,c=Ga(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function s(){var b,c,e,f;if(b=sb,Ha.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Ia)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=t(),f!==la?(tb=b,c=Ja(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function t(){var a,b,c,d,e;return a=sb,b=u(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=t(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function u(){var a,b,c,d,e,f;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(e=L(),e===la&&(e=pa),e!==la?(f=G(),f!==la?(tb=a,b=Ka(b,d,f),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function v(){var b,c,e,f;if(b=sb,La.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Ma)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=w(),f!==la?(tb=b,c=Na(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function w(){var a,b,c,d,e;return a=sb,b=x(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=w(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function x(){var a,b,c,d;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(tb=a,b=Oa(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function y(){var b,c,e,f;if(b=sb,Pa.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Qa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=z(),f!==la?(tb=b,c=Ra(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function z(){var a,b,c,d,e;return a=sb,b=A(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=z(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function A(){var a,b,c,d;return a=sb,b=G(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=G(),d!==la?(tb=a,b=Oa(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function B(){var b,c,e,f;if(b=sb,Sa.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Ta)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=C(),f!==la?(tb=b,c=Ua(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function C(){var a,b,c,d,e;return a=sb,b=G(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=C(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function D(){var b,c,e,f;if(b=sb,Va.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(Wa)),c!==la){for(e=[],f=S();f!==la;)e.push(f),f=S();e!==la?(f=E(),f!==la?(tb=b,c=Xa(c,f),b=c):(sb=b,b=oa)):(sb=b,b=oa)}else sb=b,b=oa;return b}function E(){var a,b,c,d,e;return a=sb,b=F(),b!==la?(c=sb,d=L(),d===la&&(d=pa),d!==la?(e=E(),e!==la?(d=[d,e],c=d):(sb=c,c=oa)):(sb=c,c=oa),c===la&&(c=pa),c!==la?(tb=a,b=ua(b,c),a=b):(sb=a,a=oa)):(sb=a,a=oa),a}function F(){var a,b,c,d,e,f,g,h,i,j,k,l;return a=sb,b=I(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=I(),d!==la?(e=L(),e===la&&(e=pa),e!==la?(f=J(),f!==la?(g=L(),g!==la?(h=K(),h!==la?(i=L(),i===la&&(i=pa),i!==la?(j=K(),j!==la?(k=L(),k===la&&(k=pa),k!==la?(l=G(),l!==la?(tb=a,b=Ya(b,d,f,h,j,l),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function G(){var a,b,c,d;return a=sb,b=H(),b!==la?(c=L(),c===la&&(c=pa),c!==la?(d=H(),d!==la?(tb=a,b=Za(b,d),a=b):(sb=a,a=oa)):(sb=a,a=oa)):(sb=a,a=oa),a}function H(){var a,b;return a=sb,b=J(),b!==la&&(tb=a,b=$a(b)),a=b}function I(){var a;return a=N(),a===la&&(a=R()),a}function J(){var a,b,c;return a=sb,b=Q(),b===la&&(b=pa),b!==la?(c=N(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa),a===la&&(a=sb,b=Q(),b===la&&(b=pa),b!==la?(c=R(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa)),a}function K(){var b;return 48===a.charCodeAt(sb)?(b=_a,sb++):(b=la,0===yb&&d(ab)),b===la&&(49===a.charCodeAt(sb)?(b=bb,sb++):(b=la,0===yb&&d(cb))),b}function L(){var a,b,c,d,e;if(a=sb,b=[],c=S(),c!==la)for(;c!==la;)b.push(c),c=S();else b=oa;if(b!==la)if(c=M(),c===la&&(c=pa),c!==la){for(d=[],e=S();e!==la;)d.push(e),e=S();d!==la?(b=[b,c,d],a=b):(sb=a,a=oa)}else sb=a,a=oa;else sb=a,a=oa;if(a===la)if(a=sb,b=M(),b!==la){for(c=[],d=S();d!==la;)c.push(d),d=S();c!==la?(b=[b,c],a=b):(sb=a,a=oa)}else sb=a,a=oa;return a}function M(){var b;return 44===a.charCodeAt(sb)?(b=db,sb++):(b=la,0===yb&&d(eb)),b}function N(){var a,b,c;return a=sb,b=O(),b!==la?(c=P(),c===la&&(c=pa),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa),a===la&&(a=sb,b=R(),b!==la?(c=P(),c!==la?(b=[b,c],a=b):(sb=a,a=oa)):(sb=a,a=oa)),a}function O(){var b,c,e,f;return b=sb,c=R(),c===la&&(c=pa),c!==la?(46===a.charCodeAt(sb)?(e=fb,sb++):(e=la,0===yb&&d(gb)),e!==la?(f=R(),f!==la?(c=[c,e,f],b=c):(sb=b,b=oa)):(sb=b,b=oa)):(sb=b,b=oa),b===la&&(b=sb,c=R(),c!==la?(46===a.charCodeAt(sb)?(e=fb,sb++):(e=la,0===yb&&d(gb)),e!==la?(c=[c,e],b=c):(sb=b,b=oa)):(sb=b,b=oa)),b}function P(){var b,c,e,f;return b=sb,hb.test(a.charAt(sb))?(c=a.charAt(sb),sb++):(c=la,0===yb&&d(ib)),c!==la?(e=Q(),e===la&&(e=pa),e!==la?(f=R(),f!==la?(c=[c,e,f],b=c):(sb=b,b=oa)):(sb=b,b=oa)):(sb=b,b=oa),b}function Q(){var b;return 43===a.charCodeAt(sb)?(b=jb,sb++):(b=la,0===yb&&d(kb)),b===la&&(45===a.charCodeAt(sb)?(b=lb,sb++):(b=la,0===yb&&d(mb))),b}function R(){var b,c,e;if(b=sb,c=[],nb.test(a.charAt(sb))?(e=a.charAt(sb),sb++):(e=la,0===yb&&d(ob)),e!==la)for(;e!==la;)c.push(e),nb.test(a.charAt(sb))?(e=a.charAt(sb),sb++):(e=la,0===yb&&d(ob));else c=oa;return c!==la&&(tb=b,c=pb(c)),b=c}function S(){var b;return qb.test(a.charAt(sb))?(b=a.charAt(sb),sb++):(b=la,0===yb&&d(rb)),b}function T(a,b){return"mlazhvcsqt".indexOf(a)===-1?zb=b:(zb[0]+=b[0],zb[1]+=b[1]),Db=a,zb.slice(0)}function U(a,b){for(var c=[],d=zb.slice(0),e=0;e<b.length;e+=2){zb=d.slice(0);var f=T(a,b.slice(e,e+2));c=c.concat(f),e==b.length-4&&(Ab=f.slice(0))}return c}function V(){"CcSsQqTt".indexOf(Db)==-1&&(Ab=zb.slice(0));var a=[0,0];return a[0]=2*zb[0]-Ab[0],a[1]=2*zb[1]-Ab[1],a}function W(a,b){var c=[b,0];return"H"==a&&(c[1]=zb[1]),T(a,c)}function X(a,b){var c=[0,b];return"V"==a&&(c[0]=zb[0]),T(a,c)}function Y(a,b){var c=[a];if(b&&b.length>1)for(var d=b[1],e=0;e<d.length;e++)c.push(d[e]);return c}function Z(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))}function $(a,b){return a[0]*b[0]+a[1]*b[1]}function _(a,b){return $(a,b)/(Z(a)*Z(b))}function aa(a,b){var c=1;return a[0]*b[1]-a[1]*b[0]<0&&(c=-1),c*Math.acos(_(a,b))}function ba(a,b){var c=Math.cos(b),d=Math.sin(b);return[c*a[0]+d*a[1],-1*d*a[0]+c*a[1]]}function ca(a,b){var c=Math.cos(b),d=Math.sin(b);return[c*a[0]-d*a[1],d*a[0]+c*a[1]]}function da(a,b){return[(a[0]-b[0])/2,(a[1]-b[1])/2]}function ea(a,b){return[(a[0]+b[0])/2,(a[1]+b[1])/2]}function fa(a,b){return[a[0]*b[0],a[1]*b[1]]}function ga(a,b){return[a*b[0],a*b[1]]}function ha(a,b){return[a[0]+b[0],a[1]+b[1]]}function ia(a,b,c,d,e,f,g){if(0==b||0==c)return void Bb.push({type:"lineTo",args:g});var d=d*(Math.PI/180);b=Math.abs(b),c=Math.abs(c);var h=ba(da(a,g),d),i=fa(h,h),j=Math.pow(b,2),k=Math.pow(c,2),l=Math.sqrt(i[0]/j+i[1]/k);l>1&&(b*=l,c*=l,j=Math.pow(b,2),k=Math.pow(c,2));var m=Math.sqrt((j*k-j*i[1]-k*i[0])/(j*i[1]+k*i[0]));e==f&&(m*=-1);var n=ga(m,[b*h[1]/c,-c*h[0]/b]),o=ha(ca(n,d),ea(a,g)),p=[(h[0]-n[0])/b,(h[1]-n[1])/c],q=[(-1*h[0]-n[0])/b,(-1*h[1]-n[1])/c],r=aa([1,0],p),s=aa(p,q),t=r,u=r+s;Bb.push({type:"save",args:[]},{type:"translate",args:[o[0],o[1]]},{type:"rotate",args:[d]},{type:"scale",args:[b,c]},{type:"arc",args:[0,0,1,t,u,1-f]},{type:"restore",args:[]})}var ja,ka=arguments.length>1?arguments[1]:{},la={},ma={svg_path:f},na=f,oa=la,pa=null,qa=function(a){return Bb},ra=/^[Mm]/,sa={type:"class",value:"[Mm]",description:"[Mm]"},ta=function(a,b){var c=a;Cb&&(c="M",Cb=!1),Bb.push({type:"moveTo",args:T(c,b[0])});for(var d=1;d<b.length;d++)Bb.push({type:"lineTo",args:T(a,b[d])})},ua=function(a,b){return Y(a,b)},va=/^[Zz]/,wa={type:"class",value:"[Zz]",description:"[Zz]"},xa=function(){Bb.push({type:"closePath",args:[]})},ya=/^[Ll]/,za={type:"class",value:"[Ll]",description:"[Ll]"},Aa=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:T(a,b[c])})},Ba=/^[Hh]/,Ca={type:"class",value:"[Hh]",description:"[Hh]"},Da=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:W(a,b[c])})},Ea=/^[Vv]/,Fa={type:"class",value:"[Vv]",description:"[Vv]"},Ga=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"lineTo",args:X(a,b[c])})},Ha=/^[Cc]/,Ia={type:"class",value:"[Cc]",description:"[Cc]"},Ja=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"bezierCurveTo",args:U(a,b[c])})},Ka=function(a,b,c){return a.concat(b,c)},La=/^[Ss]/,Ma={type:"class",value:"[Ss]",description:"[Ss]"},Na=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"bezierCurveTo",args:V().concat(U(a,b[c]))})},Oa=function(a,b){return a.concat(b)},Pa=/^[Qq]/,Qa={type:"class",value:"[Qq]",description:"[Qq]"},Ra=function(a,b){for(var c=0;c<b.length;c++)Bb.push({type:"quadraticCurveTo",args:U(a,b[c])})},Sa=/^[Tt]/,Ta={type:"class",value:"[Tt]",description:"[Tt]"},Ua=function(a,b){for(var c=0;c<b.length;c++){var d=V();Bb.push({type:"quadraticCurveTo",args:d.concat(U(a,b[c]))}),Ab=d.slice(0)}},Va=/^[Aa]/,Wa={type:"class",value:"[Aa]",description:"[Aa]"},Xa=function(a,b){for(var c=0;c<b.length;c++){var d=[zb.slice()],e=[T(a,b[c].slice(-2))];absArgs=d.concat(b[c].slice(0,-2),e),ia.apply(this,absArgs)}},Ya=function(a,b,c,d,e,f){return[parseFloat(a),parseFloat(b),parseFloat(c.join("")),parseInt(d),parseInt(e),f[0],f[1]]},Za=function(a,b){return[a,b]},$a=function(a){return parseFloat(a.join(""))},_a="0",ab={type:"literal",value:"0",description:'"0"'},bb="1",cb={type:"literal",value:"1",description:'"1"'},db=",",eb={type:"literal",value:",",description:'","'},fb=".",gb={type:"literal",value:".",description:'"."'},hb=/^[eE]/,ib={type:"class",value:"[eE]",description:"[eE]"},jb="+",kb={type:"literal",value:"+",description:'"+"'},lb="-",mb={type:"literal",value:"-",description:'"-"'},nb=/^[0-9]/,ob={type:"class",value:"[0-9]",description:"[0-9]"},pb=function(a){return a.join("")},qb=/^[ \t\n\r]/,rb={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},sb=0,tb=0,ub=0,vb={line:1,column:1,seenCR:!1},wb=0,xb=[],yb=0;if("startRule"in ka){if(!(ka.startRule in ma))throw new Error("Can't start parsing from rule \""+ka.startRule+'".');na=ma[ka.startRule]}var zb=[0,0],Ab=[0,0],Bb=[],Cb=!0,Db="";if(ja=na(),ja!==la&&sb===a.length)return ja;throw ja!==la&&sb<a.length&&d({type:"end",description:"end of input"}),e(null,xb,wb)}return a(b,Error),{SyntaxError:b,parse:c}}();for(var c=["closePath","moveTo","lineTo","quadraticCurveTo","bezierCurveTo","rect","arc","arcTo","ellipse","isPointInPath","isPointInStroke"],d=0;d<c.length;d++){var e=c[d];a.prototype[e]=b(e)}a.prototype.addPath=function(a,b){var c=!1;b&&b.hasOwnProperty("a")&&b.hasOwnProperty("b")&&b.hasOwnProperty("c")&&b.hasOwnProperty("d")&&b.hasOwnProperty("e")&&b.hasOwnProperty("f")&&(c=!0,this.ops_.push({type:"save",args:[]}),this.ops_.push({type:"transform",args:[b.a,b.b,b.c,b.d,b.e,b.f]})),this.ops_=this.ops_.concat(a.ops_),c&&this.ops_.push({type:"restore",args:[]})},original_fill=CanvasRenderingContext2D.prototype.fill,original_stroke=CanvasRenderingContext2D.prototype.stroke,original_clip=CanvasRenderingContext2D.prototype.clip,original_is_point_in_path=CanvasRenderingContext2D.prototype.isPointInPath,original_is_point_in_stroke=CanvasRenderingContext2D.prototype.isPointInStroke,CanvasRenderingContext2D.prototype.fill=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_fill.apply(this,Array.prototype.slice.call(arguments,1))}else original_fill.apply(this,arguments)},CanvasRenderingContext2D.prototype.stroke=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_stroke.call(this)}else original_stroke.call(this)},CanvasRenderingContext2D.prototype.clip=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}original_clip.apply(this,Array.prototype.slice.call(arguments,1))}else original_clip.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInPath=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}return original_is_point_in_path.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_path.apply(this,arguments)},CanvasRenderingContext2D.prototype.isPointInStroke=function(b){if(b instanceof a){this.beginPath();for(var c=0,d=b.ops_.length;c<d;c++){var e=b.ops_[c];CanvasRenderingContext2D.prototype[e.type].apply(this,e.args)}return original_is_point_in_stroke.apply(this,Array.prototype.slice.call(arguments,1))}return original_is_point_in_stroke.apply(this,arguments)},Path2D=a}();